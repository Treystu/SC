{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/AutoLink.ts","mappings":";AAAA;;;;;;;GAOG;;;AAuBH,MAAa,QAAQ;IAInB,YAAY,QAAsB,EAAE,aAA6B;QAC/D,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;IACrC,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,oBAAoB,CACxB,MAAqB,EACrB,eAAuB,EACvB,kBAA8B,EAC9B,aAAsB;QAEtB,8CAA8C;QAC9C,MAAM,OAAO,GAAY;YACvB,MAAM,EAAE,MAAM,CAAC,aAAa;YAC5B,SAAS,EAAE,MAAM,CAAC,gBAAgB;YAClC,IAAI,EAAE,MAAM,CAAC,WAAW;YACxB,QAAQ,EAAE,QAAQ;YAClB,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE;YACnB,QAAQ,EAAE,IAAI,EAAE,yCAAyC;SAC1D,CAAC;QAEF,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAEjC,+EAA+E;QAC/E,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,MAAM,OAAO,GAAoB;gBAC/B,IAAI,EAAE,iBAAiB;gBACvB,eAAe;gBACf,kBAAkB;gBAClB,aAAa;gBACb,UAAU,EAAE,MAAM,CAAC,IAAI;gBACvB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;aACtB,CAAC;YAEF,IAAI,CAAC;gBACH,MAAM,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,MAAM,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;YACrE,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,oFAAoF;gBACpF,OAAO,CAAC,IAAI,CAAC,gDAAgD,EAAE,KAAK,CAAC,CAAC;YACxE,CAAC;QACH,CAAC;IACH,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,sBAAsB,CAAC,OAAwB;QACnD,uCAAuC;QACvC,MAAM,eAAe,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QAEzE,IAAI,eAAe,EAAE,CAAC;YACpB,+CAA+C;YAC/C,OAAO;QACT,CAAC;QAED,8CAA8C;QAC9C,MAAM,OAAO,GAAY;YACvB,MAAM,EAAE,OAAO,CAAC,eAAe;YAC/B,SAAS,EAAE,OAAO,CAAC,kBAAkB;YACrC,IAAI,EAAE,OAAO,CAAC,aAAa;YAC3B,QAAQ,EAAE,QAAQ;YAClB,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE;YACnB,QAAQ,EAAE,IAAI;SACf,CAAC;QAEF,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IACnC,CAAC;CACF;AA3ED,4BA2EC","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/AutoLink.ts"],"sourcesContent":["/**\n * AutoLink - Automatically establishes bidirectional connections between peers\n * \n * When an invite is redeemed, this system:\n * 1. Adds the inviter to the recipient's contacts\n * 2. Notifies the inviter that their invite was accepted\n * 3. Establishes a trusted connection between both parties\n */\n\nimport { PendingInvite, Contact } from './types.js';\n\nexport interface AutoLinkMessage {\n  type: 'INVITE_ACCEPTED';\n  recipientPeerId: string;\n  recipientPublicKey: Uint8Array;\n  recipientName?: string;\n  inviteCode: string;\n  timestamp: number;\n}\n\nexport interface ContactStore {\n  add(contact: Contact): Promise<void>;\n  get(peerId: string): Promise<Contact | null>;\n  has(peerId: string): Promise<boolean>;\n}\n\nexport interface MessageSender {\n  sendToPeer(peerId: string, message: AutoLinkMessage): Promise<void>;\n}\n\nexport class AutoLink {\n  private contacts: ContactStore;\n  private messageSender?: MessageSender;\n\n  constructor(contacts: ContactStore, messageSender?: MessageSender) {\n    this.contacts = contacts;\n    this.messageSender = messageSender;\n  }\n\n  /**\n   * Create an automatic connection when an invite is redeemed\n   */\n  async createAutoConnection(\n    invite: PendingInvite,\n    recipientPeerId: string,\n    recipientPublicKey: Uint8Array,\n    recipientName?: string\n  ): Promise<void> {\n    // Add the inviter to the recipient's contacts\n    const contact: Contact = {\n      peerId: invite.inviterPeerId,\n      publicKey: invite.inviterPublicKey,\n      name: invite.inviterName,\n      addedVia: 'invite',\n      addedAt: Date.now(),\n      verified: true, // Auto-verified through invite signature\n    };\n\n    await this.contacts.add(contact);\n\n    // Send acceptance notification to the inviter (if message sender is available)\n    if (this.messageSender) {\n      const message: AutoLinkMessage = {\n        type: 'INVITE_ACCEPTED',\n        recipientPeerId,\n        recipientPublicKey,\n        recipientName,\n        inviteCode: invite.code,\n        timestamp: Date.now(),\n      };\n\n      try {\n        await this.messageSender.sendToPeer(invite.inviterPeerId, message);\n      } catch (error) {\n        // Log but don't fail - the inviter will discover the connection through other means\n        console.warn('Failed to send invite acceptance notification:', error);\n      }\n    }\n  }\n\n  /**\n   * Handle an invite acceptance message\n   * This is called on the inviter's side when someone redeems their invite\n   */\n  async handleInviteAcceptance(message: AutoLinkMessage): Promise<void> {\n    // Check if this contact already exists\n    const existingContact = await this.contacts.get(message.recipientPeerId);\n    \n    if (existingContact) {\n      // Contact already exists, no need to add again\n      return;\n    }\n\n    // Add the recipient to the inviter's contacts\n    const contact: Contact = {\n      peerId: message.recipientPeerId,\n      publicKey: message.recipientPublicKey,\n      name: message.recipientName,\n      addedVia: 'invite',\n      addedAt: Date.now(),\n      verified: true,\n    };\n\n    await this.contacts.add(contact);\n  }\n}\n"],"version":3}