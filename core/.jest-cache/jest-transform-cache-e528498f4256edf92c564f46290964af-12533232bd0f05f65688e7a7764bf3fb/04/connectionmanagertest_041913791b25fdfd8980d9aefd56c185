c82a0f5ff49d9bae725c68a1f94aaf72
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const connection_manager_1 = require("./connection-manager");
describe('ConnectionManager', () => {
    let manager;
    beforeEach(() => {
        manager = new connection_manager_1.ConnectionManager();
    });
    afterEach(() => {
        manager.cleanup();
    });
    describe('Basic Connection Management', () => {
        it('should add a connection', () => {
            manager.addConnection('peer1', 'webrtc');
            const connection = manager.getConnection('peer1');
            expect(connection).toBeDefined();
            expect(connection?.type).toBe('webrtc');
            expect(connection?.status).toBe('connecting');
        });
        it('should get all connections', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.addConnection('peer2', 'ble');
            const connections = manager.getAllConnections();
            expect(connections.length).toBe(2);
        });
        it('should remove a connection', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.removeConnection('peer1');
            const connection = manager.getConnection('peer1');
            expect(connection).toBeUndefined();
        });
    });
    describe('Connection Status', () => {
        it('should update connection status', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.updateConnectionStatus('peer1', 'connected');
            const connection = manager.getConnection('peer1');
            expect(connection?.status).toBe('connected');
        });
        it('should get connected peers', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.addConnection('peer2', 'ble');
            manager.updateConnectionStatus('peer1', 'connected');
            const connected = manager.getConnectedPeers();
            expect(connected.length).toBe(1);
            expect(connected[0].id).toBe('peer1');
        });
    });
    describe('Connection Metrics', () => {
        it('should update connection metrics', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.updateConnectionMetrics('peer1', {
                quality: 0.9,
                latency: 50,
                bandwidth: { upload: 1000, download: 2000 }
            });
            const connection = manager.getConnection('peer1');
            expect(connection?.quality).toBe(0.9);
            expect(connection?.latency).toBe(50);
            expect(connection?.bandwidth).toEqual({ upload: 1000, download: 2000 });
        });
        it('should partially update metrics', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.updateConnectionMetrics('peer1', { quality: 0.8 });
            const connection = manager.getConnection('peer1');
            expect(connection?.quality).toBe(0.8);
        });
    });
    describe('Best Connection Selection', () => {
        it('should return null when no connections are available', () => {
            const best = manager.getBestConnection();
            expect(best).toBeNull();
        });
        it('should return null when no connections are connected', () => {
            manager.addConnection('peer1', 'webrtc');
            const best = manager.getBestConnection();
            expect(best).toBeNull();
        });
        it('should return the best connected peer', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.addConnection('peer2', 'ble');
            manager.updateConnectionStatus('peer1', 'connected');
            manager.updateConnectionStatus('peer2', 'connected');
            manager.updateConnectionMetrics('peer1', { quality: 0.7 });
            manager.updateConnectionMetrics('peer2', { quality: 0.9 });
            const best = manager.getBestConnection();
            expect(best?.id).toBe('peer2');
        });
    });
    describe('Statistics', () => {
        it('should return statistics with no connections', () => {
            const stats = manager.getStatistics();
            expect(stats.total).toBe(0);
            expect(stats.connected).toBe(0);
        });
        it('should return accurate connection statistics', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.addConnection('peer2', 'ble');
            manager.updateConnectionStatus('peer1', 'connected');
            const stats = manager.getStatistics();
            expect(stats.total).toBe(2);
            expect(stats.connected).toBe(1);
            expect(stats.connecting).toBe(1);
        });
        it('should calculate average quality and latency', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.addConnection('peer2', 'ble');
            manager.updateConnectionStatus('peer1', 'connected');
            manager.updateConnectionStatus('peer2', 'connected');
            manager.updateConnectionMetrics('peer1', { quality: 0.8, latency: 50 });
            manager.updateConnectionMetrics('peer2', { quality: 1.0, latency: 30 });
            const stats = manager.getStatistics();
            expect(stats.avgQuality).toBe(0.9);
            expect(stats.avgLatency).toBe(40);
        });
    });
    describe('Configuration', () => {
        it('should use default configuration', () => {
            const defaultManager = new connection_manager_1.ConnectionManager();
            expect(defaultManager).toBeDefined();
            defaultManager.cleanup();
        });
        it('should use custom configuration', () => {
            const customManager = new connection_manager_1.ConnectionManager({
                maxPeers: 100,
                reconnectInterval: 10000,
                connectionTimeout: 60000,
                keepAliveInterval: 20000
            });
            expect(customManager).toBeDefined();
            customManager.cleanup();
        });
    });
    describe('Cleanup', () => {
        it('should cleanup all connections', () => {
            manager.addConnection('peer1', 'webrtc');
            manager.addConnection('peer2', 'ble');
            manager.cleanup();
            const connections = manager.getAllConnections();
            expect(connections.length).toBe(0);
        });
        it('should be safe to call cleanup multiple times', () => {
            manager.addConnection('peer1', 'webrtc');
            expect(() => {
                manager.cleanup();
                manager.cleanup();
            }).not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29ubmVjdGlvbi1tYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2REFBeUQ7QUFFekQsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLE9BQTBCLENBQUM7SUFFL0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLE9BQU8sR0FBRyxJQUFJLHNDQUFpQixFQUFFLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtRQUMzQyxFQUFFLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1lBQ2pDLE9BQU8sQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRXpDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDbEQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2pDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtZQUNwQyxPQUFPLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUN6QyxPQUFPLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV0QyxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsaUJBQWlC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LENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29ubmVjdGlvbi1tYW5hZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29ubmVjdGlvbk1hbmFnZXIgfSBmcm9tICcuL2Nvbm5lY3Rpb24tbWFuYWdlcic7XG5cbmRlc2NyaWJlKCdDb25uZWN0aW9uTWFuYWdlcicsICgpID0+IHtcbiAgbGV0IG1hbmFnZXI6IENvbm5lY3Rpb25NYW5hZ2VyO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIG1hbmFnZXIgPSBuZXcgQ29ubmVjdGlvbk1hbmFnZXIoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBtYW5hZ2VyLmNsZWFudXAoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Jhc2ljIENvbm5lY3Rpb24gTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFkZCBhIGNvbm5lY3Rpb24nLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgXG4gICAgICBjb25zdCBjb25uZWN0aW9uID0gbWFuYWdlci5nZXRDb25uZWN0aW9uKCdwZWVyMScpO1xuICAgICAgZXhwZWN0KGNvbm5lY3Rpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY29ubmVjdGlvbj8udHlwZSkudG9CZSgnd2VicnRjJyk7XG4gICAgICBleHBlY3QoY29ubmVjdGlvbj8uc3RhdHVzKS50b0JlKCdjb25uZWN0aW5nJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBhbGwgY29ubmVjdGlvbnMnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgbWFuYWdlci5hZGRDb25uZWN0aW9uKCdwZWVyMicsICdibGUnKTtcbiAgICAgIFxuICAgICAgY29uc3QgY29ubmVjdGlvbnMgPSBtYW5hZ2VyLmdldEFsbENvbm5lY3Rpb25zKCk7XG4gICAgICBleHBlY3QoY29ubmVjdGlvbnMubGVuZ3RoKS50b0JlKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgYSBjb25uZWN0aW9uJywgKCkgPT4ge1xuICAgICAgbWFuYWdlci5hZGRDb25uZWN0aW9uKCdwZWVyMScsICd3ZWJydGMnKTtcbiAgICAgIG1hbmFnZXIucmVtb3ZlQ29ubmVjdGlvbigncGVlcjEnKTtcbiAgICAgIFxuICAgICAgY29uc3QgY29ubmVjdGlvbiA9IG1hbmFnZXIuZ2V0Q29ubmVjdGlvbigncGVlcjEnKTtcbiAgICAgIGV4cGVjdChjb25uZWN0aW9uKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25uZWN0aW9uIFN0YXR1cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBjb25uZWN0aW9uIHN0YXR1cycsICgpID0+IHtcbiAgICAgIG1hbmFnZXIuYWRkQ29ubmVjdGlvbigncGVlcjEnLCAnd2VicnRjJyk7XG4gICAgICBtYW5hZ2VyLnVwZGF0ZUNvbm5lY3Rpb25TdGF0dXMoJ3BlZXIxJywgJ2Nvbm5lY3RlZCcpO1xuICAgICAgXG4gICAgICBjb25zdCBjb25uZWN0aW9uID0gbWFuYWdlci5nZXRDb25uZWN0aW9uKCdwZWVyMScpO1xuICAgICAgZXhwZWN0KGNvbm5lY3Rpb24/LnN0YXR1cykudG9CZSgnY29ubmVjdGVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBjb25uZWN0ZWQgcGVlcnMnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgbWFuYWdlci5hZGRDb25uZWN0aW9uKCdwZWVyMicsICdibGUnKTtcbiAgICAgIG1hbmFnZXIudXBkYXRlQ29ubmVjdGlvblN0YXR1cygncGVlcjEnLCAnY29ubmVjdGVkJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvbm5lY3RlZCA9IG1hbmFnZXIuZ2V0Q29ubmVjdGVkUGVlcnMoKTtcbiAgICAgIGV4cGVjdChjb25uZWN0ZWQubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KGNvbm5lY3RlZFswXS5pZCkudG9CZSgncGVlcjEnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Nvbm5lY3Rpb24gTWV0cmljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBjb25uZWN0aW9uIG1ldHJpY3MnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgbWFuYWdlci51cGRhdGVDb25uZWN0aW9uTWV0cmljcygncGVlcjEnLCB7XG4gICAgICAgIHF1YWxpdHk6IDAuOSxcbiAgICAgICAgbGF0ZW5jeTogNTAsXG4gICAgICAgIGJhbmR3aWR0aDogeyB1cGxvYWQ6IDEwMDAsIGRvd25sb2FkOiAyMDAwIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb25uZWN0aW9uID0gbWFuYWdlci5nZXRDb25uZWN0aW9uKCdwZWVyMScpO1xuICAgICAgZXhwZWN0KGNvbm5lY3Rpb24/LnF1YWxpdHkpLnRvQmUoMC45KTtcbiAgICAgIGV4cGVjdChjb25uZWN0aW9uPy5sYXRlbmN5KS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdChjb25uZWN0aW9uPy5iYW5kd2lkdGgpLnRvRXF1YWwoeyB1cGxvYWQ6IDEwMDAsIGRvd25sb2FkOiAyMDAwIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXJ0aWFsbHkgdXBkYXRlIG1ldHJpY3MnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgbWFuYWdlci51cGRhdGVDb25uZWN0aW9uTWV0cmljcygncGVlcjEnLCB7IHF1YWxpdHk6IDAuOCB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY29ubmVjdGlvbiA9IG1hbmFnZXIuZ2V0Q29ubmVjdGlvbigncGVlcjEnKTtcbiAgICAgIGV4cGVjdChjb25uZWN0aW9uPy5xdWFsaXR5KS50b0JlKDAuOCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCZXN0IENvbm5lY3Rpb24gU2VsZWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBubyBjb25uZWN0aW9ucyBhcmUgYXZhaWxhYmxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYmVzdCA9IG1hbmFnZXIuZ2V0QmVzdENvbm5lY3Rpb24oKTtcbiAgICAgIGV4cGVjdChiZXN0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIG5vIGNvbm5lY3Rpb25zIGFyZSBjb25uZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgY29uc3QgYmVzdCA9IG1hbmFnZXIuZ2V0QmVzdENvbm5lY3Rpb24oKTtcbiAgICAgIGV4cGVjdChiZXN0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGJlc3QgY29ubmVjdGVkIHBlZXInLCAoKSA9PiB7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIxJywgJ3dlYnJ0YycpO1xuICAgICAgbWFuYWdlci5hZGRDb25uZWN0aW9uKCdwZWVyMicsICdibGUnKTtcbiAgICAgIFxuICAgICAgbWFuYWdlci51cGRhdGVDb25uZWN0aW9uU3RhdHVzKCdwZWVyMScsICdjb25uZWN0ZWQnKTtcbiAgICAgIG1hbmFnZXIudXBkYXRlQ29ubmVjdGlvblN0YXR1cygncGVlcjInLCAnY29ubmVjdGVkJyk7XG4gICAgICBcbiAgICAgIG1hbmFnZXIudXBkYXRlQ29ubmVjdGlvbk1ldHJpY3MoJ3BlZXIxJywgeyBxdWFsaXR5OiAwLjcgfSk7XG4gICAgICBtYW5hZ2VyLnVwZGF0ZUNvbm5lY3Rpb25NZXRyaWNzKCdwZWVyMicsIHsgcXVhbGl0eTogMC45IH0pO1xuICAgICAgXG4gICAgICBjb25zdCBiZXN0ID0gbWFuYWdlci5nZXRCZXN0Q29ubmVjdGlvbigpO1xuICAgICAgZXhwZWN0KGJlc3Q/LmlkKS50b0JlKCdwZWVyMicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3RhdGlzdGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBzdGF0aXN0aWNzIHdpdGggbm8gY29ubmVjdGlvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0cyA9IG1hbmFnZXIuZ2V0U3RhdGlzdGljcygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWwpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuY29ubmVjdGVkKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYWNjdXJhdGUgY29ubmVjdGlvbiBzdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgICAgbWFuYWdlci5hZGRDb25uZWN0aW9uKCdwZWVyMScsICd3ZWJydGMnKTtcbiAgICAgIG1hbmFnZXIuYWRkQ29ubmVjdGlvbigncGVlcjInLCAnYmxlJyk7XG4gICAgICBtYW5hZ2VyLnVwZGF0ZUNvbm5lY3Rpb25TdGF0dXMoJ3BlZXIxJywgJ2Nvbm5lY3RlZCcpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IG1hbmFnZXIuZ2V0U3RhdGlzdGljcygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbm5lY3RlZCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5jb25uZWN0aW5nKS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgYXZlcmFnZSBxdWFsaXR5IGFuZCBsYXRlbmN5JywgKCkgPT4ge1xuICAgICAgbWFuYWdlci5hZGRDb25uZWN0aW9uKCdwZWVyMScsICd3ZWJydGMnKTtcbiAgICAgIG1hbmFnZXIuYWRkQ29ubmVjdGlvbigncGVlcjInLCAnYmxlJyk7XG4gICAgICBcbiAgICAgIG1hbmFnZXIudXBkYXRlQ29ubmVjdGlvblN0YXR1cygncGVlcjEnLCAnY29ubmVjdGVkJyk7XG4gICAgICBtYW5hZ2VyLnVwZGF0ZUNvbm5lY3Rpb25TdGF0dXMoJ3BlZXIyJywgJ2Nvbm5lY3RlZCcpO1xuICAgICAgXG4gICAgICBtYW5hZ2VyLnVwZGF0ZUNvbm5lY3Rpb25NZXRyaWNzKCdwZWVyMScsIHsgcXVhbGl0eTogMC44LCBsYXRlbmN5OiA1MCB9KTtcbiAgICAgIG1hbmFnZXIudXBkYXRlQ29ubmVjdGlvbk1ldHJpY3MoJ3BlZXIyJywgeyBxdWFsaXR5OiAxLjAsIGxhdGVuY3k6IDMwIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IG1hbmFnZXIuZ2V0U3RhdGlzdGljcygpO1xuICAgICAgZXhwZWN0KHN0YXRzLmF2Z1F1YWxpdHkpLnRvQmUoMC45KTtcbiAgICAgIGV4cGVjdChzdGF0cy5hdmdMYXRlbmN5KS50b0JlKDQwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGVmYXVsdE1hbmFnZXIgPSBuZXcgQ29ubmVjdGlvbk1hbmFnZXIoKTtcbiAgICAgIGV4cGVjdChkZWZhdWx0TWFuYWdlcikudG9CZURlZmluZWQoKTtcbiAgICAgIGRlZmF1bHRNYW5hZ2VyLmNsZWFudXAoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGN1c3RvbSBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tTWFuYWdlciA9IG5ldyBDb25uZWN0aW9uTWFuYWdlcih7XG4gICAgICAgIG1heFBlZXJzOiAxMDAsXG4gICAgICAgIHJlY29ubmVjdEludGVydmFsOiAxMDAwMCxcbiAgICAgICAgY29ubmVjdGlvblRpbWVvdXQ6IDYwMDAwLFxuICAgICAgICBrZWVwQWxpdmVJbnRlcnZhbDogMjAwMDBcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGN1c3RvbU1hbmFnZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBjdXN0b21NYW5hZ2VyLmNsZWFudXAoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NsZWFudXAnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjbGVhbnVwIGFsbCBjb25uZWN0aW9ucycsICgpID0+IHtcbiAgICAgIG1hbmFnZXIuYWRkQ29ubmVjdGlvbigncGVlcjEnLCAnd2VicnRjJyk7XG4gICAgICBtYW5hZ2VyLmFkZENvbm5lY3Rpb24oJ3BlZXIyJywgJ2JsZScpO1xuICAgICAgXG4gICAgICBtYW5hZ2VyLmNsZWFudXAoKTtcbiAgICAgIFxuICAgICAgY29uc3QgY29ubmVjdGlvbnMgPSBtYW5hZ2VyLmdldEFsbENvbm5lY3Rpb25zKCk7XG4gICAgICBleHBlY3QoY29ubmVjdGlvbnMubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBzYWZlIHRvIGNhbGwgY2xlYW51cCBtdWx0aXBsZSB0aW1lcycsICgpID0+IHtcbiAgICAgIG1hbmFnZXIuYWRkQ29ubmVjdGlvbigncGVlcjEnLCAnd2VicnRjJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIG1hbmFnZXIuY2xlYW51cCgpO1xuICAgICAgICBtYW5hZ2VyLmNsZWFudXAoKTtcbiAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=