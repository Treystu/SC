{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/storage/blob-store.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/storage/blob-store.test.ts"],"sourcesContent":["import { BlobStore, IndexedDBBlobAdapter } from \"./blob-store\";\n\ndescribe(\"BlobStore\", () => {\n  let blobStore: BlobStore;\n\n  beforeEach(() => {\n    blobStore = new BlobStore();\n  });\n\n  it(\"should store a blob and return its hash\", async () => {\n    const data = new Uint8Array([1, 2, 3, 4]);\n    const hash = await blobStore.put(data);\n\n    // sha256 of [1,2,3,4]\n    // 9f64a747e1b97f131fabb6b447296c9b6f0201e79fb3c5356e6c77e89b6a806a\n    expect(typeof hash).toBe(\"string\");\n    expect(hash.length).toBe(64);\n    expect(await blobStore.has(hash)).toBe(true);\n  });\n\n  it(\"should retrieve a stored blob\", async () => {\n    const data = new Uint8Array([5, 6, 7, 8]);\n    const hash = await blobStore.put(data);\n\n    const retrieved = await blobStore.get(hash);\n    expect(retrieved).toEqual(data);\n  });\n\n  it(\"should return null for non-existent blob\", async () => {\n    const retrieved = await blobStore.get(\"non-existent\");\n    expect(retrieved).toBeUndefined();\n  });\n\n  it(\"should return false for has() if blob does not exist\", async () => {\n    expect(await blobStore.has(\"non-existent\")).toBe(false);\n  });\n\n  describe(\"with persistence adapter\", () => {\n    let blobStore: BlobStore;\n    let mockAdapter: jest.Mocked<IndexedDBBlobAdapter>;\n\n    beforeEach(async () => {\n      mockAdapter = {\n        dbName: 'testDb',\n        storeName: 'testStore',\n        db: null,\n        version: 1,\n        init: jest.fn().mockResolvedValue(undefined),\n        put: jest.fn().mockResolvedValue(undefined),\n        get: jest.fn().mockResolvedValue(null),\n        has: jest.fn().mockResolvedValue(false),\n        delete: jest.fn().mockResolvedValue(undefined),\n        clear: jest.fn().mockResolvedValue(undefined),\n        getAll: jest.fn().mockResolvedValue(new Map()),\n        getSize: jest.fn().mockResolvedValue(0),\n        ensureInit: jest.fn().mockResolvedValue(undefined)\n      } as any;\n      \n      blobStore = new BlobStore(mockAdapter);\n    });\n\n    it(\"should store data using persistence adapter\", async () => {\n      const data = new Uint8Array([1, 2, 3, 4]);\n      \n      const hash = await blobStore.put(data);\n      \n      expect(mockAdapter.put).toHaveBeenCalledWith(hash, data);\n      expect(hash).toBe(\"9f64a747e1b97f131fabb6b447296c9b6f0201e79fb3c5356e6c77e89b6a806a\");\n    });\n\n    it(\"should retrieve from persistence when not in memory\", async () => {\n      const data = new Uint8Array([5, 6, 7, 8]);\n      const hash = \"05060708\";\n      \n      // Mock persistence hit\n      mockAdapter.get.mockResolvedValue(data);\n      \n      const result = await blobStore.get(hash);\n      \n      expect(mockAdapter.get).toHaveBeenCalledWith(hash);\n      expect(result).toEqual(data);\n    });\n\n    it(\"should check persistence for data existence\", async () => {\n      const hash = \"testhash\";\n      \n      // Mock persistence hit\n      mockAdapter.has.mockResolvedValue(true);\n      \n      const exists = await blobStore.has(hash);\n      \n      expect(mockAdapter.has).toHaveBeenCalledWith(hash);\n      expect(exists).toBe(true);\n    });\n  });\n});\n"],"version":3}