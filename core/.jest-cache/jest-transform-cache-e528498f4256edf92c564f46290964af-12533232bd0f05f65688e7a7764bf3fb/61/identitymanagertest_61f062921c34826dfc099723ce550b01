4c497cd039556ebc90c067ac6103d2a0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const identity_manager_1 = require("./identity-manager");
// Mock localStorage for Node.js environment
const localStorageMock = (() => {
    let store = {};
    return {
        getItem: (key) => store[key] || null,
        setItem: (key, value) => { store[key] = value; },
        removeItem: (key) => { delete store[key]; },
        clear: () => { store = {}; }
    };
})();
global.localStorage = localStorageMock;
(0, globals_1.describe)('IdentityManager', () => {
    let manager;
    (0, globals_1.beforeEach)(() => {
        localStorage.clear();
        manager = new identity_manager_1.IdentityManager();
    });
    (0, globals_1.describe)('Identity Generation', () => {
        (0, globals_1.it)('should generate new identity', async () => {
            const identity = await manager.generateIdentity();
            (0, globals_1.expect)(identity).toBeDefined();
            (0, globals_1.expect)(identity.id).toBeDefined();
            (0, globals_1.expect)(identity.publicKey).toBeDefined();
            (0, globals_1.expect)(identity.privateKey).toBeDefined();
            (0, globals_1.expect)(identity.created).toBeInstanceOf(Date);
        });
        (0, globals_1.it)('should generate identity with display name', async () => {
            const identity = await manager.generateIdentity('Alice');
            (0, globals_1.expect)(identity.displayName).toBe('Alice');
        });
        (0, globals_1.it)('should generate unique IDs', async () => {
            const identity1 = await manager.generateIdentity();
            const manager2 = new identity_manager_1.IdentityManager();
            const identity2 = await manager2.generateIdentity();
            (0, globals_1.expect)(identity1.id).not.toBe(identity2.id);
        });
        (0, globals_1.it)('should use Ed25519 keys', async () => {
            const identity = await manager.generateIdentity();
            (0, globals_1.expect)(identity.publicKey.algorithm.name).toBe('Ed25519');
            (0, globals_1.expect)(identity.privateKey.algorithm.name).toBe('Ed25519');
        });
    });
    (0, globals_1.describe)('Identity Persistence', () => {
        (0, globals_1.it)('should save identity to storage', async () => {
            const identity = await manager.generateIdentity('Bob');
            // generateIdentity automatically saves, so we just need to load it back
            const loaded = await manager.loadIdentity();
            (0, globals_1.expect)(loaded).toBeDefined();
            (0, globals_1.expect)(loaded?.id).toBe(identity.id);
        });
        (0, globals_1.it)('should load identity from storage', async () => {
            await manager.generateIdentity('Charlie');
            // generateIdentity automatically saves
            const newManager = new identity_manager_1.IdentityManager();
            const loaded = await newManager.loadIdentity();
            (0, globals_1.expect)(loaded).toBeDefined();
            (0, globals_1.expect)(loaded?.displayName).toBe('Charlie');
        });
        (0, globals_1.it)('should return null when no identity exists', async () => {
            const loaded = await manager.loadIdentity();
            (0, globals_1.expect)(loaded).toBeNull();
        });
        (0, globals_1.it)('should delete identity from storage', async () => {
            await manager.generateIdentity();
            // generateIdentity automatically saves
            await manager.deleteIdentity();
            const loaded = await manager.loadIdentity();
            (0, globals_1.expect)(loaded).toBeNull();
        });
    });
    (0, globals_1.describe)('Identity Export/Import', () => {
        (0, globals_1.it)('should export identity to JWK format', async () => {
            const identity = await manager.generateIdentity('Dave');
            const exported = await manager.exportIdentity();
            (0, globals_1.expect)(exported).toBeDefined();
            (0, globals_1.expect)(exported.id).toBe(identity.id);
            (0, globals_1.expect)(exported.publicKeyJwk).toBeDefined();
            (0, globals_1.expect)(exported.privateKeyJwk).toBeDefined();
            (0, globals_1.expect)(exported.displayName).toBe('Dave');
        });
        (0, globals_1.it)('should import identity from JWK format', async () => {
            const original = await manager.generateIdentity('Eve');
            const exported = await manager.exportIdentity();
            const newManager = new identity_manager_1.IdentityManager();
            const imported = await newManager.importIdentity(exported);
            (0, globals_1.expect)(imported.id).toBe(original.id);
            (0, globals_1.expect)(imported.displayName).toBe(original.displayName);
        });
        (0, globals_1.it)('should preserve key material on export/import', async () => {
            await manager.generateIdentity();
            const exported = await manager.exportIdentity();
            const newManager = new identity_manager_1.IdentityManager();
            const imported = await newManager.importIdentity(exported);
            // Verify keys can still be used for signing
            const data = new Uint8Array([1, 2, 3]);
            const signature = await crypto.subtle.sign('Ed25519', imported.privateKey, data);
            const verified = await crypto.subtle.verify('Ed25519', imported.publicKey, signature, data);
            (0, globals_1.expect)(verified).toBe(true);
        });
    });
    (0, globals_1.describe)('Public Key Operations', () => {
        (0, globals_1.it)('should get public key', async () => {
            await manager.generateIdentity();
            const publicKey = await manager.getPublicKey();
            (0, globals_1.expect)(publicKey).toBeDefined();
            (0, globals_1.expect)(publicKey.type).toBe('public');
        });
        (0, globals_1.it)('should export public key as bytes', async () => {
            await manager.generateIdentity();
            const publicKeyBytes = await manager.getPublicKeyBytes();
            (0, globals_1.expect)(publicKeyBytes).toBeInstanceOf(Uint8Array);
            (0, globals_1.expect)(publicKeyBytes.length).toBeGreaterThan(0);
        });
        (0, globals_1.it)('should export public key as hex string', async () => {
            await manager.generateIdentity();
            const publicKeyHex = await manager.getPublicKeyHex();
            (0, globals_1.expect)(typeof publicKeyHex).toBe('string');
            (0, globals_1.expect)(publicKeyHex.length).toBeGreaterThan(0);
            (0, globals_1.expect)(/^[0-9a-f]+$/i.test(publicKeyHex)).toBe(true);
        });
    });
    (0, globals_1.describe)('Identity Verification', () => {
        (0, globals_1.it)('should verify identity has keys', async () => {
            await manager.generateIdentity();
            const hasIdentity = manager.hasIdentity();
            (0, globals_1.expect)(hasIdentity).toBe(true);
        });
        (0, globals_1.it)('should return false when no identity', () => {
            const hasIdentity = manager.hasIdentity();
            (0, globals_1.expect)(hasIdentity).toBe(false);
        });
        (0, globals_1.it)('should get current identity', async () => {
            const generated = await manager.generateIdentity('Frank');
            const current = manager.getCurrentIdentity();
            (0, globals_1.expect)(current).toBeDefined();
            (0, globals_1.expect)(current?.id).toBe(generated.id);
        });
        (0, globals_1.it)('should return null for current identity when none exists', () => {
            const current = manager.getCurrentIdentity();
            (0, globals_1.expect)(current).toBeNull();
        });
    });
    (0, globals_1.describe)('Signing Operations', () => {
        (0, globals_1.it)('should sign data with private key', async () => {
            await manager.generateIdentity();
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            const signature = await manager.sign(data);
            (0, globals_1.expect)(signature).toBeInstanceOf(Uint8Array);
            (0, globals_1.expect)(signature.length).toBeGreaterThan(0);
        });
        (0, globals_1.it)('should verify signature with public key', async () => {
            await manager.generateIdentity();
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            const signature = await manager.sign(data);
            const verified = await manager.verify(data, signature);
            (0, globals_1.expect)(verified).toBe(true);
        });
        (0, globals_1.it)('should reject invalid signature', async () => {
            await manager.generateIdentity();
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            const wrongSignature = new Uint8Array(64);
            const verified = await manager.verify(data, wrongSignature);
            (0, globals_1.expect)(verified).toBe(false);
        });
        (0, globals_1.it)('should reject modified data', async () => {
            await manager.generateIdentity();
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            const signature = await manager.sign(data);
            const identity = await manager.getIdentity();
            (0, globals_1.expect)(identity).toBeDefined();
            const modifiedData = new Uint8Array([1, 2, 3, 4, 6]);
            const verified = await manager.verify(modifiedData, signature, identity.publicKey);
            (0, globals_1.expect)(verified).toBe(false);
        });
    });
    (0, globals_1.describe)('Display Name Management', () => {
        (0, globals_1.it)('should have display name from generation', async () => {
            await manager.generateIdentity('Initial');
            const identity = await manager.getIdentity();
            (0, globals_1.expect)(identity?.displayName).toBe('Initial');
        });
        (0, globals_1.it)('should persist display name', async () => {
            await manager.generateIdentity('TestName');
            const newManager = new identity_manager_1.IdentityManager();
            const loaded = await newManager.loadIdentity();
            (0, globals_1.expect)(loaded?.displayName).toBe('TestName');
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.it)('should throw when trying to sign without identity', async () => {
            const data = new Uint8Array([1, 2, 3]);
            await (0, globals_1.expect)(manager.sign(data)).rejects.toThrow();
        });
        (0, globals_1.it)('should throw when trying to export without identity', async () => {
            await (0, globals_1.expect)(manager.exportIdentity()).rejects.toThrow();
        });
        (0, globals_1.it)('should throw when importing invalid identity', async () => {
            const invalid = {
                id: 'invalid',
                publicKeyJwk: {},
                privateKeyJwk: {},
                created: new Date().toISOString()
            };
            await (0, globals_1.expect)(manager.importIdentity(invalid)).rejects.toThrow();
        });
    });
    (0, globals_1.describe)('Security', () => {
        (0, globals_1.it)('should not expose private key directly', async () => {
            const identity = await manager.generateIdentity();
            (0, globals_1.expect)(identity.privateKey.extractable).toBe(true); // For export
            (0, globals_1.expect)(identity.privateKey.usages).toContain('sign');
        });
        (0, globals_1.it)('should generate cryptographically secure IDs', async () => {
            const identity1 = await manager.generateIdentity();
            const identity2 = await manager.generateIdentity();
            // IDs should be sufficiently random
            (0, globals_1.expect)(identity1.id.length).toBeGreaterThanOrEqual(16);
            (0, globals_1.expect)(identity2.id.length).toBeGreaterThanOrEqual(16);
            (0, globals_1.expect)(identity1.id).not.toBe(identity2.id);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvaWRlbnRpdHktbWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsMkNBQXVFO0FBQ3ZFLHlEQUFvRTtBQUVwRSw0Q0FBNEM7QUFDNUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEdBQUcsRUFBRTtJQUM3QixJQUFJLEtBQUssR0FBOEIsRUFBRSxDQUFDO0lBQzFDLE9BQU87UUFDTCxPQUFPLEVBQUUsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJO1FBQzVDLE9BQU8sRUFBRSxDQUFDLEdBQVcsRUFBRSxLQUFhLEVBQUUsRUFBRSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLFVBQVUsRUFBRSxDQUFDLEdBQVcsRUFBRSxFQUFFLEdBQUcsT0FBTyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUM3QixDQUFDO0FBQ0osQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUVMLE1BQU0sQ0FBQyxZQUFZLEdBQUcsZ0JBQXVCLENBQUM7QUFFOUMsSUFBQSxrQkFBUSxFQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLE9BQXdCLENBQUM7SUFFN0IsSUFBQSxvQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNyQixPQUFPLEdBQUcsSUFBSSxrQ0FBZSxFQUFFLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLElBQUEsWUFBRSxFQUFDLDhCQUE4QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVDLE1BQU0sUUFB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QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvaWRlbnRpdHktbWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVFYWNoLCBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBJZGVudGl0eU1hbmFnZXIsIHR5cGUgSWRlbnRpdHkgfSBmcm9tICcuL2lkZW50aXR5LW1hbmFnZXInO1xuXG4vLyBNb2NrIGxvY2FsU3RvcmFnZSBmb3IgTm9kZS5qcyBlbnZpcm9ubWVudFxuY29uc3QgbG9jYWxTdG9yYWdlTW9jayA9ICgoKSA9PiB7XG4gIGxldCBzdG9yZTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9O1xuICByZXR1cm4ge1xuICAgIGdldEl0ZW06IChrZXk6IHN0cmluZykgPT4gc3RvcmVba2V5XSB8fCBudWxsLFxuICAgIHNldEl0ZW06IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykgPT4geyBzdG9yZVtrZXldID0gdmFsdWU7IH0sXG4gICAgcmVtb3ZlSXRlbTogKGtleTogc3RyaW5nKSA9PiB7IGRlbGV0ZSBzdG9yZVtrZXldOyB9LFxuICAgIGNsZWFyOiAoKSA9PiB7IHN0b3JlID0ge307IH1cbiAgfTtcbn0pKCk7XG5cbmdsb2JhbC5sb2NhbFN0b3JhZ2UgPSBsb2NhbFN0b3JhZ2VNb2NrIGFzIGFueTtcblxuZGVzY3JpYmUoJ0lkZW50aXR5TWFuYWdlcicsICgpID0+IHtcbiAgbGV0IG1hbmFnZXI6IElkZW50aXR5TWFuYWdlcjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgICBtYW5hZ2VyID0gbmV3IElkZW50aXR5TWFuYWdlcigpO1xuICB9KTtcblxuICBkZXNjcmliZSgnSWRlbnRpdHkgR2VuZXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIG5ldyBpZGVudGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG5cbiAgICAgIGV4cGVjdChpZGVudGl0eSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChpZGVudGl0eS5pZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChpZGVudGl0eS5wdWJsaWNLZXkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoaWRlbnRpdHkucHJpdmF0ZUtleSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChpZGVudGl0eS5jcmVhdGVkKS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgaWRlbnRpdHkgd2l0aCBkaXNwbGF5IG5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpZGVudGl0eSA9IGF3YWl0IG1hbmFnZXIuZ2VuZXJhdGVJZGVudGl0eSgnQWxpY2UnKTtcblxuICAgICAgZXhwZWN0KGlkZW50aXR5LmRpc3BsYXlOYW1lKS50b0JlKCdBbGljZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgSURzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaWRlbnRpdHkxID0gYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG4gICAgICBjb25zdCBtYW5hZ2VyMiA9IG5ldyBJZGVudGl0eU1hbmFnZXIoKTtcbiAgICAgIGNvbnN0IGlkZW50aXR5MiA9IGF3YWl0IG1hbmFnZXIyLmdlbmVyYXRlSWRlbnRpdHkoKTtcblxuICAgICAgZXhwZWN0KGlkZW50aXR5MS5pZCkubm90LnRvQmUoaWRlbnRpdHkyLmlkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIEVkMjU1MTkga2V5cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG5cbiAgICAgIGV4cGVjdChpZGVudGl0eS5wdWJsaWNLZXkuYWxnb3JpdGhtLm5hbWUpLnRvQmUoJ0VkMjU1MTknKTtcbiAgICAgIGV4cGVjdChpZGVudGl0eS5wcml2YXRlS2V5LmFsZ29yaXRobS5uYW1lKS50b0JlKCdFZDI1NTE5Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJZGVudGl0eSBQZXJzaXN0ZW5jZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhdmUgaWRlbnRpdHkgdG8gc3RvcmFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCdCb2InKTtcbiAgICAgIC8vIGdlbmVyYXRlSWRlbnRpdHkgYXV0b21hdGljYWxseSBzYXZlcywgc28gd2UganVzdCBuZWVkIHRvIGxvYWQgaXQgYmFja1xuXG4gICAgICBjb25zdCBsb2FkZWQgPSBhd2FpdCBtYW5hZ2VyLmxvYWRJZGVudGl0eSgpO1xuICAgICAgZXhwZWN0KGxvYWRlZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsb2FkZWQ/LmlkKS50b0JlKGlkZW50aXR5LmlkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9hZCBpZGVudGl0eSBmcm9tIHN0b3JhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoJ0NoYXJsaWUnKTtcbiAgICAgIC8vIGdlbmVyYXRlSWRlbnRpdHkgYXV0b21hdGljYWxseSBzYXZlc1xuXG4gICAgICBjb25zdCBuZXdNYW5hZ2VyID0gbmV3IElkZW50aXR5TWFuYWdlcigpO1xuICAgICAgY29uc3QgbG9hZGVkID0gYXdhaXQgbmV3TWFuYWdlci5sb2FkSWRlbnRpdHkoKTtcblxuICAgICAgZXhwZWN0KGxvYWRlZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsb2FkZWQ/LmRpc3BsYXlOYW1lKS50b0JlKCdDaGFybGllJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gbm8gaWRlbnRpdHkgZXhpc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9hZGVkID0gYXdhaXQgbWFuYWdlci5sb2FkSWRlbnRpdHkoKTtcbiAgICAgIGV4cGVjdChsb2FkZWQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBpZGVudGl0eSBmcm9tIHN0b3JhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgICAgIC8vIGdlbmVyYXRlSWRlbnRpdHkgYXV0b21hdGljYWxseSBzYXZlc1xuICAgICAgYXdhaXQgbWFuYWdlci5kZWxldGVJZGVudGl0eSgpO1xuXG4gICAgICBjb25zdCBsb2FkZWQgPSBhd2FpdCBtYW5hZ2VyLmxvYWRJZGVudGl0eSgpO1xuICAgICAgZXhwZWN0KGxvYWRlZCkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0lkZW50aXR5IEV4cG9ydC9JbXBvcnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgaWRlbnRpdHkgdG8gSldLIGZvcm1hdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCdEYXZlJyk7XG4gICAgICBjb25zdCBleHBvcnRlZCA9IGF3YWl0IG1hbmFnZXIuZXhwb3J0SWRlbnRpdHkoKTtcblxuICAgICAgZXhwZWN0KGV4cG9ydGVkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGV4cG9ydGVkLmlkKS50b0JlKGlkZW50aXR5LmlkKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZC5wdWJsaWNLZXlKd2spLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZXhwb3J0ZWQucHJpdmF0ZUtleUp3aykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChleHBvcnRlZC5kaXNwbGF5TmFtZSkudG9CZSgnRGF2ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbXBvcnQgaWRlbnRpdHkgZnJvbSBKV0sgZm9ybWF0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWwgPSBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoJ0V2ZScpO1xuICAgICAgY29uc3QgZXhwb3J0ZWQgPSBhd2FpdCBtYW5hZ2VyLmV4cG9ydElkZW50aXR5KCk7XG5cbiAgICAgIGNvbnN0IG5ld01hbmFnZXIgPSBuZXcgSWRlbnRpdHlNYW5hZ2VyKCk7XG4gICAgICBjb25zdCBpbXBvcnRlZCA9IGF3YWl0IG5ld01hbmFnZXIuaW1wb3J0SWRlbnRpdHkoZXhwb3J0ZWQpO1xuXG4gICAgICBleHBlY3QoaW1wb3J0ZWQuaWQpLnRvQmUob3JpZ2luYWwuaWQpO1xuICAgICAgZXhwZWN0KGltcG9ydGVkLmRpc3BsYXlOYW1lKS50b0JlKG9yaWdpbmFsLmRpc3BsYXlOYW1lKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUga2V5IG1hdGVyaWFsIG9uIGV4cG9ydC9pbXBvcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgICAgIGNvbnN0IGV4cG9ydGVkID0gYXdhaXQgbWFuYWdlci5leHBvcnRJZGVudGl0eSgpO1xuXG4gICAgICBjb25zdCBuZXdNYW5hZ2VyID0gbmV3IElkZW50aXR5TWFuYWdlcigpO1xuICAgICAgY29uc3QgaW1wb3J0ZWQgPSBhd2FpdCBuZXdNYW5hZ2VyLmltcG9ydElkZW50aXR5KGV4cG9ydGVkKTtcblxuICAgICAgLy8gVmVyaWZ5IGtleXMgY2FuIHN0aWxsIGJlIHVzZWQgZm9yIHNpZ25pbmdcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShbMSwgMiwgM10pO1xuICAgICAgY29uc3Qgc2lnbmF0dXJlID0gYXdhaXQgY3J5cHRvLnN1YnRsZS5zaWduKFxuICAgICAgICAnRWQyNTUxOScsXG4gICAgICAgIGltcG9ydGVkLnByaXZhdGVLZXksXG4gICAgICAgIGRhdGFcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHZlcmlmaWVkID0gYXdhaXQgY3J5cHRvLnN1YnRsZS52ZXJpZnkoXG4gICAgICAgICdFZDI1NTE5JyxcbiAgICAgICAgaW1wb3J0ZWQucHVibGljS2V5LFxuICAgICAgICBzaWduYXR1cmUsXG4gICAgICAgIGRhdGFcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdCh2ZXJpZmllZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1B1YmxpYyBLZXkgT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBwdWJsaWMga2V5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG4gICAgICBjb25zdCBwdWJsaWNLZXkgPSBhd2FpdCBtYW5hZ2VyLmdldFB1YmxpY0tleSgpO1xuXG4gICAgICBleHBlY3QocHVibGljS2V5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHB1YmxpY0tleS50eXBlKS50b0JlKCdwdWJsaWMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhwb3J0IHB1YmxpYyBrZXkgYXMgYnl0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgICAgIGNvbnN0IHB1YmxpY0tleUJ5dGVzID0gYXdhaXQgbWFuYWdlci5nZXRQdWJsaWNLZXlCeXRlcygpO1xuXG4gICAgICBleHBlY3QocHVibGljS2V5Qnl0ZXMpLnRvQmVJbnN0YW5jZU9mKFVpbnQ4QXJyYXkpO1xuICAgICAgZXhwZWN0KHB1YmxpY0tleUJ5dGVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgcHVibGljIGtleSBhcyBoZXggc3RyaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG4gICAgICBjb25zdCBwdWJsaWNLZXlIZXggPSBhd2FpdCBtYW5hZ2VyLmdldFB1YmxpY0tleUhleCgpO1xuXG4gICAgICBleHBlY3QodHlwZW9mIHB1YmxpY0tleUhleCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QocHVibGljS2V5SGV4Lmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KC9eWzAtOWEtZl0rJC9pLnRlc3QocHVibGljS2V5SGV4KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0lkZW50aXR5IFZlcmlmaWNhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZlcmlmeSBpZGVudGl0eSBoYXMga2V5cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IG1hbmFnZXIuZ2VuZXJhdGVJZGVudGl0eSgpO1xuICAgICAgY29uc3QgaGFzSWRlbnRpdHkgPSBtYW5hZ2VyLmhhc0lkZW50aXR5KCk7XG5cbiAgICAgIGV4cGVjdChoYXNJZGVudGl0eSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gbm8gaWRlbnRpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBoYXNJZGVudGl0eSA9IG1hbmFnZXIuaGFzSWRlbnRpdHkoKTtcbiAgICAgIGV4cGVjdChoYXNJZGVudGl0eSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBjdXJyZW50IGlkZW50aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGVkID0gYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCdGcmFuaycpO1xuICAgICAgY29uc3QgY3VycmVudCA9IG1hbmFnZXIuZ2V0Q3VycmVudElkZW50aXR5KCk7XG5cbiAgICAgIGV4cGVjdChjdXJyZW50KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGN1cnJlbnQ/LmlkKS50b0JlKGdlbmVyYXRlZC5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIGZvciBjdXJyZW50IGlkZW50aXR5IHdoZW4gbm9uZSBleGlzdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50ID0gbWFuYWdlci5nZXRDdXJyZW50SWRlbnRpdHkoKTtcbiAgICAgIGV4cGVjdChjdXJyZW50KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2lnbmluZyBPcGVyYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2lnbiBkYXRhIHdpdGggcHJpdmF0ZSBrZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuXG4gICAgICBjb25zdCBzaWduYXR1cmUgPSBhd2FpdCBtYW5hZ2VyLnNpZ24oZGF0YSk7XG5cbiAgICAgIGV4cGVjdChzaWduYXR1cmUpLnRvQmVJbnN0YW5jZU9mKFVpbnQ4QXJyYXkpO1xuICAgICAgZXhwZWN0KHNpZ25hdHVyZS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmVyaWZ5IHNpZ25hdHVyZSB3aXRoIHB1YmxpYyBrZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuXG4gICAgICBjb25zdCBzaWduYXR1cmUgPSBhd2FpdCBtYW5hZ2VyLnNpZ24oZGF0YSk7XG4gICAgICBjb25zdCB2ZXJpZmllZCA9IGF3YWl0IG1hbmFnZXIudmVyaWZ5KGRhdGEsIHNpZ25hdHVyZSk7XG5cbiAgICAgIGV4cGVjdCh2ZXJpZmllZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgc2lnbmF0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGNvbnN0IHdyb25nU2lnbmF0dXJlID0gbmV3IFVpbnQ4QXJyYXkoNjQpO1xuXG4gICAgICBjb25zdCB2ZXJpZmllZCA9IGF3YWl0IG1hbmFnZXIudmVyaWZ5KGRhdGEsIHdyb25nU2lnbmF0dXJlKTtcbiAgICAgIGV4cGVjdCh2ZXJpZmllZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBtb2RpZmllZCBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCk7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGNvbnN0IHNpZ25hdHVyZSA9IGF3YWl0IG1hbmFnZXIuc2lnbihkYXRhKTtcblxuICAgICAgY29uc3QgaWRlbnRpdHkgPSBhd2FpdCBtYW5hZ2VyLmdldElkZW50aXR5KCk7XG4gICAgICBleHBlY3QoaWRlbnRpdHkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vZGlmaWVkRGF0YSA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA2XSk7XG4gICAgICBjb25zdCB2ZXJpZmllZCA9IGF3YWl0IG1hbmFnZXIudmVyaWZ5KG1vZGlmaWVkRGF0YSwgc2lnbmF0dXJlLCBpZGVudGl0eSEucHVibGljS2V5KTtcblxuICAgICAgZXhwZWN0KHZlcmlmaWVkKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Rpc3BsYXkgTmFtZSBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGF2ZSBkaXNwbGF5IG5hbWUgZnJvbSBnZW5lcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbWFuYWdlci5nZW5lcmF0ZUlkZW50aXR5KCdJbml0aWFsJyk7XG5cbiAgICAgIGNvbnN0IGlkZW50aXR5ID0gYXdhaXQgbWFuYWdlci5nZXRJZGVudGl0eSgpO1xuICAgICAgZXhwZWN0KGlkZW50aXR5Py5kaXNwbGF5TmFtZSkudG9CZSgnSW5pdGlhbCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwZXJzaXN0IGRpc3BsYXkgbmFtZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IG1hbmFnZXIuZ2VuZXJhdGVJZGVudGl0eSgnVGVzdE5hbWUnKTtcblxuICAgICAgY29uc3QgbmV3TWFuYWdlciA9IG5ldyBJZGVudGl0eU1hbmFnZXIoKTtcbiAgICAgIGNvbnN0IGxvYWRlZCA9IGF3YWl0IG5ld01hbmFnZXIubG9hZElkZW50aXR5KCk7XG5cbiAgICAgIGV4cGVjdChsb2FkZWQ/LmRpc3BsYXlOYW1lKS50b0JlKCdUZXN0TmFtZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyB3aGVuIHRyeWluZyB0byBzaWduIHdpdGhvdXQgaWRlbnRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDNdKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KG1hbmFnZXIuc2lnbihkYXRhKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IHdoZW4gdHJ5aW5nIHRvIGV4cG9ydCB3aXRob3V0IGlkZW50aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KG1hbmFnZXIuZXhwb3J0SWRlbnRpdHkoKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IHdoZW4gaW1wb3J0aW5nIGludmFsaWQgaWRlbnRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkID0ge1xuICAgICAgICBpZDogJ2ludmFsaWQnLFxuICAgICAgICBwdWJsaWNLZXlKd2s6IHt9LFxuICAgICAgICBwcml2YXRlS2V5SndrOiB7fSxcbiAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QobWFuYWdlci5pbXBvcnRJZGVudGl0eShpbnZhbGlkIGFzIGFueSkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBub3QgZXhwb3NlIHByaXZhdGUga2V5IGRpcmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaWRlbnRpdHkgPSBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcblxuICAgICAgZXhwZWN0KGlkZW50aXR5LnByaXZhdGVLZXkuZXh0cmFjdGFibGUpLnRvQmUodHJ1ZSk7IC8vIEZvciBleHBvcnRcbiAgICAgIGV4cGVjdChpZGVudGl0eS5wcml2YXRlS2V5LnVzYWdlcykudG9Db250YWluKCdzaWduJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGNyeXB0b2dyYXBoaWNhbGx5IHNlY3VyZSBJRHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpZGVudGl0eTEgPSBhd2FpdCBtYW5hZ2VyLmdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgICAgIGNvbnN0IGlkZW50aXR5MiA9IGF3YWl0IG1hbmFnZXIuZ2VuZXJhdGVJZGVudGl0eSgpO1xuXG4gICAgICAvLyBJRHMgc2hvdWxkIGJlIHN1ZmZpY2llbnRseSByYW5kb21cbiAgICAgIGV4cGVjdChpZGVudGl0eTEuaWQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDE2KTtcbiAgICAgIGV4cGVjdChpZGVudGl0eTIuaWQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDE2KTtcbiAgICAgIGV4cGVjdChpZGVudGl0eTEuaWQpLm5vdC50b0JlKGlkZW50aXR5Mi5pZCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=