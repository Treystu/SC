{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/AutoLink.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/AutoLink.test.ts"],"sourcesContent":["/**\n * Tests for AutoLink\n */\n\nimport { AutoLink, ContactStore, MessageSender, AutoLinkMessage } from './AutoLink';\nimport { InviteManager } from './InviteManager';\nimport { Contact, PendingInvite } from './types';\nimport { generateIdentity } from '../crypto/primitives';\n\n// Mock ContactStore implementation\nclass MockContactStore implements ContactStore {\n  private contacts: Map<string, Contact> = new Map();\n\n  async add(contact: Contact): Promise<void> {\n    this.contacts.set(contact.peerId, contact);\n  }\n\n  async get(peerId: string): Promise<Contact | null> {\n    return this.contacts.get(peerId) || null;\n  }\n\n  async has(peerId: string): Promise<boolean> {\n    return this.contacts.has(peerId);\n  }\n\n  getAll(): Contact[] {\n    return Array.from(this.contacts.values());\n  }\n\n  clear(): void {\n    this.contacts.clear();\n  }\n}\n\n// Mock MessageSender implementation\nclass MockMessageSender implements MessageSender {\n  public sentMessages: Array<{ peerId: string; message: AutoLinkMessage }> = [];\n  public shouldFail: boolean = false;\n\n  async sendToPeer(peerId: string, message: AutoLinkMessage): Promise<void> {\n    if (this.shouldFail) {\n      throw new Error('Failed to send message');\n    }\n    this.sentMessages.push({ peerId, message });\n  }\n\n  clear(): void {\n    this.sentMessages = [];\n  }\n}\n\ndescribe('AutoLink', () => {\n  let autoLink: AutoLink;\n  let contactStore: MockContactStore;\n  let messageSender: MockMessageSender;\n  let inviteManager: InviteManager;\n  let identity: ReturnType<typeof generateIdentity>;\n\n  beforeEach(() => {\n    contactStore = new MockContactStore();\n    messageSender = new MockMessageSender();\n    autoLink = new AutoLink(contactStore, messageSender);\n    \n    identity = generateIdentity();\n    inviteManager = new InviteManager(\n      'inviter-peer-id',\n      identity.publicKey,\n      identity.privateKey,\n      'Inviter User'\n    );\n  });\n\n  describe('Auto Connection Creation', () => {\n    it('should add inviter to contacts', async () => {\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      await autoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey,\n        'Recipient User'\n      );\n\n      const contact = await contactStore.get('inviter-peer-id');\n      expect(contact).not.toBeNull();\n      expect(contact!.peerId).toBe('inviter-peer-id');\n      expect(contact!.publicKey).toEqual(identity.publicKey);\n      expect(contact!.name).toBe('Inviter User');\n      expect(contact!.addedVia).toBe('invite');\n      expect(contact!.verified).toBe(true);\n    });\n\n    it('should send acceptance notification to inviter', async () => {\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      await autoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey,\n        'Recipient User'\n      );\n\n      expect(messageSender.sentMessages).toHaveLength(1);\n      expect(messageSender.sentMessages[0].peerId).toBe('inviter-peer-id');\n      expect(messageSender.sentMessages[0].message.type).toBe('INVITE_ACCEPTED');\n      expect(messageSender.sentMessages[0].message.recipientPeerId).toBe('recipient-peer-id');\n      expect(messageSender.sentMessages[0].message.recipientPublicKey).toEqual(recipientIdentity.publicKey);\n      expect(messageSender.sentMessages[0].message.recipientName).toBe('Recipient User');\n      expect(messageSender.sentMessages[0].message.inviteCode).toBe(invite.code);\n    });\n\n    it('should work without message sender', async () => {\n      const autoLinkWithoutSender = new AutoLink(contactStore);\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      await autoLinkWithoutSender.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey,\n        'Recipient User'\n      );\n\n      const contact = await contactStore.get('inviter-peer-id');\n      expect(contact).not.toBeNull();\n    });\n\n    it('should handle message sending failures gracefully', async () => {\n      messageSender.shouldFail = true;\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      // Should not throw\n      await expect(\n        autoLink.createAutoConnection(\n          invite,\n          'recipient-peer-id',\n          recipientIdentity.publicKey,\n          'Recipient User'\n        )\n      ).resolves.not.toThrow();\n\n      // Contact should still be added\n      const contact = await contactStore.get('inviter-peer-id');\n      expect(contact).not.toBeNull();\n    });\n\n    it('should handle recipient without name', async () => {\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      await autoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey\n      );\n\n      const message = messageSender.sentMessages[0]?.message;\n      expect(message?.recipientName).toBeUndefined();\n    });\n\n    it('should set correct contact metadata', async () => {\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      await autoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey,\n        'Recipient User'\n      );\n\n      const contact = await contactStore.get('inviter-peer-id');\n      expect(contact!.addedAt).toBeGreaterThan(0);\n      expect(contact!.addedAt).toBeLessThanOrEqual(Date.now());\n    });\n  });\n\n  describe('Invite Acceptance Handling', () => {\n    it('should add recipient to contacts when handling acceptance', async () => {\n      const recipientIdentity = generateIdentity();\n      const message: AutoLinkMessage = {\n        type: 'INVITE_ACCEPTED',\n        recipientPeerId: 'recipient-peer-id',\n        recipientPublicKey: recipientIdentity.publicKey,\n        recipientName: 'Recipient User',\n        inviteCode: 'test-invite-code',\n        timestamp: Date.now(),\n      };\n\n      await autoLink.handleInviteAcceptance(message);\n\n      const contact = await contactStore.get('recipient-peer-id');\n      expect(contact).not.toBeNull();\n      expect(contact!.peerId).toBe('recipient-peer-id');\n      expect(contact!.publicKey).toEqual(recipientIdentity.publicKey);\n      expect(contact!.name).toBe('Recipient User');\n      expect(contact!.addedVia).toBe('invite');\n      expect(contact!.verified).toBe(true);\n    });\n\n    it('should not duplicate existing contacts', async () => {\n      const recipientIdentity = generateIdentity();\n      const existingContact: Contact = {\n        peerId: 'recipient-peer-id',\n        publicKey: recipientIdentity.publicKey,\n        name: 'Old Name',\n        addedVia: 'manual',\n        addedAt: Date.now() - 1000,\n        verified: false,\n      };\n\n      await contactStore.add(existingContact);\n\n      const message: AutoLinkMessage = {\n        type: 'INVITE_ACCEPTED',\n        recipientPeerId: 'recipient-peer-id',\n        recipientPublicKey: recipientIdentity.publicKey,\n        recipientName: 'New Name',\n        inviteCode: 'test-invite-code',\n        timestamp: Date.now(),\n      };\n\n      await autoLink.handleInviteAcceptance(message);\n\n      const contact = await contactStore.get('recipient-peer-id');\n      expect(contact!.name).toBe('Old Name'); // Should not change\n    });\n\n    it('should handle acceptance without recipient name', async () => {\n      const recipientIdentity = generateIdentity();\n      const message: AutoLinkMessage = {\n        type: 'INVITE_ACCEPTED',\n        recipientPeerId: 'recipient-peer-id',\n        recipientPublicKey: recipientIdentity.publicKey,\n        inviteCode: 'test-invite-code',\n        timestamp: Date.now(),\n      };\n\n      await autoLink.handleInviteAcceptance(message);\n\n      const contact = await contactStore.get('recipient-peer-id');\n      expect(contact).not.toBeNull();\n      expect(contact!.name).toBeUndefined();\n    });\n  });\n\n  describe('Bidirectional Connection', () => {\n    it('should create bidirectional link when both sides process', async () => {\n      // Create two AutoLink instances for inviter and recipient\n      const inviterContacts = new MockContactStore();\n      const recipientContacts = new MockContactStore();\n      const recipientSender = new MockMessageSender();\n      \n      const inviterAutoLink = new AutoLink(inviterContacts);\n      const recipientAutoLink = new AutoLink(recipientContacts, recipientSender);\n\n      // Create invite\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      // Recipient redeems invite\n      await recipientAutoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey,\n        'Recipient User'\n      );\n\n      // Inviter processes acceptance\n      const acceptanceMessage = recipientSender.sentMessages[0].message;\n      await inviterAutoLink.handleInviteAcceptance(acceptanceMessage);\n\n      // Both should have each other as contacts\n      const inviterContact = await recipientContacts.get('inviter-peer-id');\n      const recipientContact = await inviterContacts.get('recipient-peer-id');\n\n      expect(inviterContact).not.toBeNull();\n      expect(recipientContact).not.toBeNull();\n      expect(inviterContact!.peerId).toBe('inviter-peer-id');\n      expect(recipientContact!.peerId).toBe('recipient-peer-id');\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle invite without inviter name', async () => {\n      const anonymousManager = new InviteManager(\n        'inviter-peer-id',\n        identity.publicKey,\n        identity.privateKey\n      );\n      const invite = await anonymousManager.createInvite();\n      const recipientIdentity = generateIdentity();\n\n      await autoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey\n      );\n\n      const contact = await contactStore.get('inviter-peer-id');\n      expect(contact!.name).toBe('User'); // Default name when none provided\n    });\n\n    it('should include timestamp in acceptance message', async () => {\n      const invite = await inviteManager.createInvite();\n      const recipientIdentity = generateIdentity();\n      const beforeTime = Date.now();\n\n      await autoLink.createAutoConnection(\n        invite,\n        'recipient-peer-id',\n        recipientIdentity.publicKey\n      );\n\n      const afterTime = Date.now();\n      const message = messageSender.sentMessages[0]?.message;\n      \n      expect(message?.timestamp).toBeGreaterThanOrEqual(beforeTime);\n      expect(message?.timestamp).toBeLessThanOrEqual(afterTime);\n    });\n  });\n});\n"],"version":3}