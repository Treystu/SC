41169c770d7621b7393055b214d708be
"use strict";
/**
 * Binary Message Format for Sovereign Communications
 *
 * Wire Protocol Documentation:
 * ===========================
 *
 * Endianness: All multi-byte integers use Big Endian (network byte order)
 *
 * Header Structure (fixed 108 bytes):
 * Offset | Size | Field      | Description
 * -------|------|------------|------------------------------------------
 * 0      | 1    | Version    | Protocol version (current: 0x01)
 * 1      | 1    | Type       | Message type (see MessageType enum)
 * 2      | 1    | TTL        | Time-to-live for mesh routing (max: 255)
 * 3      | 1    | Reserved   | Reserved for future use (must be 0x00)
 * 4      | 8    | Timestamp  | Unix timestamp in milliseconds (big-endian)
 * 12     | 32   | Sender ID  | Ed25519 public key of sender
 * 44     | 64   | Signature  | Compact Ed25519 signature of message
 *
 * Body:
 * - Encrypted payload (variable length, max: MAX_PAYLOAD_SIZE)
 *
 * Version Migration:
 * - v1 (0x01): Initial protocol version
 * - Future versions will maintain backward compatibility where possible
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MessageValidationError = exports.MAX_TTL = exports.MAX_PAYLOAD_SIZE = exports.HEADER_SIZE = exports.MAX_SUPPORTED_VERSION = exports.MIN_SUPPORTED_VERSION = exports.PROTOCOL_VERSION = exports.MessageType = void 0;
exports.validateHeader = validateHeader;
exports.validateMessage = validateMessage;
exports.encodeHeader = encodeHeader;
exports.decodeHeader = decodeHeader;
exports.encodeMessage = encodeMessage;
exports.decodeMessage = decodeMessage;
exports.messageHash = messageHash;
exports.isVersionSupported = isVersionSupported;
exports.getMessageTypeName = getMessageTypeName;
const sha2_js_1 = require("@noble/hashes/sha2.js");
var MessageType;
(function (MessageType) {
    // Data messages
    MessageType[MessageType["TEXT"] = 1] = "TEXT";
    MessageType[MessageType["FILE_METADATA"] = 2] = "FILE_METADATA";
    MessageType[MessageType["FILE_CHUNK"] = 3] = "FILE_CHUNK";
    MessageType[MessageType["VOICE"] = 4] = "VOICE";
    MessageType[MessageType["MESSAGE_REACTION"] = 5] = "MESSAGE_REACTION";
    // Control messages
    MessageType[MessageType["CONTROL_ACK"] = 16] = "CONTROL_ACK";
    MessageType[MessageType["CONTROL_PING"] = 17] = "CONTROL_PING";
    MessageType[MessageType["CONTROL_PONG"] = 18] = "CONTROL_PONG";
    // Peer management
    MessageType[MessageType["PEER_DISCOVERY"] = 32] = "PEER_DISCOVERY";
    MessageType[MessageType["PEER_INTRODUCTION"] = 33] = "PEER_INTRODUCTION";
    // Batching
    MessageType[MessageType["BATCH"] = 144] = "BATCH";
    // Cryptographic
    MessageType[MessageType["KEY_EXCHANGE"] = 48] = "KEY_EXCHANGE";
    MessageType[MessageType["SESSION_KEY"] = 49] = "SESSION_KEY";
    MessageType[MessageType["SESSION_PRESENCE"] = 50] = "SESSION_PRESENCE";
    // DHT / Kademlia
    MessageType[MessageType["DHT_FIND_NODE"] = 64] = "DHT_FIND_NODE";
    MessageType[MessageType["DHT_FOUND_NODES"] = 65] = "DHT_FOUND_NODES";
    MessageType[MessageType["DHT_FIND_VALUE"] = 66] = "DHT_FIND_VALUE";
    MessageType[MessageType["DHT_STORE"] = 67] = "DHT_STORE";
    MessageType[MessageType["DHT_STORE_ACK"] = 68] = "DHT_STORE_ACK";
    MessageType[MessageType["DHT_FOUND_VALUE"] = 69] = "DHT_FOUND_VALUE";
    // Self-update
    MessageType[MessageType["UPDATE_MANIFEST"] = 80] = "UPDATE_MANIFEST";
    // Rendezvous
    MessageType[MessageType["RENDEZVOUS_ANNOUNCE"] = 96] = "RENDEZVOUS_ANNOUNCE";
    MessageType[MessageType["RENDEZVOUS_QUERY"] = 97] = "RENDEZVOUS_QUERY";
    MessageType[MessageType["RENDEZVOUS_RESPONSE"] = 98] = "RENDEZVOUS_RESPONSE";
    // Content Addressing (Phase 4)
    MessageType[MessageType["REQUEST_BLOB"] = 112] = "REQUEST_BLOB";
    MessageType[MessageType["RESPONSE_BLOB"] = 113] = "RESPONSE_BLOB";
    // Social Recovery (Phase 4)
    MessageType[MessageType["STORE_SHARE"] = 128] = "STORE_SHARE";
    MessageType[MessageType["REQUEST_SHARE"] = 129] = "REQUEST_SHARE";
    MessageType[MessageType["RESPONSE_SHARE"] = 130] = "RESPONSE_SHARE";
})(MessageType || (exports.MessageType = MessageType = {}));
// Protocol constants
exports.PROTOCOL_VERSION = 0x01;
exports.MIN_SUPPORTED_VERSION = 0x01;
exports.MAX_SUPPORTED_VERSION = 0x01;
exports.HEADER_SIZE = 108; // 1 + 1 + 1 + 1 + 8 + 32 + 64 (compact signature)
exports.MAX_PAYLOAD_SIZE = 1024 * 1024; // 1 MB max payload
exports.MAX_TTL = 255;
/**
 * Validation error with detailed context
 */
class MessageValidationError extends Error {
    constructor(message, field, value) {
        super(message);
        this.field = field;
        this.value = value;
        this.name = "MessageValidationError";
    }
}
exports.MessageValidationError = MessageValidationError;
/**
 * Validate message header fields
 * @throws {MessageValidationError} if validation fails
 */
function validateHeader(header) {
    // Validate version
    if (header.version < exports.MIN_SUPPORTED_VERSION ||
        header.version > exports.MAX_SUPPORTED_VERSION) {
        throw new MessageValidationError(`Unsupported protocol version: ${header.version}. Supported: ${exports.MIN_SUPPORTED_VERSION}-${exports.MAX_SUPPORTED_VERSION}`, "version", header.version);
    }
    // Validate message type
    const validTypes = Object.values(MessageType).filter((v) => typeof v === "number");
    if (!validTypes.includes(header.type)) {
        throw new MessageValidationError(`Invalid message type: 0x${header.type.toString(16).padStart(2, "0")}`, "type", header.type);
    }
    // Validate TTL
    if (header.ttl < 0 || header.ttl > exports.MAX_TTL) {
        throw new MessageValidationError(`Invalid TTL: ${header.ttl}. Must be 0-${exports.MAX_TTL}`, "ttl", header.ttl);
    }
    // Validate timestamp
    if (!Number.isSafeInteger(header.timestamp) || header.timestamp < 0) {
        throw new MessageValidationError(`Invalid timestamp: ${header.timestamp}`, "timestamp", header.timestamp);
    }
    // Validate sender ID size
    if (header.senderId.length !== 32) {
        throw new MessageValidationError(`Invalid sender ID length: ${header.senderId.length}. Expected: 32`, "senderId", header.senderId.length);
    }
    // Validate signature size
    // Ed25519 signatures can be 64 bytes (standard) or 65 bytes (compact with recovery byte)
    if (header.signature.length !== 64 && header.signature.length !== 65) {
        throw new MessageValidationError(`Invalid signature length: ${header.signature.length}. Expected: 64 or 65`, "signature", header.signature.length);
    }
}
/**
 * Validate complete message
 * @throws {MessageValidationError} if validation fails
 */
function validateMessage(message) {
    validateHeader(message.header);
    // Validate payload size
    if (message.payload.length > exports.MAX_PAYLOAD_SIZE) {
        throw new MessageValidationError(`Payload too large: ${message.payload.length} bytes. Max: ${exports.MAX_PAYLOAD_SIZE}`, "payload", message.payload.length);
    }
}
/**
 * Encode a message header to binary format (Big Endian)
 * @throws {MessageValidationError} if header is invalid
 */
function encodeHeader(header) {
    // Validate before encoding
    validateHeader(header);
    const buffer = new Uint8Array(exports.HEADER_SIZE);
    let offset = 0;
    // Version (1 byte)
    buffer[offset++] = header.version;
    // Type (1 byte)
    buffer[offset++] = header.type;
    // TTL (1 byte)
    buffer[offset++] = header.ttl;
    // Reserved (1 byte)
    buffer[offset++] = 0;
    // Timestamp (8 bytes, big-endian)
    const timestamp = BigInt(header.timestamp);
    for (let i = 7; i >= 0; i--) {
        buffer[offset++] = Number((timestamp >> BigInt(i * 8)) & BigInt(0xff));
    }
    // Sender ID (32 bytes)
    buffer.set(header.senderId, offset);
    offset += 32;
    // Signature (64 bytes - Ed25519 signature)
    buffer.set(header.signature, offset);
    return buffer;
}
/**
 * Decode a message header from binary format (Big Endian)
 * @throws {MessageValidationError} if buffer is invalid or too small
 */
function decodeHeader(buffer) {
    if (buffer.length < exports.HEADER_SIZE) {
        throw new MessageValidationError(`Invalid header size: ${buffer.length} bytes. Expected: ${exports.HEADER_SIZE} bytes`, "buffer", buffer.length);
    }
    let offset = 0;
    const version = buffer[offset++];
    const type = buffer[offset++];
    const ttl = buffer[offset++];
    offset++; // Skip reserved byte
    // Timestamp (8 bytes, big-endian)
    let timestamp = 0;
    for (let i = 0; i < 8; i++) {
        timestamp = timestamp * 256 + buffer[offset++];
    }
    // Sender ID (32 bytes)
    const senderId = buffer.slice(offset, offset + 32);
    offset += 32;
    // Signature (64 bytes)
    const signature = buffer.slice(offset, offset + 64);
    const header = {
        version,
        type,
        ttl,
        timestamp,
        senderId,
        signature,
    };
    // Validate decoded header
    validateHeader(header);
    return header;
}
/**
 * Encode a complete message (header + payload)
 * @throws {MessageValidationError} if message is invalid
 */
function encodeMessage(message) {
    // Validate before encoding
    validateMessage(message);
    const headerBytes = encodeHeader(message.header);
    const result = new Uint8Array(headerBytes.length + message.payload.length);
    result.set(headerBytes, 0);
    result.set(message.payload, headerBytes.length);
    return result;
}
/**
 * Decode a complete message (header + payload)
 * @throws {MessageValidationError} if buffer is invalid
 */
function decodeMessage(buffer) {
    if (buffer.length < exports.HEADER_SIZE) {
        throw new MessageValidationError(`Buffer too small: ${buffer.length} bytes. Minimum: ${exports.HEADER_SIZE} bytes`, "buffer", buffer.length);
    }
    const header = decodeHeader(buffer.slice(0, exports.HEADER_SIZE));
    const payload = buffer.slice(exports.HEADER_SIZE);
    const message = { header, payload };
    // Validate complete message
    validateMessage(message);
    return message;
}
/**
 * Create a cryptographically secure message hash for deduplication
 * Uses SHA-256 for collision resistance
 */
function messageHash(message) {
    const messageBytes = encodeMessage(message);
    const hash = (0, sha2_js_1.sha256)(messageBytes);
    // Convert to hex string
    return Array.from(hash)
        .map((b) => b.toString(16).padStart(2, "0"))
        .join("");
}
/**
 * Check if a version is supported
 */
function isVersionSupported(version) {
    return version >= exports.MIN_SUPPORTED_VERSION && version <= exports.MAX_SUPPORTED_VERSION;
}
/**
 * Get human-readable message type name
 */
function getMessageTypeName(type) {
    const typeNames = {
        [MessageType.TEXT]: "TEXT",
        [MessageType.FILE_METADATA]: "FILE_METADATA",
        [MessageType.FILE_CHUNK]: "FILE_CHUNK",
        [MessageType.VOICE]: "VOICE",
        [MessageType.MESSAGE_REACTION]: "MESSAGE_REACTION",
        [MessageType.CONTROL_ACK]: "CONTROL_ACK",
        [MessageType.CONTROL_PING]: "CONTROL_PING",
        [MessageType.CONTROL_PONG]: "CONTROL_PONG",
        [MessageType.PEER_DISCOVERY]: "PEER_DISCOVERY",
        [MessageType.PEER_INTRODUCTION]: "PEER_INTRODUCTION",
        [MessageType.KEY_EXCHANGE]: "KEY_EXCHANGE",
        [MessageType.SESSION_KEY]: "SESSION_KEY",
        [MessageType.SESSION_PRESENCE]: "SESSION_PRESENCE",
        [MessageType.DHT_FIND_NODE]: "DHT_FIND_NODE",
        [MessageType.DHT_FOUND_NODES]: "DHT_FOUND_NODES",
        [MessageType.DHT_FIND_VALUE]: "DHT_FIND_VALUE",
        [MessageType.DHT_STORE]: "DHT_STORE",
        [MessageType.DHT_STORE_ACK]: "DHT_STORE_ACK",
        [MessageType.DHT_FOUND_VALUE]: "DHT_FOUND_VALUE",
        [MessageType.UPDATE_MANIFEST]: "UPDATE_MANIFEST",
        [MessageType.REQUEST_BLOB]: "REQUEST_BLOB",
        [MessageType.RESPONSE_BLOB]: "RESPONSE_BLOB",
        [MessageType.STORE_SHARE]: "STORE_SHARE",
        [MessageType.REQUEST_SHARE]: "REQUEST_SHARE",
        [MessageType.RESPONSE_SHARE]: "RESPONSE_SHARE",
    };
    return typeNames[type] || `UNKNOWN(0x${type.toString(16).padStart(2, "0")})`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvcHJvdG9jb2wvbWVzc2FnZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5Qkc7OztBQTBGSCx3Q0E2REM7QUFNRCwwQ0FXQztBQU1ELG9DQWlDQztBQU1ELG9DQTBDQztBQU1ELHNDQVNDO0FBTUQsc0NBa0JDO0FBTUQsa0NBUUM7QUFLRCxnREFFQztBQUtELGdEQTZCQztBQTNWRCxtREFBK0M7QUFFL0MsSUFBWSxXQTRDWDtBQTVDRCxXQUFZLFdBQVc7SUFDckIsZ0JBQWdCO0lBQ2hCLDZDQUFXLENBQUE7SUFDWCwrREFBb0IsQ0FBQTtJQUNwQix5REFBaUIsQ0FBQTtJQUNqQiwrQ0FBWSxDQUFBO0lBQ1oscUVBQXVCLENBQUE7SUFDdkIsbUJBQW1CO0lBQ25CLDREQUFrQixDQUFBO0lBQ2xCLDhEQUFtQixDQUFBO0lBQ25CLDhEQUFtQixDQUFBO0lBQ25CLGtCQUFrQjtJQUNsQixrRUFBcUIsQ0FBQTtJQUNyQix3RUFBd0IsQ0FBQTtJQUV4QixXQUFXO0lBQ1gsaURBQVksQ0FBQTtJQUVaLGdCQUFnQjtJQUNoQiw4REFBbUIsQ0FBQTtJQUNuQiw0REFBa0IsQ0FBQTtJQUNsQixzRUFBdUIsQ0FBQTtJQUN2QixpQkFBaUI7SUFDakIsZ0VBQW9CLENBQUE7SUFDcEIsb0VBQXNCLENBQUE7SUFDdEIsa0VBQXFCLENBQUE7SUFDckIsd0RBQWdCLENBQUE7SUFDaEIsZ0VBQW9CLENBQUE7SUFDcEIsb0VBQXNCLENBQUE7SUFDdEIsY0FBYztJQUNkLG9FQUFzQixDQUFBO0lBQ3RCLGFBQWE7SUFDYiw0RUFBMEIsQ0FBQTtJQUMxQixzRUFBdUIsQ0FBQTtJQUN2Qiw0RUFBMEIsQ0FBQTtJQUUxQiwrQkFBK0I7SUFDL0IsK0RBQW1CLENBQUE7SUFDbkIsaUVBQW9CLENBQUE7SUFFcEIsNEJBQTRCO0lBQzVCLDZEQUFrQixDQUFBO0lBQ2xCLGlF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QUFXLENBQUMsU0FBUyxDQUFDLEVBQUUsV0FBVztRQUNwQyxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsRUFBRSxlQUFlO1FBQzVDLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxFQUFFLGlCQUFpQjtRQUNoRCxDQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUMsRUFBRSxpQkFBaUI7UUFDaEQsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLEVBQUUsY0FBYztRQUMxQyxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsRUFBRSxlQUFlO1FBQzVDLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxFQUFFLGFBQWE7UUFDeEMsQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLEVBQUUsZUFBZTtRQUM1QyxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsRUFBRSxnQkFBZ0I7S0FDL0MsQ0FBQztJQUNGLE9BQU8sU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLGFBQWEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUM7QUFDL0UsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy9wcm90b2NvbC9tZXNzYWdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQmluYXJ5IE1lc3NhZ2UgRm9ybWF0IGZvciBTb3ZlcmVpZ24gQ29tbXVuaWNhdGlvbnNcbiAqXG4gKiBXaXJlIFByb3RvY29sIERvY3VtZW50YXRpb246XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqXG4gKiBFbmRpYW5uZXNzOiBBbGwgbXVsdGktYnl0ZSBpbnRlZ2VycyB1c2UgQmlnIEVuZGlhbiAobmV0d29yayBieXRlIG9yZGVyKVxuICpcbiAqIEhlYWRlciBTdHJ1Y3R1cmUgKGZpeGVkIDEwOCBieXRlcyk6XG4gKiBPZmZzZXQgfCBTaXplIHwgRmllbGQgICAgICB8IERlc2NyaXB0aW9uXG4gKiAtLS0tLS0tfC0tLS0tLXwtLS0tLS0tLS0tLS18LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAwICAgICAgfCAxICAgIHwgVmVyc2lvbiAgICB8IFByb3RvY29sIHZlcnNpb24gKGN1cnJlbnQ6IDB4MDEpXG4gKiAxICAgICAgfCAxICAgIHwgVHlwZSAgICAgICB8IE1lc3NhZ2UgdHlwZSAoc2VlIE1lc3NhZ2VUeXBlIGVudW0pXG4gKiAyICAgICAgfCAxICAgIHwgVFRMICAgICAgICB8IFRpbWUtdG8tbGl2ZSBmb3IgbWVzaCByb3V0aW5nIChtYXg6IDI1NSlcbiAqIDMgICAgICB8IDEgICAgfCBSZXNlcnZlZCAgIHwgUmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2UgKG11c3QgYmUgMHgwMClcbiAqIDQgICAgICB8IDggICAgfCBUaW1lc3RhbXAgIHwgVW5peCB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzIChiaWctZW5kaWFuKVxuICogMTIgICAgIHwgMzIgICB8IFNlbmRlciBJRCAgfCBFZDI1NTE5IHB1YmxpYyBrZXkgb2Ygc2VuZGVyXG4gKiA0NCAgICAgfCA2NCAgIHwgU2lnbmF0dXJlICB8IENvbXBhY3QgRWQyNTUxOSBzaWduYXR1cmUgb2YgbWVzc2FnZVxuICpcbiAqIEJvZHk6XG4gKiAtIEVuY3J5cHRlZCBwYXlsb2FkICh2YXJpYWJsZSBsZW5ndGgsIG1heDogTUFYX1BBWUxPQURfU0laRSlcbiAqXG4gKiBWZXJzaW9uIE1pZ3JhdGlvbjpcbiAqIC0gdjEgKDB4MDEpOiBJbml0aWFsIHByb3RvY29sIHZlcnNpb25cbiAqIC0gRnV0dXJlIHZlcnNpb25zIHdpbGwgbWFpbnRhaW4gYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aGVyZSBwb3NzaWJsZVxuICovXG5cbmltcG9ydCB7IHNoYTI1NiB9IGZyb20gXCJAbm9ibGUvaGFzaGVzL3NoYTIuanNcIjtcblxuZXhwb3J0IGVudW0gTWVzc2FnZVR5cGUge1xuICAvLyBEYXRhIG1lc3NhZ2VzXG4gIFRFWFQgPSAweDAxLFxuICBGSUxFX01FVEFEQVRBID0gMHgwMixcbiAgRklMRV9DSFVOSyA9IDB4MDMsXG4gIFZPSUNFID0gMHgwNCxcbiAgTUVTU0FHRV9SRUFDVElPTiA9IDB4MDUsXG4gIC8vIENvbnRyb2wgbWVzc2FnZXNcbiAgQ09OVFJPTF9BQ0sgPSAweDEwLFxuICBDT05UUk9MX1BJTkcgPSAweDExLFxuICBDT05UUk9MX1BPTkcgPSAweDEyLFxuICAvLyBQZWVyIG1hbmFnZW1lbnRcbiAgUEVFUl9ESVNDT1ZFUlkgPSAweDIwLFxuICBQRUVSX0lOVFJPRFVDVElPTiA9IDB4MjEsXG5cbiAgLy8gQmF0Y2hpbmdcbiAgQkFUQ0ggPSAweDkwLFxuXG4gIC8vIENyeXB0b2dyYXBoaWNcbiAgS0VZX0VYQ0hBTkdFID0gMHgzMCxcbiAgU0VTU0lPTl9LRVkgPSAweDMxLFxuICBTRVNTSU9OX1BSRVNFTkNFID0gMHgzMiwgIC8vIFNlc3Npb24gcHJlc2VuY2UgYnJvYWRjYXN0IGZvciBzaW5nbGUtc2Vzc2lvbiBlbmZvcmNlbWVudFxuICAvLyBESFQgLyBLYWRlbWxpYVxuICBESFRfRklORF9OT0RFID0gMHg0MCxcbiAgREhUX0ZPVU5EX05PREVTID0gMHg0MSxcbiAgREhUX0ZJTkRfVkFMVUUgPSAweDQyLFxuICBESFRfU1RPUkUgPSAweDQzLFxuICBESFRfU1RPUkVfQUNLID0gMHg0NCxcbiAgREhUX0ZPVU5EX1ZBTFVFID0gMHg0NSxcbiAgLy8gU2VsZi11cGRhdGVcbiAgVVBEQVRFX01BTklGRVNUID0gMHg1MCxcbiAgLy8gUmVuZGV6dm91c1xuICBSRU5ERVpWT1VTX0FOTk9VTkNFID0gMHg2MCxcbiAgUkVOREVaVk9VU19RVUVSWSA9IDB4NjEsXG4gIFJFTkRFWlZPVVNfUkVTUE9OU0UgPSAweDYyLFxuXG4gIC8vIENvbnRlbnQgQWRkcmVzc2luZyAoUGhhc2UgNClcbiAgUkVRVUVTVF9CTE9CID0gMHg3MCxcbiAgUkVTUE9OU0VfQkxPQiA9IDB4NzEsXG5cbiAgLy8gU29jaWFsIFJlY292ZXJ5IChQaGFzZSA0KVxuICBTVE9SRV9TSEFSRSA9IDB4ODAsXG4gIFJFUVVFU1RfU0hBUkUgPSAweDgxLFxuICBSRVNQT05TRV9TSEFSRSA9IDB4ODIsXG59XG5cbi8vIFByb3RvY29sIGNvbnN0YW50c1xuZXhwb3J0IGNvbnN0IFBST1RPQ09MX1ZFUlNJT04gPSAweDAxO1xuZXhwb3J0IGNvbnN0IE1JTl9TVVBQT1JURURfVkVSU0lPTiA9IDB4MDE7XG5leHBvcnQgY29uc3QgTUFYX1NVUFBPUlRFRF9WRVJTSU9OID0gMHgwMTtcbmV4cG9ydCBjb25zdCBIRUFERVJfU0laRSA9IDEwODsgLy8gMSArIDEgKyAxICsgMSArIDggKyAzMiArIDY0IChjb21wYWN0IHNpZ25hdHVyZSlcbmV4cG9ydCBjb25zdCBNQVhfUEFZTE9BRF9TSVpFID0gMTAyNCAqIDEwMjQ7IC8vIDEgTUIgbWF4IHBheWxvYWRcbmV4cG9ydCBjb25zdCBNQVhfVFRMID0gMjU1O1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VIZWFkZXIge1xuICB2ZXJzaW9uOiBudW1iZXI7XG4gIHR5cGU6IE1lc3NhZ2VUeXBlO1xuICB0dGw6IG51bWJlcjtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHNlbmRlcklkOiBVaW50OEFycmF5O1xuICBzaWduYXR1cmU6IFVpbnQ4QXJyYXk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVzc2FnZSB7XG4gIGhlYWRlcjogTWVzc2FnZUhlYWRlcjtcbiAgcGF5bG9hZDogVWludDhBcnJheTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0aW9uIGVycm9yIHdpdGggZGV0YWlsZWQgY29udGV4dFxuICovXG5leHBvcnQgY2xhc3MgTWVzc2FnZVZhbGlkYXRpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHB1YmxpYyByZWFkb25seSBmaWVsZD86IHN0cmluZyxcbiAgICBwdWJsaWMgcmVhZG9ubHkgdmFsdWU/OiB1bmtub3duLFxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSBcIk1lc3NhZ2VWYWxpZGF0aW9uRXJyb3JcIjtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIG1lc3NhZ2UgaGVhZGVyIGZpZWxkc1xuICogQHRocm93cyB7TWVzc2FnZVZhbGlkYXRpb25FcnJvcn0gaWYgdmFsaWRhdGlvbiBmYWlsc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVIZWFkZXIoaGVhZGVyOiBNZXNzYWdlSGVhZGVyKTogdm9pZCB7XG4gIC8vIFZhbGlkYXRlIHZlcnNpb25cbiAgaWYgKFxuICAgIGhlYWRlci52ZXJzaW9uIDwgTUlOX1NVUFBPUlRFRF9WRVJTSU9OIHx8XG4gICAgaGVhZGVyLnZlcnNpb24gPiBNQVhfU1VQUE9SVEVEX1ZFUlNJT05cbiAgKSB7XG4gICAgdGhyb3cgbmV3IE1lc3NhZ2VWYWxpZGF0aW9uRXJyb3IoXG4gICAgICBgVW5zdXBwb3J0ZWQgcHJvdG9jb2wgdmVyc2lvbjogJHtoZWFkZXIudmVyc2lvbn0uIFN1cHBvcnRlZDogJHtNSU5fU1VQUE9SVEVEX1ZFUlNJT059LSR7TUFYX1NVUFBPUlRFRF9WRVJTSU9OfWAsXG4gICAgICBcInZlcnNpb25cIixcbiAgICAgIGhlYWRlci52ZXJzaW9uLFxuICAgICk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBtZXNzYWdlIHR5cGVcbiAgY29uc3QgdmFsaWRUeXBlcyA9IE9iamVjdC52YWx1ZXMoTWVzc2FnZVR5cGUpLmZpbHRlcihcbiAgICAodikgPT4gdHlwZW9mIHYgPT09IFwibnVtYmVyXCIsXG4gICk7XG4gIGlmICghdmFsaWRUeXBlcy5pbmNsdWRlcyhoZWFkZXIudHlwZSkpIHtcbiAgICB0aHJvdyBuZXcgTWVzc2FnZVZhbGlkYXRpb25FcnJvcihcbiAgICAgIGBJbnZhbGlkIG1lc3NhZ2UgdHlwZTogMHgke2hlYWRlci50eXBlLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCBcIjBcIil9YCxcbiAgICAgIFwidHlwZVwiLFxuICAgICAgaGVhZGVyLnR5cGUsXG4gICAgKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIFRUTFxuICBpZiAoaGVhZGVyLnR0bCA8IDAgfHwgaGVhZGVyLnR0bCA+IE1BWF9UVEwpIHtcbiAgICB0aHJvdyBuZXcgTWVzc2FnZVZhbGlkYXRpb25FcnJvcihcbiAgICAgIGBJbnZhbGlkIFRUTDogJHtoZWFkZXIudHRsfS4gTXVzdCBiZSAwLSR7TUFYX1RUTH1gLFxuICAgICAgXCJ0dGxcIixcbiAgICAgIGhlYWRlci50dGwsXG4gICAgKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIHRpbWVzdGFtcFxuICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKGhlYWRlci50aW1lc3RhbXApIHx8IGhlYWRlci50aW1lc3RhbXAgPCAwKSB7XG4gICAgdGhyb3cgbmV3IE1lc3NhZ2VWYWxpZGF0aW9uRXJyb3IoXG4gICAgICBgSW52YWxpZCB0aW1lc3RhbXA6ICR7aGVhZGVyLnRpbWVzdGFtcH1gLFxuICAgICAgXCJ0aW1lc3RhbXBcIixcbiAgICAgIGhlYWRlci50aW1lc3RhbXAsXG4gICAgKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIHNlbmRlciBJRCBzaXplXG4gIGlmIChoZWFkZXIuc2VuZGVySWQubGVuZ3RoICE9PSAzMikge1xuICAgIHRocm93IG5ldyBNZXNzYWdlVmFsaWRhdGlvbkVycm9yKFxuICAgICAgYEludmFsaWQgc2VuZGVyIElEIGxlbmd0aDogJHtoZWFkZXIuc2VuZGVySWQubGVuZ3RofS4gRXhwZWN0ZWQ6IDMyYCxcbiAgICAgIFwic2VuZGVySWRcIixcbiAgICAgIGhlYWRlci5zZW5kZXJJZC5sZW5ndGgsXG4gICAgKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIHNpZ25hdHVyZSBzaXplXG4gIC8vIEVkMjU1MTkgc2lnbmF0dXJlcyBjYW4gYmUgNjQgYnl0ZXMgKHN0YW5kYXJkKSBvciA2NSBieXRlcyAoY29tcGFjdCB3aXRoIHJlY292ZXJ5IGJ5dGUpXG4gIGlmIChoZWFkZXIuc2lnbmF0dXJlLmxlbmd0aCAhPT0gNjQgJiYgaGVhZGVyLnNpZ25hdHVyZS5sZW5ndGggIT09IDY1KSB7XG4gICAgdGhyb3cgbmV3IE1lc3NhZ2VWYWxpZGF0aW9uRXJyb3IoXG4gICAgICBgSW52YWxpZCBzaWduYXR1cmUgbGVuZ3RoOiAke2hlYWRlci5zaWduYXR1cmUubGVuZ3RofS4gRXhwZWN0ZWQ6IDY0IG9yIDY1YCxcbiAgICAgIFwic2lnbmF0dXJlXCIsXG4gICAgICBoZWFkZXIuc2lnbmF0dXJlLmxlbmd0aCxcbiAgICApO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY29tcGxldGUgbWVzc2FnZVxuICogQHRocm93cyB7TWVzc2FnZVZhbGlkYXRpb25FcnJvcn0gaWYgdmFsaWRhdGlvbiBmYWlsc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVNZXNzYWdlKG1lc3NhZ2U6IE1lc3NhZ2UpOiB2b2lkIHtcbiAgdmFsaWRhdGVIZWFkZXIobWVzc2FnZS5oZWFkZXIpO1xuXG4gIC8vIFZhbGlkYXRlIHBheWxvYWQgc2l6ZVxuICBpZiAobWVzc2FnZS5wYXlsb2FkLmxlbmd0aCA+IE1BWF9QQVlMT0FEX1NJWkUpIHtcbiAgICB0aHJvdyBuZXcgTWVzc2FnZVZhbGlkYXRpb25FcnJvcihcbiAgICAgIGBQYXlsb2FkIHRvbyBsYXJnZTogJHttZXNzYWdlLnBheWxvYWQubGVuZ3RofSBieXRlcy4gTWF4OiAke01BWF9QQVlMT0FEX1NJWkV9YCxcbiAgICAgIFwicGF5bG9hZFwiLFxuICAgICAgbWVzc2FnZS5wYXlsb2FkLmxlbmd0aCxcbiAgICApO1xuICB9XG59XG5cbi8qKlxuICogRW5jb2RlIGEgbWVzc2FnZSBoZWFkZXIgdG8gYmluYXJ5IGZvcm1hdCAoQmlnIEVuZGlhbilcbiAqIEB0aHJvd3Mge01lc3NhZ2VWYWxpZGF0aW9uRXJyb3J9IGlmIGhlYWRlciBpcyBpbnZhbGlkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGVIZWFkZXIoaGVhZGVyOiBNZXNzYWdlSGVhZGVyKTogVWludDhBcnJheSB7XG4gIC8vIFZhbGlkYXRlIGJlZm9yZSBlbmNvZGluZ1xuICB2YWxpZGF0ZUhlYWRlcihoZWFkZXIpO1xuXG4gIGNvbnN0IGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KEhFQURFUl9TSVpFKTtcbiAgbGV0IG9mZnNldCA9IDA7XG5cbiAgLy8gVmVyc2lvbiAoMSBieXRlKVxuICBidWZmZXJbb2Zmc2V0KytdID0gaGVhZGVyLnZlcnNpb247XG5cbiAgLy8gVHlwZSAoMSBieXRlKVxuICBidWZmZXJbb2Zmc2V0KytdID0gaGVhZGVyLnR5cGU7XG5cbiAgLy8gVFRMICgxIGJ5dGUpXG4gIGJ1ZmZlcltvZmZzZXQrK10gPSBoZWFkZXIudHRsO1xuXG4gIC8vIFJlc2VydmVkICgxIGJ5dGUpXG4gIGJ1ZmZlcltvZmZzZXQrK10gPSAwO1xuXG4gIC8vIFRpbWVzdGFtcCAoOCBieXRlcywgYmlnLWVuZGlhbilcbiAgY29uc3QgdGltZXN0YW1wID0gQmlnSW50KGhlYWRlci50aW1lc3RhbXApO1xuICBmb3IgKGxldCBpID0gNzsgaSA+PSAwOyBpLS0pIHtcbiAgICBidWZmZXJbb2Zmc2V0KytdID0gTnVtYmVyKCh0aW1lc3RhbXAgPj4gQmlnSW50KGkgKiA4KSkgJiBCaWdJbnQoMHhmZikpO1xuICB9XG5cbiAgLy8gU2VuZGVyIElEICgzMiBieXRlcylcbiAgYnVmZmVyLnNldChoZWFkZXIuc2VuZGVySWQsIG9mZnNldCk7XG4gIG9mZnNldCArPSAzMjtcblxuICAvLyBTaWduYXR1cmUgKDY0IGJ5dGVzIC0gRWQyNTUxOSBzaWduYXR1cmUpXG4gIGJ1ZmZlci5zZXQoaGVhZGVyLnNpZ25hdHVyZSwgb2Zmc2V0KTtcblxuICByZXR1cm4gYnVmZmVyO1xufVxuXG4vKipcbiAqIERlY29kZSBhIG1lc3NhZ2UgaGVhZGVyIGZyb20gYmluYXJ5IGZvcm1hdCAoQmlnIEVuZGlhbilcbiAqIEB0aHJvd3Mge01lc3NhZ2VWYWxpZGF0aW9uRXJyb3J9IGlmIGJ1ZmZlciBpcyBpbnZhbGlkIG9yIHRvbyBzbWFsbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVjb2RlSGVhZGVyKGJ1ZmZlcjogVWludDhBcnJheSk6IE1lc3NhZ2VIZWFkZXIge1xuICBpZiAoYnVmZmVyLmxlbmd0aCA8IEhFQURFUl9TSVpFKSB7XG4gICAgdGhyb3cgbmV3IE1lc3NhZ2VWYWxpZGF0aW9uRXJyb3IoXG4gICAgICBgSW52YWxpZCBoZWFkZXIgc2l6ZTogJHtidWZmZXIubGVuZ3RofSBieXRlcy4gRXhwZWN0ZWQ6ICR7SEVBREVSX1NJWkV9IGJ5dGVzYCxcbiAgICAgIFwiYnVmZmVyXCIsXG4gICAgICBidWZmZXIubGVuZ3RoLFxuICAgICk7XG4gIH1cblxuICBsZXQgb2Zmc2V0ID0gMDtcblxuICBjb25zdCB2ZXJzaW9uID0gYnVmZmVyW29mZnNldCsrXTtcbiAgY29uc3QgdHlwZSA9IGJ1ZmZlcltvZmZzZXQrK10gYXMgTWVzc2FnZVR5cGU7XG4gIGNvbnN0IHR0bCA9IGJ1ZmZlcltvZmZzZXQrK107XG4gIG9mZnNldCsrOyAvLyBTa2lwIHJlc2VydmVkIGJ5dGVcblxuICAvLyBUaW1lc3RhbXAgKDggYnl0ZXMsIGJpZy1lbmRpYW4pXG4gIGxldCB0aW1lc3RhbXAgPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykge1xuICAgIHRpbWVzdGFtcCA9IHRpbWVzdGFtcCAqIDI1NiArIGJ1ZmZlcltvZmZzZXQrK107XG4gIH1cblxuICAvLyBTZW5kZXIgSUQgKDMyIGJ5dGVzKVxuICBjb25zdCBzZW5kZXJJZCA9IGJ1ZmZlci5zbGljZShvZmZzZXQsIG9mZnNldCArIDMyKTtcbiAgb2Zmc2V0ICs9IDMyO1xuXG4gIC8vIFNpZ25hdHVyZSAoNjQgYnl0ZXMpXG4gIGNvbnN0IHNpZ25hdHVyZSA9IGJ1ZmZlci5zbGljZShvZmZzZXQsIG9mZnNldCArIDY0KTtcblxuICBjb25zdCBoZWFkZXI6IE1lc3NhZ2VIZWFkZXIgPSB7XG4gICAgdmVyc2lvbixcbiAgICB0eXBlLFxuICAgIHR0bCxcbiAgICB0aW1lc3RhbXAsXG4gICAgc2VuZGVySWQsXG4gICAgc2lnbmF0dXJlLFxuICB9O1xuXG4gIC8vIFZhbGlkYXRlIGRlY29kZWQgaGVhZGVyXG4gIHZhbGlkYXRlSGVhZGVyKGhlYWRlcik7XG5cbiAgcmV0dXJuIGhlYWRlcjtcbn1cblxuLyoqXG4gKiBFbmNvZGUgYSBjb21wbGV0ZSBtZXNzYWdlIChoZWFkZXIgKyBwYXlsb2FkKVxuICogQHRocm93cyB7TWVzc2FnZVZhbGlkYXRpb25FcnJvcn0gaWYgbWVzc2FnZSBpcyBpbnZhbGlkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGVNZXNzYWdlKG1lc3NhZ2U6IE1lc3NhZ2UpOiBVaW50OEFycmF5IHtcbiAgLy8gVmFsaWRhdGUgYmVmb3JlIGVuY29kaW5nXG4gIHZhbGlkYXRlTWVzc2FnZShtZXNzYWdlKTtcblxuICBjb25zdCBoZWFkZXJCeXRlcyA9IGVuY29kZUhlYWRlcihtZXNzYWdlLmhlYWRlcik7XG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGhlYWRlckJ5dGVzLmxlbmd0aCArIG1lc3NhZ2UucGF5bG9hZC5sZW5ndGgpO1xuICByZXN1bHQuc2V0KGhlYWRlckJ5dGVzLCAwKTtcbiAgcmVzdWx0LnNldChtZXNzYWdlLnBheWxvYWQsIGhlYWRlckJ5dGVzLmxlbmd0aCk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogRGVjb2RlIGEgY29tcGxldGUgbWVzc2FnZSAoaGVhZGVyICsgcGF5bG9hZClcbiAqIEB0aHJvd3Mge01lc3NhZ2VWYWxpZGF0aW9uRXJyb3J9IGlmIGJ1ZmZlciBpcyBpbnZhbGlkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVNZXNzYWdlKGJ1ZmZlcjogVWludDhBcnJheSk6IE1lc3NhZ2Uge1xuICBpZiAoYnVmZmVyLmxlbmd0aCA8IEhFQURFUl9TSVpFKSB7XG4gICAgdGhyb3cgbmV3IE1lc3NhZ2VWYWxpZGF0aW9uRXJyb3IoXG4gICAgICBgQnVmZmVyIHRvbyBzbWFsbDogJHtidWZmZXIubGVuZ3RofSBieXRlcy4gTWluaW11bTogJHtIRUFERVJfU0laRX0gYnl0ZXNgLFxuICAgICAgXCJidWZmZXJcIixcbiAgICAgIGJ1ZmZlci5sZW5ndGgsXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0IGhlYWRlciA9IGRlY29kZUhlYWRlcihidWZmZXIuc2xpY2UoMCwgSEVBREVSX1NJWkUpKTtcbiAgY29uc3QgcGF5bG9hZCA9IGJ1ZmZlci5zbGljZShIRUFERVJfU0laRSk7XG5cbiAgY29uc3QgbWVzc2FnZTogTWVzc2FnZSA9IHsgaGVhZGVyLCBwYXlsb2FkIH07XG5cbiAgLy8gVmFsaWRhdGUgY29tcGxldGUgbWVzc2FnZVxuICB2YWxpZGF0ZU1lc3NhZ2UobWVzc2FnZSk7XG5cbiAgcmV0dXJuIG1lc3NhZ2U7XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgY3J5cHRvZ3JhcGhpY2FsbHkgc2VjdXJlIG1lc3NhZ2UgaGFzaCBmb3IgZGVkdXBsaWNhdGlvblxuICogVXNlcyBTSEEtMjU2IGZvciBjb2xsaXNpb24gcmVzaXN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gbWVzc2FnZUhhc2gobWVzc2FnZTogTWVzc2FnZSk6IHN0cmluZyB7XG4gIGNvbnN0IG1lc3NhZ2VCeXRlcyA9IGVuY29kZU1lc3NhZ2UobWVzc2FnZSk7XG4gIGNvbnN0IGhhc2ggPSBzaGEyNTYobWVzc2FnZUJ5dGVzKTtcblxuICAvLyBDb252ZXJ0IHRvIGhleCBzdHJpbmdcbiAgcmV0dXJuIEFycmF5LmZyb20oaGFzaClcbiAgICAubWFwKChiOiBudW1iZXIpID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIFwiMFwiKSlcbiAgICAuam9pbihcIlwiKTtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHZlcnNpb24gaXMgc3VwcG9ydGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1ZlcnNpb25TdXBwb3J0ZWQodmVyc2lvbjogbnVtYmVyKTogYm9vbGVhbiB7XG4gIHJldHVybiB2ZXJzaW9uID49IE1JTl9TVVBQT1JURURfVkVSU0lPTiAmJiB2ZXJzaW9uIDw9IE1BWF9TVVBQT1JURURfVkVSU0lPTjtcbn1cblxuLyoqXG4gKiBHZXQgaHVtYW4tcmVhZGFibGUgbWVzc2FnZSB0eXBlIG5hbWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE1lc3NhZ2VUeXBlTmFtZSh0eXBlOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCB0eXBlTmFtZXM6IFJlY29yZDxudW1iZXIsIHN0cmluZz4gPSB7XG4gICAgW01lc3NhZ2VUeXBlLlRFWFRdOiBcIlRFWFRcIixcbiAgICBbTWVzc2FnZVR5cGUuRklMRV9NRVRBREFUQV06IFwiRklMRV9NRVRBREFUQVwiLFxuICAgIFtNZXNzYWdlVHlwZS5GSUxFX0NIVU5LXTogXCJGSUxFX0NIVU5LXCIsXG4gICAgW01lc3NhZ2VUeXBlLlZPSUNFXTogXCJWT0lDRVwiLFxuICAgIFtNZXNzYWdlVHlwZS5NRVNTQUdFX1JFQUNUSU9OXTogXCJNRVNTQUdFX1JFQUNUSU9OXCIsXG4gICAgW01lc3NhZ2VUeXBlLkNPTlRST0xfQUNLXTogXCJDT05UUk9MX0FDS1wiLFxuICAgIFtNZXNzYWdlVHlwZS5DT05UUk9MX1BJTkddOiBcIkNPTlRST0xfUElOR1wiLFxuICAgIFtNZXNzYWdlVHlwZS5DT05UUk9MX1BPTkddOiBcIkNPTlRST0xfUE9OR1wiLFxuICAgIFtNZXNzYWdlVHlwZS5QRUVSX0RJU0NPVkVSWV06IFwiUEVFUl9ESVNDT1ZFUllcIixcbiAgICBbTWVzc2FnZVR5cGUuUEVFUl9JTlRST0RVQ1RJT05dOiBcIlBFRVJfSU5UUk9EVUNUSU9OXCIsXG4gICAgW01lc3NhZ2VUeXBlLktFWV9FWENIQU5HRV06IFwiS0VZX0VYQ0hBTkdFXCIsXG4gICAgW01lc3NhZ2VUeXBlLlNFU1NJT05fS0VZXTogXCJTRVNTSU9OX0tFWVwiLFxuICAgIFtNZXNzYWdlVHlwZS5TRVNTSU9OX1BSRVNFTkNFXTogXCJTRVNTSU9OX1BSRVNFTkNFXCIsXG4gICAgW01lc3NhZ2VUeXBlLkRIVF9GSU5EX05PREVdOiBcIkRIVF9GSU5EX05PREVcIixcbiAgICBbTWVzc2FnZVR5cGUuREhUX0ZPVU5EX05PREVTXTogXCJESFRfRk9VTkRfTk9ERVNcIixcbiAgICBbTWVzc2FnZVR5cGUuREhUX0ZJTkRfVkFMVUVdOiBcIkRIVF9GSU5EX1ZBTFVFXCIsXG4gICAgW01lc3NhZ2VUeXBlLkRIVF9TVE9SRV06IFwiREhUX1NUT1JFXCIsXG4gICAgW01lc3NhZ2VUeXBlLkRIVF9TVE9SRV9BQ0tdOiBcIkRIVF9TVE9SRV9BQ0tcIixcbiAgICBbTWVzc2FnZVR5cGUuREhUX0ZPVU5EX1ZBTFVFXTogXCJESFRfRk9VTkRfVkFMVUVcIixcbiAgICBbTWVzc2FnZVR5cGUuVVBEQVRFX01BTklGRVNUXTogXCJVUERBVEVfTUFOSUZFU1RcIixcbiAgICBbTWVzc2FnZVR5cGUuUkVRVUVTVF9CTE9CXTogXCJSRVFVRVNUX0JMT0JcIixcbiAgICBbTWVzc2FnZVR5cGUuUkVTUE9OU0VfQkxPQl06IFwiUkVTUE9OU0VfQkxPQlwiLFxuICAgIFtNZXNzYWdlVHlwZS5TVE9SRV9TSEFSRV06IFwiU1RPUkVfU0hBUkVcIixcbiAgICBbTWVzc2FnZVR5cGUuUkVRVUVTVF9TSEFSRV06IFwiUkVRVUVTVF9TSEFSRVwiLFxuICAgIFtNZXNzYWdlVHlwZS5SRVNQT05TRV9TSEFSRV06IFwiUkVTUE9OU0VfU0hBUkVcIixcbiAgfTtcbiAgcmV0dXJuIHR5cGVOYW1lc1t0eXBlXSB8fCBgVU5LTk9XTigweCR7dHlwZS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgXCIwXCIpfSlgO1xufVxuIl0sInZlcnNpb24iOjN9