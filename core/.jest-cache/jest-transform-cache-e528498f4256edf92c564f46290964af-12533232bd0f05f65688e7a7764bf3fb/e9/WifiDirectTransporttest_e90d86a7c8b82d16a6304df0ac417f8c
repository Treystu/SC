6fe7848dbbbdcd4701c920d041cea630
"use strict";
/**
 * Tests for Wi-Fi Direct Transport Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
const WifiDirectTransport_js_1 = require("./WifiDirectTransport.js");
describe("WifiDirectTransport", () => {
    let transport;
    const localPeerId = "test-local-peer";
    beforeEach(() => {
        transport = new WifiDirectTransport_js_1.MockWifiDirectTransport(localPeerId);
    });
    afterEach(async () => {
        await transport.stop();
    });
    describe("Initialization", () => {
        it("should create transport with default config", () => {
            expect(transport.localPeerId).toBe(localPeerId);
        });
        it("should create transport with custom config", () => {
            const customTransport = new WifiDirectTransport_js_1.MockWifiDirectTransport(localPeerId, {
                port: 9000,
                preferGroupOwner: true,
            });
            expect(customTransport.localPeerId).toBe(localPeerId);
        });
    });
    describe("Lifecycle", () => {
        it("should start and stop transport", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            expect(transport.getConnectedPeers()).toHaveLength(0);
            await transport.stop();
        });
    });
    describe("Discovery", () => {
        it("should start and stop discovery", async () => {
            const events = {
                onMessage: jest.fn(),
                onDiscoveryStateChanged: jest.fn(),
            };
            await transport.start(events);
            expect(transport.isDiscovering()).toBe(false);
            await transport.startDiscovery();
            expect(transport.isDiscovering()).toBe(true);
            expect(events.onDiscoveryStateChanged).toHaveBeenCalledWith(true);
            await transport.stopDiscovery();
            expect(transport.isDiscovering()).toBe(false);
            expect(events.onDiscoveryStateChanged).toHaveBeenCalledWith(false);
        });
        it("should return discovered devices", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const devices = transport.getDiscoveredDevices();
            expect(Array.isArray(devices)).toBe(true);
        });
    });
    describe("Group Management", () => {
        it("should create a group as group owner", async () => {
            const events = {
                onMessage: jest.fn(),
                onGroupFormed: jest.fn(),
                onRoleChanged: jest.fn(),
            };
            await transport.start(events);
            const groupInfo = await transport.createGroup();
            expect(groupInfo).toBeDefined();
            expect(groupInfo.isOwner).toBe(true);
            expect(groupInfo.networkName).toMatch(/^DIRECT-SC-/);
            expect(events.onGroupFormed).toHaveBeenCalledWith(groupInfo);
            expect(events.onRoleChanged).toHaveBeenCalledWith(WifiDirectTransport_js_1.WifiDirectRole.GROUP_OWNER);
            expect(transport.getRole()).toBe(WifiDirectTransport_js_1.WifiDirectRole.GROUP_OWNER);
        });
        it("should remove a group", async () => {
            const events = {
                onMessage: jest.fn(),
                onGroupRemoved: jest.fn(),
                onRoleChanged: jest.fn(),
            };
            await transport.start(events);
            await transport.createGroup();
            await transport.removeGroup();
            expect(transport.getGroupInfo()).toBeUndefined();
            expect(transport.getRole()).toBe(WifiDirectTransport_js_1.WifiDirectRole.UNDETERMINED);
            expect(events.onGroupRemoved).toHaveBeenCalled();
        });
        it("should get group info when in a group", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.createGroup();
            const groupInfo = transport.getGroupInfo();
            expect(groupInfo).toBeDefined();
            expect(groupInfo?.owner).toBeDefined();
        });
        it("should return undefined when not in a group", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const groupInfo = transport.getGroupInfo();
            expect(groupInfo).toBeUndefined();
        });
    });
    describe("Connection", () => {
        it("should connect to a peer", async () => {
            const events = {
                onMessage: jest.fn(),
                onPeerConnected: jest.fn(),
                onStateChange: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            expect(events.onStateChange).toHaveBeenCalledWith("remote-peer", "connecting");
            expect(events.onStateChange).toHaveBeenCalledWith("remote-peer", "connected");
            expect(events.onPeerConnected).toHaveBeenCalled();
            expect(transport.getConnectedPeers()).toContain("remote-peer");
        });
        it("should disconnect from a peer", async () => {
            const events = {
                onMessage: jest.fn(),
                onPeerDisconnected: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            await transport.disconnect("remote-peer");
            expect(events.onPeerDisconnected).toHaveBeenCalledWith("remote-peer", "disconnected");
            expect(transport.getConnectedPeers()).not.toContain("remote-peer");
        });
    });
    describe("Messaging", () => {
        it("should send message to connected peer", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const payload = new Uint8Array([1, 2, 3, 4, 5]);
            await expect(transport.send("remote-peer", payload)).resolves.not.toThrow();
            const peerInfo = transport.getWifiDirectPeerInfo("remote-peer");
            expect(peerInfo?.bytesSent).toBe(5);
        });
        it("should fail to send to disconnected peer", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const payload = new Uint8Array([1, 2, 3, 4, 5]);
            await expect(transport.send("unknown-peer", payload)).rejects.toThrow();
        });
        it("should broadcast to all connected peers", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("peer1");
            await transport.connect("peer2");
            const payload = new Uint8Array([1, 2, 3]);
            await transport.broadcast(payload);
            const peer1Info = transport.getWifiDirectPeerInfo("peer1");
            const peer2Info = transport.getWifiDirectPeerInfo("peer2");
            expect(peer1Info?.bytesSent).toBe(3);
            expect(peer2Info?.bytesSent).toBe(3);
        });
        it("should receive simulated messages", async () => {
            const onMessage = jest.fn();
            const events = {
                onMessage,
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const payload = new Uint8Array([10, 20, 30]);
            transport.simulateMessage("remote-peer", payload);
            expect(onMessage).toHaveBeenCalledWith(expect.objectContaining({
                from: "remote-peer",
                payload,
            }));
        });
    });
    describe("Wi-Fi Direct Availability", () => {
        it("should check if Wi-Fi Direct is available", async () => {
            const isAvailable = await transport.isWifiDirectAvailable();
            expect(typeof isAvailable).toBe("boolean");
        });
    });
    describe("Connection Info", () => {
        it("should request connection info when in a group", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.createGroup();
            const connInfo = await transport.requestConnectionInfo();
            expect(connInfo).toBeDefined();
            expect(connInfo?.groupOwnerAddress).toBeDefined();
            expect(connInfo?.isGroupOwner).toBe(true);
        });
        it("should return undefined when not in a group", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const connInfo = await transport.requestConnectionInfo();
            expect(connInfo).toBeUndefined();
        });
    });
    describe("Service Discovery", () => {
        it("should register and unregister service", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const serviceRecord = {
                serviceType: "_sc._tcp",
                instanceName: "TestService",
                txtRecord: new Map([["version", "1.0"]]),
            };
            await expect(transport.registerService(serviceRecord)).resolves.not.toThrow();
            await expect(transport.unregisterService()).resolves.not.toThrow();
        });
        it("should discover services", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await expect(transport.discoverServices("_sc._tcp")).resolves.not.toThrow();
        });
    });
    describe("Peer Info", () => {
        it("should return Wi-Fi Direct-specific peer info", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const peerInfo = transport.getWifiDirectPeerInfo("remote-peer");
            expect(peerInfo).toBeDefined();
            expect(peerInfo?.transportType).toBe("wifi-direct");
            expect(peerInfo?.role).toBeDefined();
            expect(peerInfo?.isGroupOwner).toBeDefined();
            expect(peerInfo?.bandwidthMbps).toBeDefined();
        });
        it("should return undefined for unknown peer", () => {
            const peerInfo = transport.getWifiDirectPeerInfo("unknown-peer");
            expect(peerInfo).toBeUndefined();
        });
    });
    describe("Connection Requests", () => {
        it("should handle simulated connection requests", async () => {
            const onConnectionRequest = jest.fn();
            const events = {
                onMessage: jest.fn(),
                onConnectionRequest,
            };
            await transport.start(events);
            const device = {
                deviceId: "incoming-device",
                name: "Test Device",
                status: WifiDirectTransport_js_1.WifiDirectDeviceStatus.AVAILABLE,
                isGroupOwner: false,
                lastSeen: Date.now(),
            };
            transport.simulateConnectionRequest(device);
            expect(onConnectionRequest).toHaveBeenCalledWith(device);
        });
    });
});
describe("Wi-Fi Direct Constants", () => {
    it("should have valid default config", () => {
        expect(WifiDirectTransport_js_1.DEFAULT_WIFI_DIRECT_CONFIG.serviceType).toBeDefined();
        expect(WifiDirectTransport_js_1.DEFAULT_WIFI_DIRECT_CONFIG.port).toBeGreaterThan(0);
        expect(WifiDirectTransport_js_1.DEFAULT_WIFI_DIRECT_CONFIG.maxPeers).toBeGreaterThan(0);
    });
    it("should have valid role enum", () => {
        expect(WifiDirectTransport_js_1.WifiDirectRole.GROUP_OWNER).toBe("group_owner");
        expect(WifiDirectTransport_js_1.WifiDirectRole.CLIENT).toBe("client");
        expect(WifiDirectTransport_js_1.WifiDirectRole.UNDETERMINED).toBe("undetermined");
    });
    it("should have valid device status enum", () => {
        expect(WifiDirectTransport_js_1.WifiDirectDeviceStatus.CONNECTED).toBe("connected");
        expect(WifiDirectTransport_js_1.WifiDirectDeviceStatus.AVAILABLE).toBe("available");
        expect(WifiDirectTransport_js_1.WifiDirectDeviceStatus.UNAVAILABLE).toBe("unavailable");
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvdHJhbnNwb3J0L1dpZmlEaXJlY3RUcmFuc3BvcnQudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgscUVBUWtDO0FBRWxDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxTQUFrQyxDQUFDO0lBQ3ZDLE1BQU0sV0FBVyxHQUFHLGlCQUFpQixDQUFDO0lBRXRDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxTQUFTLEdBQUcsSUFBSSxnREFBdUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN2RCxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQsTUFBTSxlQUFlLEdBQUcsSUFBSSxnREFBdUIsQ0FBQyxXQUFXLEVBQUU7Z0JBQy9ELElBQUksRUFBRSxJQUFJO2dCQUNWLGdCQUFnQixFQUFFLElBQUk7YUFDdkIsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFL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USxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtRQUNyQyxNQUFNLENBQUMsdUNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDdkQsTUFBTSxDQUFDLHVDQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sQ0FBQyx1Q0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUMzRCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsTUFBTSxDQUFDLCtDQUFzQixDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMzRCxNQUFNLENBQUMsK0NBQXNCLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNELE1BQU0sQ0FBQywrQ0FBc0IsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDakUsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy90cmFuc3BvcnQvV2lmaURpcmVjdFRyYW5zcG9ydC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgZm9yIFdpLUZpIERpcmVjdCBUcmFuc3BvcnQgSW1wbGVtZW50YXRpb25cbiAqL1xuXG5pbXBvcnQge1xuICBNb2NrV2lmaURpcmVjdFRyYW5zcG9ydCxcbiAgV2lmaURpcmVjdFJvbGUsXG4gIFdpZmlEaXJlY3REZXZpY2VTdGF0dXMsXG4gIERFRkFVTFRfV0lGSV9ESVJFQ1RfQ09ORklHLFxuICBXaWZpRGlyZWN0VHJhbnNwb3J0RXZlbnRzLFxuICBXaWZpRGlyZWN0RGV2aWNlSW5mbyxcbiAgV2lmaURpcmVjdFNlcnZpY2VSZWNvcmQsXG59IGZyb20gXCIuL1dpZmlEaXJlY3RUcmFuc3BvcnQuanNcIjtcblxuZGVzY3JpYmUoXCJXaWZpRGlyZWN0VHJhbnNwb3J0XCIsICgpID0+IHtcbiAgbGV0IHRyYW5zcG9ydDogTW9ja1dpZmlEaXJlY3RUcmFuc3BvcnQ7XG4gIGNvbnN0IGxvY2FsUGVlcklkID0gXCJ0ZXN0LWxvY2FsLXBlZXJcIjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB0cmFuc3BvcnQgPSBuZXcgTW9ja1dpZmlEaXJlY3RUcmFuc3BvcnQobG9jYWxQZWVySWQpO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHRyYW5zcG9ydC5zdG9wKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiSW5pdGlhbGl6YXRpb25cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNyZWF0ZSB0cmFuc3BvcnQgd2l0aCBkZWZhdWx0IGNvbmZpZ1wiLCAoKSA9PiB7XG4gICAgICBleHBlY3QodHJhbnNwb3J0LmxvY2FsUGVlcklkKS50b0JlKGxvY2FsUGVlcklkKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGNyZWF0ZSB0cmFuc3BvcnQgd2l0aCBjdXN0b20gY29uZmlnXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbVRyYW5zcG9ydCA9IG5ldyBNb2NrV2lmaURpcmVjdFRyYW5zcG9ydChsb2NhbFBlZXJJZCwge1xuICAgICAgICBwb3J0OiA5MDAwLFxuICAgICAgICBwcmVmZXJHcm91cE93bmVyOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoY3VzdG9tVHJhbnNwb3J0LmxvY2FsUGVlcklkKS50b0JlKGxvY2FsUGVlcklkKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJMaWZlY3ljbGVcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHN0YXJ0IGFuZCBzdG9wIHRyYW5zcG9ydFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBleHBlY3QodHJhbnNwb3J0LmdldENvbm5lY3RlZFBlZXJzKCkpLnRvSGF2ZUxlbmd0aCgwKTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0b3AoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJEaXNjb3ZlcnlcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHN0YXJ0IGFuZCBzdG9wIGRpc2NvdmVyeVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgICBvbkRpc2NvdmVyeVN0YXRlQ2hhbmdlZDogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG5cbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuaXNEaXNjb3ZlcmluZygpKS50b0JlKGZhbHNlKTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0RGlzY292ZXJ5KCk7XG4gICAgICBleHBlY3QodHJhbnNwb3J0LmlzRGlzY292ZXJpbmcoKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChldmVudHMub25EaXNjb3ZlcnlTdGF0ZUNoYW5nZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHRydWUpO1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RvcERpc2NvdmVyeSgpO1xuICAgICAgZXhwZWN0KHRyYW5zcG9ydC5pc0Rpc2NvdmVyaW5nKCkpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGV2ZW50cy5vbkRpc2NvdmVyeVN0YXRlQ2hhbmdlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIGRpc2NvdmVyZWQgZGV2aWNlc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRldmljZXMgPSB0cmFuc3BvcnQuZ2V0RGlzY292ZXJlZERldmljZXMoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KGRldmljZXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkdyb3VwIE1hbmFnZW1lbnRcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNyZWF0ZSBhIGdyb3VwIGFzIGdyb3VwIG93bmVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uR3JvdXBGb3JtZWQ6IGplc3QuZm4oKSxcbiAgICAgICAgb25Sb2xlQ2hhbmdlZDogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBjb25zdCBncm91cEluZm8gPSBhd2FpdCB0cmFuc3BvcnQuY3JlYXRlR3JvdXAoKTtcblxuICAgICAgZXhwZWN0KGdyb3VwSW5mbykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChncm91cEluZm8uaXNPd25lcikudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChncm91cEluZm8ubmV0d29ya05hbWUpLnRvTWF0Y2goL15ESVJFQ1QtU0MtLyk7XG4gICAgICBleHBlY3QoZXZlbnRzLm9uR3JvdXBGb3JtZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGdyb3VwSW5mbyk7XG4gICAgICBleHBlY3QoZXZlbnRzLm9uUm9sZUNoYW5nZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFdpZmlEaXJlY3RSb2xlLkdST1VQX09XTkVSKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuZ2V0Um9sZSgpKS50b0JlKFdpZmlEaXJlY3RSb2xlLkdST1VQX09XTkVSKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJlbW92ZSBhIGdyb3VwXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uR3JvdXBSZW1vdmVkOiBqZXN0LmZuKCksXG4gICAgICAgIG9uUm9sZUNoYW5nZWQ6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNyZWF0ZUdyb3VwKCk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQucmVtb3ZlR3JvdXAoKTtcblxuICAgICAgZXhwZWN0KHRyYW5zcG9ydC5nZXRHcm91cEluZm8oKSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRyYW5zcG9ydC5nZXRSb2xlKCkpLnRvQmUoV2lmaURpcmVjdFJvbGUuVU5ERVRFUk1JTkVEKTtcbiAgICAgIGV4cGVjdChldmVudHMub25Hcm91cFJlbW92ZWQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGdldCBncm91cCBpbmZvIHdoZW4gaW4gYSBncm91cFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY3JlYXRlR3JvdXAoKTtcblxuICAgICAgY29uc3QgZ3JvdXBJbmZvID0gdHJhbnNwb3J0LmdldEdyb3VwSW5mbygpO1xuICAgICAgZXhwZWN0KGdyb3VwSW5mbykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChncm91cEluZm8/Lm93bmVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIHVuZGVmaW5lZCB3aGVuIG5vdCBpbiBhIGdyb3VwXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcblxuICAgICAgY29uc3QgZ3JvdXBJbmZvID0gdHJhbnNwb3J0LmdldEdyb3VwSW5mbygpO1xuICAgICAgZXhwZWN0KGdyb3VwSW5mbykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkNvbm5lY3Rpb25cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNvbm5lY3QgdG8gYSBwZWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uUGVlckNvbm5lY3RlZDogamVzdC5mbigpLFxuICAgICAgICBvblN0YXRlQ2hhbmdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicmVtb3RlLXBlZXJcIik7XG5cbiAgICAgIGV4cGVjdChldmVudHMub25TdGF0ZUNoYW5nZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJyZW1vdGUtcGVlclwiLCBcImNvbm5lY3RpbmdcIik7XG4gICAgICBleHBlY3QoZXZlbnRzLm9uU3RhdGVDaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwicmVtb3RlLXBlZXJcIiwgXCJjb25uZWN0ZWRcIik7XG4gICAgICBleHBlY3QoZXZlbnRzLm9uUGVlckNvbm5lY3RlZCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHRyYW5zcG9ydC5nZXRDb25uZWN0ZWRQZWVycygpKS50b0NvbnRhaW4oXCJyZW1vdGUtcGVlclwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGRpc2Nvbm5lY3QgZnJvbSBhIHBlZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBXaWZpRGlyZWN0VHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgICAgb25QZWVyRGlzY29ubmVjdGVkOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicmVtb3RlLXBlZXJcIik7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuZGlzY29ubmVjdChcInJlbW90ZS1wZWVyXCIpO1xuXG4gICAgICBleHBlY3QoZXZlbnRzLm9uUGVlckRpc2Nvbm5lY3RlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJyZW1vdGUtcGVlclwiLCBcImRpc2Nvbm5lY3RlZFwiKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuZ2V0Q29ubmVjdGVkUGVlcnMoKSkubm90LnRvQ29udGFpbihcInJlbW90ZS1wZWVyXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIk1lc3NhZ2luZ1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgc2VuZCBtZXNzYWdlIHRvIGNvbm5lY3RlZCBwZWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicmVtb3RlLXBlZXJcIik7XG5cbiAgICAgIGNvbnN0IHBheWxvYWQgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuICAgICAgYXdhaXQgZXhwZWN0KHRyYW5zcG9ydC5zZW5kKFwicmVtb3RlLXBlZXJcIiwgcGF5bG9hZCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG5cbiAgICAgIGNvbnN0IHBlZXJJbmZvID0gdHJhbnNwb3J0LmdldFdpZmlEaXJlY3RQZWVySW5mbyhcInJlbW90ZS1wZWVyXCIpO1xuICAgICAgZXhwZWN0KHBlZXJJbmZvPy5ieXRlc1NlbnQpLnRvQmUoNSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBmYWlsIHRvIHNlbmQgdG8gZGlzY29ubmVjdGVkIHBlZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBXaWZpRGlyZWN0VHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuXG4gICAgICBjb25zdCBwYXlsb2FkID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGF3YWl0IGV4cGVjdCh0cmFuc3BvcnQuc2VuZChcInVua25vd24tcGVlclwiLCBwYXlsb2FkKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBicm9hZGNhc3QgdG8gYWxsIGNvbm5lY3RlZCBwZWVyc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY29ubmVjdChcInBlZXIxXCIpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNvbm5lY3QoXCJwZWVyMlwiKTtcblxuICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzXSk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuYnJvYWRjYXN0KHBheWxvYWQpO1xuXG4gICAgICBjb25zdCBwZWVyMUluZm8gPSB0cmFuc3BvcnQuZ2V0V2lmaURpcmVjdFBlZXJJbmZvKFwicGVlcjFcIik7XG4gICAgICBjb25zdCBwZWVyMkluZm8gPSB0cmFuc3BvcnQuZ2V0V2lmaURpcmVjdFBlZXJJbmZvKFwicGVlcjJcIik7XG4gICAgICBleHBlY3QocGVlcjFJbmZvPy5ieXRlc1NlbnQpLnRvQmUoMyk7XG4gICAgICBleHBlY3QocGVlcjJJbmZvPy5ieXRlc1NlbnQpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZWNlaXZlIHNpbXVsYXRlZCBtZXNzYWdlc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvbk1lc3NhZ2UgPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNvbm5lY3QoXCJyZW1vdGUtcGVlclwiKTtcblxuICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBVaW50OEFycmF5KFsxMCwgMjAsIDMwXSk7XG4gICAgICB0cmFuc3BvcnQuc2ltdWxhdGVNZXNzYWdlKFwicmVtb3RlLXBlZXJcIiwgcGF5bG9hZCk7XG5cbiAgICAgIGV4cGVjdChvbk1lc3NhZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZnJvbTogXCJyZW1vdGUtcGVlclwiLFxuICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIldpLUZpIERpcmVjdCBBdmFpbGFiaWxpdHlcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNoZWNrIGlmIFdpLUZpIERpcmVjdCBpcyBhdmFpbGFibGVcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXNBdmFpbGFibGUgPSBhd2FpdCB0cmFuc3BvcnQuaXNXaWZpRGlyZWN0QXZhaWxhYmxlKCk7XG4gICAgICBleHBlY3QodHlwZW9mIGlzQXZhaWxhYmxlKS50b0JlKFwiYm9vbGVhblwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJDb25uZWN0aW9uIEluZm9cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJlcXVlc3QgY29ubmVjdGlvbiBpbmZvIHdoZW4gaW4gYSBncm91cFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IFdpZmlEaXJlY3RUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY3JlYXRlR3JvdXAoKTtcblxuICAgICAgY29uc3QgY29ubkluZm8gPSBhd2FpdCB0cmFuc3BvcnQucmVxdWVzdENvbm5lY3Rpb25JbmZvKCk7XG4gICAgICBleHBlY3QoY29ubkluZm8pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY29ubkluZm8/Lmdyb3VwT3duZXJBZGRyZXNzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGNvbm5JbmZvPy5pc0dyb3VwT3duZXIpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZXR1cm4gdW5kZWZpbmVkIHdoZW4gbm90IGluIGEgZ3JvdXBcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBXaWZpRGlyZWN0VHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuXG4gICAgICBjb25zdCBjb25uSW5mbyA9IGF3YWl0IHRyYW5zcG9ydC5yZXF1ZXN0Q29ubmVjdGlvbkluZm8oKTtcbiAgICAgIGV4cGVjdChjb25uSW5mbykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlNlcnZpY2UgRGlzY292ZXJ5XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCByZWdpc3RlciBhbmQgdW5yZWdpc3RlciBzZXJ2aWNlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcblxuICAgICAgY29uc3Qgc2VydmljZVJlY29yZDogV2lmaURpcmVjdFNlcnZpY2VSZWNvcmQgPSB7XG4gICAgICAgIHNlcnZpY2VUeXBlOiBcIl9zYy5fdGNwXCIsXG4gICAgICAgIGluc3RhbmNlTmFtZTogXCJUZXN0U2VydmljZVwiLFxuICAgICAgICB0eHRSZWNvcmQ6IG5ldyBNYXAoW1tcInZlcnNpb25cIiwgXCIxLjBcIl1dKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdCh0cmFuc3BvcnQucmVnaXN0ZXJTZXJ2aWNlKHNlcnZpY2VSZWNvcmQpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgYXdhaXQgZXhwZWN0KHRyYW5zcG9ydC51bnJlZ2lzdGVyU2VydmljZSgpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZGlzY292ZXIgc2VydmljZXNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBXaWZpRGlyZWN0VHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuXG4gICAgICBhd2FpdCBleHBlY3QodHJhbnNwb3J0LmRpc2NvdmVyU2VydmljZXMoXCJfc2MuX3RjcFwiKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJQZWVyIEluZm9cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBXaS1GaSBEaXJlY3Qtc3BlY2lmaWMgcGVlciBpbmZvXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicmVtb3RlLXBlZXJcIik7XG5cbiAgICAgIGNvbnN0IHBlZXJJbmZvID0gdHJhbnNwb3J0LmdldFdpZmlEaXJlY3RQZWVySW5mbyhcInJlbW90ZS1wZWVyXCIpO1xuICAgICAgZXhwZWN0KHBlZXJJbmZvKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHBlZXJJbmZvPy50cmFuc3BvcnRUeXBlKS50b0JlKFwid2lmaS1kaXJlY3RcIik7XG4gICAgICBleHBlY3QocGVlckluZm8/LnJvbGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocGVlckluZm8/LmlzR3JvdXBPd25lcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChwZWVySW5mbz8uYmFuZHdpZHRoTWJwcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJldHVybiB1bmRlZmluZWQgZm9yIHVua25vd24gcGVlclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZWVySW5mbyA9IHRyYW5zcG9ydC5nZXRXaWZpRGlyZWN0UGVlckluZm8oXCJ1bmtub3duLXBlZXJcIik7XG4gICAgICBleHBlY3QocGVlckluZm8pLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJDb25uZWN0aW9uIFJlcXVlc3RzXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBoYW5kbGUgc2ltdWxhdGVkIGNvbm5lY3Rpb24gcmVxdWVzdHNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb25Db25uZWN0aW9uUmVxdWVzdCA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IGV2ZW50czogV2lmaURpcmVjdFRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uQ29ubmVjdGlvblJlcXVlc3QsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcblxuICAgICAgY29uc3QgZGV2aWNlOiBXaWZpRGlyZWN0RGV2aWNlSW5mbyA9IHtcbiAgICAgICAgZGV2aWNlSWQ6IFwiaW5jb21pbmctZGV2aWNlXCIsXG4gICAgICAgIG5hbWU6IFwiVGVzdCBEZXZpY2VcIixcbiAgICAgICAgc3RhdHVzOiBXaWZpRGlyZWN0RGV2aWNlU3RhdHVzLkFWQUlMQUJMRSxcbiAgICAgICAgaXNHcm91cE93bmVyOiBmYWxzZSxcbiAgICAgICAgbGFzdFNlZW46IERhdGUubm93KCksXG4gICAgICB9O1xuXG4gICAgICB0cmFuc3BvcnQuc2ltdWxhdGVDb25uZWN0aW9uUmVxdWVzdChkZXZpY2UpO1xuXG4gICAgICBleHBlY3Qob25Db25uZWN0aW9uUmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZGV2aWNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoXCJXaS1GaSBEaXJlY3QgQ29uc3RhbnRzXCIsICgpID0+IHtcbiAgaXQoXCJzaG91bGQgaGF2ZSB2YWxpZCBkZWZhdWx0IGNvbmZpZ1wiLCAoKSA9PiB7XG4gICAgZXhwZWN0KERFRkFVTFRfV0lGSV9ESVJFQ1RfQ09ORklHLnNlcnZpY2VUeXBlKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChERUZBVUxUX1dJRklfRElSRUNUX0NPTkZJRy5wb3J0KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgZXhwZWN0KERFRkFVTFRfV0lGSV9ESVJFQ1RfQ09ORklHLm1heFBlZXJzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGhhdmUgdmFsaWQgcm9sZSBlbnVtXCIsICgpID0+IHtcbiAgICBleHBlY3QoV2lmaURpcmVjdFJvbGUuR1JPVVBfT1dORVIpLnRvQmUoXCJncm91cF9vd25lclwiKTtcbiAgICBleHBlY3QoV2lmaURpcmVjdFJvbGUuQ0xJRU5UKS50b0JlKFwiY2xpZW50XCIpO1xuICAgIGV4cGVjdChXaWZpRGlyZWN0Um9sZS5VTkRFVEVSTUlORUQpLnRvQmUoXCJ1bmRldGVybWluZWRcIik7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGhhdmUgdmFsaWQgZGV2aWNlIHN0YXR1cyBlbnVtXCIsICgpID0+IHtcbiAgICBleHBlY3QoV2lmaURpcmVjdERldmljZVN0YXR1cy5DT05ORUNURUQpLnRvQmUoXCJjb25uZWN0ZWRcIik7XG4gICAgZXhwZWN0KFdpZmlEaXJlY3REZXZpY2VTdGF0dXMuQVZBSUxBQkxFKS50b0JlKFwiYXZhaWxhYmxlXCIpO1xuICAgIGV4cGVjdChXaWZpRGlyZWN0RGV2aWNlU3RhdHVzLlVOQVZBSUxBQkxFKS50b0JlKFwidW5hdmFpbGFibGVcIik7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=