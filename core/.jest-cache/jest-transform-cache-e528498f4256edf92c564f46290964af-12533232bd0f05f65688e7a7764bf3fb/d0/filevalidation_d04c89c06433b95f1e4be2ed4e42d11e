25f5952d0b91158ad472c798195a1ff4
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FILE_LIMITS = void 0;
exports.validateFile = validateFile;
exports.validateFileList = validateFileList;
exports.FILE_LIMITS = {
    MAX_SIZE: 100 * 1024 * 1024, // 100MB
    MAX_FILES_PER_MESSAGE: 10,
    ALLOWED_TYPES: [
        // Images
        "image/jpeg",
        "image/png",
        "image/gif",
        "image/webp",
        // Videos
        "video/mp4",
        "video/webm",
        "video/quicktime",
        // Audio
        "audio/mpeg",
        "audio/ogg",
        "audio/wav",
        "audio/webm",
        // Documents
        "application/pdf",
        "text/plain",
        // Archives
        "application/zip",
        "application/x-7z-compressed",
    ],
    BLOCKED_EXTENSIONS: [
        ".exe",
        ".bat",
        ".cmd",
        ".com",
        ".pif",
        ".scr",
        ".vbs",
        ".js",
        ".jar",
        ".app",
        ".deb",
        ".rpm",
    ],
};
function validateFile(file) {
    // Check file size
    if (file.size > exports.FILE_LIMITS.MAX_SIZE) {
        return {
            valid: false,
            error: `File too large. Maximum size is ${exports.FILE_LIMITS.MAX_SIZE / 1024 / 1024}MB`,
        };
    }
    // Check file type
    if (!exports.FILE_LIMITS.ALLOWED_TYPES.includes(file.type)) {
        return {
            valid: false,
            error: `File type not allowed: ${file.type}`,
        };
    }
    // Check file extension
    const extension = "." + file.name.split(".").pop()?.toLowerCase();
    if (exports.FILE_LIMITS.BLOCKED_EXTENSIONS.includes(extension)) {
        return {
            valid: false,
            error: `File extension not allowed: ${extension}`,
        };
    }
    // Sanitize filename
    const sanitizedName = sanitizeFilename(file.name);
    return {
        valid: true,
        sanitizedName,
    };
}
function validateFileList(files) {
    if (files.length > exports.FILE_LIMITS.MAX_FILES_PER_MESSAGE) {
        return {
            valid: false,
            error: `Too many files. Maximum is ${exports.FILE_LIMITS.MAX_FILES_PER_MESSAGE} files per message`,
        };
    }
    for (const file of Array.from(files)) {
        const result = validateFile(file);
        if (!result.valid) {
            return result;
        }
    }
    return { valid: true };
}
function sanitizeFilename(filename) {
    // Remove path traversal attempts
    let sanitized = filename.replace(/\.\./g, "");
    // Remove special characters except dots, dashes, underscores
    sanitized = sanitized.replace(/[^a-zA-Z0-9.\-_]/g, "_");
    // Limit length
    if (sanitized.length > 255) {
        const ext = filename.toLowerCase().split(".").pop();
        sanitized = sanitized.substring(0, 250) + "." + ext;
    }
    return sanitized;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvZmlsZS12YWxpZGF0aW9uLnRzIiwibWFwcGluZ3MiOiI7OztBQStDQSxvQ0FpQ0M7QUFFRCw0Q0FrQkM7QUE5RlksUUFBQSxXQUFXLEdBQUc7SUFDekIsUUFBUSxFQUFFLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxFQUFFLFFBQVE7SUFDckMscUJBQXFCLEVBQUUsRUFBRTtJQUN6QixhQUFhLEVBQUU7UUFDYixTQUFTO1FBQ1QsWUFBWTtRQUNaLFdBQVc7UUFDWCxXQUFXO1FBQ1gsWUFBWTtRQUNaLFNBQVM7UUFDVCxXQUFXO1FBQ1gsWUFBWTtRQUNaLGlCQUFpQjtRQUNqQixRQUFRO1FBQ1IsWUFBWTtRQUNaLFdBQVc7UUFDWCxXQUFXO1FBQ1gsWUFBWTtRQUNaLFlBQVk7UUFDWixpQkFBaUI7UUFDakIsWUFBWTtRQUNaLFdBQVc7UUFDWCxpQkFBaUI7UUFDakIsNkJBQTZCO0tBQzlCO0lBQ0Qsa0JBQWtCLEVBQUU7UUFDbEIsTUFBTTtRQUNOLE1BQU07UUFDTixNQUFNO1FBQ04sTUFBTTtRQUNOLE1BQU07UUFDTixNQUFNO1FBQ04sTUFBTTtRQUNOLEtBQUs7UUFDTCxNQUFNO1FBQ04sTUFBTTtRQUNOLE1BQU07UUFDTixNQUFNO0tBQ1A7Q0FDRixDQUFDO0FBRUYsU0FBZ0IsWUFBWSxDQUFDLElBQVU7SUFDckMsa0JBQWtCO0lBQ2xCLElBQUksSUFBSSxDQUFDLElBQUksR0FBRyxtQkFBVyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3JDLE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSxtQ0FBbUMsbUJBQVcsQ0FBQyxRQUFRLEdBQUcsSUFBSSxHQUFHLElBQUksSUFBSTtTQUNqRixDQUFDO0lBQ0osQ0FBQztJQUVELGtCQUFrQjtJQUNsQixJQUFJLENBQUMsbUJBQVcsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ25ELE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSwwQkFBMEIsSUFBSSxDQUFDLElBQUksRUFBRTtTQUM3QyxDQUFDO0lBQ0osQ0FBQztJQUVELHVCQUF1QjtJQUN2QixNQUFNLFNBQVMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsV0FBVyxFQUFFLENBQUM7SUFDbEUsSUFBSSxtQkFBVyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQ3ZELE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSwrQkFBK0IsU0FBUyxFQUFFO1NBQ2xELENBQUM7SUFDSixDQUFDO0lBRUQsb0JBQW9CO0lBQ3BCLE1BQU0sYUFBYSxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVsRCxPQUFPO1FBQ0wsS0FBSyxFQUFFLElBQUk7UUFDWCxhQUFhO0tBQ2QsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFnQixnQkFBZ0IsQ0FDOUIsS0FBd0I7SUFFeEIsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLG1CQUFXLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNyRCxPQUFPO1lBQ0wsS0FBSyxFQUFFLEtBQUs7WUFDWixLQUFLLEVBQUUsOEJBQThCLG1CQUFXLENBQUMscUJBQXFCLG9CQUFvQjtTQUMzRixDQUFDO0lBQ0osQ0FBQztJQUVELEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3JDLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2xCLE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBRUQsU0FBUyxnQkFBZ0IsQ0FBQyxRQUFnQjtJQUN4QyxpQ0FBaUM7SUFDakMsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFFOUMsNkRBQTZEO0lBQzdELFNBQVMsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLG1CQUFtQixFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRXhELGVBQWU7SUFDZixJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDM0IsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNwRCxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUN0RCxDQUFDO0lBRUQsT0FBTyxTQUFTLENBQUM7QUFDbkIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy9maWxlLXZhbGlkYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGludGVyZmFjZSBGaWxlVmFsaWRhdGlvblJlc3VsdCB7XG4gIHZhbGlkOiBib29sZWFuO1xuICBlcnJvcj86IHN0cmluZztcbiAgc2FuaXRpemVkTmFtZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IEZJTEVfTElNSVRTID0ge1xuICBNQVhfU0laRTogMTAwICogMTAyNCAqIDEwMjQsIC8vIDEwME1CXG4gIE1BWF9GSUxFU19QRVJfTUVTU0FHRTogMTAsXG4gIEFMTE9XRURfVFlQRVM6IFtcbiAgICAvLyBJbWFnZXNcbiAgICBcImltYWdlL2pwZWdcIixcbiAgICBcImltYWdlL3BuZ1wiLFxuICAgIFwiaW1hZ2UvZ2lmXCIsXG4gICAgXCJpbWFnZS93ZWJwXCIsXG4gICAgLy8gVmlkZW9zXG4gICAgXCJ2aWRlby9tcDRcIixcbiAgICBcInZpZGVvL3dlYm1cIixcbiAgICBcInZpZGVvL3F1aWNrdGltZVwiLFxuICAgIC8vIEF1ZGlvXG4gICAgXCJhdWRpby9tcGVnXCIsXG4gICAgXCJhdWRpby9vZ2dcIixcbiAgICBcImF1ZGlvL3dhdlwiLFxuICAgIFwiYXVkaW8vd2VibVwiLFxuICAgIC8vIERvY3VtZW50c1xuICAgIFwiYXBwbGljYXRpb24vcGRmXCIsXG4gICAgXCJ0ZXh0L3BsYWluXCIsXG4gICAgLy8gQXJjaGl2ZXNcbiAgICBcImFwcGxpY2F0aW9uL3ppcFwiLFxuICAgIFwiYXBwbGljYXRpb24veC03ei1jb21wcmVzc2VkXCIsXG4gIF0sXG4gIEJMT0NLRURfRVhURU5TSU9OUzogW1xuICAgIFwiLmV4ZVwiLFxuICAgIFwiLmJhdFwiLFxuICAgIFwiLmNtZFwiLFxuICAgIFwiLmNvbVwiLFxuICAgIFwiLnBpZlwiLFxuICAgIFwiLnNjclwiLFxuICAgIFwiLnZic1wiLFxuICAgIFwiLmpzXCIsXG4gICAgXCIuamFyXCIsXG4gICAgXCIuYXBwXCIsXG4gICAgXCIuZGViXCIsXG4gICAgXCIucnBtXCIsXG4gIF0sXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVGaWxlKGZpbGU6IEZpbGUpOiBGaWxlVmFsaWRhdGlvblJlc3VsdCB7XG4gIC8vIENoZWNrIGZpbGUgc2l6ZVxuICBpZiAoZmlsZS5zaXplID4gRklMRV9MSU1JVFMuTUFYX1NJWkUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgZXJyb3I6IGBGaWxlIHRvbyBsYXJnZS4gTWF4aW11bSBzaXplIGlzICR7RklMRV9MSU1JVFMuTUFYX1NJWkUgLyAxMDI0IC8gMTAyNH1NQmAsXG4gICAgfTtcbiAgfVxuXG4gIC8vIENoZWNrIGZpbGUgdHlwZVxuICBpZiAoIUZJTEVfTElNSVRTLkFMTE9XRURfVFlQRVMuaW5jbHVkZXMoZmlsZS50eXBlKSkge1xuICAgIHJldHVybiB7XG4gICAgICB2YWxpZDogZmFsc2UsXG4gICAgICBlcnJvcjogYEZpbGUgdHlwZSBub3QgYWxsb3dlZDogJHtmaWxlLnR5cGV9YCxcbiAgICB9O1xuICB9XG5cbiAgLy8gQ2hlY2sgZmlsZSBleHRlbnNpb25cbiAgY29uc3QgZXh0ZW5zaW9uID0gXCIuXCIgKyBmaWxlLm5hbWUuc3BsaXQoXCIuXCIpLnBvcCgpPy50b0xvd2VyQ2FzZSgpO1xuICBpZiAoRklMRV9MSU1JVFMuQkxPQ0tFRF9FWFRFTlNJT05TLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgZXJyb3I6IGBGaWxlIGV4dGVuc2lvbiBub3QgYWxsb3dlZDogJHtleHRlbnNpb259YCxcbiAgICB9O1xuICB9XG5cbiAgLy8gU2FuaXRpemUgZmlsZW5hbWVcbiAgY29uc3Qgc2FuaXRpemVkTmFtZSA9IHNhbml0aXplRmlsZW5hbWUoZmlsZS5uYW1lKTtcblxuICByZXR1cm4ge1xuICAgIHZhbGlkOiB0cnVlLFxuICAgIHNhbml0aXplZE5hbWUsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUZpbGVMaXN0KFxuICBmaWxlczogRmlsZUxpc3QgfCBGaWxlW10sXG4pOiBGaWxlVmFsaWRhdGlvblJlc3VsdCB7XG4gIGlmIChmaWxlcy5sZW5ndGggPiBGSUxFX0xJTUlUUy5NQVhfRklMRVNfUEVSX01FU1NBR0UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgZXJyb3I6IGBUb28gbWFueSBmaWxlcy4gTWF4aW11bSBpcyAke0ZJTEVfTElNSVRTLk1BWF9GSUxFU19QRVJfTUVTU0FHRX0gZmlsZXMgcGVyIG1lc3NhZ2VgLFxuICAgIH07XG4gIH1cblxuICBmb3IgKGNvbnN0IGZpbGUgb2YgQXJyYXkuZnJvbShmaWxlcykpIHtcbiAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgaWYgKCFyZXN1bHQudmFsaWQpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfTtcbn1cblxuZnVuY3Rpb24gc2FuaXRpemVGaWxlbmFtZShmaWxlbmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gUmVtb3ZlIHBhdGggdHJhdmVyc2FsIGF0dGVtcHRzXG4gIGxldCBzYW5pdGl6ZWQgPSBmaWxlbmFtZS5yZXBsYWNlKC9cXC5cXC4vZywgXCJcIik7XG5cbiAgLy8gUmVtb3ZlIHNwZWNpYWwgY2hhcmFjdGVycyBleGNlcHQgZG90cywgZGFzaGVzLCB1bmRlcnNjb3Jlc1xuICBzYW5pdGl6ZWQgPSBzYW5pdGl6ZWQucmVwbGFjZSgvW15hLXpBLVowLTkuXFwtX10vZywgXCJfXCIpO1xuXG4gIC8vIExpbWl0IGxlbmd0aFxuICBpZiAoc2FuaXRpemVkLmxlbmd0aCA+IDI1NSkge1xuICAgIGNvbnN0IGV4dCA9IGZpbGVuYW1lLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIuXCIpLnBvcCgpO1xuICAgIHNhbml0aXplZCA9IHNhbml0aXplZC5zdWJzdHJpbmcoMCwgMjUwKSArIFwiLlwiICsgZXh0O1xuICB9XG5cbiAgcmV0dXJuIHNhbml0aXplZDtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==