{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/discovery/peer.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/discovery/peer.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach } from '@jest/globals';\nimport {\n  QRCodeDiscovery,\n  ManualDiscovery,\n  type PeerInfo,\n  type PeerEndpoint,\n} from './peer';\n\ndescribe('QRCodeDiscovery', () => {\n  let mockPeerInfo: PeerInfo;\n\n  beforeEach(() => {\n    mockPeerInfo = {\n      publicKey: new Uint8Array([1, 2, 3, 4, 5]),\n      peerId: 'test-peer-123',\n      displayName: 'Test Peer',\n      endpoints: [\n        { type: 'webrtc', signaling: 'signal-server-1' },\n        { type: 'local', address: '192.168.1.100:8080' },\n      ],\n      timestamp: 1234567890,\n    };\n  });\n\n  describe('generateQRData', () => {\n    it('should generate QR code data with sc:// prefix', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      expect(qrData).toMatch(/^sc:\\/\\//);\n    });\n\n    it('should encode peer info in QR code', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      expect(qrData.length).toBeGreaterThan(20);\n    });\n\n    it('should handle peer without display name', () => {\n      const peerWithoutName = { ...mockPeerInfo, displayName: undefined };\n      const qrData = QRCodeDiscovery.generateQRData(peerWithoutName);\n      expect(qrData).toMatch(/^sc:\\/\\//);\n    });\n\n    it('should handle peer with multiple endpoints', () => {\n      const peerWithEndpoints = {\n        ...mockPeerInfo,\n        endpoints: [\n          { type: 'webrtc' as const, signaling: 'sig1' },\n          { type: 'bluetooth' as const, rssi: -50 },\n          { type: 'local' as const, address: '10.0.0.1:3000' },\n        ],\n      };\n      const qrData = QRCodeDiscovery.generateQRData(peerWithEndpoints);\n      expect(qrData).toBeDefined();\n    });\n\n    it('should encode public key as hex string', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      expect(parsedPeer).toBeDefined();\n      if (parsedPeer) {\n        expect(parsedPeer.publicKey).toEqual(mockPeerInfo.publicKey);\n      }\n    });\n  });\n\n  describe('parseQRData', () => {\n    it('should parse valid QR code data', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      \n      expect(parsedPeer).toBeDefined();\n      expect(parsedPeer?.peerId).toBe(mockPeerInfo.peerId);\n      expect(parsedPeer?.displayName).toBe(mockPeerInfo.displayName);\n    });\n\n    it('should return null for invalid QR code', () => {\n      const result = QRCodeDiscovery.parseQRData('invalid-qr-code');\n      expect(result).toBeNull();\n    });\n\n    it('should return null for malformed sc:// data', () => {\n      const result = QRCodeDiscovery.parseQRData('sc://not-base64!!!');\n      expect(result).toBeNull();\n    });\n\n    it('should parse QR code without sc:// prefix', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      const withoutPrefix = qrData.replace('sc://', '');\n      const result = QRCodeDiscovery.parseQRData(withoutPrefix);\n      expect(result).toBeDefined();\n    });\n\n    it('should reconstruct public key from hex', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      \n      expect(parsedPeer?.publicKey).toEqual(mockPeerInfo.publicKey);\n    });\n\n    it('should reconstruct endpoints', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      \n      expect(parsedPeer?.endpoints).toHaveLength(2);\n      expect(parsedPeer?.endpoints[0].type).toBe('webrtc');\n      expect(parsedPeer?.endpoints[1].type).toBe('local');\n    });\n\n    it('should handle empty endpoints array', () => {\n      const peerWithoutEndpoints = { ...mockPeerInfo, endpoints: [] };\n      const qrData = QRCodeDiscovery.generateQRData(peerWithoutEndpoints);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      \n      expect(parsedPeer?.endpoints).toEqual([]);\n    });\n  });\n\n  describe('roundtrip encoding', () => {\n    it('should preserve peer info through encode/decode cycle', () => {\n      const qrData = QRCodeDiscovery.generateQRData(mockPeerInfo);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      \n      expect(parsedPeer?.peerId).toBe(mockPeerInfo.peerId);\n      expect(parsedPeer?.displayName).toBe(mockPeerInfo.displayName);\n      expect(parsedPeer?.timestamp).toBe(mockPeerInfo.timestamp);\n    });\n\n    it('should handle large public keys', () => {\n      const largePeer = {\n        ...mockPeerInfo,\n        publicKey: new Uint8Array(32).fill(255),\n      };\n      const qrData = QRCodeDiscovery.generateQRData(largePeer);\n      const parsedPeer = QRCodeDiscovery.parseQRData(qrData);\n      \n      expect(parsedPeer?.publicKey).toHaveLength(32);\n    });\n  });\n});\n\ndescribe('ManualDiscovery', () => {\n  describe('parseManualEntry', () => {\n    it('should parse valid IP:port address', () => {\n      const result = ManualDiscovery.parseManualEntry('192.168.1.100:8080');\n      expect(result).toBeDefined();\n      expect(result?.type).toBe('manual');\n      expect(result?.address).toBe('192.168.1.100:8080');\n    });\n\n    it('should parse peer_id@IP:port format', () => {\n      const result = ManualDiscovery.parseManualEntry('peer123@10.0.0.1:3000');\n      expect(result).toBeDefined();\n      expect(result?.type).toBe('manual');\n      expect(result?.address).toBe('10.0.0.1:3000');\n    });\n\n    it('should reject invalid port numbers', () => {\n      const result1 = ManualDiscovery.parseManualEntry('192.168.1.1:0');\n      expect(result1).toBeNull();\n      \n      const result2 = ManualDiscovery.parseManualEntry('192.168.1.1:70000');\n      expect(result2).toBeNull();\n      \n      const result3 = ManualDiscovery.parseManualEntry('192.168.1.1:-1');\n      expect(result3).toBeNull();\n    });\n\n    it('should reject malformed addresses', () => {\n      const result1 = ManualDiscovery.parseManualEntry('invalid');\n      expect(result1).toBeNull();\n      \n      const result2 = ManualDiscovery.parseManualEntry('192.168.1.1');\n      expect(result2).toBeNull();\n      \n      const result3 = ManualDiscovery.parseManualEntry('192.168.1.1:abc');\n      expect(result3).toBeNull();\n    });\n\n    it('should handle IPv6 addresses', () => {\n      const result = ManualDiscovery.parseManualEntry('[::1]:8080');\n      // May or may not be supported depending on implementation\n      expect(result).toBeDefined();\n    });\n\n    it('should handle domain names with ports', () => {\n      const result = ManualDiscovery.parseManualEntry('example.com:8080');\n      expect(result).toBeDefined();\n      expect(result?.address).toBe('example.com:8080');\n    });\n  });\n});\n"],"version":3}