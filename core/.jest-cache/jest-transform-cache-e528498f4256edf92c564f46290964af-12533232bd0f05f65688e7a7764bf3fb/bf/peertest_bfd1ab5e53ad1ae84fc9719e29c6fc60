72e47d606263447990f5c2de55c6df5a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const peer_1 = require("./peer");
(0, globals_1.describe)('QRCodeDiscovery', () => {
    let mockPeerInfo;
    (0, globals_1.beforeEach)(() => {
        mockPeerInfo = {
            publicKey: new Uint8Array([1, 2, 3, 4, 5]),
            peerId: 'test-peer-123',
            displayName: 'Test Peer',
            endpoints: [
                { type: 'webrtc', signaling: 'signal-server-1' },
                { type: 'local', address: '192.168.1.100:8080' },
            ],
            timestamp: 1234567890,
        };
    });
    (0, globals_1.describe)('generateQRData', () => {
        (0, globals_1.it)('should generate QR code data with sc:// prefix', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            (0, globals_1.expect)(qrData).toMatch(/^sc:\/\//);
        });
        (0, globals_1.it)('should encode peer info in QR code', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            (0, globals_1.expect)(qrData.length).toBeGreaterThan(20);
        });
        (0, globals_1.it)('should handle peer without display name', () => {
            const peerWithoutName = { ...mockPeerInfo, displayName: undefined };
            const qrData = peer_1.QRCodeDiscovery.generateQRData(peerWithoutName);
            (0, globals_1.expect)(qrData).toMatch(/^sc:\/\//);
        });
        (0, globals_1.it)('should handle peer with multiple endpoints', () => {
            const peerWithEndpoints = {
                ...mockPeerInfo,
                endpoints: [
                    { type: 'webrtc', signaling: 'sig1' },
                    { type: 'bluetooth', rssi: -50 },
                    { type: 'local', address: '10.0.0.1:3000' },
                ],
            };
            const qrData = peer_1.QRCodeDiscovery.generateQRData(peerWithEndpoints);
            (0, globals_1.expect)(qrData).toBeDefined();
        });
        (0, globals_1.it)('should encode public key as hex string', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer).toBeDefined();
            if (parsedPeer) {
                (0, globals_1.expect)(parsedPeer.publicKey).toEqual(mockPeerInfo.publicKey);
            }
        });
    });
    (0, globals_1.describe)('parseQRData', () => {
        (0, globals_1.it)('should parse valid QR code data', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer).toBeDefined();
            (0, globals_1.expect)(parsedPeer?.peerId).toBe(mockPeerInfo.peerId);
            (0, globals_1.expect)(parsedPeer?.displayName).toBe(mockPeerInfo.displayName);
        });
        (0, globals_1.it)('should return null for invalid QR code', () => {
            const result = peer_1.QRCodeDiscovery.parseQRData('invalid-qr-code');
            (0, globals_1.expect)(result).toBeNull();
        });
        (0, globals_1.it)('should return null for malformed sc:// data', () => {
            const result = peer_1.QRCodeDiscovery.parseQRData('sc://not-base64!!!');
            (0, globals_1.expect)(result).toBeNull();
        });
        (0, globals_1.it)('should parse QR code without sc:// prefix', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            const withoutPrefix = qrData.replace('sc://', '');
            const result = peer_1.QRCodeDiscovery.parseQRData(withoutPrefix);
            (0, globals_1.expect)(result).toBeDefined();
        });
        (0, globals_1.it)('should reconstruct public key from hex', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer?.publicKey).toEqual(mockPeerInfo.publicKey);
        });
        (0, globals_1.it)('should reconstruct endpoints', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer?.endpoints).toHaveLength(2);
            (0, globals_1.expect)(parsedPeer?.endpoints[0].type).toBe('webrtc');
            (0, globals_1.expect)(parsedPeer?.endpoints[1].type).toBe('local');
        });
        (0, globals_1.it)('should handle empty endpoints array', () => {
            const peerWithoutEndpoints = { ...mockPeerInfo, endpoints: [] };
            const qrData = peer_1.QRCodeDiscovery.generateQRData(peerWithoutEndpoints);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer?.endpoints).toEqual([]);
        });
    });
    (0, globals_1.describe)('roundtrip encoding', () => {
        (0, globals_1.it)('should preserve peer info through encode/decode cycle', () => {
            const qrData = peer_1.QRCodeDiscovery.generateQRData(mockPeerInfo);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer?.peerId).toBe(mockPeerInfo.peerId);
            (0, globals_1.expect)(parsedPeer?.displayName).toBe(mockPeerInfo.displayName);
            (0, globals_1.expect)(parsedPeer?.timestamp).toBe(mockPeerInfo.timestamp);
        });
        (0, globals_1.it)('should handle large public keys', () => {
            const largePeer = {
                ...mockPeerInfo,
                publicKey: new Uint8Array(32).fill(255),
            };
            const qrData = peer_1.QRCodeDiscovery.generateQRData(largePeer);
            const parsedPeer = peer_1.QRCodeDiscovery.parseQRData(qrData);
            (0, globals_1.expect)(parsedPeer?.publicKey).toHaveLength(32);
        });
    });
});
(0, globals_1.describe)('ManualDiscovery', () => {
    (0, globals_1.describe)('parseManualEntry', () => {
        (0, globals_1.it)('should parse valid IP:port address', () => {
            const result = peer_1.ManualDiscovery.parseManualEntry('192.168.1.100:8080');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result?.type).toBe('manual');
            (0, globals_1.expect)(result?.address).toBe('192.168.1.100:8080');
        });
        (0, globals_1.it)('should parse peer_id@IP:port format', () => {
            const result = peer_1.ManualDiscovery.parseManualEntry('peer123@10.0.0.1:3000');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result?.type).toBe('manual');
            (0, globals_1.expect)(result?.address).toBe('10.0.0.1:3000');
        });
        (0, globals_1.it)('should reject invalid port numbers', () => {
            const result1 = peer_1.ManualDiscovery.parseManualEntry('192.168.1.1:0');
            (0, globals_1.expect)(result1).toBeNull();
            const result2 = peer_1.ManualDiscovery.parseManualEntry('192.168.1.1:70000');
            (0, globals_1.expect)(result2).toBeNull();
            const result3 = peer_1.ManualDiscovery.parseManualEntry('192.168.1.1:-1');
            (0, globals_1.expect)(result3).toBeNull();
        });
        (0, globals_1.it)('should reject malformed addresses', () => {
            const result1 = peer_1.ManualDiscovery.parseManualEntry('invalid');
            (0, globals_1.expect)(result1).toBeNull();
            const result2 = peer_1.ManualDiscovery.parseManualEntry('192.168.1.1');
            (0, globals_1.expect)(result2).toBeNull();
            const result3 = peer_1.ManualDiscovery.parseManualEntry('192.168.1.1:abc');
            (0, globals_1.expect)(result3).toBeNull();
        });
        (0, globals_1.it)('should handle IPv6 addresses', () => {
            const result = peer_1.ManualDiscovery.parseManualEntry('[::1]:8080');
            // May or may not be supported depending on implementation
            (0, globals_1.expect)(result).toBeDefined();
        });
        (0, globals_1.it)('should handle domain names with ports', () => {
            const result = peer_1.ManualDiscovery.parseManualEntry('example.com:8080');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result?.address).toBe('example.com:8080');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvZGlzY292ZXJ5L3BlZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDJDQUFpRTtBQUNqRSxpQ0FLZ0I7QUFFaEIsSUFBQSxrQkFBUSxFQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLFlBQXNCLENBQUM7SUFFM0IsSUFBQSxvQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLFlBQVksR0FBRztZQUNiLFNBQVMsRUFBRSxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxQyxNQUFNLEVBQUUsZUFBZTtZQUN2QixXQUFXLEVBQUUsV0FBVztZQUN4QixTQUFTLEVBQUU7Z0JBQ1QsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRTtnQkFDaEQsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRTthQUNqRDtZQUNELFNBQVMsRUFBRSxVQUFVO1NBQ3RCLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsSUFBQSxZQUFFLEVBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO1lBQ3hELE1BQU0sTUFBTSxHQUFHLHNCQUFlLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzVELElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxNQUFNLEdBQUcsc0JBQWUsQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDNUQsSUFBQSxnQkFBTSxF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QUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDaEUsSUFBQSxnQkFBTSxFQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRTNCLE1BQU0sT0FBTyxHQUFHLHNCQUFlLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNwRSxJQUFBLGdCQUFNLEVBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7WUFDdEMsTUFBTSxNQUFNLEdBQUcsc0JBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM5RCwwREFBMEQ7WUFDMUQsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1lBQy9DLE1BQU0sTUFBTSxHQUFHLHNCQUFlLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNwRSxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0IsSUFBQSxnQkFBTSxFQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvZGlzY292ZXJ5L3BlZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHtcbiAgUVJDb2RlRGlzY292ZXJ5LFxuICBNYW51YWxEaXNjb3ZlcnksXG4gIHR5cGUgUGVlckluZm8sXG4gIHR5cGUgUGVlckVuZHBvaW50LFxufSBmcm9tICcuL3BlZXInO1xuXG5kZXNjcmliZSgnUVJDb2RlRGlzY292ZXJ5JywgKCkgPT4ge1xuICBsZXQgbW9ja1BlZXJJbmZvOiBQZWVySW5mbztcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrUGVlckluZm8gPSB7XG4gICAgICBwdWJsaWNLZXk6IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSksXG4gICAgICBwZWVySWQ6ICd0ZXN0LXBlZXItMTIzJyxcbiAgICAgIGRpc3BsYXlOYW1lOiAnVGVzdCBQZWVyJyxcbiAgICAgIGVuZHBvaW50czogW1xuICAgICAgICB7IHR5cGU6ICd3ZWJydGMnLCBzaWduYWxpbmc6ICdzaWduYWwtc2VydmVyLTEnIH0sXG4gICAgICAgIHsgdHlwZTogJ2xvY2FsJywgYWRkcmVzczogJzE5Mi4xNjguMS4xMDA6ODA4MCcgfSxcbiAgICAgIF0sXG4gICAgICB0aW1lc3RhbXA6IDEyMzQ1Njc4OTAsXG4gICAgfTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlbmVyYXRlUVJEYXRhJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgUVIgY29kZSBkYXRhIHdpdGggc2M6Ly8gcHJlZml4JywgKCkgPT4ge1xuICAgICAgY29uc3QgcXJEYXRhID0gUVJDb2RlRGlzY292ZXJ5LmdlbmVyYXRlUVJEYXRhKG1vY2tQZWVySW5mbyk7XG4gICAgICBleHBlY3QocXJEYXRhKS50b01hdGNoKC9ec2M6XFwvXFwvLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVuY29kZSBwZWVyIGluZm8gaW4gUVIgY29kZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHFyRGF0YSA9IFFSQ29kZURpc2NvdmVyeS5nZW5lcmF0ZVFSRGF0YShtb2NrUGVlckluZm8pO1xuICAgICAgZXhwZWN0KHFyRGF0YS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigyMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwZWVyIHdpdGhvdXQgZGlzcGxheSBuYW1lJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlcldpdGhvdXROYW1lID0geyAuLi5tb2NrUGVlckluZm8sIGRpc3BsYXlOYW1lOiB1bmRlZmluZWQgfTtcbiAgICAgIGNvbnN0IHFyRGF0YSA9IFFSQ29kZURpc2NvdmVyeS5nZW5lcmF0ZVFSRGF0YShwZWVyV2l0aG91dE5hbWUpO1xuICAgICAgZXhwZWN0KHFyRGF0YSkudG9NYXRjaCgvXnNjOlxcL1xcLy8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGVlciB3aXRoIG11bHRpcGxlIGVuZHBvaW50cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlZXJXaXRoRW5kcG9pbnRzID0ge1xuICAgICAgICAuLi5tb2NrUGVlckluZm8sXG4gICAgICAgIGVuZHBvaW50czogW1xuICAgICAgICAgIHsgdHlwZTogJ3dlYnJ0YycgYXMgY29uc3QsIHNpZ25hbGluZzogJ3NpZzEnIH0sXG4gICAgICAgICAgeyB0eXBlOiAnYmx1ZXRvb3RoJyBhcyBjb25zdCwgcnNzaTogLTUwIH0sXG4gICAgICAgICAgeyB0eXBlOiAnbG9jYWwnIGFzIGNvbnN0LCBhZGRyZXNzOiAnMTAuMC4wLjE6MzAwMCcgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG4gICAgICBjb25zdCBxckRhdGEgPSBRUkNvZGVEaXNjb3ZlcnkuZ2VuZXJhdGVRUkRhdGEocGVlcldpdGhFbmRwb2ludHMpO1xuICAgICAgZXhwZWN0KHFyRGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5jb2RlIHB1YmxpYyBrZXkgYXMgaGV4IHN0cmluZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHFyRGF0YSA9IFFSQ29kZURpc2NvdmVyeS5nZW5lcmF0ZVFSRGF0YShtb2NrUGVlckluZm8pO1xuICAgICAgY29uc3QgcGFyc2VkUGVlciA9IFFSQ29kZURpc2NvdmVyeS5wYXJzZVFSRGF0YShxckRhdGEpO1xuICAgICAgZXhwZWN0KHBhcnNlZFBlZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBpZiAocGFyc2VkUGVlcikge1xuICAgICAgICBleHBlY3QocGFyc2VkUGVlci5wdWJsaWNLZXkpLnRvRXF1YWwobW9ja1BlZXJJbmZvLnB1YmxpY0tleSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwYXJzZVFSRGF0YScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHBhcnNlIHZhbGlkIFFSIGNvZGUgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IHFyRGF0YSA9IFFSQ29kZURpc2NvdmVyeS5nZW5lcmF0ZVFSRGF0YShtb2NrUGVlckluZm8pO1xuICAgICAgY29uc3QgcGFyc2VkUGVlciA9IFFSQ29kZURpc2NvdmVyeS5wYXJzZVFSRGF0YShxckRhdGEpO1xuICAgICAgXG4gICAgICBleHBlY3QocGFyc2VkUGVlcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChwYXJzZWRQZWVyPy5wZWVySWQpLnRvQmUobW9ja1BlZXJJbmZvLnBlZXJJZCk7XG4gICAgICBleHBlY3QocGFyc2VkUGVlcj8uZGlzcGxheU5hbWUpLnRvQmUobW9ja1BlZXJJbmZvLmRpc3BsYXlOYW1lKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIGludmFsaWQgUVIgY29kZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFFSQ29kZURpc2NvdmVyeS5wYXJzZVFSRGF0YSgnaW52YWxpZC1xci1jb2RlJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBmb3IgbWFsZm9ybWVkIHNjOi8vIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBRUkNvZGVEaXNjb3ZlcnkucGFyc2VRUkRhdGEoJ3NjOi8vbm90LWJhc2U2NCEhIScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcGFyc2UgUVIgY29kZSB3aXRob3V0IHNjOi8vIHByZWZpeCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHFyRGF0YSA9IFFSQ29kZURpc2NvdmVyeS5nZW5lcmF0ZVFSRGF0YShtb2NrUGVlckluZm8pO1xuICAgICAgY29uc3Qgd2l0aG91dFByZWZpeCA9IHFyRGF0YS5yZXBsYWNlKCdzYzovLycsICcnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFFSQ29kZURpc2NvdmVyeS5wYXJzZVFSRGF0YSh3aXRob3V0UHJlZml4KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlY29uc3RydWN0IHB1YmxpYyBrZXkgZnJvbSBoZXgnLCAoKSA9PiB7XG4gICAgICBjb25zdCBxckRhdGEgPSBRUkNvZGVEaXNjb3ZlcnkuZ2VuZXJhdGVRUkRhdGEobW9ja1BlZXJJbmZvKTtcbiAgICAgIGNvbnN0IHBhcnNlZFBlZXIgPSBRUkNvZGVEaXNjb3ZlcnkucGFyc2VRUkRhdGEocXJEYXRhKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBhcnNlZFBlZXI/LnB1YmxpY0tleSkudG9FcXVhbChtb2NrUGVlckluZm8ucHVibGljS2V5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVjb25zdHJ1Y3QgZW5kcG9pbnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcXJEYXRhID0gUVJDb2RlRGlzY292ZXJ5LmdlbmVyYXRlUVJEYXRhKG1vY2tQZWVySW5mbyk7XG4gICAgICBjb25zdCBwYXJzZWRQZWVyID0gUVJDb2RlRGlzY292ZXJ5LnBhcnNlUVJEYXRhKHFyRGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwYXJzZWRQZWVyPy5lbmRwb2ludHMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChwYXJzZWRQZWVyPy5lbmRwb2ludHNbMF0udHlwZSkudG9CZSgnd2VicnRjJyk7XG4gICAgICBleHBlY3QocGFyc2VkUGVlcj8uZW5kcG9pbnRzWzFdLnR5cGUpLnRvQmUoJ2xvY2FsJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBlbmRwb2ludHMgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZWVyV2l0aG91dEVuZHBvaW50cyA9IHsgLi4ubW9ja1BlZXJJbmZvLCBlbmRwb2ludHM6IFtdIH07XG4gICAgICBjb25zdCBxckRhdGEgPSBRUkNvZGVEaXNjb3ZlcnkuZ2VuZXJhdGVRUkRhdGEocGVlcldpdGhvdXRFbmRwb2ludHMpO1xuICAgICAgY29uc3QgcGFyc2VkUGVlciA9IFFSQ29kZURpc2NvdmVyeS5wYXJzZVFSRGF0YShxckRhdGEpO1xuICAgICAgXG4gICAgICBleHBlY3QocGFyc2VkUGVlcj8uZW5kcG9pbnRzKS50b0VxdWFsKFtdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JvdW5kdHJpcCBlbmNvZGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByZXNlcnZlIHBlZXIgaW5mbyB0aHJvdWdoIGVuY29kZS9kZWNvZGUgY3ljbGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBxckRhdGEgPSBRUkNvZGVEaXNjb3ZlcnkuZ2VuZXJhdGVRUkRhdGEobW9ja1BlZXJJbmZvKTtcbiAgICAgIGNvbnN0IHBhcnNlZFBlZXIgPSBRUkNvZGVEaXNjb3ZlcnkucGFyc2VRUkRhdGEocXJEYXRhKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBhcnNlZFBlZXI/LnBlZXJJZCkudG9CZShtb2NrUGVlckluZm8ucGVlcklkKTtcbiAgICAgIGV4cGVjdChwYXJzZWRQZWVyPy5kaXNwbGF5TmFtZSkudG9CZShtb2NrUGVlckluZm8uZGlzcGxheU5hbWUpO1xuICAgICAgZXhwZWN0KHBhcnNlZFBlZXI/LnRpbWVzdGFtcCkudG9CZShtb2NrUGVlckluZm8udGltZXN0YW1wKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIHB1YmxpYyBrZXlzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbGFyZ2VQZWVyID0ge1xuICAgICAgICAuLi5tb2NrUGVlckluZm8sXG4gICAgICAgIHB1YmxpY0tleTogbmV3IFVpbnQ4QXJyYXkoMzIpLmZpbGwoMjU1KSxcbiAgICAgIH07XG4gICAgICBjb25zdCBxckRhdGEgPSBRUkNvZGVEaXNjb3ZlcnkuZ2VuZXJhdGVRUkRhdGEobGFyZ2VQZWVyKTtcbiAgICAgIGNvbnN0IHBhcnNlZFBlZXIgPSBRUkNvZGVEaXNjb3ZlcnkucGFyc2VRUkRhdGEocXJEYXRhKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBhcnNlZFBlZXI/LnB1YmxpY0tleSkudG9IYXZlTGVuZ3RoKDMyKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ01hbnVhbERpc2NvdmVyeScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ3BhcnNlTWFudWFsRW50cnknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwYXJzZSB2YWxpZCBJUDpwb3J0IGFkZHJlc3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBNYW51YWxEaXNjb3ZlcnkucGFyc2VNYW51YWxFbnRyeSgnMTkyLjE2OC4xLjEwMDo4MDgwJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdD8udHlwZSkudG9CZSgnbWFudWFsJyk7XG4gICAgICBleHBlY3QocmVzdWx0Py5hZGRyZXNzKS50b0JlKCcxOTIuMTY4LjEuMTAwOjgwODAnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcGFyc2UgcGVlcl9pZEBJUDpwb3J0IGZvcm1hdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE1hbnVhbERpc2NvdmVyeS5wYXJzZU1hbnVhbEVudHJ5KCdwZWVyMTIzQDEwLjAuMC4xOjMwMDAnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Py50eXBlKS50b0JlKCdtYW51YWwnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQ/LmFkZHJlc3MpLnRvQmUoJzEwLjAuMC4xOjMwMDAnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgcG9ydCBudW1iZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0MSA9IE1hbnVhbERpc2NvdmVyeS5wYXJzZU1hbnVhbEVudHJ5KCcxOTIuMTY4LjEuMTowJyk7XG4gICAgICBleHBlY3QocmVzdWx0MSkudG9CZU51bGwoKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0MiA9IE1hbnVhbERpc2NvdmVyeS5wYXJzZU1hbnVhbEVudHJ5KCcxOTIuMTY4LjEuMTo3MDAwMCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdDIpLnRvQmVOdWxsKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdDMgPSBNYW51YWxEaXNjb3ZlcnkucGFyc2VNYW51YWxFbnRyeSgnMTkyLjE2OC4xLjE6LTEnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQzKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbWFsZm9ybWVkIGFkZHJlc3NlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdDEgPSBNYW51YWxEaXNjb3ZlcnkucGFyc2VNYW51YWxFbnRyeSgnaW52YWxpZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdDEpLnRvQmVOdWxsKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBNYW51YWxEaXNjb3ZlcnkucGFyc2VNYW51YWxFbnRyeSgnMTkyLjE2OC4xLjEnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQyKS50b0JlTnVsbCgpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQzID0gTWFudWFsRGlzY292ZXJ5LnBhcnNlTWFudWFsRW50cnkoJzE5Mi4xNjguMS4xOmFiYycpO1xuICAgICAgZXhwZWN0KHJlc3VsdDMpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBJUHY2IGFkZHJlc3NlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE1hbnVhbERpc2NvdmVyeS5wYXJzZU1hbnVhbEVudHJ5KCdbOjoxXTo4MDgwJyk7XG4gICAgICAvLyBNYXkgb3IgbWF5IG5vdCBiZSBzdXBwb3J0ZWQgZGVwZW5kaW5nIG9uIGltcGxlbWVudGF0aW9uXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZG9tYWluIG5hbWVzIHdpdGggcG9ydHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBNYW51YWxEaXNjb3ZlcnkucGFyc2VNYW51YWxFbnRyeSgnZXhhbXBsZS5jb206ODA4MCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQ/LmFkZHJlc3MpLnRvQmUoJ2V4YW1wbGUuY29tOjgwODAnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==