{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/transport/BleTransport.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/transport/BleTransport.ts"],"sourcesContent":["/**\n * BLE Transport Implementation\n *\n * A Transport abstraction for Bluetooth Low Energy communication.\n * This provides a platform-agnostic interface that can be implemented\n * by platform-specific BLE code (Android, iOS).\n *\n * This module defines:\n * 1. BleTransport interface extending Transport\n * 2. BleTransportConfig for BLE-specific settings\n * 3. BleTransportEvents for BLE-specific events\n * 4. Mock implementation for testing/web simulation\n */\n\nimport {\n  Transport,\n  TransportPeerId,\n  TransportEvents,\n  TransportConfig,\n  TransportPeerInfo,\n  TransportConnectionState,\n  transportRegistry,\n} from \"./Transport.js\";\n\n/**\n * BLE-specific advertising mode\n */\nexport enum BleAdvertisingMode {\n  LOW_POWER = \"low_power\",\n  BALANCED = \"balanced\",\n  LOW_LATENCY = \"low_latency\",\n}\n\n/**\n * BLE-specific scan mode\n */\nexport enum BleScanMode {\n  LOW_POWER = \"low_power\",\n  BALANCED = \"balanced\",\n  LOW_LATENCY = \"low_latency\",\n  OPPORTUNISTIC = \"opportunistic\",\n}\n\n/**\n * BLE device discovery result\n */\nexport interface BleDeviceInfo {\n  /** Device identifier (MAC address or UUID) */\n  deviceId: string;\n  /** Device name if available */\n  name?: string;\n  /** Signal strength in dBm */\n  rssi: number;\n  /** Whether the device is connectable */\n  connectable: boolean;\n  /** Service UUIDs advertised by the device */\n  serviceUuids: string[];\n  /** Manufacturer data if available */\n  manufacturerData?: Uint8Array;\n  /** Last seen timestamp */\n  lastSeen: number;\n}\n\n/**\n * BLE-specific transport configuration\n */\nexport interface BleTransportConfig extends TransportConfig {\n  /** Service UUID for mesh networking */\n  serviceUuid?: string;\n  /** TX characteristic UUID */\n  txCharacteristicUuid?: string;\n  /** RX characteristic UUID */\n  rxCharacteristicUuid?: string;\n  /** Advertising mode */\n  advertisingMode?: BleAdvertisingMode;\n  /** Scan mode */\n  scanMode?: BleScanMode;\n  /** Maximum MTU size to negotiate */\n  maxMtu?: number;\n  /** Scan duration in milliseconds (0 = continuous) */\n  scanDuration?: number;\n  /** Advertising interval in milliseconds */\n  advertisingInterval?: number;\n  /** Enable adaptive scanning based on battery */\n  adaptiveScanning?: boolean;\n  /** Minimum RSSI for connection (filter weak signals) */\n  minRssi?: number;\n  /** Maximum number of BLE connections */\n  maxConnections?: number;\n}\n\n/**\n * BLE-specific transport events\n */\nexport interface BleTransportEvents extends TransportEvents {\n  /**\n   * Called when a BLE device is discovered during scanning.\n   * @param device The discovered device info\n   */\n  onDeviceDiscovered?(device: BleDeviceInfo): void;\n\n  /**\n   * Called when RSSI (signal strength) changes for a connected peer.\n   * @param peerId The peer's ID\n   * @param rssi The new RSSI value in dBm\n   */\n  onRssiChanged?(peerId: TransportPeerId, rssi: number): void;\n\n  /**\n   * Called when MTU negotiation completes.\n   * @param peerId The peer's ID\n   * @param mtu The negotiated MTU size\n   */\n  onMtuNegotiated?(peerId: TransportPeerId, mtu: number): void;\n\n  /**\n   * Called when advertising state changes.\n   * @param isAdvertising Whether advertising is currently active\n   */\n  onAdvertisingStateChanged?(isAdvertising: boolean): void;\n\n  /**\n   * Called when scanning state changes.\n   * @param isScanning Whether scanning is currently active\n   */\n  onScanningStateChanged?(isScanning: boolean): void;\n}\n\n/**\n * Extended peer info for BLE connections\n */\nexport interface BlePeerInfo extends TransportPeerInfo {\n  /** Signal strength in dBm */\n  rssi?: number;\n  /** Negotiated MTU size */\n  mtu?: number;\n  /** Whether this peer was discovered via scan or incoming connection */\n  discoveredViaScan: boolean;\n}\n\n/**\n * BLE Transport interface extending the base Transport interface.\n * Platform-specific implementations (Android, iOS) should implement this interface.\n */\nexport interface BleTransport extends Transport {\n  /**\n   * Start BLE advertising to make this device discoverable.\n   * @param advertisingData Optional data to include in advertisements\n   */\n  startAdvertising(advertisingData?: Uint8Array): Promise<void>;\n\n  /**\n   * Stop BLE advertising.\n   */\n  stopAdvertising(): Promise<void>;\n\n  /**\n   * Check if advertising is currently active.\n   */\n  isAdvertising(): boolean;\n\n  /**\n   * Start scanning for BLE devices.\n   * @param filterUuids Optional service UUIDs to filter by\n   */\n  startScanning(filterUuids?: string[]): Promise<void>;\n\n  /**\n   * Stop scanning for BLE devices.\n   */\n  stopScanning(): Promise<void>;\n\n  /**\n   * Check if scanning is currently active.\n   */\n  isScanning(): boolean;\n\n  /**\n   * Get list of discovered devices.\n   */\n  getDiscoveredDevices(): BleDeviceInfo[];\n\n  /**\n   * Get the current RSSI for a connected peer.\n   * @param peerId The peer ID to query\n   */\n  getRssi(peerId: TransportPeerId): Promise<number | undefined>;\n\n  /**\n   * Get the negotiated MTU for a peer.\n   * @param peerId The peer ID to query\n   */\n  getMtu(peerId: TransportPeerId): number | undefined;\n\n  /**\n   * Request MTU negotiation with a peer.\n   * @param peerId The peer ID\n   * @param requestedMtu The MTU size to request\n   */\n  requestMtu(peerId: TransportPeerId, requestedMtu: number): Promise<number>;\n\n  /**\n   * Get BLE-specific peer info.\n   * @param peerId The peer ID to query\n   */\n  getBlePeerInfo(peerId: TransportPeerId): BlePeerInfo | undefined;\n}\n\n/**\n * Default BLE service and characteristic UUIDs for SC mesh protocol.\n * These follow the Bluetooth SIG base UUID format.\n */\nexport const BLE_MESH_SERVICE_UUID = \"5c000001-0000-1000-8000-00805f9b34fb\";\nexport const BLE_TX_CHARACTERISTIC_UUID =\n  \"5c000002-0000-1000-8000-00805f9b34fb\";\nexport const BLE_RX_CHARACTERISTIC_UUID =\n  \"5c000003-0000-1000-8000-00805f9b34fb\";\nexport const BLE_VERSION_CHARACTERISTIC_UUID =\n  \"5c000004-0000-1000-8000-00805f9b34fb\";\nexport const BLE_METADATA_CHARACTERISTIC_UUID =\n  \"5c000005-0000-1000-8000-00805f9b34fb\";\n\n/**\n * Default BLE transport configuration.\n */\nexport const DEFAULT_BLE_CONFIG: Required<BleTransportConfig> = {\n  serviceUuid: BLE_MESH_SERVICE_UUID,\n  txCharacteristicUuid: BLE_TX_CHARACTERISTIC_UUID,\n  rxCharacteristicUuid: BLE_RX_CHARACTERISTIC_UUID,\n  advertisingMode: BleAdvertisingMode.BALANCED,\n  scanMode: BleScanMode.BALANCED,\n  maxMtu: 517,\n  scanDuration: 0, // Continuous\n  advertisingInterval: 250,\n  adaptiveScanning: true,\n  minRssi: -90,\n  maxConnections: 7,\n  maxPeers: 7,\n  connectionTimeout: 30000,\n  heartbeatInterval: 30000,\n  options: {},\n};\n\n/**\n * Mock BLE Transport for testing and web environments.\n * This implementation simulates BLE behavior for testing purposes.\n */\nexport class MockBleTransport implements BleTransport {\n  readonly localPeerId: TransportPeerId;\n  readonly name = \"bluetooth\";\n\n  private config: Required<BleTransportConfig>;\n  private events: BleTransportEvents | null = null;\n  private peers: Map<TransportPeerId, BlePeerInfo> = new Map();\n  private discoveredDevices: Map<string, BleDeviceInfo> = new Map();\n  private isRunning = false;\n  private _isAdvertising = false;\n  private _isScanning = false;\n  private scanInterval: NodeJS.Timeout | null = null;\n\n  constructor(localPeerId: TransportPeerId, config: BleTransportConfig = {}) {\n    this.localPeerId = localPeerId;\n    this.config = { ...DEFAULT_BLE_CONFIG, ...config };\n  }\n\n  async start(events: BleTransportEvents): Promise<void> {\n    this.events = events;\n    this.isRunning = true;\n  }\n\n  async stop(): Promise<void> {\n    await this.stopAdvertising();\n    await this.stopScanning();\n    this.peers.clear();\n    this.discoveredDevices.clear();\n    this.events = null;\n    this.isRunning = false;\n  }\n\n  async connect(peerId: TransportPeerId): Promise<void> {\n    if (!this.isRunning) {\n      throw new Error(\"Transport not started\");\n    }\n\n    const peerInfo: BlePeerInfo = {\n      peerId,\n      state: \"connecting\",\n      transportType: \"bluetooth\",\n      connectionQuality: 80,\n      bytesSent: 0,\n      bytesReceived: 0,\n      lastSeen: Date.now(),\n      rssi: -60,\n      mtu: 185,\n      discoveredViaScan: true,\n    };\n\n    this.peers.set(peerId, peerInfo);\n    this.events?.onStateChange?.(peerId, \"connecting\");\n\n    // Simulate connection delay\n    await new Promise((resolve) => setTimeout(resolve, 100));\n\n    peerInfo.state = \"connected\";\n    this.events?.onStateChange?.(peerId, \"connected\");\n    this.events?.onPeerConnected?.(peerId, peerInfo);\n  }\n\n  async disconnect(peerId: TransportPeerId): Promise<void> {\n    const peer = this.peers.get(peerId);\n    if (peer) {\n      peer.state = \"disconnected\";\n      this.events?.onStateChange?.(peerId, \"disconnected\");\n      this.events?.onPeerDisconnected?.(peerId, \"disconnected\");\n      this.peers.delete(peerId);\n    }\n  }\n\n  async send(peerId: TransportPeerId, payload: Uint8Array): Promise<void> {\n    const peer = this.peers.get(peerId);\n    if (!peer || peer.state !== \"connected\") {\n      throw new Error(`Peer ${peerId} not connected`);\n    }\n\n    peer.bytesSent = (peer.bytesSent || 0) + payload.length;\n    peer.lastSeen = Date.now();\n  }\n\n  async broadcast(\n    payload: Uint8Array,\n    excludePeerId?: TransportPeerId,\n  ): Promise<void> {\n    const sendPromises: Promise<void>[] = [];\n    for (const [peerId, peer] of this.peers) {\n      if (peerId !== excludePeerId && peer.state === \"connected\") {\n        sendPromises.push(this.send(peerId, payload));\n      }\n    }\n    await Promise.all(sendPromises);\n  }\n\n  getConnectedPeers(): TransportPeerId[] {\n    return Array.from(this.peers.entries())\n      .filter(([, peer]) => peer.state === \"connected\")\n      .map(([id]) => id);\n  }\n\n  getPeerInfo(peerId: TransportPeerId): TransportPeerInfo | undefined {\n    return this.peers.get(peerId);\n  }\n\n  getConnectionState(\n    peerId: TransportPeerId,\n  ): TransportConnectionState | undefined {\n    return this.peers.get(peerId)?.state;\n  }\n\n  // BLE-specific methods\n\n  async startAdvertising(_advertisingData?: Uint8Array): Promise<void> {\n    this._isAdvertising = true;\n    this.events?.onAdvertisingStateChanged?.(true);\n  }\n\n  async stopAdvertising(): Promise<void> {\n    this._isAdvertising = false;\n    this.events?.onAdvertisingStateChanged?.(false);\n  }\n\n  isAdvertising(): boolean {\n    return this._isAdvertising;\n  }\n\n  async startScanning(_filterUuids?: string[]): Promise<void> {\n    this._isScanning = true;\n    this.events?.onScanningStateChanged?.(true);\n\n    // Simulate periodic device discovery\n    this.scanInterval = setInterval(() => {\n      // Mock discovered device\n      const mockDevice: BleDeviceInfo = {\n        deviceId: `mock-device-${Date.now()}`,\n        name: \"SC Peer\",\n        rssi: -70 + Math.floor(Math.random() * 30),\n        connectable: true,\n        serviceUuids: [this.config.serviceUuid],\n        lastSeen: Date.now(),\n      };\n      this.discoveredDevices.set(mockDevice.deviceId, mockDevice);\n      this.events?.onDeviceDiscovered?.(mockDevice);\n    }, 5000);\n  }\n\n  async stopScanning(): Promise<void> {\n    this._isScanning = false;\n    if (this.scanInterval) {\n      clearInterval(this.scanInterval);\n      this.scanInterval = null;\n    }\n    this.events?.onScanningStateChanged?.(false);\n  }\n\n  isScanning(): boolean {\n    return this._isScanning;\n  }\n\n  getDiscoveredDevices(): BleDeviceInfo[] {\n    return Array.from(this.discoveredDevices.values());\n  }\n\n  async getRssi(peerId: TransportPeerId): Promise<number | undefined> {\n    return this.peers.get(peerId)?.rssi;\n  }\n\n  getMtu(peerId: TransportPeerId): number | undefined {\n    return this.peers.get(peerId)?.mtu;\n  }\n\n  async requestMtu(\n    peerId: TransportPeerId,\n    requestedMtu: number,\n  ): Promise<number> {\n    const peer = this.peers.get(peerId);\n    if (!peer) {\n      throw new Error(`Peer ${peerId} not found`);\n    }\n\n    // Simulate MTU negotiation (usually returns min of requested and supported)\n    const negotiatedMtu = Math.min(requestedMtu, this.config.maxMtu);\n    peer.mtu = negotiatedMtu;\n    this.events?.onMtuNegotiated?.(peerId, negotiatedMtu);\n    return negotiatedMtu;\n  }\n\n  getBlePeerInfo(peerId: TransportPeerId): BlePeerInfo | undefined {\n    return this.peers.get(peerId);\n  }\n\n  /**\n   * Simulate receiving a message from a peer.\n   * Used for testing purposes.\n   */\n  simulateMessage(from: TransportPeerId, payload: Uint8Array): void {\n    const peer = this.peers.get(from);\n    if (peer) {\n      peer.bytesReceived = (peer.bytesReceived || 0) + payload.length;\n      peer.lastSeen = Date.now();\n    }\n\n    this.events?.onMessage({\n      from,\n      payload,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Simulate an incoming connection request.\n   * Used for testing purposes.\n   */\n  async simulateIncomingConnection(peerId: TransportPeerId): Promise<void> {\n    const peerInfo: BlePeerInfo = {\n      peerId,\n      state: \"connected\",\n      transportType: \"bluetooth\",\n      connectionQuality: 75,\n      bytesSent: 0,\n      bytesReceived: 0,\n      lastSeen: Date.now(),\n      rssi: -65,\n      mtu: 185,\n      discoveredViaScan: false,\n    };\n\n    this.peers.set(peerId, peerInfo);\n    this.events?.onPeerConnected?.(peerId, peerInfo);\n  }\n}\n\n// Register the mock BLE transport factory\ntransportRegistry.register(\"bluetooth\", (config?: TransportConfig) => {\n  const peerId = `ble-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n  return new MockBleTransport(peerId, config as BleTransportConfig);\n});\n\n/**\n * BLE transport factory type\n */\nexport type BleTransportFactory = (\n  localPeerId: TransportPeerId,\n  config?: BleTransportConfig,\n) => BleTransport;\n"],"version":3}