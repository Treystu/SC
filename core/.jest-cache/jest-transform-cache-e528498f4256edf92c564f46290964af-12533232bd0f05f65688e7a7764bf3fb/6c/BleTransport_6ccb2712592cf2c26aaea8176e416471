1ea94a1ce96666d607d75220dcc42391
"use strict";
/**
 * BLE Transport Implementation
 *
 * A Transport abstraction for Bluetooth Low Energy communication.
 * This provides a platform-agnostic interface that can be implemented
 * by platform-specific BLE code (Android, iOS).
 *
 * This module defines:
 * 1. BleTransport interface extending Transport
 * 2. BleTransportConfig for BLE-specific settings
 * 3. BleTransportEvents for BLE-specific events
 * 4. Mock implementation for testing/web simulation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockBleTransport = exports.DEFAULT_BLE_CONFIG = exports.BLE_METADATA_CHARACTERISTIC_UUID = exports.BLE_VERSION_CHARACTERISTIC_UUID = exports.BLE_RX_CHARACTERISTIC_UUID = exports.BLE_TX_CHARACTERISTIC_UUID = exports.BLE_MESH_SERVICE_UUID = exports.BleScanMode = exports.BleAdvertisingMode = void 0;
const Transport_js_1 = require("./Transport.js");
/**
 * BLE-specific advertising mode
 */
var BleAdvertisingMode;
(function (BleAdvertisingMode) {
    BleAdvertisingMode["LOW_POWER"] = "low_power";
    BleAdvertisingMode["BALANCED"] = "balanced";
    BleAdvertisingMode["LOW_LATENCY"] = "low_latency";
})(BleAdvertisingMode || (exports.BleAdvertisingMode = BleAdvertisingMode = {}));
/**
 * BLE-specific scan mode
 */
var BleScanMode;
(function (BleScanMode) {
    BleScanMode["LOW_POWER"] = "low_power";
    BleScanMode["BALANCED"] = "balanced";
    BleScanMode["LOW_LATENCY"] = "low_latency";
    BleScanMode["OPPORTUNISTIC"] = "opportunistic";
})(BleScanMode || (exports.BleScanMode = BleScanMode = {}));
/**
 * Default BLE service and characteristic UUIDs for SC mesh protocol.
 * These follow the Bluetooth SIG base UUID format.
 */
exports.BLE_MESH_SERVICE_UUID = "5c000001-0000-1000-8000-00805f9b34fb";
exports.BLE_TX_CHARACTERISTIC_UUID = "5c000002-0000-1000-8000-00805f9b34fb";
exports.BLE_RX_CHARACTERISTIC_UUID = "5c000003-0000-1000-8000-00805f9b34fb";
exports.BLE_VERSION_CHARACTERISTIC_UUID = "5c000004-0000-1000-8000-00805f9b34fb";
exports.BLE_METADATA_CHARACTERISTIC_UUID = "5c000005-0000-1000-8000-00805f9b34fb";
/**
 * Default BLE transport configuration.
 */
exports.DEFAULT_BLE_CONFIG = {
    serviceUuid: exports.BLE_MESH_SERVICE_UUID,
    txCharacteristicUuid: exports.BLE_TX_CHARACTERISTIC_UUID,
    rxCharacteristicUuid: exports.BLE_RX_CHARACTERISTIC_UUID,
    advertisingMode: BleAdvertisingMode.BALANCED,
    scanMode: BleScanMode.BALANCED,
    maxMtu: 517,
    scanDuration: 0, // Continuous
    advertisingInterval: 250,
    adaptiveScanning: true,
    minRssi: -90,
    maxConnections: 7,
    maxPeers: 7,
    connectionTimeout: 30000,
    heartbeatInterval: 30000,
    options: {},
};
/**
 * Mock BLE Transport for testing and web environments.
 * This implementation simulates BLE behavior for testing purposes.
 */
class MockBleTransport {
    constructor(localPeerId, config = {}) {
        this.name = "bluetooth";
        this.events = null;
        this.peers = new Map();
        this.discoveredDevices = new Map();
        this.isRunning = false;
        this._isAdvertising = false;
        this._isScanning = false;
        this.scanInterval = null;
        this.localPeerId = localPeerId;
        this.config = { ...exports.DEFAULT_BLE_CONFIG, ...config };
    }
    async start(events) {
        this.events = events;
        this.isRunning = true;
    }
    async stop() {
        await this.stopAdvertising();
        await this.stopScanning();
        this.peers.clear();
        this.discoveredDevices.clear();
        this.events = null;
        this.isRunning = false;
    }
    async connect(peerId) {
        if (!this.isRunning) {
            throw new Error("Transport not started");
        }
        const peerInfo = {
            peerId,
            state: "connecting",
            transportType: "bluetooth",
            connectionQuality: 80,
            bytesSent: 0,
            bytesReceived: 0,
            lastSeen: Date.now(),
            rssi: -60,
            mtu: 185,
            discoveredViaScan: true,
        };
        this.peers.set(peerId, peerInfo);
        this.events?.onStateChange?.(peerId, "connecting");
        // Simulate connection delay
        await new Promise((resolve) => setTimeout(resolve, 100));
        peerInfo.state = "connected";
        this.events?.onStateChange?.(peerId, "connected");
        this.events?.onPeerConnected?.(peerId, peerInfo);
    }
    async disconnect(peerId) {
        const peer = this.peers.get(peerId);
        if (peer) {
            peer.state = "disconnected";
            this.events?.onStateChange?.(peerId, "disconnected");
            this.events?.onPeerDisconnected?.(peerId, "disconnected");
            this.peers.delete(peerId);
        }
    }
    async send(peerId, payload) {
        const peer = this.peers.get(peerId);
        if (!peer || peer.state !== "connected") {
            throw new Error(`Peer ${peerId} not connected`);
        }
        peer.bytesSent = (peer.bytesSent || 0) + payload.length;
        peer.lastSeen = Date.now();
    }
    async broadcast(payload, excludePeerId) {
        const sendPromises = [];
        for (const [peerId, peer] of this.peers) {
            if (peerId !== excludePeerId && peer.state === "connected") {
                sendPromises.push(this.send(peerId, payload));
            }
        }
        await Promise.all(sendPromises);
    }
    getConnectedPeers() {
        return Array.from(this.peers.entries())
            .filter(([, peer]) => peer.state === "connected")
            .map(([id]) => id);
    }
    getPeerInfo(peerId) {
        return this.peers.get(peerId);
    }
    getConnectionState(peerId) {
        return this.peers.get(peerId)?.state;
    }
    // BLE-specific methods
    async startAdvertising(_advertisingData) {
        this._isAdvertising = true;
        this.events?.onAdvertisingStateChanged?.(true);
    }
    async stopAdvertising() {
        this._isAdvertising = false;
        this.events?.onAdvertisingStateChanged?.(false);
    }
    isAdvertising() {
        return this._isAdvertising;
    }
    async startScanning(_filterUuids) {
        this._isScanning = true;
        this.events?.onScanningStateChanged?.(true);
        // Simulate periodic device discovery
        this.scanInterval = setInterval(() => {
            // Mock discovered device
            const mockDevice = {
                deviceId: `mock-device-${Date.now()}`,
                name: "SC Peer",
                rssi: -70 + Math.floor(Math.random() * 30),
                connectable: true,
                serviceUuids: [this.config.serviceUuid],
                lastSeen: Date.now(),
            };
            this.discoveredDevices.set(mockDevice.deviceId, mockDevice);
            this.events?.onDeviceDiscovered?.(mockDevice);
        }, 5000);
    }
    async stopScanning() {
        this._isScanning = false;
        if (this.scanInterval) {
            clearInterval(this.scanInterval);
            this.scanInterval = null;
        }
        this.events?.onScanningStateChanged?.(false);
    }
    isScanning() {
        return this._isScanning;
    }
    getDiscoveredDevices() {
        return Array.from(this.discoveredDevices.values());
    }
    async getRssi(peerId) {
        return this.peers.get(peerId)?.rssi;
    }
    getMtu(peerId) {
        return this.peers.get(peerId)?.mtu;
    }
    async requestMtu(peerId, requestedMtu) {
        const peer = this.peers.get(peerId);
        if (!peer) {
            throw new Error(`Peer ${peerId} not found`);
        }
        // Simulate MTU negotiation (usually returns min of requested and supported)
        const negotiatedMtu = Math.min(requestedMtu, this.config.maxMtu);
        peer.mtu = negotiatedMtu;
        this.events?.onMtuNegotiated?.(peerId, negotiatedMtu);
        return negotiatedMtu;
    }
    getBlePeerInfo(peerId) {
        return this.peers.get(peerId);
    }
    /**
     * Simulate receiving a message from a peer.
     * Used for testing purposes.
     */
    simulateMessage(from, payload) {
        const peer = this.peers.get(from);
        if (peer) {
            peer.bytesReceived = (peer.bytesReceived || 0) + payload.length;
            peer.lastSeen = Date.now();
        }
        this.events?.onMessage({
            from,
            payload,
            timestamp: Date.now(),
        });
    }
    /**
     * Simulate an incoming connection request.
     * Used for testing purposes.
     */
    async simulateIncomingConnection(peerId) {
        const peerInfo = {
            peerId,
            state: "connected",
            transportType: "bluetooth",
            connectionQuality: 75,
            bytesSent: 0,
            bytesReceived: 0,
            lastSeen: Date.now(),
            rssi: -65,
            mtu: 185,
            discoveredViaScan: false,
        };
        this.peers.set(peerId, peerInfo);
        this.events?.onPeerConnected?.(peerId, peerInfo);
    }
}
exports.MockBleTransport = MockBleTransport;
// Register the mock BLE transport factory
Transport_js_1.transportRegistry.register("bluetooth", (config) => {
    const peerId = `ble-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;
    return new MockBleTransport(peerId, config);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvdHJhbnNwb3J0L0JsZVRyYW5zcG9ydC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7OztHQVlHOzs7QUFFSCxpREFRd0I7QUFFeEI7O0dBRUc7QUFDSCxJQUFZLGtCQUlYO0FBSkQsV0FBWSxrQkFBa0I7SUFDNUIsNkNBQXVCLENBQUE7SUFDdkIsMkNBQXFCLENBQUE7SUFDckIsaURBQTJCLENBQUE7QUFDN0IsQ0FBQyxFQUpXLGtCQUFrQixrQ0FBbEIsa0JBQWtCLFFBSTdCO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLFdBS1g7QUFMRCxXQUFZLFdBQVc7SUFDckIsc0NBQXVCLENBQUE7SUFDdkIsb0NBQXFCLENBQUE7SUFDckIsMENBQTJCLENBQUE7SUFDM0IsOENBQStCLENBQUE7QUFDakMsQ0FBQyxFQUxXLFdBQVcsMkJBQVgsV0FBVyxRQUt0QjtBQXVLRDs7O0dBR0c7QUFDVSxRQUFBLHFCQUFxQixHQUFHLHNDQUFzQyxDQUFDO0FBQy9ELFFBQUEsMEJBQTBCLEdBQ3JDLHNDQUFzQyxDQUFDO0FBQzVCLFFBQUEsMEJBQTBCLEdBQ3JDLHNDQUFzQyxDQUFDO0FBQzVCLFFBQUEsK0JBQStCLEdBQzFDLHNDQUFzQyxDQUFDO0FBQzVCLFFBQUEsZ0NBQWdDLEdBQzNDLHNDQUFzQyxDQUFDO0FBRXpDOztHQUVHO0FBQ1UsUUFBQSxrQkFBa0IsR0FBaUM7SUFDOUQsV0FBVyxFQUFFLDZCQUFxQjtJQUNsQyxvQkFBb0IsRUFBRSxrQ0FBMEI7SUFDaEQsb0JBQW9CLEVBQUUsa0NBQTBCO0lBQ2hELGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxRQUFRO0lBQzVDLFFBQVEsRUFBRSxXQUFXLENBQUMsUUFBUTtJQUM5QixNQUFNLEVBQUUsR0FBRztJQUNYLFlBQVksRUFBRSxDQUFDLEVBQUUsYUFBYTtJQUM5QixtQkFBbUIsRUFBRSxHQUFHO0lBQ3hCLGdCQUFnQixFQUFFLElBQUk7SUFD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QUFNLE1BQU0sR0FBRyxPQUFPLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM3RSxPQUFPLElBQUksZ0JBQWdCLENBQUMsTUFBTSxFQUFFLE1BQTRCLENBQUMsQ0FBQztBQUNwRSxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy90cmFuc3BvcnQvQmxlVHJhbnNwb3J0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQkxFIFRyYW5zcG9ydCBJbXBsZW1lbnRhdGlvblxuICpcbiAqIEEgVHJhbnNwb3J0IGFic3RyYWN0aW9uIGZvciBCbHVldG9vdGggTG93IEVuZXJneSBjb21tdW5pY2F0aW9uLlxuICogVGhpcyBwcm92aWRlcyBhIHBsYXRmb3JtLWFnbm9zdGljIGludGVyZmFjZSB0aGF0IGNhbiBiZSBpbXBsZW1lbnRlZFxuICogYnkgcGxhdGZvcm0tc3BlY2lmaWMgQkxFIGNvZGUgKEFuZHJvaWQsIGlPUykuXG4gKlxuICogVGhpcyBtb2R1bGUgZGVmaW5lczpcbiAqIDEuIEJsZVRyYW5zcG9ydCBpbnRlcmZhY2UgZXh0ZW5kaW5nIFRyYW5zcG9ydFxuICogMi4gQmxlVHJhbnNwb3J0Q29uZmlnIGZvciBCTEUtc3BlY2lmaWMgc2V0dGluZ3NcbiAqIDMuIEJsZVRyYW5zcG9ydEV2ZW50cyBmb3IgQkxFLXNwZWNpZmljIGV2ZW50c1xuICogNC4gTW9jayBpbXBsZW1lbnRhdGlvbiBmb3IgdGVzdGluZy93ZWIgc2ltdWxhdGlvblxuICovXG5cbmltcG9ydCB7XG4gIFRyYW5zcG9ydCxcbiAgVHJhbnNwb3J0UGVlcklkLFxuICBUcmFuc3BvcnRFdmVudHMsXG4gIFRyYW5zcG9ydENvbmZpZyxcbiAgVHJhbnNwb3J0UGVlckluZm8sXG4gIFRyYW5zcG9ydENvbm5lY3Rpb25TdGF0ZSxcbiAgdHJhbnNwb3J0UmVnaXN0cnksXG59IGZyb20gXCIuL1RyYW5zcG9ydC5qc1wiO1xuXG4vKipcbiAqIEJMRS1zcGVjaWZpYyBhZHZlcnRpc2luZyBtb2RlXG4gKi9cbmV4cG9ydCBlbnVtIEJsZUFkdmVydGlzaW5nTW9kZSB7XG4gIExPV19QT1dFUiA9IFwibG93X3Bvd2VyXCIsXG4gIEJBTEFOQ0VEID0gXCJiYWxhbmNlZFwiLFxuICBMT1dfTEFURU5DWSA9IFwibG93X2xhdGVuY3lcIixcbn1cblxuLyoqXG4gKiBCTEUtc3BlY2lmaWMgc2NhbiBtb2RlXG4gKi9cbmV4cG9ydCBlbnVtIEJsZVNjYW5Nb2RlIHtcbiAgTE9XX1BPV0VSID0gXCJsb3dfcG93ZXJcIixcbiAgQkFMQU5DRUQgPSBcImJhbGFuY2VkXCIsXG4gIExPV19MQVRFTkNZID0gXCJsb3dfbGF0ZW5jeVwiLFxuICBPUFBPUlRVTklTVElDID0gXCJvcHBvcnR1bmlzdGljXCIsXG59XG5cbi8qKlxuICogQkxFIGRldmljZSBkaXNjb3ZlcnkgcmVzdWx0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmxlRGV2aWNlSW5mbyB7XG4gIC8qKiBEZXZpY2UgaWRlbnRpZmllciAoTUFDIGFkZHJlc3Mgb3IgVVVJRCkgKi9cbiAgZGV2aWNlSWQ6IHN0cmluZztcbiAgLyoqIERldmljZSBuYW1lIGlmIGF2YWlsYWJsZSAqL1xuICBuYW1lPzogc3RyaW5nO1xuICAvKiogU2lnbmFsIHN0cmVuZ3RoIGluIGRCbSAqL1xuICByc3NpOiBudW1iZXI7XG4gIC8qKiBXaGV0aGVyIHRoZSBkZXZpY2UgaXMgY29ubmVjdGFibGUgKi9cbiAgY29ubmVjdGFibGU6IGJvb2xlYW47XG4gIC8qKiBTZXJ2aWNlIFVVSURzIGFkdmVydGlzZWQgYnkgdGhlIGRldmljZSAqL1xuICBzZXJ2aWNlVXVpZHM6IHN0cmluZ1tdO1xuICAvKiogTWFudWZhY3R1cmVyIGRhdGEgaWYgYXZhaWxhYmxlICovXG4gIG1hbnVmYWN0dXJlckRhdGE/OiBVaW50OEFycmF5O1xuICAvKiogTGFzdCBzZWVuIHRpbWVzdGFtcCAqL1xuICBsYXN0U2VlbjogbnVtYmVyO1xufVxuXG4vKipcbiAqIEJMRS1zcGVjaWZpYyB0cmFuc3BvcnQgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJsZVRyYW5zcG9ydENvbmZpZyBleHRlbmRzIFRyYW5zcG9ydENvbmZpZyB7XG4gIC8qKiBTZXJ2aWNlIFVVSUQgZm9yIG1lc2ggbmV0d29ya2luZyAqL1xuICBzZXJ2aWNlVXVpZD86IHN0cmluZztcbiAgLyoqIFRYIGNoYXJhY3RlcmlzdGljIFVVSUQgKi9cbiAgdHhDaGFyYWN0ZXJpc3RpY1V1aWQ/OiBzdHJpbmc7XG4gIC8qKiBSWCBjaGFyYWN0ZXJpc3RpYyBVVUlEICovXG4gIHJ4Q2hhcmFjdGVyaXN0aWNVdWlkPzogc3RyaW5nO1xuICAvKiogQWR2ZXJ0aXNpbmcgbW9kZSAqL1xuICBhZHZlcnRpc2luZ01vZGU/OiBCbGVBZHZlcnRpc2luZ01vZGU7XG4gIC8qKiBTY2FuIG1vZGUgKi9cbiAgc2Nhbk1vZGU/OiBCbGVTY2FuTW9kZTtcbiAgLyoqIE1heGltdW0gTVRVIHNpemUgdG8gbmVnb3RpYXRlICovXG4gIG1heE10dT86IG51bWJlcjtcbiAgLyoqIFNjYW4gZHVyYXRpb24gaW4gbWlsbGlzZWNvbmRzICgwID0gY29udGludW91cykgKi9cbiAgc2NhbkR1cmF0aW9uPzogbnVtYmVyO1xuICAvKiogQWR2ZXJ0aXNpbmcgaW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzICovXG4gIGFkdmVydGlzaW5nSW50ZXJ2YWw/OiBudW1iZXI7XG4gIC8qKiBFbmFibGUgYWRhcHRpdmUgc2Nhbm5pbmcgYmFzZWQgb24gYmF0dGVyeSAqL1xuICBhZGFwdGl2ZVNjYW5uaW5nPzogYm9vbGVhbjtcbiAgLyoqIE1pbmltdW0gUlNTSSBmb3IgY29ubmVjdGlvbiAoZmlsdGVyIHdlYWsgc2lnbmFscykgKi9cbiAgbWluUnNzaT86IG51bWJlcjtcbiAgLyoqIE1heGltdW0gbnVtYmVyIG9mIEJMRSBjb25uZWN0aW9ucyAqL1xuICBtYXhDb25uZWN0aW9ucz86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBCTEUtc3BlY2lmaWMgdHJhbnNwb3J0IGV2ZW50c1xuICovXG5leHBvcnQgaW50ZXJmYWNlIEJsZVRyYW5zcG9ydEV2ZW50cyBleHRlbmRzIFRyYW5zcG9ydEV2ZW50cyB7XG4gIC8qKlxuICAgKiBDYWxsZWQgd2hlbiBhIEJMRSBkZXZpY2UgaXMgZGlzY292ZXJlZCBkdXJpbmcgc2Nhbm5pbmcuXG4gICAqIEBwYXJhbSBkZXZpY2UgVGhlIGRpc2NvdmVyZWQgZGV2aWNlIGluZm9cbiAgICovXG4gIG9uRGV2aWNlRGlzY292ZXJlZD8oZGV2aWNlOiBCbGVEZXZpY2VJbmZvKTogdm9pZDtcblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gUlNTSSAoc2lnbmFsIHN0cmVuZ3RoKSBjaGFuZ2VzIGZvciBhIGNvbm5lY3RlZCBwZWVyLlxuICAgKiBAcGFyYW0gcGVlcklkIFRoZSBwZWVyJ3MgSURcbiAgICogQHBhcmFtIHJzc2kgVGhlIG5ldyBSU1NJIHZhbHVlIGluIGRCbVxuICAgKi9cbiAgb25Sc3NpQ2hhbmdlZD8ocGVlcklkOiBUcmFuc3BvcnRQZWVySWQsIHJzc2k6IG51bWJlcik6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIE1UVSBuZWdvdGlhdGlvbiBjb21wbGV0ZXMuXG4gICAqIEBwYXJhbSBwZWVySWQgVGhlIHBlZXIncyBJRFxuICAgKiBAcGFyYW0gbXR1IFRoZSBuZWdvdGlhdGVkIE1UVSBzaXplXG4gICAqL1xuICBvbk10dU5lZ290aWF0ZWQ/KHBlZXJJZDogVHJhbnNwb3J0UGVlcklkLCBtdHU6IG51bWJlcik6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIGFkdmVydGlzaW5nIHN0YXRlIGNoYW5nZXMuXG4gICAqIEBwYXJhbSBpc0FkdmVydGlzaW5nIFdoZXRoZXIgYWR2ZXJ0aXNpbmcgaXMgY3VycmVudGx5IGFjdGl2ZVxuICAgKi9cbiAgb25BZHZlcnRpc2luZ1N0YXRlQ2hhbmdlZD8oaXNBZHZlcnRpc2luZzogYm9vbGVhbik6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHNjYW5uaW5nIHN0YXRlIGNoYW5nZXMuXG4gICAqIEBwYXJhbSBpc1NjYW5uaW5nIFdoZXRoZXIgc2Nhbm5pbmcgaXMgY3VycmVudGx5IGFjdGl2ZVxuICAgKi9cbiAgb25TY2FubmluZ1N0YXRlQ2hhbmdlZD8oaXNTY2FubmluZzogYm9vbGVhbik6IHZvaWQ7XG59XG5cbi8qKlxuICogRXh0ZW5kZWQgcGVlciBpbmZvIGZvciBCTEUgY29ubmVjdGlvbnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBCbGVQZWVySW5mbyBleHRlbmRzIFRyYW5zcG9ydFBlZXJJbmZvIHtcbiAgLyoqIFNpZ25hbCBzdHJlbmd0aCBpbiBkQm0gKi9cbiAgcnNzaT86IG51bWJlcjtcbiAgLyoqIE5lZ290aWF0ZWQgTVRVIHNpemUgKi9cbiAgbXR1PzogbnVtYmVyO1xuICAvKiogV2hldGhlciB0aGlzIHBlZXIgd2FzIGRpc2NvdmVyZWQgdmlhIHNjYW4gb3IgaW5jb21pbmcgY29ubmVjdGlvbiAqL1xuICBkaXNjb3ZlcmVkVmlhU2NhbjogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBCTEUgVHJhbnNwb3J0IGludGVyZmFjZSBleHRlbmRpbmcgdGhlIGJhc2UgVHJhbnNwb3J0IGludGVyZmFjZS5cbiAqIFBsYXRmb3JtLXNwZWNpZmljIGltcGxlbWVudGF0aW9ucyAoQW5kcm9pZCwgaU9TKSBzaG91bGQgaW1wbGVtZW50IHRoaXMgaW50ZXJmYWNlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJsZVRyYW5zcG9ydCBleHRlbmRzIFRyYW5zcG9ydCB7XG4gIC8qKlxuICAgKiBTdGFydCBCTEUgYWR2ZXJ0aXNpbmcgdG8gbWFrZSB0aGlzIGRldmljZSBkaXNjb3ZlcmFibGUuXG4gICAqIEBwYXJhbSBhZHZlcnRpc2luZ0RhdGEgT3B0aW9uYWwgZGF0YSB0byBpbmNsdWRlIGluIGFkdmVydGlzZW1lbnRzXG4gICAqL1xuICBzdGFydEFkdmVydGlzaW5nKGFkdmVydGlzaW5nRGF0YT86IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBTdG9wIEJMRSBhZHZlcnRpc2luZy5cbiAgICovXG4gIHN0b3BBZHZlcnRpc2luZygpOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhZHZlcnRpc2luZyBpcyBjdXJyZW50bHkgYWN0aXZlLlxuICAgKi9cbiAgaXNBZHZlcnRpc2luZygpOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTdGFydCBzY2FubmluZyBmb3IgQkxFIGRldmljZXMuXG4gICAqIEBwYXJhbSBmaWx0ZXJVdWlkcyBPcHRpb25hbCBzZXJ2aWNlIFVVSURzIHRvIGZpbHRlciBieVxuICAgKi9cbiAgc3RhcnRTY2FubmluZyhmaWx0ZXJVdWlkcz86IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogU3RvcCBzY2FubmluZyBmb3IgQkxFIGRldmljZXMuXG4gICAqL1xuICBzdG9wU2Nhbm5pbmcoKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogQ2hlY2sgaWYgc2Nhbm5pbmcgaXMgY3VycmVudGx5IGFjdGl2ZS5cbiAgICovXG4gIGlzU2Nhbm5pbmcoKTogYm9vbGVhbjtcblxuICAvKipcbiAgICogR2V0IGxpc3Qgb2YgZGlzY292ZXJlZCBkZXZpY2VzLlxuICAgKi9cbiAgZ2V0RGlzY292ZXJlZERldmljZXMoKTogQmxlRGV2aWNlSW5mb1tdO1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgUlNTSSBmb3IgYSBjb25uZWN0ZWQgcGVlci5cbiAgICogQHBhcmFtIHBlZXJJZCBUaGUgcGVlciBJRCB0byBxdWVyeVxuICAgKi9cbiAgZ2V0UnNzaShwZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCk6IFByb21pc2U8bnVtYmVyIHwgdW5kZWZpbmVkPjtcblxuICAvKipcbiAgICogR2V0IHRoZSBuZWdvdGlhdGVkIE1UVSBmb3IgYSBwZWVyLlxuICAgKiBAcGFyYW0gcGVlcklkIFRoZSBwZWVyIElEIHRvIHF1ZXJ5XG4gICAqL1xuICBnZXRNdHUocGVlcklkOiBUcmFuc3BvcnRQZWVySWQpOiBudW1iZXIgfCB1bmRlZmluZWQ7XG5cbiAgLyoqXG4gICAqIFJlcXVlc3QgTVRVIG5lZ290aWF0aW9uIHdpdGggYSBwZWVyLlxuICAgKiBAcGFyYW0gcGVlcklkIFRoZSBwZWVyIElEXG4gICAqIEBwYXJhbSByZXF1ZXN0ZWRNdHUgVGhlIE1UVSBzaXplIHRvIHJlcXVlc3RcbiAgICovXG4gIHJlcXVlc3RNdHUocGVlcklkOiBUcmFuc3BvcnRQZWVySWQsIHJlcXVlc3RlZE10dTogbnVtYmVyKTogUHJvbWlzZTxudW1iZXI+O1xuXG4gIC8qKlxuICAgKiBHZXQgQkxFLXNwZWNpZmljIHBlZXIgaW5mby5cbiAgICogQHBhcmFtIHBlZXJJZCBUaGUgcGVlciBJRCB0byBxdWVyeVxuICAgKi9cbiAgZ2V0QmxlUGVlckluZm8ocGVlcklkOiBUcmFuc3BvcnRQZWVySWQpOiBCbGVQZWVySW5mbyB8IHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiBEZWZhdWx0IEJMRSBzZXJ2aWNlIGFuZCBjaGFyYWN0ZXJpc3RpYyBVVUlEcyBmb3IgU0MgbWVzaCBwcm90b2NvbC5cbiAqIFRoZXNlIGZvbGxvdyB0aGUgQmx1ZXRvb3RoIFNJRyBiYXNlIFVVSUQgZm9ybWF0LlxuICovXG5leHBvcnQgY29uc3QgQkxFX01FU0hfU0VSVklDRV9VVUlEID0gXCI1YzAwMDAwMS0wMDAwLTEwMDAtODAwMC0wMDgwNWY5YjM0ZmJcIjtcbmV4cG9ydCBjb25zdCBCTEVfVFhfQ0hBUkFDVEVSSVNUSUNfVVVJRCA9XG4gIFwiNWMwMDAwMDItMDAwMC0xMDAwLTgwMDAtMDA4MDVmOWIzNGZiXCI7XG5leHBvcnQgY29uc3QgQkxFX1JYX0NIQVJBQ1RFUklTVElDX1VVSUQgPVxuICBcIjVjMDAwMDAzLTAwMDAtMTAwMC04MDAwLTAwODA1ZjliMzRmYlwiO1xuZXhwb3J0IGNvbnN0IEJMRV9WRVJTSU9OX0NIQVJBQ1RFUklTVElDX1VVSUQgPVxuICBcIjVjMDAwMDA0LTAwMDAtMTAwMC04MDAwLTAwODA1ZjliMzRmYlwiO1xuZXhwb3J0IGNvbnN0IEJMRV9NRVRBREFUQV9DSEFSQUNURVJJU1RJQ19VVUlEID1cbiAgXCI1YzAwMDAwNS0wMDAwLTEwMDAtODAwMC0wMDgwNWY5YjM0ZmJcIjtcblxuLyoqXG4gKiBEZWZhdWx0IEJMRSB0cmFuc3BvcnQgY29uZmlndXJhdGlvbi5cbiAqL1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfQkxFX0NPTkZJRzogUmVxdWlyZWQ8QmxlVHJhbnNwb3J0Q29uZmlnPiA9IHtcbiAgc2VydmljZVV1aWQ6IEJMRV9NRVNIX1NFUlZJQ0VfVVVJRCxcbiAgdHhDaGFyYWN0ZXJpc3RpY1V1aWQ6IEJMRV9UWF9DSEFSQUNURVJJU1RJQ19VVUlELFxuICByeENoYXJhY3RlcmlzdGljVXVpZDogQkxFX1JYX0NIQVJBQ1RFUklTVElDX1VVSUQsXG4gIGFkdmVydGlzaW5nTW9kZTogQmxlQWR2ZXJ0aXNpbmdNb2RlLkJBTEFOQ0VELFxuICBzY2FuTW9kZTogQmxlU2Nhbk1vZGUuQkFMQU5DRUQsXG4gIG1heE10dTogNTE3LFxuICBzY2FuRHVyYXRpb246IDAsIC8vIENvbnRpbnVvdXNcbiAgYWR2ZXJ0aXNpbmdJbnRlcnZhbDogMjUwLFxuICBhZGFwdGl2ZVNjYW5uaW5nOiB0cnVlLFxuICBtaW5Sc3NpOiAtOTAsXG4gIG1heENvbm5lY3Rpb25zOiA3LFxuICBtYXhQZWVyczogNyxcbiAgY29ubmVjdGlvblRpbWVvdXQ6IDMwMDAwLFxuICBoZWFydGJlYXRJbnRlcnZhbDogMzAwMDAsXG4gIG9wdGlvbnM6IHt9LFxufTtcblxuLyoqXG4gKiBNb2NrIEJMRSBUcmFuc3BvcnQgZm9yIHRlc3RpbmcgYW5kIHdlYiBlbnZpcm9ubWVudHMuXG4gKiBUaGlzIGltcGxlbWVudGF0aW9uIHNpbXVsYXRlcyBCTEUgYmVoYXZpb3IgZm9yIHRlc3RpbmcgcHVycG9zZXMuXG4gKi9cbmV4cG9ydCBjbGFzcyBNb2NrQmxlVHJhbnNwb3J0IGltcGxlbWVudHMgQmxlVHJhbnNwb3J0IHtcbiAgcmVhZG9ubHkgbG9jYWxQZWVySWQ6IFRyYW5zcG9ydFBlZXJJZDtcbiAgcmVhZG9ubHkgbmFtZSA9IFwiYmx1ZXRvb3RoXCI7XG5cbiAgcHJpdmF0ZSBjb25maWc6IFJlcXVpcmVkPEJsZVRyYW5zcG9ydENvbmZpZz47XG4gIHByaXZhdGUgZXZlbnRzOiBCbGVUcmFuc3BvcnRFdmVudHMgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBwZWVyczogTWFwPFRyYW5zcG9ydFBlZXJJZCwgQmxlUGVlckluZm8+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGRpc2NvdmVyZWREZXZpY2VzOiBNYXA8c3RyaW5nLCBCbGVEZXZpY2VJbmZvPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBpc1J1bm5pbmcgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfaXNBZHZlcnRpc2luZyA9IGZhbHNlO1xuICBwcml2YXRlIF9pc1NjYW5uaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgc2NhbkludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKGxvY2FsUGVlcklkOiBUcmFuc3BvcnRQZWVySWQsIGNvbmZpZzogQmxlVHJhbnNwb3J0Q29uZmlnID0ge30pIHtcbiAgICB0aGlzLmxvY2FsUGVlcklkID0gbG9jYWxQZWVySWQ7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLkRFRkFVTFRfQkxFX0NPTkZJRywgLi4uY29uZmlnIH07XG4gIH1cblxuICBhc3luYyBzdGFydChldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuZXZlbnRzID0gZXZlbnRzO1xuICAgIHRoaXMuaXNSdW5uaW5nID0gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIHN0b3AoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5zdG9wQWR2ZXJ0aXNpbmcoKTtcbiAgICBhd2FpdCB0aGlzLnN0b3BTY2FubmluZygpO1xuICAgIHRoaXMucGVlcnMuY2xlYXIoKTtcbiAgICB0aGlzLmRpc2NvdmVyZWREZXZpY2VzLmNsZWFyKCk7XG4gICAgdGhpcy5ldmVudHMgPSBudWxsO1xuICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7XG4gIH1cblxuICBhc3luYyBjb25uZWN0KHBlZXJJZDogVHJhbnNwb3J0UGVlcklkKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmlzUnVubmluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVHJhbnNwb3J0IG5vdCBzdGFydGVkXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHBlZXJJbmZvOiBCbGVQZWVySW5mbyA9IHtcbiAgICAgIHBlZXJJZCxcbiAgICAgIHN0YXRlOiBcImNvbm5lY3RpbmdcIixcbiAgICAgIHRyYW5zcG9ydFR5cGU6IFwiYmx1ZXRvb3RoXCIsXG4gICAgICBjb25uZWN0aW9uUXVhbGl0eTogODAsXG4gICAgICBieXRlc1NlbnQ6IDAsXG4gICAgICBieXRlc1JlY2VpdmVkOiAwLFxuICAgICAgbGFzdFNlZW46IERhdGUubm93KCksXG4gICAgICByc3NpOiAtNjAsXG4gICAgICBtdHU6IDE4NSxcbiAgICAgIGRpc2NvdmVyZWRWaWFTY2FuOiB0cnVlLFxuICAgIH07XG5cbiAgICB0aGlzLnBlZXJzLnNldChwZWVySWQsIHBlZXJJbmZvKTtcbiAgICB0aGlzLmV2ZW50cz8ub25TdGF0ZUNoYW5nZT8uKHBlZXJJZCwgXCJjb25uZWN0aW5nXCIpO1xuXG4gICAgLy8gU2ltdWxhdGUgY29ubmVjdGlvbiBkZWxheVxuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuXG4gICAgcGVlckluZm8uc3RhdGUgPSBcImNvbm5lY3RlZFwiO1xuICAgIHRoaXMuZXZlbnRzPy5vblN0YXRlQ2hhbmdlPy4ocGVlcklkLCBcImNvbm5lY3RlZFwiKTtcbiAgICB0aGlzLmV2ZW50cz8ub25QZWVyQ29ubmVjdGVkPy4ocGVlcklkLCBwZWVySW5mbyk7XG4gIH1cblxuICBhc3luYyBkaXNjb25uZWN0KHBlZXJJZDogVHJhbnNwb3J0UGVlcklkKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcGVlciA9IHRoaXMucGVlcnMuZ2V0KHBlZXJJZCk7XG4gICAgaWYgKHBlZXIpIHtcbiAgICAgIHBlZXIuc3RhdGUgPSBcImRpc2Nvbm5lY3RlZFwiO1xuICAgICAgdGhpcy5ldmVudHM/Lm9uU3RhdGVDaGFuZ2U/LihwZWVySWQsIFwiZGlzY29ubmVjdGVkXCIpO1xuICAgICAgdGhpcy5ldmVudHM/Lm9uUGVlckRpc2Nvbm5lY3RlZD8uKHBlZXJJZCwgXCJkaXNjb25uZWN0ZWRcIik7XG4gICAgICB0aGlzLnBlZXJzLmRlbGV0ZShwZWVySWQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbmQocGVlcklkOiBUcmFuc3BvcnRQZWVySWQsIHBheWxvYWQ6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwZWVyID0gdGhpcy5wZWVycy5nZXQocGVlcklkKTtcbiAgICBpZiAoIXBlZXIgfHwgcGVlci5zdGF0ZSAhPT0gXCJjb25uZWN0ZWRcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQZWVyICR7cGVlcklkfSBub3QgY29ubmVjdGVkYCk7XG4gICAgfVxuXG4gICAgcGVlci5ieXRlc1NlbnQgPSAocGVlci5ieXRlc1NlbnQgfHwgMCkgKyBwYXlsb2FkLmxlbmd0aDtcbiAgICBwZWVyLmxhc3RTZWVuID0gRGF0ZS5ub3coKTtcbiAgfVxuXG4gIGFzeW5jIGJyb2FkY2FzdChcbiAgICBwYXlsb2FkOiBVaW50OEFycmF5LFxuICAgIGV4Y2x1ZGVQZWVySWQ/OiBUcmFuc3BvcnRQZWVySWQsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNlbmRQcm9taXNlczogUHJvbWlzZTx2b2lkPltdID0gW107XG4gICAgZm9yIChjb25zdCBbcGVlcklkLCBwZWVyXSBvZiB0aGlzLnBlZXJzKSB7XG4gICAgICBpZiAocGVlcklkICE9PSBleGNsdWRlUGVlcklkICYmIHBlZXIuc3RhdGUgPT09IFwiY29ubmVjdGVkXCIpIHtcbiAgICAgICAgc2VuZFByb21pc2VzLnB1c2godGhpcy5zZW5kKHBlZXJJZCwgcGF5bG9hZCkpO1xuICAgICAgfVxuICAgIH1cbiAgICBhd2FpdCBQcm9taXNlLmFsbChzZW5kUHJvbWlzZXMpO1xuICB9XG5cbiAgZ2V0Q29ubmVjdGVkUGVlcnMoKTogVHJhbnNwb3J0UGVlcklkW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMucGVlcnMuZW50cmllcygpKVxuICAgICAgLmZpbHRlcigoWywgcGVlcl0pID0+IHBlZXIuc3RhdGUgPT09IFwiY29ubmVjdGVkXCIpXG4gICAgICAubWFwKChbaWRdKSA9PiBpZCk7XG4gIH1cblxuICBnZXRQZWVySW5mbyhwZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCk6IFRyYW5zcG9ydFBlZXJJbmZvIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5wZWVycy5nZXQocGVlcklkKTtcbiAgfVxuXG4gIGdldENvbm5lY3Rpb25TdGF0ZShcbiAgICBwZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCxcbiAgKTogVHJhbnNwb3J0Q29ubmVjdGlvblN0YXRlIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5wZWVycy5nZXQocGVlcklkKT8uc3RhdGU7XG4gIH1cblxuICAvLyBCTEUtc3BlY2lmaWMgbWV0aG9kc1xuXG4gIGFzeW5jIHN0YXJ0QWR2ZXJ0aXNpbmcoX2FkdmVydGlzaW5nRGF0YT86IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLl9pc0FkdmVydGlzaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmV2ZW50cz8ub25BZHZlcnRpc2luZ1N0YXRlQ2hhbmdlZD8uKHRydWUpO1xuICB9XG5cbiAgYXN5bmMgc3RvcEFkdmVydGlzaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuX2lzQWR2ZXJ0aXNpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmV2ZW50cz8ub25BZHZlcnRpc2luZ1N0YXRlQ2hhbmdlZD8uKGZhbHNlKTtcbiAgfVxuXG4gIGlzQWR2ZXJ0aXNpbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzQWR2ZXJ0aXNpbmc7XG4gIH1cblxuICBhc3luYyBzdGFydFNjYW5uaW5nKF9maWx0ZXJVdWlkcz86IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5faXNTY2FubmluZyA9IHRydWU7XG4gICAgdGhpcy5ldmVudHM/Lm9uU2Nhbm5pbmdTdGF0ZUNoYW5nZWQ/Lih0cnVlKTtcblxuICAgIC8vIFNpbXVsYXRlIHBlcmlvZGljIGRldmljZSBkaXNjb3ZlcnlcbiAgICB0aGlzLnNjYW5JbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIC8vIE1vY2sgZGlzY292ZXJlZCBkZXZpY2VcbiAgICAgIGNvbnN0IG1vY2tEZXZpY2U6IEJsZURldmljZUluZm8gPSB7XG4gICAgICAgIGRldmljZUlkOiBgbW9jay1kZXZpY2UtJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIG5hbWU6IFwiU0MgUGVlclwiLFxuICAgICAgICByc3NpOiAtNzAgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCksXG4gICAgICAgIGNvbm5lY3RhYmxlOiB0cnVlLFxuICAgICAgICBzZXJ2aWNlVXVpZHM6IFt0aGlzLmNvbmZpZy5zZXJ2aWNlVXVpZF0sXG4gICAgICAgIGxhc3RTZWVuOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICAgIHRoaXMuZGlzY292ZXJlZERldmljZXMuc2V0KG1vY2tEZXZpY2UuZGV2aWNlSWQsIG1vY2tEZXZpY2UpO1xuICAgICAgdGhpcy5ldmVudHM/Lm9uRGV2aWNlRGlzY292ZXJlZD8uKG1vY2tEZXZpY2UpO1xuICAgIH0sIDUwMDApO1xuICB9XG5cbiAgYXN5bmMgc3RvcFNjYW5uaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuX2lzU2Nhbm5pbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5zY2FuSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zY2FuSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5zY2FuSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLmV2ZW50cz8ub25TY2FubmluZ1N0YXRlQ2hhbmdlZD8uKGZhbHNlKTtcbiAgfVxuXG4gIGlzU2Nhbm5pbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2lzU2Nhbm5pbmc7XG4gIH1cblxuICBnZXREaXNjb3ZlcmVkRGV2aWNlcygpOiBCbGVEZXZpY2VJbmZvW10ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZGlzY292ZXJlZERldmljZXMudmFsdWVzKCkpO1xuICB9XG5cbiAgYXN5bmMgZ2V0UnNzaShwZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCk6IFByb21pc2U8bnVtYmVyIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMucGVlcnMuZ2V0KHBlZXJJZCk/LnJzc2k7XG4gIH1cblxuICBnZXRNdHUocGVlcklkOiBUcmFuc3BvcnRQZWVySWQpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnBlZXJzLmdldChwZWVySWQpPy5tdHU7XG4gIH1cblxuICBhc3luYyByZXF1ZXN0TXR1KFxuICAgIHBlZXJJZDogVHJhbnNwb3J0UGVlcklkLFxuICAgIHJlcXVlc3RlZE10dTogbnVtYmVyLFxuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IHBlZXIgPSB0aGlzLnBlZXJzLmdldChwZWVySWQpO1xuICAgIGlmICghcGVlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQZWVyICR7cGVlcklkfSBub3QgZm91bmRgKTtcbiAgICB9XG5cbiAgICAvLyBTaW11bGF0ZSBNVFUgbmVnb3RpYXRpb24gKHVzdWFsbHkgcmV0dXJucyBtaW4gb2YgcmVxdWVzdGVkIGFuZCBzdXBwb3J0ZWQpXG4gICAgY29uc3QgbmVnb3RpYXRlZE10dSA9IE1hdGgubWluKHJlcXVlc3RlZE10dSwgdGhpcy5jb25maWcubWF4TXR1KTtcbiAgICBwZWVyLm10dSA9IG5lZ290aWF0ZWRNdHU7XG4gICAgdGhpcy5ldmVudHM/Lm9uTXR1TmVnb3RpYXRlZD8uKHBlZXJJZCwgbmVnb3RpYXRlZE10dSk7XG4gICAgcmV0dXJuIG5lZ290aWF0ZWRNdHU7XG4gIH1cblxuICBnZXRCbGVQZWVySW5mbyhwZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCk6IEJsZVBlZXJJbmZvIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5wZWVycy5nZXQocGVlcklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaW11bGF0ZSByZWNlaXZpbmcgYSBtZXNzYWdlIGZyb20gYSBwZWVyLlxuICAgKiBVc2VkIGZvciB0ZXN0aW5nIHB1cnBvc2VzLlxuICAgKi9cbiAgc2ltdWxhdGVNZXNzYWdlKGZyb206IFRyYW5zcG9ydFBlZXJJZCwgcGF5bG9hZDogVWludDhBcnJheSk6IHZvaWQge1xuICAgIGNvbnN0IHBlZXIgPSB0aGlzLnBlZXJzLmdldChmcm9tKTtcbiAgICBpZiAocGVlcikge1xuICAgICAgcGVlci5ieXRlc1JlY2VpdmVkID0gKHBlZXIuYnl0ZXNSZWNlaXZlZCB8fCAwKSArIHBheWxvYWQubGVuZ3RoO1xuICAgICAgcGVlci5sYXN0U2VlbiA9IERhdGUubm93KCk7XG4gICAgfVxuXG4gICAgdGhpcy5ldmVudHM/Lm9uTWVzc2FnZSh7XG4gICAgICBmcm9tLFxuICAgICAgcGF5bG9hZCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaW11bGF0ZSBhbiBpbmNvbWluZyBjb25uZWN0aW9uIHJlcXVlc3QuXG4gICAqIFVzZWQgZm9yIHRlc3RpbmcgcHVycG9zZXMuXG4gICAqL1xuICBhc3luYyBzaW11bGF0ZUluY29taW5nQ29ubmVjdGlvbihwZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHBlZXJJbmZvOiBCbGVQZWVySW5mbyA9IHtcbiAgICAgIHBlZXJJZCxcbiAgICAgIHN0YXRlOiBcImNvbm5lY3RlZFwiLFxuICAgICAgdHJhbnNwb3J0VHlwZTogXCJibHVldG9vdGhcIixcbiAgICAgIGNvbm5lY3Rpb25RdWFsaXR5OiA3NSxcbiAgICAgIGJ5dGVzU2VudDogMCxcbiAgICAgIGJ5dGVzUmVjZWl2ZWQ6IDAsXG4gICAgICBsYXN0U2VlbjogRGF0ZS5ub3coKSxcbiAgICAgIHJzc2k6IC02NSxcbiAgICAgIG10dTogMTg1LFxuICAgICAgZGlzY292ZXJlZFZpYVNjYW46IGZhbHNlLFxuICAgIH07XG5cbiAgICB0aGlzLnBlZXJzLnNldChwZWVySWQsIHBlZXJJbmZvKTtcbiAgICB0aGlzLmV2ZW50cz8ub25QZWVyQ29ubmVjdGVkPy4ocGVlcklkLCBwZWVySW5mbyk7XG4gIH1cbn1cblxuLy8gUmVnaXN0ZXIgdGhlIG1vY2sgQkxFIHRyYW5zcG9ydCBmYWN0b3J5XG50cmFuc3BvcnRSZWdpc3RyeS5yZWdpc3RlcihcImJsdWV0b290aFwiLCAoY29uZmlnPzogVHJhbnNwb3J0Q29uZmlnKSA9PiB7XG4gIGNvbnN0IHBlZXJJZCA9IGBibGUtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIsIDgpfWA7XG4gIHJldHVybiBuZXcgTW9ja0JsZVRyYW5zcG9ydChwZWVySWQsIGNvbmZpZyBhcyBCbGVUcmFuc3BvcnRDb25maWcpO1xufSk7XG5cbi8qKlxuICogQkxFIHRyYW5zcG9ydCBmYWN0b3J5IHR5cGVcbiAqL1xuZXhwb3J0IHR5cGUgQmxlVHJhbnNwb3J0RmFjdG9yeSA9IChcbiAgbG9jYWxQZWVySWQ6IFRyYW5zcG9ydFBlZXJJZCxcbiAgY29uZmlnPzogQmxlVHJhbnNwb3J0Q29uZmlnLFxuKSA9PiBCbGVUcmFuc3BvcnQ7XG4iXSwidmVyc2lvbiI6M30=