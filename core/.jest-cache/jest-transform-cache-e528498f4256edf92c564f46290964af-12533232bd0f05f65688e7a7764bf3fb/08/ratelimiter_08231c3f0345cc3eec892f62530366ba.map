{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/rate-limiter.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/rate-limiter.ts"],"sourcesContent":["export interface RateLimitConfig {\n  messagesPerMinute: number;\n  messagesPerHour: number;\n  filesPerHour: number;\n  maxMessageSize: number;\n}\n\nexport const DEFAULT_RATE_LIMITS: RateLimitConfig = {\n  messagesPerMinute: 60,\n  messagesPerHour: 1000,\n  filesPerHour: 100,\n  maxMessageSize: 10000\n};\n\nexport class RateLimiter {\n  private messageTimestamps = new Map<string, number[]>();\n  private fileTimestamps = new Map<string, number[]>();\n  private config: RateLimitConfig;\n  \n  constructor(config: RateLimitConfig = DEFAULT_RATE_LIMITS) {\n    this.config = config;\n  }\n  \n  canSendMessage(userId: string): { allowed: boolean; reason?: string } {\n    const now = Date.now();\n    const userMessages = this.messageTimestamps.get(userId) || [];\n    \n    // Check per-minute limit\n    const lastMinute = userMessages.filter(t => now - t < 60000);\n    if (lastMinute.length >= this.config.messagesPerMinute) {\n      return {\n        allowed: false,\n        reason: `Rate limit exceeded: ${this.config.messagesPerMinute} messages per minute`\n      };\n    }\n    \n    // Check per-hour limit\n    const lastHour = userMessages.filter(t => now - t < 3600000);\n    if (lastHour.length >= this.config.messagesPerHour) {\n      return {\n        allowed: false,\n        reason: `Rate limit exceeded: ${this.config.messagesPerHour} messages per hour`\n      };\n    }\n    \n    // Record this message\n    lastHour.push(now);\n    this.messageTimestamps.set(userId, lastHour);\n    \n    return { allowed: true };\n  }\n  \n  canSendFile(userId: string): { allowed: boolean; reason?: string } {\n    const now = Date.now();\n    const userFiles = this.fileTimestamps.get(userId) || [];\n    \n    // Check per-hour limit\n    const lastHour = userFiles.filter(t => now - t < 3600000);\n    if (lastHour.length >= this.config.filesPerHour) {\n      return {\n        allowed: false,\n        reason: `Rate limit exceeded: ${this.config.filesPerHour} files per hour`\n      };\n    }\n    \n    // Record this file\n    lastHour.push(now);\n    this.fileTimestamps.set(userId, lastHour);\n    \n    return { allowed: true };\n  }\n  \n  cleanup() {\n    const now = Date.now();\n    const hourAgo = now - 3600000;\n    \n    // Clean up old timestamps\n    for (const [userId, timestamps] of this.messageTimestamps.entries()) {\n      const recent = timestamps.filter(t => t > hourAgo);\n      if (recent.length === 0) {\n        this.messageTimestamps.delete(userId);\n      } else {\n        this.messageTimestamps.set(userId, recent);\n      }\n    }\n    \n    for (const [userId, timestamps] of this.fileTimestamps.entries()) {\n      const recent = timestamps.filter(t => t > hourAgo);\n      if (recent.length === 0) {\n        this.fileTimestamps.delete(userId);\n      } else {\n        this.fileTimestamps.set(userId, recent);\n      }\n    }\n  }\n}\n\n// Global rate limiter instance\nexport const rateLimiter = new RateLimiter();\n\n// Cleanup every 5 minutes\nconst __rateLimiterCleanupTimer = setInterval(() => rateLimiter.cleanup(), 5 * 60 * 1000);\ntry {\n  if (__rateLimiterCleanupTimer && typeof (__rateLimiterCleanupTimer as any).unref === 'function') {\n    (__rateLimiterCleanupTimer as any).unref();\n  }\n  } catch (e) { /* no-op */ }"],"version":3}