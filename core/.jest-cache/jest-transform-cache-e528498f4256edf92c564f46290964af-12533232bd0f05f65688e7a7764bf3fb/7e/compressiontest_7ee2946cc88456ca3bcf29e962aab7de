dbd0a8163bb4f76649b6903a0cf6653b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const compression_1 = require("./compression");
describe('Compression', () => {
    describe('compressMessage', () => {
        it('should return uncompressed data for small messages', () => {
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            const result = (0, compression_1.compressMessage)(data);
            expect(result.compressed).toBe(false);
            expect(result.data).toEqual(data);
            expect(result.originalSize).toBe(5);
            expect(result.compressedSize).toBe(5);
        });
        it('should compress large messages with repetitive data', () => {
            const data = new Uint8Array(2048).fill(65); // 2KB of 'A's - highly compressible
            const result = (0, compression_1.compressMessage)(data);
            expect(result.compressed).toBe(true);
            expect(result.originalSize).toBe(2048);
            expect(result.compressedSize).toBeLessThan(result.originalSize);
            // Repetitive data compresses very well
            expect(result.compressedSize).toBeLessThan(result.originalSize * 0.1);
        });
        it('should handle empty data', () => {
            const data = new Uint8Array(0);
            const result = (0, compression_1.compressMessage)(data);
            expect(result.compressed).toBe(false);
            expect(result.data).toEqual(data);
            expect(result.originalSize).toBe(0);
            expect(result.compressedSize).toBe(0);
        });
        it('should return consistent results for same input', () => {
            const data = new Uint8Array([10, 20, 30, 40, 50]);
            const result1 = (0, compression_1.compressMessage)(data);
            const result2 = (0, compression_1.compressMessage)(data);
            expect(result1).toEqual(result2);
        });
    });
    describe('decompressMessage', () => {
        it('should return original data if not compressed', () => {
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            const result = (0, compression_1.decompressMessage)(data, false);
            expect(result).toEqual(data);
        });
        it('should throw error for invalid compressed data', () => {
            const data = new Uint8Array([1, 2, 3, 4, 5]);
            // Trying to decompress invalid data should throw
            expect(() => (0, compression_1.decompressMessage)(data, true)).toThrow('Failed to decompress message');
        });
        it('should handle empty data', () => {
            const data = new Uint8Array(0);
            const result = (0, compression_1.decompressMessage)(data, false);
            expect(result).toEqual(data);
        });
    });
    describe('getCompressionRatio', () => {
        it('should return 1.0 for uncompressed data', () => {
            const result = {
                data: new Uint8Array([1, 2, 3]),
                compressed: false,
                originalSize: 100,
                compressedSize: 100,
            };
            expect((0, compression_1.getCompressionRatio)(result)).toBe(1.0);
        });
        it('should calculate ratio correctly for compressed data', () => {
            const result = {
                data: new Uint8Array([1, 2]),
                compressed: true,
                originalSize: 100,
                compressedSize: 50,
            };
            expect((0, compression_1.getCompressionRatio)(result)).toBe(0.5);
        });
        it('should handle 0% compression (ratio 1.0)', () => {
            const result = {
                data: new Uint8Array([1, 2, 3]),
                compressed: true,
                originalSize: 100,
                compressedSize: 100,
            };
            expect((0, compression_1.getCompressionRatio)(result)).toBe(1.0);
        });
        it('should handle perfect compression (small ratio)', () => {
            const result = {
                data: new Uint8Array([1]),
                compressed: true,
                originalSize: 1000,
                compressedSize: 10,
            };
            expect((0, compression_1.getCompressionRatio)(result)).toBe(0.01);
        });
    });
    describe('Integration', () => {
        it('should compress and decompress successfully', () => {
            const originalData = new Uint8Array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);
            const compressed = (0, compression_1.compressMessage)(originalData);
            const decompressed = (0, compression_1.decompressMessage)(compressed.data, compressed.compressed);
            expect(decompressed).toEqual(originalData);
        });
        it('should maintain data integrity through compress/decompress cycle', () => {
            const originalData = new Uint8Array(500);
            for (let i = 0; i < originalData.length; i++) {
                originalData[i] = i % 256;
            }
            const compressed = (0, compression_1.compressMessage)(originalData);
            const decompressed = (0, compression_1.decompressMessage)(compressed.data, compressed.compressed);
            expect(decompressed).toEqual(originalData);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29tcHJlc3Npb24udGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLCtDQUEyRztBQUUzRyxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQy9CLEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxHQUFHLEVBQUU7WUFDNUQsTUFBTSxJQUFJLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QyxNQUFNLE1BQU0sR0FBRyxJQUFBLDZCQUFlLEVBQUMsSUFBSSxDQUFDLENBQUM7WUFFckMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsR0FBRyxFQUFFO1lBQzdELE1BQU0sSUFBSSxHQUFHLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLG9DQUFvQztZQUNoRixNQUFNLE1BQU0sR0FBRyxJQUFBLDZCQUFlLEVBQUMsSUFBSSxDQUFDLENBQUM7WUFFckMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxD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O1lBQzFFLE1BQU0sWUFBWSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzdDLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1lBQzVCLENBQUM7WUFFRCxNQUFNLFVBQVUsR0FBRyxJQUFBLDZCQUFlLEVBQUMsWUFBWSxDQUFDLENBQUM7WUFDakQsTUFBTSxZQUFZLEdBQUcsSUFBQSwrQkFBaUIsRUFBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUvRSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy9jb21wcmVzc2lvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbXByZXNzTWVzc2FnZSwgZGVjb21wcmVzc01lc3NhZ2UsIGdldENvbXByZXNzaW9uUmF0aW8sIENvbXByZXNzaW9uUmVzdWx0IH0gZnJvbSAnLi9jb21wcmVzc2lvbic7XG5cbmRlc2NyaWJlKCdDb21wcmVzc2lvbicsICgpID0+IHtcbiAgZGVzY3JpYmUoJ2NvbXByZXNzTWVzc2FnZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1bmNvbXByZXNzZWQgZGF0YSBmb3Igc21hbGwgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXByZXNzTWVzc2FnZShkYXRhKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wcmVzc2VkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbChkYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub3JpZ2luYWxTaXplKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wcmVzc2VkU2l6ZSkudG9CZSg1KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29tcHJlc3MgbGFyZ2UgbWVzc2FnZXMgd2l0aCByZXBldGl0aXZlIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoMjA0OCkuZmlsbCg2NSk7IC8vIDJLQiBvZiAnQSdzIC0gaGlnaGx5IGNvbXByZXNzaWJsZVxuICAgICAgY29uc3QgcmVzdWx0ID0gY29tcHJlc3NNZXNzYWdlKGRhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmNvbXByZXNzZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm9yaWdpbmFsU2l6ZSkudG9CZSgyMDQ4KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29tcHJlc3NlZFNpemUpLnRvQmVMZXNzVGhhbihyZXN1bHQub3JpZ2luYWxTaXplKTtcbiAgICAgIC8vIFJlcGV0aXRpdmUgZGF0YSBjb21wcmVzc2VzIHZlcnkgd2VsbFxuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wcmVzc2VkU2l6ZSkudG9CZUxlc3NUaGFuKHJlc3VsdC5vcmlnaW5hbFNpemUgKiAwLjEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSgwKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXByZXNzTWVzc2FnZShkYXRhKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wcmVzc2VkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbChkYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub3JpZ2luYWxTaXplKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wcmVzc2VkU2l6ZSkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbnNpc3RlbnQgcmVzdWx0cyBmb3Igc2FtZSBpbnB1dCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShbMTAsIDIwLCAzMCwgNDAsIDUwXSk7XG4gICAgICBjb25zdCByZXN1bHQxID0gY29tcHJlc3NNZXNzYWdlKGRhdGEpO1xuICAgICAgY29uc3QgcmVzdWx0MiA9IGNvbXByZXNzTWVzc2FnZShkYXRhKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdDEpLnRvRXF1YWwocmVzdWx0Mik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWNvbXByZXNzTWVzc2FnZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBvcmlnaW5hbCBkYXRhIGlmIG5vdCBjb21wcmVzc2VkJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBjb25zdCByZXN1bHQgPSBkZWNvbXByZXNzTWVzc2FnZShkYXRhLCBmYWxzZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZGF0YSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBpbnZhbGlkIGNvbXByZXNzZWQgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNV0pO1xuXG4gICAgICAvLyBUcnlpbmcgdG8gZGVjb21wcmVzcyBpbnZhbGlkIGRhdGEgc2hvdWxkIHRocm93XG4gICAgICBleHBlY3QoKCkgPT4gZGVjb21wcmVzc01lc3NhZ2UoZGF0YSwgdHJ1ZSkpLnRvVGhyb3coJ0ZhaWxlZCB0byBkZWNvbXByZXNzIG1lc3NhZ2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoMCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBkZWNvbXByZXNzTWVzc2FnZShkYXRhLCBmYWxzZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZGF0YSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRDb21wcmVzc2lvblJhdGlvJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIDEuMCBmb3IgdW5jb21wcmVzc2VkIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQ6IENvbXByZXNzaW9uUmVzdWx0ID0ge1xuICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheShbMSwgMiwgM10pLFxuICAgICAgICBjb21wcmVzc2VkOiBmYWxzZSxcbiAgICAgICAgb3JpZ2luYWxTaXplOiAxMDAsXG4gICAgICAgIGNvbXByZXNzZWRTaXplOiAxMDAsXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoZ2V0Q29tcHJlc3Npb25SYXRpbyhyZXN1bHQpKS50b0JlKDEuMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSByYXRpbyBjb3JyZWN0bHkgZm9yIGNvbXByZXNzZWQgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdDogQ29tcHJlc3Npb25SZXN1bHQgPSB7XG4gICAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KFsxLCAyXSksXG4gICAgICAgIGNvbXByZXNzZWQ6IHRydWUsXG4gICAgICAgIG9yaWdpbmFsU2l6ZTogMTAwLFxuICAgICAgICBjb21wcmVzc2VkU2l6ZTogNTAsXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoZ2V0Q29tcHJlc3Npb25SYXRpbyhyZXN1bHQpKS50b0JlKDAuNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSAwJSBjb21wcmVzc2lvbiAocmF0aW8gMS4wKScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdDogQ29tcHJlc3Npb25SZXN1bHQgPSB7XG4gICAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzXSksXG4gICAgICAgIGNvbXByZXNzZWQ6IHRydWUsXG4gICAgICAgIG9yaWdpbmFsU2l6ZTogMTAwLFxuICAgICAgICBjb21wcmVzc2VkU2l6ZTogMTAwLFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KGdldENvbXByZXNzaW9uUmF0aW8ocmVzdWx0KSkudG9CZSgxLjApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGVyZmVjdCBjb21wcmVzc2lvbiAoc21hbGwgcmF0aW8pJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0OiBDb21wcmVzc2lvblJlc3VsdCA9IHtcbiAgICAgICAgZGF0YTogbmV3IFVpbnQ4QXJyYXkoWzFdKSxcbiAgICAgICAgY29tcHJlc3NlZDogdHJ1ZSxcbiAgICAgICAgb3JpZ2luYWxTaXplOiAxMDAwLFxuICAgICAgICBjb21wcmVzc2VkU2l6ZTogMTAsXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoZ2V0Q29tcHJlc3Npb25SYXRpbyhyZXN1bHQpKS50b0JlKDAuMDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb21wcmVzcyBhbmQgZGVjb21wcmVzcyBzdWNjZXNzZnVsbHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbERhdGEgPSBuZXcgVWludDhBcnJheShbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTBdKTtcbiAgICAgIGNvbnN0IGNvbXByZXNzZWQgPSBjb21wcmVzc01lc3NhZ2Uob3JpZ2luYWxEYXRhKTtcbiAgICAgIGNvbnN0IGRlY29tcHJlc3NlZCA9IGRlY29tcHJlc3NNZXNzYWdlKGNvbXByZXNzZWQuZGF0YSwgY29tcHJlc3NlZC5jb21wcmVzc2VkKTtcblxuICAgICAgZXhwZWN0KGRlY29tcHJlc3NlZCkudG9FcXVhbChvcmlnaW5hbERhdGEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBkYXRhIGludGVncml0eSB0aHJvdWdoIGNvbXByZXNzL2RlY29tcHJlc3MgY3ljbGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbERhdGEgPSBuZXcgVWludDhBcnJheSg1MDApO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcmlnaW5hbERhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgb3JpZ2luYWxEYXRhW2ldID0gaSAlIDI1NjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29tcHJlc3NlZCA9IGNvbXByZXNzTWVzc2FnZShvcmlnaW5hbERhdGEpO1xuICAgICAgY29uc3QgZGVjb21wcmVzc2VkID0gZGVjb21wcmVzc01lc3NhZ2UoY29tcHJlc3NlZC5kYXRhLCBjb21wcmVzc2VkLmNvbXByZXNzZWQpO1xuXG4gICAgICBleHBlY3QoZGVjb21wcmVzc2VkKS50b0VxdWFsKG9yaWdpbmFsRGF0YSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=