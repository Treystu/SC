{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/db-schema.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/db-schema.ts"],"sourcesContent":["/**\n * Database Schema - IndexedDB schema definitions\n * Task 183: Database schema and migration system\n */\n\nexport const DB_NAME = 'SovereignCommunications';\nexport const DB_VERSION = 2; // Incremented for V1 persistence stores\n\nexport interface Message {\n  id: string;\n  conversationId: string;\n  senderId: string;\n  recipientId: string;\n  content: string;\n  timestamp: number;\n  type: 'text' | 'file' | 'voice' | 'video';\n  encrypted: boolean;\n  signature?: string;\n  metadata?: Record<string, any>;\n  status: 'pending' | 'sent' | 'delivered' | 'read' | 'failed';\n  replyToId?: string;\n  reactions?: Array<{ userId: string; emoji: string }>;\n}\n\nexport interface Contact {\n  id: string;\n  publicKey: string;\n  name?: string;\n  avatar?: string;\n  lastSeen?: number;\n  addedAt: number;\n  verified: boolean;\n  blocked: boolean;\n  metadata?: Record<string, any>;\n}\n\nexport interface Conversation {\n  id: string;\n  type: 'direct' | 'group';\n  participantIds: string[];\n  name?: string;\n  avatar?: string;\n  lastMessageId?: string;\n  lastMessageTime?: number;\n  unreadCount: number;\n  muted: boolean;\n  archived: boolean;\n  createdAt: number;\n  metadata?: Record<string, any>;\n}\n\nexport interface Peer {\n  id: string;\n  publicKey: string;\n  lastSeen: number;\n  connected: boolean;\n  connectionType: 'webrtc' | 'ble' | 'wifi';\n  signalStrength?: number;\n  latency?: number;\n  metadata?: Record<string, any>;\n}\n\nexport interface FileMetadata {\n  id: string;\n  messageId: string;\n  name: string;\n  size: number;\n  mimeType: string;\n  hash: string;\n  encryptionKey?: string;\n  thumbnail?: string;\n  uploadedAt: number;\n  status: 'uploading' | 'uploaded' | 'downloading' | 'downloaded' | 'failed';\n}\n\nexport interface Settings {\n  id: 'user_settings';\n  theme: 'light' | 'dark' | 'system';\n  notifications: {\n    enabled: boolean;\n    sound: boolean;\n    vibrate: boolean;\n    showPreviews: boolean;\n  };\n  privacy: {\n    readReceipts: boolean;\n    typingIndicators: boolean;\n    lastSeen: boolean;\n  };\n  media: {\n    autoDownload: boolean;\n    downloadOnWifi: boolean;\n    maxFileSize: number;\n  };\n  network: {\n    enableWebRTC: boolean;\n    enableBLE: boolean;\n    maxPeers: number;\n  };\n}\n\nexport interface KeyPair {\n  id: 'identity_keypair';\n  publicKey: string;\n  privateKey: string;\n  createdAt: number;\n}\n\n/**\n * Identity - User's cryptographic identity\n * For sovereignty: can have multiple identities, one is primary\n */\nexport interface Identity {\n  id: string;\n  publicKey: Uint8Array;\n  privateKey: Uint8Array; // Will be encrypted at rest\n  fingerprint: string; // SHA-256 hash of public key\n  createdAt: number;\n  label?: string; // Human-readable label\n  isPrimary: boolean; // Only one can be primary\n}\n\n/**\n * PersistedPeer - Extended peer info for persistence\n * Includes reputation and mesh routing metadata\n */\nexport interface PersistedPeer {\n  id: string;\n  publicKey: string;\n  transportType: 'webrtc' | 'ble' | 'wifi';\n  lastSeen: number;\n  connectedAt: number;\n  connectionQuality: number; // 0-100\n  bytesSent: number;\n  bytesReceived: number;\n  reputation: number; // 0-100, affects routing decisions\n  isBlacklisted: boolean;\n  blacklistedUntil?: number; // Unix timestamp\n  metadata?: Record<string, any>;\n}\n\n/**\n * Route - Mesh routing table entry\n * Used to warm-start routing on app reload\n */\nexport interface Route {\n  destinationId: string; // Peer ID we're routing to\n  nextHopId: string; // Next peer in the path\n  cost: number; // Routing cost (lower is better)\n  lastUpdated: number; // Unix timestamp\n  ttl: number; // Seconds until route expires\n  metrics?: {\n    latency: number; // Average latency in ms\n    successRate: number; // 0-1, message delivery success rate\n  };\n}\n\n/**\n * SessionKey - Encrypted session key for a peer\n * Enables Perfect Forward Secrecy - rotates regularly\n */\nexport interface SessionKey {\n  peerId: string;\n  key: Uint8Array; // Encrypted with master key\n  nonce: Uint8Array; // For XChaCha20-Poly1305\n  createdAt: number;\n  messageCount: number; // Number of messages sent with this key\n  expiresAt: number; // Unix timestamp when key should rotate\n}\n\nexport const STORE_CONFIGS = {\n  messages: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'conversationId', keyPath: 'conversationId', unique: false },\n      { name: 'timestamp', keyPath: 'timestamp', unique: false },\n      { name: 'senderId', keyPath: 'senderId', unique: false },\n      { name: 'status', keyPath: 'status', unique: false }\n    ]\n  },\n  contacts: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'publicKey', keyPath: 'publicKey', unique: true },\n      { name: 'addedAt', keyPath: 'addedAt', unique: false }\n    ]\n  },\n  conversations: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'lastMessageTime', keyPath: 'lastMessageTime', unique: false },\n      { name: 'type', keyPath: 'type', unique: false }\n    ]\n  },\n  peers: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'publicKey', keyPath: 'publicKey', unique: true },\n      { name: 'lastSeen', keyPath: 'lastSeen', unique: false },\n      { name: 'connected', keyPath: 'connected', unique: false }\n    ]\n  },\n  files: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'messageId', keyPath: 'messageId', unique: false },\n      { name: 'hash', keyPath: 'hash', unique: false }\n    ]\n  },\n  settings: {\n    keyPath: 'id'\n  },\n  keypair: {\n    keyPath: 'id'\n  },\n  // New stores for V1 persistence\n  identities: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'fingerprint', keyPath: 'fingerprint', unique: true },\n      { name: 'isPrimary', keyPath: 'isPrimary', unique: false },\n      { name: 'createdAt', keyPath: 'createdAt', unique: false }\n    ]\n  },\n  persistedPeers: {\n    keyPath: 'id',\n    indexes: [\n      { name: 'publicKey', keyPath: 'publicKey', unique: true },\n      { name: 'lastSeen', keyPath: 'lastSeen', unique: false },\n      { name: 'isBlacklisted', keyPath: 'isBlacklisted', unique: false },\n      { name: 'transportType', keyPath: 'transportType', unique: false },\n      { name: 'reputation', keyPath: 'reputation', unique: false }\n    ]\n  },\n  routes: {\n    keyPath: 'destinationId',\n    indexes: [\n      { name: 'nextHopId', keyPath: 'nextHopId', unique: false },\n      { name: 'lastUpdated', keyPath: 'lastUpdated', unique: false },\n      { name: 'cost', keyPath: 'cost', unique: false }\n    ]\n  },\n  sessionKeys: {\n    keyPath: 'peerId',\n    indexes: [\n      { name: 'expiresAt', keyPath: 'expiresAt', unique: false },\n      { name: 'createdAt', keyPath: 'createdAt', unique: false }\n    ]\n  }\n};\n\n/**\n * Initialize database with schema\n */\nexport function initializeDatabase(): Promise<IDBDatabase> {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => reject(request.error);\n    request.onsuccess = () => resolve(request.result);\n\n    request.onupgradeneeded = (event) => {\n      const db = (event.target as IDBOpenDBRequest).result;\n\n      // Create object stores\n      Object.entries(STORE_CONFIGS).forEach(([storeName, config]) => {\n        if (!db.objectStoreNames.contains(storeName)) {\n          const store = db.createObjectStore(storeName, {\n            keyPath: config.keyPath\n          });\n\n          // Create indexes\n          if ('indexes' in config && config.indexes) {\n            config.indexes.forEach(index => {\n              store.createIndex(index.name, index.keyPath, {\n                unique: index.unique || false\n              });\n            });\n          }\n        }\n      });\n    };\n  });\n}\n\n/**\n * Clear all data from database\n */\nexport async function clearDatabase(): Promise<void> {\n  const db = await initializeDatabase();\n  const transaction = db.transaction(\n    Array.from(db.objectStoreNames),\n    'readwrite'\n  );\n\n  Array.from(db.objectStoreNames).forEach(storeName => {\n    transaction.objectStore(storeName).clear();\n  });\n\n  return new Promise((resolve, reject) => {\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error);\n  });\n}\n\n/**\n * Get database size estimate\n */\nexport async function getDatabaseSize(): Promise<{\n  usage: number;\n  quota: number;\n  percentage: number;\n}> {\n  if ('storage' in navigator && 'estimate' in navigator.storage) {\n    const estimate = await navigator.storage.estimate();\n    const usage = estimate.usage || 0;\n    const quota = estimate.quota || 0;\n    const percentage = quota > 0 ? (usage / quota) * 100 : 0;\n\n    return { usage, quota, percentage };\n  }\n\n  return { usage: 0, quota: 0, percentage: 0 };\n}\n"],"version":3}