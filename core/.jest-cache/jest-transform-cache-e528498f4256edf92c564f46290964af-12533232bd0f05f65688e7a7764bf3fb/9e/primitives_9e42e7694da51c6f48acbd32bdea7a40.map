{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/crypto/primitives.ts","mappings":";AAAA;;;;;GAKG;;;AAmDH,0EAuCC;AAKD,4EAeC;AA4BD,0CAYC;AAOD,4CAIC;AAOD,4DAKC;AAKD,gDAQC;AAKD,kCAEC;AAED,sCAEC;AAID,kCAKC;AAED,0CAcC;AAED,sDAWC;AAQD,gDAyBC;AAQD,gDAeC;AAID,wCAaC;AAED,wCAeC;AAID,4CAqBC;AAED,8CAcC;AAED,kCA+BC;AAID,0CAOC;AAED,gCAEC;AAED,kDAQC;AAiBD,wCAQC;AAED,0CAMC;AAED,4CAcC;AAED,4CAMC;AA/dD,yDAA2D;AAC3D,mDAAuD;AAC9C,uFADA,gBAAM,OACA;AAAE,uFADA,gBAAM,OACA;AACvB,wDAA6D;AAC7D,mDAA6C;AACpC,qFADA,cAAI,OACA;AA2Bb,2BAA2B;AAE3B;;GAEG;AACH,SAAS,gBAAgB,CACvB,KAAgD;IAEhD,IAAI,KAAK,YAAY,UAAU,IAAI,KAAK,CAAC,WAAW,KAAK,UAAU;QACjE,OAAO,KAAK,CAAC;IACf,OAAO,IAAI,UAAU,CAAC,KAAK,CAAC,CAAC;AAC/B,CAAC;AAED;;;GAGG;AACH,SAAgB,+BAA+B,CAAC,KAAiB;IAC/D,MAAM,KAAK,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC;IACtC,IAAI,CAAC;QACH,OAAO,oBAAO,CAAC,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;IAC3C,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,sDAAsD;QACtD,MAAM,CAAC,GAAG,CAAC,EAAE,IAAI,IAAI,CAAC,GAAG,GAAG,CAAC;QAC7B,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,KAAK,CAAC,CAAC;QACrC,MAAM,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,CAAC,0BAA0B;QAE9C,IAAI,CAAC,GAAG,EAAE,CAAC;QACX,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;YAC5B,CAAC,IAAI,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;QAC7C,CAAC;QAED,MAAM,GAAG,GAAG,EAAE,CAAC;QACf,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QAC1B,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QAE9B,MAAM,MAAM,GAAG,CAAC,IAAY,EAAE,GAAW,EAAE,GAAW,EAAE,EAAE;YACxD,IAAI,GAAG,GAAG,EAAE,CAAC;YACb,IAAI,IAAI,GAAG,CAAC;YACZ,OAAO,GAAG,GAAG,EAAE,EAAE,CAAC;gBAChB,IAAI,GAAG,GAAG,EAAE,KAAK,EAAE;oBAAE,GAAG,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,GAAG,CAAC;gBAC9C,IAAI,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,GAAG,CAAC;gBAC3B,GAAG,IAAI,EAAE,CAAC;YACZ,CAAC;YACD,OAAO,GAAG,CAAC;QACb,CAAC,CAAC;QAEF,MAAM,MAAM,GAAG,MAAM,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,GAAG,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;QAE7B,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,EAAE,CAAC,CAAC;QAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;YAC5B,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;QACtD,CAAC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;AACH,CAAC;AAED;;GAEG;AACH,SAAgB,gCAAgC,CAC9C,MAAkB;IAElB,MAAM,KAAK,GAAG,gBAAgB,CAAC,MAAM,CAAC,CAAC;IACvC,IAAI,CAAC;QACH,OAAO,oBAAO,CAAC,KAAK,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;IACjD,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,2EAA2E;QAC3E,MAAM,IAAI,GAAG,IAAA,gBAAM,EAAC,KAAK,CAAC,CAAC;QAC3B,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;QACjC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC;QACjB,MAAM,CAAC,EAAE,CAAC,IAAI,GAAG,CAAC;QAClB,MAAM,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;QACjB,OAAO,MAAM,CAAC;IAChB,CAAC;AACH,CAAC;AAED,qBAAqB;AAErB;;GAEG;AACI,MAAM,WAAW,GAAG,CAAC,CAAS,EAAc,EAAE;IACnD,IAAI,OAAO,UAAU,KAAK,WAAW,IAAI,UAAU,CAAC,MAAM,EAAE,eAAe,EAAE,CAAC;QAC5E,OAAO,UAAU,CAAC,MAAM,CAAC,eAAe,CAAC,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;IAC9D,CAAC;IACD,0CAA0C;IAC1C,IAAI,CAAC;QACH,IAAI,OAAO,OAAO,KAAK,WAAW,IAAI,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;YAC9D,2CAA2C;YAC3C,8DAA8D;YAC9D,MAAM,UAAU,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;YACrC,OAAO,IAAI,UAAU,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,8CAA8C;IAChD,CAAC;IACD,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;AACjE,CAAC,CAAC;AAhBW,QAAA,WAAW,eAgBtB;AAEF;;GAEG;AACH,SAAgB,eAAe,CAAC,KAAiB;IAC/C,IAAI,KAAK,CAAC,MAAM,GAAG,EAAE;QAAE,OAAO,KAAK,CAAC;IACpC,iCAAiC;IACjC,IAAI,OAAO,GAAG,IAAI,CAAC;IACnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtC,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;YAC1B,OAAO,GAAG,KAAK,CAAC;YAChB,MAAM;QACR,CAAC;IACH,CAAC;IACD,IAAI,OAAO;QAAE,OAAO,KAAK,CAAC;IAC1B,OAAO,IAAI,CAAC;AACd,CAAC;AAED,yBAAyB;AAEzB;;GAEG;AACH,SAAgB,gBAAgB;IAC9B,MAAM,UAAU,GAAG,IAAA,mBAAW,EAAC,EAAE,CAAC,CAAC;IACnC,MAAM,SAAS,GAAG,oBAAO,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;IACnD,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,CAAC;AACnC,CAAC;AAEY,QAAA,eAAe,GAAG,gBAAgB,CAAC;AAEhD;;GAEG;AACH,SAAgB,wBAAwB;IACtC,MAAM,UAAU,GAAG,IAAA,mBAAW,EAAC,EAAE,CAAC,CAAC;IACnC,wDAAwD;IACxD,MAAM,SAAS,GAAG,mBAAM,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;IAClD,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,CAAC;AACnC,CAAC;AAED;;GAEG;AACH,SAAgB,kBAAkB;IAChC,OAAO;QACL,GAAG,EAAE,WAAW,EAAE;QAClB,KAAK,EAAE,aAAa,EAAE;QACtB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;QACrB,YAAY,EAAE,CAAC;QACf,OAAO,EAAE,CAAC;KACX,CAAC;AACJ,CAAC;AAED;;GAEG;AACH,SAAgB,WAAW;IACzB,OAAO,IAAA,mBAAW,EAAC,EAAE,CAAC,CAAC;AACzB,CAAC;AAED,SAAgB,aAAa;IAC3B,OAAO,IAAA,mBAAW,EAAC,EAAE,CAAC,CAAC;AACzB,CAAC;AAED,kBAAkB;AAElB,SAAgB,WAAW,CACzB,OAAmB,EACnB,UAAsB;IAEtB,OAAO,oBAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,EAAE,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC;AAC/E,CAAC;AAED,SAAgB,eAAe,CAC7B,OAAmB,EACnB,SAAqB,EACrB,SAAqB;IAErB,IAAI,CAAC;QACH,OAAO,oBAAO,CAAC,MAAM,CACnB,gBAAgB,CAAC,SAAS,CAAC,EAC3B,gBAAgB,CAAC,OAAO,CAAC,EACzB,gBAAgB,CAAC,SAAS,CAAC,CAC5B,CAAC;IACJ,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AACH,CAAC;AAED,SAAgB,qBAAqB,CACnC,KAIG;IAEH,kEAAkE;IAClE,OAAO,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,EAAE,CAC1B,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,CAC9D,CAAC;AACJ,CAAC;AAED,uBAAuB;AAEvB;;;GAGG;AACH,SAAgB,kBAAkB,CAChC,UAAsB,EACtB,aAAyB,EACzB,IAAiB,EACjB,IAAiB;IAEjB,MAAM,IAAI,GAAG,gBAAgB,CAAC,UAAU,CAAC,CAAC;IAC1C,MAAM,GAAG,GAAG,gBAAgB,CAAC,aAAa,CAAC,CAAC;IAE5C,IAAI,IAAI,CAAC,MAAM,KAAK,EAAE,IAAI,GAAG,CAAC,MAAM,KAAK,EAAE,EAAE,CAAC;QAC5C,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;IAClD,CAAC;IAED,MAAM,YAAY,GAAG,mBAAM,CAAC,eAAe,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;IAEvD,MAAM,UAAU,GAAG,IAAA,cAAI,EACrB,gBAAM,EACN,YAAY,EACZ,IAAI,IAAI,IAAI,UAAU,CAAC,EAAE,CAAC,EAC1B,IAAI,IAAI,IAAI,UAAU,CAAC,CAAC,CAAC,EACzB,EAAE,CACH,CAAC;IAEF,UAAU,CAAC,YAAY,CAAC,CAAC;IACzB,OAAO,UAAU,CAAC;AACpB,CAAC;AAED;;;;;GAKG;AACH,SAAgB,kBAAkB,CAChC,UAAsB,EACtB,aAAyB,EACzB,IAAiB,EACjB,IAAiB;IAEjB,+DAA+D;IAC/D,MAAM,UAAU,GAAG,gCAAgC,CACjD,gBAAgB,CAAC,UAAU,CAAC,CAC7B,CAAC;IACF,MAAM,SAAS,GAAG,+BAA+B,CAC/C,gBAAgB,CAAC,aAAa,CAAC,CAChC,CAAC;IAEF,OAAO,kBAAkB,CAAC,UAAU,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC/D,CAAC;AAED,qBAAqB;AAErB,SAAgB,cAAc,CAC5B,IAAgB,EAChB,GAAe,EACf,KAAiB;IAEjB,MAAM,CAAC,GAAG,gBAAgB,CAAC,GAAG,CAAC,CAAC;IAChC,MAAM,CAAC,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC;IAElC,IAAI,CAAC,CAAC,MAAM,KAAK,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;IAC7D,IAAI,CAAC,CAAC,MAAM,KAAK,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;IAE/D,MAAM,MAAM,GAAG,IAAA,6BAAiB,EAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACvC,OAAO,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;AAChD,CAAC;AAED,SAAgB,cAAc,CAC5B,SAAqB,EACrB,GAAe,EACf,KAAiB;IAEjB,MAAM,IAAI,GAAG,gBAAgB,CAAC,SAAS,CAAC,CAAC;IACzC,MAAM,CAAC,GAAG,gBAAgB,CAAC,GAAG,CAAC,CAAC;IAChC,MAAM,CAAC,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC;IAElC,IAAI,CAAC,CAAC,MAAM,KAAK,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;IAC7D,IAAI,CAAC,CAAC,MAAM,KAAK,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;IAC/D,IAAI,IAAI,CAAC,MAAM,GAAG,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;IAElE,MAAM,MAAM,GAAG,IAAA,6BAAiB,EAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACvC,OAAO,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC9B,CAAC;AAED,kBAAkB;AAElB,SAAgB,gBAAgB,CAAC,QAAoB;IAInD,MAAM,EAAE,GAAG,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IACtC,MAAM,UAAU,GAAG,IAAA,cAAI,EACrB,gBAAM,EACN,EAAE,EACF,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EACnB,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,EACnC,EAAE,CACH,CAAC;IACF,MAAM,YAAY,GAAG,IAAA,cAAI,EACvB,gBAAM,EACN,EAAE,EACF,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EACnB,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,EACjC,EAAE,CACH,CAAC;IACF,UAAU,CAAC,EAAE,CAAC,CAAC;IACf,OAAO,EAAE,UAAU,EAAE,YAAY,EAAE,CAAC;AACtC,CAAC;AAED,SAAgB,iBAAiB,CAC/B,YAAwB,EACxB,QAAiB;IAEjB,MAAM,IAAI,GAAG,gBAAgB,CAAC,YAAY,CAAC,CAAC;IAC5C,OAAO;QACL,OAAO,EAAE,IAAI;QACb,YAAY,EAAE,IAAI,UAAU,CAAC,EAAE,CAAC;QAChC,eAAe,EAAE,IAAI,UAAU,CAAC,EAAE,CAAC;QACnC,WAAW,EAAE,CAAC;QACd,cAAc,EAAE,CAAC;QACjB,mBAAmB,EAAE,CAAC;QACtB,YAAY,EAAE,wBAAwB,EAAE;KACzC,CAAC;AACJ,CAAC;AAED,SAAgB,WAAW,CACzB,KAAmB,EACnB,aAAyB;IAEzB,MAAM,QAAQ,GAAG,kBAAkB,CACjC,KAAK,CAAC,YAAY,CAAC,UAAU,EAC7B,aAAa,CACd,CAAC;IACF,MAAM,IAAI,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IAEjD,MAAM,SAAS,GAAG,IAAA,cAAI,EAAC,gBAAM,EAAE,QAAQ,EAAE,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;IAClE,MAAM,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAC1C,MAAM,QAAQ,GAAG,SAAS,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IAEzC,MAAM,QAAQ,GAAG;QACf,GAAG,KAAK;QACR,OAAO,EAAE,UAAU;QACnB,mBAAmB,EAAE,KAAK,CAAC,WAAW;QACtC,WAAW,EAAE,CAAC;QACd,cAAc,EAAE,CAAC;QACjB,YAAY,EAAE,wBAAwB,EAAE;KACzC,CAAC;IAEF,IAAI,KAAK,CAAC,WAAW,KAAK,CAAC,IAAI,KAAK,CAAC,cAAc,KAAK,CAAC,EAAE,CAAC;QAC1D,gBAAgB;QAChB,QAAQ,CAAC,YAAY,GAAG,QAAQ,CAAC;QACjC,QAAQ,CAAC,eAAe,GAAG,QAAQ,CAAC,CAAC,qCAAqC;IAC5E,CAAC;IAED,UAAU,CAAC,QAAQ,CAAC,CAAC;IACrB,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,oBAAoB;AAEpB,SAAgB,eAAe,CAAC,CAAa,EAAE,CAAa;IAC1D,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM;QAAE,OAAO,KAAK,CAAC;IACxC,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QAClC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACxB,CAAC;IACD,OAAO,MAAM,KAAK,CAAC,CAAC;AACtB,CAAC;AAED,SAAgB,UAAU,CAAC,IAAgB;IACzC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACf,CAAC;AAED,SAAgB,mBAAmB,CAAC,SAAqB;IACvD,MAAM,IAAI,GAAG,IAAA,gBAAM,EAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,CAAC;IACjD,uEAAuE;IACvE,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;SACpB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;SACX,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;SAC3C,IAAI,CAAC,EAAE,CAAC;SACR,WAAW,EAAE,CAAC;AACnB,CAAC;AAED;;GAEG;AACH,MAAa,YAAY;IAAzB;QACU,SAAI,GAAG,IAAI,GAAG,EAAU,CAAC;IASnC,CAAC;IARC,WAAW,CAAC,KAAiB;QAC3B,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;IAC3D,CAAC;IACD,QAAQ,CAAC,KAAiB;QACxB,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;YAAE,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;QAChE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACrB,CAAC;CACF;AAVD,oCAUC;AAED,SAAgB,cAAc,CAAC,UAAsB;IACnD,UAAU,CAAC,OAAO,EAAE,CAAC;IACrB,6FAA6F;IAC7F,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACjD,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;QACvD,IAAI,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC;YAAE,MAAM;IACvC,CAAC;IACD,OAAO,IAAI,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;AAC1C,CAAC;AAED,SAAgB,eAAe,CAC7B,GAAe,EACf,SAAS,GAAG,OAAO,EACnB,QAAQ,GAAG,IAAI;IAEf,OAAO,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,SAAS,GAAG,SAAS,IAAI,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC;AAC/E,CAAC;AAED,SAAgB,gBAAgB,CAAC,GAAe;IAC9C,MAAM,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC;IACvB,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC;IAC3B,MAAM,MAAM,GAAG,WAAW,EAAE,CAAC;IAC7B,MAAM,QAAQ,GAAG,aAAa,EAAE,CAAC;IACjC,UAAU,CAAC,MAAM,CAAC,CAAC;IACnB,UAAU,CAAC,QAAQ,CAAC,CAAC;IACrB,OAAO;QACL,GAAG,EAAE,MAAM;QACX,KAAK,EAAE,QAAQ;QACf,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;QACrB,YAAY,EAAE,CAAC;QACf,OAAO,EAAE,CAAC;KACX,CAAC;AACJ,CAAC;AAED,SAAgB,gBAAgB,CAC9B,YAAwB,EACxB,IAAgB,EAChB,IAAiB;IAEjB,OAAO,IAAA,cAAI,EAAC,gBAAM,EAAE,YAAY,EAAE,IAAI,EAAE,IAAI,IAAI,IAAI,UAAU,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;AACzE,CAAC","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/crypto/primitives.ts"],"sourcesContent":["/**\n * Cryptographic primitives for Sovereign Communications\n *\n * Standardized Implementation using @noble libraries.\n * Provides consistent behavior across environments (Web, Node, React Native).\n */\n\nimport { ed25519, x25519 } from \"@noble/curves/ed25519.js\";\nimport { sha256, sha512 } from \"@noble/hashes/sha2.js\";\nexport { sha256, sha512 };\nimport { xchacha20poly1305 } from \"@noble/ciphers/chacha.js\";\nimport { hkdf } from \"@noble/hashes/hkdf.js\";\nexport { hkdf };\n\n// --- Types ---\n\nexport interface IdentityKeyPair {\n  publicKey: Uint8Array;\n  privateKey: Uint8Array;\n}\n\nexport interface SessionKey {\n  key: Uint8Array;\n  nonce: Uint8Array;\n  timestamp: number;\n  messageCount: number;\n  counter: number;\n}\n\nexport interface RatchetState {\n  rootKey: Uint8Array;\n  sendChainKey: Uint8Array;\n  receiveChainKey: Uint8Array;\n  sendCounter: number;\n  receiveCounter: number;\n  previousSendCounter: number;\n  dhRatchetKey: IdentityKeyPair;\n}\n\n// --- Internal Helpers ---\n\n/**\n * Ensures input is a clean Uint8Array, overcoming context issues in some test environments\n */\nfunction ensureUint8Array(\n  input: Uint8Array | number[] | ArrayBuffer | any,\n): Uint8Array {\n  if (input instanceof Uint8Array && input.constructor === Uint8Array)\n    return input;\n  return new Uint8Array(input);\n}\n\n/**\n * Manual Ed25519 public key to X25519 public key conversion (Montgomery mapping)\n * Providing a robust fallback for environments where Noble's point validation fails (e.g., some Jest/JSDOM setups)\n */\nexport function convertEd25519PublicKeyToX25519(edPub: Uint8Array): Uint8Array {\n  const bytes = ensureUint8Array(edPub);\n  try {\n    return ed25519.utils.toMontgomery(bytes);\n  } catch (err) {\n    // Robust manual fallback: u = (1 + y) / (1 - y) mod P\n    const P = (1n << 255n) - 19n;\n    const yBytes = new Uint8Array(bytes);\n    yBytes[31] &= 0x7f; // Clear sign bit to get y\n\n    let y = 0n;\n    for (let i = 0; i < 32; i++) {\n      y |= BigInt(yBytes[i]) << (BigInt(i) * 8n);\n    }\n\n    const one = 1n;\n    const num = (one + y) % P;\n    const den = (one - y + P) % P;\n\n    const modPow = (base: bigint, exp: bigint, mod: bigint) => {\n      let res = 1n;\n      base %= mod;\n      while (exp > 0n) {\n        if (exp % 2n === 1n) res = (res * base) % mod;\n        base = (base * base) % mod;\n        exp /= 2n;\n      }\n      return res;\n    };\n\n    const denInv = modPow(den, P - 2n, P);\n    const u = (num * denInv) % P;\n\n    const uBytes = new Uint8Array(32);\n    for (let i = 0; i < 32; i++) {\n      uBytes[i] = Number((u >> (BigInt(i) * 8n)) & 0xffn);\n    }\n    return uBytes;\n  }\n}\n\n/**\n * Manual Ed25519 private key (seed) to X25519 private key (scalar) conversion\n */\nexport function convertEd25519PrivateKeyToX25519(\n  edPriv: Uint8Array,\n): Uint8Array {\n  const bytes = ensureUint8Array(edPriv);\n  try {\n    return ed25519.utils.toMontgomerySecret(bytes);\n  } catch (err) {\n    // Manual fallback: X25519 scalar = first 32 bytes of SHA512(seed), clamped\n    const hash = sha512(bytes);\n    const scalar = hash.slice(0, 32);\n    scalar[0] &= 248;\n    scalar[31] &= 127;\n    scalar[31] |= 64;\n    return scalar;\n  }\n}\n\n// --- Randomness ---\n\n/**\n * Cryptographically secure random bytes\n */\nexport const randomBytes = (n: number): Uint8Array => {\n  if (typeof globalThis !== \"undefined\" && globalThis.crypto?.getRandomValues) {\n    return globalThis.crypto.getRandomValues(new Uint8Array(n));\n  }\n  // Node fallback if web crypto unavailable\n  try {\n    if (typeof process !== \"undefined\" && process?.versions?.node) {\n      // Dynamic import for Node.js crypto module\n      // eslint-disable-next-line @typescript-eslint/no-var-requires\n      const nodeCrypto = require(\"crypto\");\n      return new Uint8Array(nodeCrypto.randomBytes(n));\n    }\n  } catch (e) {\n    // Ignore and proceed to throw if no generator\n  }\n  throw new Error(\"No secure random number generator available\");\n};\n\n/**\n * Validate entropy quality (basic sanity checks)\n */\nexport function validateEntropy(bytes: Uint8Array): boolean {\n  if (bytes.length < 32) return false;\n  // Reject all zeros or same value\n  let allSame = true;\n  for (let i = 1; i < bytes.length; i++) {\n    if (bytes[i] !== bytes[0]) {\n      allSame = false;\n      break;\n    }\n  }\n  if (allSame) return false;\n  return true;\n}\n\n// --- Key Generation ---\n\n/**\n * Generate a new Ed25519 identity keypair\n */\nexport function generateIdentity(): IdentityKeyPair {\n  const privateKey = randomBytes(32);\n  const publicKey = ed25519.getPublicKey(privateKey);\n  return { publicKey, privateKey };\n}\n\nexport const generateKeyPair = generateIdentity;\n\n/**\n * Generate ephemeral X25519 keypair for ratchet/DH\n */\nexport function generateEphemeralKeyPair(): IdentityKeyPair {\n  const privateKey = randomBytes(32);\n  // Noble x25519.getPublicKey handles clamping internally\n  const publicKey = x25519.getPublicKey(privateKey);\n  return { publicKey, privateKey };\n}\n\n/**\n * Generate a new session key\n */\nexport function generateSessionKey(): SessionKey {\n  return {\n    key: generateKey(),\n    nonce: generateNonce(),\n    timestamp: Date.now(),\n    messageCount: 0,\n    counter: 0,\n  };\n}\n\n/**\n * Generate a symmetric session key\n */\nexport function generateKey(): Uint8Array {\n  return randomBytes(32);\n}\n\nexport function generateNonce(): Uint8Array {\n  return randomBytes(24);\n}\n\n// --- Signing ---\n\nexport function signMessage(\n  message: Uint8Array,\n  privateKey: Uint8Array,\n): Uint8Array {\n  return ed25519.sign(ensureUint8Array(message), ensureUint8Array(privateKey));\n}\n\nexport function verifySignature(\n  message: Uint8Array,\n  signature: Uint8Array,\n  publicKey: Uint8Array,\n): boolean {\n  try {\n    return ed25519.verify(\n      ensureUint8Array(signature),\n      ensureUint8Array(message),\n      ensureUint8Array(publicKey),\n    );\n  } catch {\n    return false;\n  }\n}\n\nexport function batchVerifySignatures(\n  items: {\n    message: Uint8Array;\n    signature: Uint8Array;\n    publicKey: Uint8Array;\n  }[],\n): boolean {\n  // Simple implementation using single verification for consistency\n  return items.every((item) =>\n    verifySignature(item.message, item.signature, item.publicKey),\n  );\n}\n\n// --- Key Exchange ---\n\n/**\n * Perform pure X25519 key exchange (RFC 7748)\n * Expects X25519 keys (clamped or unclamped scalars and Montgomery u-coordinates)\n */\nexport function performKeyExchange(\n  privateKey: Uint8Array,\n  peerPublicKey: Uint8Array,\n  salt?: Uint8Array,\n  info?: Uint8Array,\n): Uint8Array {\n  const priv = ensureUint8Array(privateKey);\n  const pub = ensureUint8Array(peerPublicKey);\n\n  if (priv.length !== 32 || pub.length !== 32) {\n    throw new Error(\"X25519 keys must be 32 bytes\");\n  }\n\n  const sharedSecret = x25519.getSharedSecret(priv, pub);\n\n  const derivedKey = hkdf(\n    sha256,\n    sharedSecret,\n    salt || new Uint8Array(32),\n    info || new Uint8Array(0),\n    32,\n  );\n\n  secureWipe(sharedSecret);\n  return derivedKey;\n}\n\n/**\n * Derives a shared secret between two parties.\n * Handles automatic conversion of Ed25519 identity keys to X25519 format.\n * If keys are already X25519, this function should be used with caution as it\n * specifically targets identity-to-dh conversion paths.\n */\nexport function deriveSharedSecret(\n  privateKey: Uint8Array,\n  peerPublicKey: Uint8Array,\n  salt?: Uint8Array,\n  info?: Uint8Array,\n): Uint8Array {\n  // Always convert identity keys to X25519 scalars/u-coordinates\n  const x25519Priv = convertEd25519PrivateKeyToX25519(\n    ensureUint8Array(privateKey),\n  );\n  const x25519Pub = convertEd25519PublicKeyToX25519(\n    ensureUint8Array(peerPublicKey),\n  );\n\n  return performKeyExchange(x25519Priv, x25519Pub, salt, info);\n}\n\n// --- Encryption ---\n\nexport function encryptMessage(\n  data: Uint8Array,\n  key: Uint8Array,\n  nonce: Uint8Array,\n): Uint8Array {\n  const k = ensureUint8Array(key);\n  const n = ensureUint8Array(nonce);\n\n  if (k.length !== 32) throw new Error(\"Key must be 32 bytes\");\n  if (n.length !== 24) throw new Error(\"Nonce must be 24 bytes\");\n\n  const cipher = xchacha20poly1305(k, n);\n  return cipher.encrypt(ensureUint8Array(data));\n}\n\nexport function decryptMessage(\n  encrypted: Uint8Array,\n  key: Uint8Array,\n  nonce: Uint8Array,\n): Uint8Array {\n  const data = ensureUint8Array(encrypted);\n  const k = ensureUint8Array(key);\n  const n = ensureUint8Array(nonce);\n\n  if (k.length !== 32) throw new Error(\"Key must be 32 bytes\");\n  if (n.length !== 24) throw new Error(\"Nonce must be 24 bytes\");\n  if (data.length < 16) throw new Error(\"Encrypted data too short\");\n\n  const cipher = xchacha20poly1305(k, n);\n  return cipher.decrypt(data);\n}\n\n// --- Ratchet ---\n\nexport function deriveMessageKey(chainKey: Uint8Array): {\n  messageKey: Uint8Array;\n  nextChainKey: Uint8Array;\n} {\n  const ck = ensureUint8Array(chainKey);\n  const messageKey = hkdf(\n    sha256,\n    ck,\n    new Uint8Array([1]),\n    new TextEncoder().encode(\"message\"),\n    32,\n  );\n  const nextChainKey = hkdf(\n    sha256,\n    ck,\n    new Uint8Array([2]),\n    new TextEncoder().encode(\"chain\"),\n    32,\n  );\n  secureWipe(ck);\n  return { messageKey, nextChainKey };\n}\n\nexport function initializeRatchet(\n  sharedSecret: Uint8Array,\n  _isAlice: boolean,\n): RatchetState {\n  const root = ensureUint8Array(sharedSecret);\n  return {\n    rootKey: root,\n    sendChainKey: new Uint8Array(32),\n    receiveChainKey: new Uint8Array(32),\n    sendCounter: 0,\n    receiveCounter: 0,\n    previousSendCounter: 0,\n    dhRatchetKey: generateEphemeralKeyPair(),\n  };\n}\n\nexport function ratchetStep(\n  state: RatchetState,\n  peerPublicKey: Uint8Array,\n): RatchetState {\n  const dhOutput = performKeyExchange(\n    state.dhRatchetKey.privateKey,\n    peerPublicKey,\n  );\n  const info = new TextEncoder().encode(\"ratchet\");\n\n  const kdfOutput = hkdf(sha256, dhOutput, state.rootKey, info, 64);\n  const newRootKey = kdfOutput.slice(0, 32);\n  const chainKey = kdfOutput.slice(32, 64);\n\n  const newState = {\n    ...state,\n    rootKey: newRootKey,\n    previousSendCounter: state.sendCounter,\n    sendCounter: 0,\n    receiveCounter: 0,\n    dhRatchetKey: generateEphemeralKeyPair(),\n  };\n\n  if (state.sendCounter === 0 && state.receiveCounter === 0) {\n    // Initial setup\n    newState.sendChainKey = chainKey;\n    newState.receiveChainKey = chainKey; // Simplified for this implementation\n  }\n\n  secureWipe(dhOutput);\n  return newState;\n}\n\n// --- Utilities ---\n\nexport function timingSafeEqual(a: Uint8Array, b: Uint8Array): boolean {\n  if (a.length !== b.length) return false;\n  let result = 0;\n  for (let i = 0; i < a.length; i++) {\n    result |= a[i] ^ b[i];\n  }\n  return result === 0;\n}\n\nexport function secureWipe(data: Uint8Array): void {\n  data.fill(0);\n}\n\nexport function generateFingerprint(publicKey: Uint8Array): string {\n  const hash = sha256(ensureUint8Array(publicKey));\n  // Return 16-char uppercase hex without spaces for consistent ID format\n  return Array.from(hash)\n    .slice(0, 8)\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\")\n    .toUpperCase();\n}\n\n/**\n * Mock NonceManager for consistency with other parts of the repo\n */\nexport class NonceManager {\n  private used = new Set<string>();\n  hasBeenUsed(nonce: Uint8Array): boolean {\n    return this.used.has(Buffer.from(nonce).toString(\"hex\"));\n  }\n  markUsed(nonce: Uint8Array): void {\n    const hex = Buffer.from(nonce).toString(\"hex\");\n    if (this.used.has(hex)) throw new Error(\"Nonce reuse detected\");\n    this.used.add(hex);\n  }\n}\n\nexport function incrementNonce(sessionKey: SessionKey): Uint8Array {\n  sessionKey.counter++;\n  // Simple increment logic for the 24-byte nonce (treating it as little-endian for simplicity)\n  for (let i = 0; i < sessionKey.nonce.length; i++) {\n    sessionKey.nonce[i] = (sessionKey.nonce[i] + 1) & 0xff;\n    if (sessionKey.nonce[i] !== 0) break;\n  }\n  return new Uint8Array(sessionKey.nonce);\n}\n\nexport function shouldRotateKey(\n  key: SessionKey,\n  timeLimit = 3600000,\n  msgLimit = 1000,\n): boolean {\n  return Date.now() - key.timestamp > timeLimit || key.messageCount > msgLimit;\n}\n\nexport function rotateSessionKey(key: SessionKey): SessionKey {\n  const oldKey = key.key;\n  const oldNonce = key.nonce;\n  const newKey = generateKey();\n  const newNonce = generateNonce();\n  secureWipe(oldKey);\n  secureWipe(oldNonce);\n  return {\n    key: newKey,\n    nonce: newNonce,\n    timestamp: Date.now(),\n    messageCount: 0,\n    counter: 0,\n  };\n}\n\nexport function deriveSessionKey(\n  sharedSecret: Uint8Array,\n  salt: Uint8Array,\n  info?: Uint8Array,\n): Uint8Array {\n  return hkdf(sha256, sharedSecret, salt, info || new Uint8Array(0), 32);\n}\n"],"version":3}