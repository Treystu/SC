a82eb7b5a1e836002c0b729c7558ab63
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const routing_1 = require("./routing");
const message_1 = require("../protocol/message");
describe('Advanced Message Priority Queue', () => {
    let queue;
    beforeEach(() => {
        queue = new routing_1.MessageQueue();
    });
    describe('Priority Escalation', () => {
        it('should not escalate recent messages', () => {
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'file1' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.enqueue(message_1.MessageType.CONTROL_PING, { data: 'ping1' });
            // Control message should come first
            const first = queue.dequeue();
            expect(first.data).toBe('ping1');
        });
        it('should track message age', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            // Wait a bit
            setTimeout(() => {
                const age = queue.getOldestMessageAge();
                expect(age).toBeGreaterThan(0);
            }, 100);
        });
        it('should provide size by priority level', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text2' });
            queue.enqueue(message_1.MessageType.VOICE, { data: 'voice1' });
            queue.enqueue(message_1.MessageType.CONTROL_PING, { data: 'ping1' });
            const sizes = queue.getSizeByPriority();
            expect(sizes.get(message_1.MessageType.TEXT)).toBe(2);
            expect(sizes.get(message_1.MessageType.VOICE)).toBe(1);
            expect(sizes.get(message_1.MessageType.CONTROL_PING)).toBe(1);
        });
    });
    describe('Starvation Prevention', () => {
        it('should eventually process low-priority messages', (done) => {
            // Add low-priority message
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'file1', timestamp: Date.now() - 35000 });
            // Add many high-priority messages
            for (let i = 0; i < 10; i++) {
                queue.enqueue(message_1.MessageType.CONTROL_PING, { data: `ping${i}` });
            }
            // Process some messages
            for (let i = 0; i < 5; i++) {
                queue.dequeue();
            }
            // Trigger starvation prevention check by waiting
            setTimeout(() => {
                // After escalation, file message might be promoted
                const sizes = queue.getSizeByPriority();
                // Verify queue is still managing priorities
                expect(queue.size()).toBeGreaterThan(0);
                done();
            }, 100);
        });
        it('should maintain original priority tracking', () => {
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'file1' });
            const size = queue.size();
            expect(size).toBe(1);
        });
    });
    describe('Queue Statistics', () => {
        it('should track total queue size', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.enqueue(message_1.MessageType.VOICE, { data: 'voice1' });
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'file1' });
            expect(queue.size()).toBe(3);
        });
        it('should track sizes by priority', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text2' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text3' });
            queue.enqueue(message_1.MessageType.VOICE, { data: 'voice1' });
            const sizes = queue.getSizeByPriority();
            expect(sizes.get(message_1.MessageType.TEXT)).toBe(3);
            expect(sizes.get(message_1.MessageType.VOICE)).toBe(1);
        });
        it('should update size after dequeue', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text2' });
            expect(queue.size()).toBe(2);
            queue.dequeue();
            expect(queue.size()).toBe(1);
            queue.dequeue();
            expect(queue.size()).toBe(0);
        });
        it('should clear all messages', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.enqueue(message_1.MessageType.VOICE, { data: 'voice1' });
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'file1' });
            expect(queue.size()).toBe(3);
            queue.clear();
            expect(queue.size()).toBe(0);
        });
    });
    describe('Priority Order', () => {
        it('should respect priority order: CONTROL > VOICE > TEXT > FILE', () => {
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'file' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text' });
            queue.enqueue(message_1.MessageType.VOICE, { data: 'voice' });
            queue.enqueue(message_1.MessageType.CONTROL_PING, { data: 'ping' });
            expect(queue.dequeue().data).toBe('ping');
            expect(queue.dequeue().data).toBe('voice');
            expect(queue.dequeue().data).toBe('text');
            expect(queue.dequeue().data).toBe('file');
        });
        it('should handle multiple control message types', () => {
            queue.enqueue(message_1.MessageType.CONTROL_ACK, { data: 'ack' });
            queue.enqueue(message_1.MessageType.CONTROL_PONG, { data: 'pong' });
            queue.enqueue(message_1.MessageType.CONTROL_PING, { data: 'ping' });
            // All are control messages, should be FIFO within same priority
            const first = queue.dequeue();
            expect(['ack', 'pong', 'ping']).toContain(first.data);
        });
        it('should handle FILE_METADATA and FILE_CHUNK', () => {
            queue.enqueue(message_1.MessageType.FILE_CHUNK, { data: 'chunk' });
            queue.enqueue(message_1.MessageType.FILE_METADATA, { data: 'metadata' });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text' });
            expect(queue.dequeue().data).toBe('text'); // Higher priority
            const next = queue.dequeue();
            expect(['chunk', 'metadata']).toContain(next.data);
        });
    });
    describe('FIFO within Priority', () => {
        it('should maintain FIFO order within same priority', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1', order: 1 });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text2', order: 2 });
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text3', order: 3 });
            expect(queue.dequeue().order).toBe(1);
            expect(queue.dequeue().order).toBe(2);
            expect(queue.dequeue().order).toBe(3);
        });
    });
    describe('Empty Queue Handling', () => {
        it('should return null when empty', () => {
            expect(queue.dequeue()).toBeNull();
        });
        it('should return null after all messages dequeued', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            queue.dequeue();
            expect(queue.dequeue()).toBeNull();
        });
        it('should handle alternating enqueue/dequeue', () => {
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text1' });
            expect(queue.dequeue().data).toBe('text1');
            queue.enqueue(message_1.MessageType.TEXT, { data: 'text2' });
            expect(queue.dequeue().data).toBe('text2');
            expect(queue.dequeue()).toBeNull();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvbWVzaC9wcmlvcml0eS1xdWV1ZS1hZHZhbmNlZC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsdUNBQXlDO0FBQ3pDLGlEQUFrRDtBQUVsRCxRQUFRLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO0lBQy9DLElBQUksS0FBbUIsQ0FBQztJQUV4QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsS0FBSyxHQUFHLElBQUksc0JBQVksRUFBRSxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzdDLEtBQUssQ0FBQyxPQUFPLENBQUMscUJBQVcsQ0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN6RCxLQUFLLENBQUMsT0FBTyxDQUFDLHFCQUFXLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDbkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxxQkFBVyxDQUFDLFlBQVksRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBRTNELG9DQUFvQztZQUNwQyxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO1lBQ2xDLEtBQUssQ0FBQyxPQUFPLENBQUMscUJBQVcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUVuRCxhQUFhO1lBQ2IsVUFBVSxDQUFD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QUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9jaHJpc3R5bWF4d2VsbC9EZXNrdG9wL0x1a2VfU3R1ZmYvR2l0SHViL1NDL2NvcmUvc3JjL21lc2gvcHJpb3JpdHktcXVldWUtYWR2YW5jZWQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNZXNzYWdlUXVldWUgfSBmcm9tICcuL3JvdXRpbmcnO1xuaW1wb3J0IHsgTWVzc2FnZVR5cGUgfSBmcm9tICcuLi9wcm90b2NvbC9tZXNzYWdlJztcblxuZGVzY3JpYmUoJ0FkdmFuY2VkIE1lc3NhZ2UgUHJpb3JpdHkgUXVldWUnLCAoKSA9PiB7XG4gIGxldCBxdWV1ZTogTWVzc2FnZVF1ZXVlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHF1ZXVlID0gbmV3IE1lc3NhZ2VRdWV1ZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnUHJpb3JpdHkgRXNjYWxhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG5vdCBlc2NhbGF0ZSByZWNlbnQgbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLkZJTEVfQ0hVTkssIHsgZGF0YTogJ2ZpbGUxJyB9KTtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDEnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5DT05UUk9MX1BJTkcsIHsgZGF0YTogJ3BpbmcxJyB9KTtcblxuICAgICAgLy8gQ29udHJvbCBtZXNzYWdlIHNob3VsZCBjb21lIGZpcnN0XG4gICAgICBjb25zdCBmaXJzdCA9IHF1ZXVlLmRlcXVldWUoKTtcbiAgICAgIGV4cGVjdChmaXJzdC5kYXRhKS50b0JlKCdwaW5nMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBtZXNzYWdlIGFnZScsICgpID0+IHtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDEnIH0pO1xuICAgICAgXG4gICAgICAvLyBXYWl0IGEgYml0XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgYWdlID0gcXVldWUuZ2V0T2xkZXN0TWVzc2FnZUFnZSgpO1xuICAgICAgICBleHBlY3QoYWdlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9LCAxMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIHNpemUgYnkgcHJpb3JpdHkgbGV2ZWwnLCAoKSA9PiB7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlRFWFQsIHsgZGF0YTogJ3RleHQxJyB9KTtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDInIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5WT0lDRSwgeyBkYXRhOiAndm9pY2UxJyB9KTtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuQ09OVFJPTF9QSU5HLCB7IGRhdGE6ICdwaW5nMScgfSk7XG5cbiAgICAgIGNvbnN0IHNpemVzID0gcXVldWUuZ2V0U2l6ZUJ5UHJpb3JpdHkoKTtcbiAgICAgIGV4cGVjdChzaXplcy5nZXQoTWVzc2FnZVR5cGUuVEVYVCkpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoc2l6ZXMuZ2V0KE1lc3NhZ2VUeXBlLlZPSUNFKSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChzaXplcy5nZXQoTWVzc2FnZVR5cGUuQ09OVFJPTF9QSU5HKSkudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N0YXJ2YXRpb24gUHJldmVudGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV2ZW50dWFsbHkgcHJvY2VzcyBsb3ctcHJpb3JpdHkgbWVzc2FnZXMnLCAoZG9uZSkgPT4ge1xuICAgICAgLy8gQWRkIGxvdy1wcmlvcml0eSBtZXNzYWdlXG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLkZJTEVfQ0hVTkssIHsgZGF0YTogJ2ZpbGUxJywgdGltZXN0YW1wOiBEYXRlLm5vdygpIC0gMzUwMDAgfSk7XG4gICAgICBcbiAgICAgIC8vIEFkZCBtYW55IGhpZ2gtcHJpb3JpdHkgbWVzc2FnZXNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLkNPTlRST0xfUElORywgeyBkYXRhOiBgcGluZyR7aX1gIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBQcm9jZXNzIHNvbWUgbWVzc2FnZXNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgIHF1ZXVlLmRlcXVldWUoKTtcbiAgICAgIH1cblxuICAgICAgLy8gVHJpZ2dlciBzdGFydmF0aW9uIHByZXZlbnRpb24gY2hlY2sgYnkgd2FpdGluZ1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vIEFmdGVyIGVzY2FsYXRpb24sIGZpbGUgbWVzc2FnZSBtaWdodCBiZSBwcm9tb3RlZFxuICAgICAgICBjb25zdCBzaXplcyA9IHF1ZXVlLmdldFNpemVCeVByaW9yaXR5KCk7XG4gICAgICAgIC8vIFZlcmlmeSBxdWV1ZSBpcyBzdGlsbCBtYW5hZ2luZyBwcmlvcml0aWVzXG4gICAgICAgIGV4cGVjdChxdWV1ZS5zaXplKCkpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSwgMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gb3JpZ2luYWwgcHJpb3JpdHkgdHJhY2tpbmcnLCAoKSA9PiB7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLkZJTEVfQ0hVTkssIHsgZGF0YTogJ2ZpbGUxJyB9KTtcbiAgICAgIGNvbnN0IHNpemUgPSBxdWV1ZS5zaXplKCk7XG4gICAgICBleHBlY3Qoc2l6ZSkudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1F1ZXVlIFN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayB0b3RhbCBxdWV1ZSBzaXplJywgKCkgPT4ge1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5URVhULCB7IGRhdGE6ICd0ZXh0MScgfSk7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlZPSUNFLCB7IGRhdGE6ICd2b2ljZTEnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5GSUxFX0NIVU5LLCB7IGRhdGE6ICdmaWxlMScgfSk7XG5cbiAgICAgIGV4cGVjdChxdWV1ZS5zaXplKCkpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYWNrIHNpemVzIGJ5IHByaW9yaXR5JywgKCkgPT4ge1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5URVhULCB7IGRhdGE6ICd0ZXh0MScgfSk7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlRFWFQsIHsgZGF0YTogJ3RleHQyJyB9KTtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDMnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5WT0lDRSwgeyBkYXRhOiAndm9pY2UxJyB9KTtcblxuICAgICAgY29uc3Qgc2l6ZXMgPSBxdWV1ZS5nZXRTaXplQnlQcmlvcml0eSgpO1xuICAgICAgZXhwZWN0KHNpemVzLmdldChNZXNzYWdlVHlwZS5URVhUKSkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChzaXplcy5nZXQoTWVzc2FnZVR5cGUuVk9JQ0UpKS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc2l6ZSBhZnRlciBkZXF1ZXVlJywgKCkgPT4ge1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5URVhULCB7IGRhdGE6ICd0ZXh0MScgfSk7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlRFWFQsIHsgZGF0YTogJ3RleHQyJyB9KTtcblxuICAgICAgZXhwZWN0KHF1ZXVlLnNpemUoKSkudG9CZSgyKTtcbiAgICAgIFxuICAgICAgcXVldWUuZGVxdWV1ZSgpO1xuICAgICAgZXhwZWN0KHF1ZXVlLnNpemUoKSkudG9CZSgxKTtcbiAgICAgIFxuICAgICAgcXVldWUuZGVxdWV1ZSgpO1xuICAgICAgZXhwZWN0KHF1ZXVlLnNpemUoKSkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2xlYXIgYWxsIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5URVhULCB7IGRhdGE6ICd0ZXh0MScgfSk7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlZPSUNFLCB7IGRhdGE6ICd2b2ljZTEnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5GSUxFX0NIVU5LLCB7IGRhdGE6ICdmaWxlMScgfSk7XG5cbiAgICAgIGV4cGVjdChxdWV1ZS5zaXplKCkpLnRvQmUoMyk7XG4gICAgICBcbiAgICAgIHF1ZXVlLmNsZWFyKCk7XG4gICAgICBleHBlY3QocXVldWUuc2l6ZSgpKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUHJpb3JpdHkgT3JkZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IHByaW9yaXR5IG9yZGVyOiBDT05UUk9MID4gVk9JQ0UgPiBURVhUID4gRklMRScsICgpID0+IHtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuRklMRV9DSFVOSywgeyBkYXRhOiAnZmlsZScgfSk7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlRFWFQsIHsgZGF0YTogJ3RleHQnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5WT0lDRSwgeyBkYXRhOiAndm9pY2UnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5DT05UUk9MX1BJTkcsIHsgZGF0YTogJ3BpbmcnIH0pO1xuXG4gICAgICBleHBlY3QocXVldWUuZGVxdWV1ZSgpLmRhdGEpLnRvQmUoJ3BpbmcnKTtcbiAgICAgIGV4cGVjdChxdWV1ZS5kZXF1ZXVlKCkuZGF0YSkudG9CZSgndm9pY2UnKTtcbiAgICAgIGV4cGVjdChxdWV1ZS5kZXF1ZXVlKCkuZGF0YSkudG9CZSgndGV4dCcpO1xuICAgICAgZXhwZWN0KHF1ZXVlLmRlcXVldWUoKS5kYXRhKS50b0JlKCdmaWxlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtdWx0aXBsZSBjb250cm9sIG1lc3NhZ2UgdHlwZXMnLCAoKSA9PiB7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLkNPTlRST0xfQUNLLCB7IGRhdGE6ICdhY2snIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5DT05UUk9MX1BPTkcsIHsgZGF0YTogJ3BvbmcnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5DT05UUk9MX1BJTkcsIHsgZGF0YTogJ3BpbmcnIH0pO1xuXG4gICAgICAvLyBBbGwgYXJlIGNvbnRyb2wgbWVzc2FnZXMsIHNob3VsZCBiZSBGSUZPIHdpdGhpbiBzYW1lIHByaW9yaXR5XG4gICAgICBjb25zdCBmaXJzdCA9IHF1ZXVlLmRlcXVldWUoKTtcbiAgICAgIGV4cGVjdChbJ2FjaycsICdwb25nJywgJ3BpbmcnXSkudG9Db250YWluKGZpcnN0LmRhdGEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgRklMRV9NRVRBREFUQSBhbmQgRklMRV9DSFVOSycsICgpID0+IHtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuRklMRV9DSFVOSywgeyBkYXRhOiAnY2h1bmsnIH0pO1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5GSUxFX01FVEFEQVRBLCB7IGRhdGE6ICdtZXRhZGF0YScgfSk7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlRFWFQsIHsgZGF0YTogJ3RleHQnIH0pO1xuXG4gICAgICBleHBlY3QocXVldWUuZGVxdWV1ZSgpLmRhdGEpLnRvQmUoJ3RleHQnKTsgLy8gSGlnaGVyIHByaW9yaXR5XG4gICAgICBcbiAgICAgIGNvbnN0IG5leHQgPSBxdWV1ZS5kZXF1ZXVlKCk7XG4gICAgICBleHBlY3QoWydjaHVuaycsICdtZXRhZGF0YSddKS50b0NvbnRhaW4obmV4dC5kYXRhKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ZJRk8gd2l0aGluIFByaW9yaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gRklGTyBvcmRlciB3aXRoaW4gc2FtZSBwcmlvcml0eScsICgpID0+IHtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDEnLCBvcmRlcjogMSB9KTtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDInLCBvcmRlcjogMiB9KTtcbiAgICAgIHF1ZXVlLmVucXVldWUoTWVzc2FnZVR5cGUuVEVYVCwgeyBkYXRhOiAndGV4dDMnLCBvcmRlcjogMyB9KTtcblxuICAgICAgZXhwZWN0KHF1ZXVlLmRlcXVldWUoKS5vcmRlcikudG9CZSgxKTtcbiAgICAgIGV4cGVjdChxdWV1ZS5kZXF1ZXVlKCkub3JkZXIpLnRvQmUoMik7XG4gICAgICBleHBlY3QocXVldWUuZGVxdWV1ZSgpLm9yZGVyKS50b0JlKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRW1wdHkgUXVldWUgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIGVtcHR5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHF1ZXVlLmRlcXVldWUoKSkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgYWZ0ZXIgYWxsIG1lc3NhZ2VzIGRlcXVldWVkJywgKCkgPT4ge1xuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5URVhULCB7IGRhdGE6ICd0ZXh0MScgfSk7XG4gICAgICBxdWV1ZS5kZXF1ZXVlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChxdWV1ZS5kZXF1ZXVlKCkpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhbHRlcm5hdGluZyBlbnF1ZXVlL2RlcXVldWUnLCAoKSA9PiB7XG4gICAgICBxdWV1ZS5lbnF1ZXVlKE1lc3NhZ2VUeXBlLlRFWFQsIHsgZGF0YTogJ3RleHQxJyB9KTtcbiAgICAgIGV4cGVjdChxdWV1ZS5kZXF1ZXVlKCkuZGF0YSkudG9CZSgndGV4dDEnKTtcbiAgICAgIFxuICAgICAgcXVldWUuZW5xdWV1ZShNZXNzYWdlVHlwZS5URVhULCB7IGRhdGE6ICd0ZXh0MicgfSk7XG4gICAgICBleHBlY3QocXVldWUuZGVxdWV1ZSgpLmRhdGEpLnRvQmUoJ3RleHQyJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChxdWV1ZS5kZXF1ZXVlKCkpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=