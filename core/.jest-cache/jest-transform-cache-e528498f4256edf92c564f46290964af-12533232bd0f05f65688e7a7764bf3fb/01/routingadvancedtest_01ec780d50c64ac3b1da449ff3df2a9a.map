{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/routing-advanced.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/routing-advanced.test.ts"],"sourcesContent":["import type { Peer, RouteMetrics } from './routing';\nimport { PeerState } from './routing';\nimport { RoutingTable, createPeer } from './routing';\n\ndescribe('Advanced Routing Table Features', () => {\n  let routingTable: RoutingTable;\n\n  beforeEach(() => {\n    routingTable = new RoutingTable('local-peer', {\n      maxCacheSize: 100,\n      cacheTTL: 1000,\n      routeTTL: 5000,\n      enableBloomFilter: true,\n    });\n  });\n\n  describe('Route Metrics and Conflict Resolution', () => {\n    it('should prefer routes with fewer hops', () => {\n      const route1 = {\n        destination: 'dest1',\n        nextHop: 'peer1',\n        hopCount: 3,\n        timestamp: Date.now(),\n        metrics: {\n          hopCount: 3,\n          latency: 100,\n          reliability: 0.9,\n          lastUsed: Date.now(),\n        },\n        expiresAt: Date.now() + 10000,\n      };\n\n      const route2 = {\n        destination: 'dest1',\n        nextHop: 'peer2',\n        hopCount: 2,\n        timestamp: Date.now(),\n        metrics: {\n          hopCount: 2,\n          latency: 100,\n          reliability: 0.9,\n          lastUsed: Date.now(),\n        },\n        expiresAt: Date.now() + 10000,\n      };\n\n      routingTable.addRoute(route1);\n      routingTable.addRoute(route2);\n\n      const nextHop = routingTable.getNextHop('dest1');\n      expect(nextHop).toBe('peer2');\n    });\n\n    it('should prefer lower latency routes with same hop count', () => {\n      const route1 = {\n        destination: 'dest1',\n        nextHop: 'peer1',\n        hopCount: 2,\n        timestamp: Date.now(),\n        metrics: {\n          hopCount: 2,\n          latency: 200,\n          reliability: 0.9,\n          lastUsed: Date.now(),\n        },\n        expiresAt: Date.now() + 10000,\n      };\n\n      const route2 = {\n        destination: 'dest1',\n        nextHop: 'peer2',\n        hopCount: 2,\n        timestamp: Date.now() + 1,\n        metrics: {\n          hopCount: 2,\n          latency: 100,\n          reliability: 0.9,\n          lastUsed: Date.now(),\n        },\n        expiresAt: Date.now() + 10000,\n      };\n\n      routingTable.addRoute(route1);\n      routingTable.addRoute(route2);\n\n      const nextHop = routingTable.getNextHop('dest1');\n      expect(nextHop).toBe('peer2');\n    });\n\n    it('should update route metrics', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      routingTable.updateRouteMetrics('peer1', 150, true);\n      const route = routingTable.getNextHop('peer1');\n      expect(route).toBe('peer1');\n    });\n  });\n\n  describe('Peer Reputation and Blacklisting', () => {\n    it('should update peer reputation on success', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      routingTable.updatePeerReputation('peer1', true);\n      const updated = routingTable.getPeer('peer1');\n      \n      expect(updated?.metadata.reputation).toBe(51);\n      expect(updated?.metadata.successCount).toBe(1);\n    });\n\n    it('should decrease reputation on failure', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      routingTable.updatePeerReputation('peer1', false);\n      const updated = routingTable.getPeer('peer1');\n      \n      expect(updated?.metadata.reputation).toBe(48);\n      expect(updated?.metadata.failureCount).toBe(1);\n    });\n\n    it('should change peer state to degraded with low reputation', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      peer.metadata.reputation = 25;\n      routingTable.addPeer(peer);\n\n      for (let i = 0; i < 5; i++) {\n        routingTable.updatePeerReputation('peer1', false);\n      }\n\n      const updated = routingTable.getPeer('peer1');\n      expect(updated?.state).toBe(PeerState.DEGRADED);\n    });\n\n    it('should blacklist a peer', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      routingTable.blacklistPeer('peer1');\n      \n      expect(routingTable.isPeerBlacklisted('peer1')).toBe(true);\n      const updated = routingTable.getPeer('peer1');\n      expect(updated?.state).toBe(PeerState.DISCONNECTED);\n    });\n\n    it('should blacklist peer with expiry', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      routingTable.blacklistPeer('peer1', 100); // 100ms\n      expect(routingTable.isPeerBlacklisted('peer1')).toBe(true);\n\n      // Wait for expiry\n      setTimeout(() => {\n        expect(routingTable.isPeerBlacklisted('peer1')).toBe(false);\n      }, 150);\n    });\n\n    it('should unblacklist a peer', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      routingTable.blacklistPeer('peer1');\n      expect(routingTable.isPeerBlacklisted('peer1')).toBe(true);\n\n      routingTable.unblacklistPeer('peer1');\n      expect(routingTable.isPeerBlacklisted('peer1')).toBe(false);\n    });\n  });\n\n  describe('Bloom Filter and LRU Cache', () => {\n    it('should use bloom filter for fast lookups', () => {\n      const hash1 = 'hash1';\n      const hash2 = 'hash2';\n\n      expect(routingTable.hasSeenMessage(hash1)).toBe(false);\n      \n      routingTable.markMessageSeen(hash1);\n      expect(routingTable.hasSeenMessage(hash1)).toBe(true);\n      expect(routingTable.hasSeenMessage(hash2)).toBe(false);\n    });\n\n    it('should evict old messages with LRU when cache is full', () => {\n      // Fill cache to limit\n      for (let i = 0; i < 100; i++) {\n        routingTable.markMessageSeen(`hash${i}`);\n      }\n\n      const stats = routingTable.getStats();\n      expect(stats.cacheSize).toBeLessThanOrEqual(100);\n\n      // Add more messages, should trigger eviction\n      for (let i = 100; i < 110; i++) {\n        routingTable.markMessageSeen(`hash${i}`);\n      }\n\n      const newStats = routingTable.getStats();\n      expect(newStats.cacheSize).toBeLessThanOrEqual(100);\n    });\n  });\n\n  describe('Memory Usage Monitoring', () => {\n    it('should track memory usage', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      routingTable.markMessageSeen('hash1');\n\n      const memory = routingTable.getMemoryUsage();\n      \n      expect(memory.bytes).toBeGreaterThan(0);\n      expect(memory.breakdown.peers).toBeGreaterThan(0);\n      expect(memory.breakdown.messageCache).toBeGreaterThan(0);\n    });\n\n    it('should include memory usage in stats', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      const stats = routingTable.getStats();\n      expect(stats.memoryUsage).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Route Expiration', () => {\n    it('should not add expired routes', async () => {\n      const expiredRoute = {\n        destination: 'dest1',\n        nextHop: 'peer1',\n        hopCount: 2,\n        timestamp: Date.now() - 10000,\n        metrics: {\n          hopCount: 2,\n          latency: 100,\n          reliability: 0.9,\n          lastUsed: Date.now() - 10000,\n        },\n        expiresAt: Date.now() - 1000, // Already expired\n      };\n\n      routingTable.addRoute(expiredRoute);\n      \n      // Route should be replaced or cleaned up\n      const nextHop = routingTable.getNextHop('dest1');\n      // Should still work if route is valid\n      expect(nextHop).toBeDefined();\n    });\n  });\n});\n"],"version":3}