6d77110b07e3791d244dd33523a305b7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const routing_1 = require("./routing");
const routing_2 = require("./routing");
describe('Advanced Routing Table Features', () => {
    let routingTable;
    beforeEach(() => {
        routingTable = new routing_2.RoutingTable('local-peer', {
            maxCacheSize: 100,
            cacheTTL: 1000,
            routeTTL: 5000,
            enableBloomFilter: true,
        });
    });
    describe('Route Metrics and Conflict Resolution', () => {
        it('should prefer routes with fewer hops', () => {
            const route1 = {
                destination: 'dest1',
                nextHop: 'peer1',
                hopCount: 3,
                timestamp: Date.now(),
                metrics: {
                    hopCount: 3,
                    latency: 100,
                    reliability: 0.9,
                    lastUsed: Date.now(),
                },
                expiresAt: Date.now() + 10000,
            };
            const route2 = {
                destination: 'dest1',
                nextHop: 'peer2',
                hopCount: 2,
                timestamp: Date.now(),
                metrics: {
                    hopCount: 2,
                    latency: 100,
                    reliability: 0.9,
                    lastUsed: Date.now(),
                },
                expiresAt: Date.now() + 10000,
            };
            routingTable.addRoute(route1);
            routingTable.addRoute(route2);
            const nextHop = routingTable.getNextHop('dest1');
            expect(nextHop).toBe('peer2');
        });
        it('should prefer lower latency routes with same hop count', () => {
            const route1 = {
                destination: 'dest1',
                nextHop: 'peer1',
                hopCount: 2,
                timestamp: Date.now(),
                metrics: {
                    hopCount: 2,
                    latency: 200,
                    reliability: 0.9,
                    lastUsed: Date.now(),
                },
                expiresAt: Date.now() + 10000,
            };
            const route2 = {
                destination: 'dest1',
                nextHop: 'peer2',
                hopCount: 2,
                timestamp: Date.now() + 1,
                metrics: {
                    hopCount: 2,
                    latency: 100,
                    reliability: 0.9,
                    lastUsed: Date.now(),
                },
                expiresAt: Date.now() + 10000,
            };
            routingTable.addRoute(route1);
            routingTable.addRoute(route2);
            const nextHop = routingTable.getNextHop('dest1');
            expect(nextHop).toBe('peer2');
        });
        it('should update route metrics', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.updateRouteMetrics('peer1', 150, true);
            const route = routingTable.getNextHop('peer1');
            expect(route).toBe('peer1');
        });
    });
    describe('Peer Reputation and Blacklisting', () => {
        it('should update peer reputation on success', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.updatePeerReputation('peer1', true);
            const updated = routingTable.getPeer('peer1');
            expect(updated?.metadata.reputation).toBe(51);
            expect(updated?.metadata.successCount).toBe(1);
        });
        it('should decrease reputation on failure', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.updatePeerReputation('peer1', false);
            const updated = routingTable.getPeer('peer1');
            expect(updated?.metadata.reputation).toBe(48);
            expect(updated?.metadata.failureCount).toBe(1);
        });
        it('should change peer state to degraded with low reputation', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            peer.metadata.reputation = 25;
            routingTable.addPeer(peer);
            for (let i = 0; i < 5; i++) {
                routingTable.updatePeerReputation('peer1', false);
            }
            const updated = routingTable.getPeer('peer1');
            expect(updated?.state).toBe(routing_1.PeerState.DEGRADED);
        });
        it('should blacklist a peer', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.blacklistPeer('peer1');
            expect(routingTable.isPeerBlacklisted('peer1')).toBe(true);
            const updated = routingTable.getPeer('peer1');
            expect(updated?.state).toBe(routing_1.PeerState.DISCONNECTED);
        });
        it('should blacklist peer with expiry', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.blacklistPeer('peer1', 100); // 100ms
            expect(routingTable.isPeerBlacklisted('peer1')).toBe(true);
            // Wait for expiry
            setTimeout(() => {
                expect(routingTable.isPeerBlacklisted('peer1')).toBe(false);
            }, 150);
        });
        it('should unblacklist a peer', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.blacklistPeer('peer1');
            expect(routingTable.isPeerBlacklisted('peer1')).toBe(true);
            routingTable.unblacklistPeer('peer1');
            expect(routingTable.isPeerBlacklisted('peer1')).toBe(false);
        });
    });
    describe('Bloom Filter and LRU Cache', () => {
        it('should use bloom filter for fast lookups', () => {
            const hash1 = 'hash1';
            const hash2 = 'hash2';
            expect(routingTable.hasSeenMessage(hash1)).toBe(false);
            routingTable.markMessageSeen(hash1);
            expect(routingTable.hasSeenMessage(hash1)).toBe(true);
            expect(routingTable.hasSeenMessage(hash2)).toBe(false);
        });
        it('should evict old messages with LRU when cache is full', () => {
            // Fill cache to limit
            for (let i = 0; i < 100; i++) {
                routingTable.markMessageSeen(`hash${i}`);
            }
            const stats = routingTable.getStats();
            expect(stats.cacheSize).toBeLessThanOrEqual(100);
            // Add more messages, should trigger eviction
            for (let i = 100; i < 110; i++) {
                routingTable.markMessageSeen(`hash${i}`);
            }
            const newStats = routingTable.getStats();
            expect(newStats.cacheSize).toBeLessThanOrEqual(100);
        });
    });
    describe('Memory Usage Monitoring', () => {
        it('should track memory usage', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            routingTable.markMessageSeen('hash1');
            const memory = routingTable.getMemoryUsage();
            expect(memory.bytes).toBeGreaterThan(0);
            expect(memory.breakdown.peers).toBeGreaterThan(0);
            expect(memory.breakdown.messageCache).toBeGreaterThan(0);
        });
        it('should include memory usage in stats', () => {
            const peer = (0, routing_2.createPeer)('peer1', new Uint8Array(32), 'webrtc');
            routingTable.addPeer(peer);
            const stats = routingTable.getStats();
            expect(stats.memoryUsage).toBeGreaterThan(0);
        });
    });
    describe('Route Expiration', () => {
        it('should not add expired routes', async () => {
            const expiredRoute = {
                destination: 'dest1',
                nextHop: 'peer1',
                hopCount: 2,
                timestamp: Date.now() - 10000,
                metrics: {
                    hopCount: 2,
                    latency: 100,
                    reliability: 0.9,
                    lastUsed: Date.now() - 10000,
                },
                expiresAt: Date.now() - 1000, // Already expired
            };
            routingTable.addRoute(expiredRoute);
            // Route should be replaced or cleaned up
            const nextHop = routingTable.getNextHop('dest1');
            // Should still work if route is valid
            expect(nextHop).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvbWVzaC9yb3V0aW5nLWFkdmFuY2VkLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFDQSx1Q0FBc0M7QUFDdEMsdUNBQXFEO0FBRXJELFFBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7SUFDL0MsSUFBSSxZQUEwQixDQUFDO0lBRS9CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxZQUFZLEdBQUcsSUFBSSxzQkFBWSxDQUFDLFlBQVksRUFBRTtZQUM1QyxZQUFZLEVBQUUsR0FBRztZQUNqQixRQUFRLEVBQUUsSUFBSTtZQUNkLFFBQVEsRUFBRSxJQUFJO1lBQ2QsaUJBQWlCLEVBQUUsSUFBSTtTQUN4QixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7UUFDckQsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtZQUM5QyxNQUFNLE1BQU0sR0FBRztnQkFDYixXQUFXLEVBQUUsT0FBTztnQkFDcEIsT0FBTyxFQUFFLE9BQU87Z0JBQ2hCLFFBQVEsRUFBRSxDQUFDO2dCQUNYLFNBQVMsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO2dCQUNyQixPQUFPLEVBQUU7b0JBQ1AsUUFBUSxFQUFFLENBQUM7b0JBQ1gsT0FBTyxFQUFFLEdBQUc7b0JBQ1osV0FBVyxFQUFFLEdBQUc7b0JBQ2hCLFFBQVEsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO2lCQUNyQjtnQkFDRCxTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUs7YUFDOUIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHO2dCQUNiLFdBQVcsRUFBRSxPQUFPO2dCQUNwQixPQUFPLEVBQUUsT0FBTztnQkFDaEIsUUFBUSxFQUFFLENBQUM7Z0JBQ1gsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7Z0JBQ3JCLE9BQU8sRUFB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QUFDLFdBQVcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsK0JBQStCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0MsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLFdBQVcsRUFBRSxPQUFPO2dCQUNwQixPQUFPLEVBQUUsT0FBTztnQkFDaEIsUUFBUSxFQUFFLENBQUM7Z0JBQ1gsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLO2dCQUM3QixPQUFPLEVBQUU7b0JBQ1AsUUFBUSxFQUFFLENBQUM7b0JBQ1gsT0FBTyxFQUFFLEdBQUc7b0JBQ1osV0FBVyxFQUFFLEdBQUc7b0JBQ2hCLFFBQVEsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSztpQkFDN0I7Z0JBQ0QsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLEVBQUUsa0JBQWtCO2FBQ2pELENBQUM7WUFFRixZQUFZLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXBDLHlDQUF5QztZQUN6QyxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2pELHNDQUFzQztZQUN0QyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9jaHJpc3R5bWF4d2VsbC9EZXNrdG9wL0x1a2VfU3R1ZmYvR2l0SHViL1NDL2NvcmUvc3JjL21lc2gvcm91dGluZy1hZHZhbmNlZC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUGVlciwgUm91dGVNZXRyaWNzIH0gZnJvbSAnLi9yb3V0aW5nJztcbmltcG9ydCB7IFBlZXJTdGF0ZSB9IGZyb20gJy4vcm91dGluZyc7XG5pbXBvcnQgeyBSb3V0aW5nVGFibGUsIGNyZWF0ZVBlZXIgfSBmcm9tICcuL3JvdXRpbmcnO1xuXG5kZXNjcmliZSgnQWR2YW5jZWQgUm91dGluZyBUYWJsZSBGZWF0dXJlcycsICgpID0+IHtcbiAgbGV0IHJvdXRpbmdUYWJsZTogUm91dGluZ1RhYmxlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHJvdXRpbmdUYWJsZSA9IG5ldyBSb3V0aW5nVGFibGUoJ2xvY2FsLXBlZXInLCB7XG4gICAgICBtYXhDYWNoZVNpemU6IDEwMCxcbiAgICAgIGNhY2hlVFRMOiAxMDAwLFxuICAgICAgcm91dGVUVEw6IDUwMDAsXG4gICAgICBlbmFibGVCbG9vbUZpbHRlcjogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JvdXRlIE1ldHJpY3MgYW5kIENvbmZsaWN0IFJlc29sdXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcmVmZXIgcm91dGVzIHdpdGggZmV3ZXIgaG9wcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJvdXRlMSA9IHtcbiAgICAgICAgZGVzdGluYXRpb246ICdkZXN0MScsXG4gICAgICAgIG5leHRIb3A6ICdwZWVyMScsXG4gICAgICAgIGhvcENvdW50OiAzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICBob3BDb3VudDogMyxcbiAgICAgICAgICBsYXRlbmN5OiAxMDAsXG4gICAgICAgICAgcmVsaWFiaWxpdHk6IDAuOSxcbiAgICAgICAgICBsYXN0VXNlZDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSxcbiAgICAgICAgZXhwaXJlc0F0OiBEYXRlLm5vdygpICsgMTAwMDAsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByb3V0ZTIgPSB7XG4gICAgICAgIGRlc3RpbmF0aW9uOiAnZGVzdDEnLFxuICAgICAgICBuZXh0SG9wOiAncGVlcjInLFxuICAgICAgICBob3BDb3VudDogMixcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgaG9wQ291bnQ6IDIsXG4gICAgICAgICAgbGF0ZW5jeTogMTAwLFxuICAgICAgICAgIHJlbGlhYmlsaXR5OiAwLjksXG4gICAgICAgICAgbGFzdFVzZWQ6IERhdGUubm93KCksXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGlyZXNBdDogRGF0ZS5ub3coKSArIDEwMDAwLFxuICAgICAgfTtcblxuICAgICAgcm91dGluZ1RhYmxlLmFkZFJvdXRlKHJvdXRlMSk7XG4gICAgICByb3V0aW5nVGFibGUuYWRkUm91dGUocm91dGUyKTtcblxuICAgICAgY29uc3QgbmV4dEhvcCA9IHJvdXRpbmdUYWJsZS5nZXROZXh0SG9wKCdkZXN0MScpO1xuICAgICAgZXhwZWN0KG5leHRIb3ApLnRvQmUoJ3BlZXIyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZWZlciBsb3dlciBsYXRlbmN5IHJvdXRlcyB3aXRoIHNhbWUgaG9wIGNvdW50JywgKCkgPT4ge1xuICAgICAgY29uc3Qgcm91dGUxID0ge1xuICAgICAgICBkZXN0aW5hdGlvbjogJ2Rlc3QxJyxcbiAgICAgICAgbmV4dEhvcDogJ3BlZXIxJyxcbiAgICAgICAgaG9wQ291bnQ6IDIsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgIGhvcENvdW50OiAyLFxuICAgICAgICAgIGxhdGVuY3k6IDIwMCxcbiAgICAgICAgICByZWxpYWJpbGl0eTogMC45LFxuICAgICAgICAgIGxhc3RVc2VkOiBEYXRlLm5vdygpLFxuICAgICAgICB9LFxuICAgICAgICBleHBpcmVzQXQ6IERhdGUubm93KCkgKyAxMDAwMCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJvdXRlMiA9IHtcbiAgICAgICAgZGVzdGluYXRpb246ICdkZXN0MScsXG4gICAgICAgIG5leHRIb3A6ICdwZWVyMicsXG4gICAgICAgIGhvcENvdW50OiAyLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkgKyAxLFxuICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgaG9wQ291bnQ6IDIsXG4gICAgICAgICAgbGF0ZW5jeTogMTAwLFxuICAgICAgICAgIHJlbGlhYmlsaXR5OiAwLjksXG4gICAgICAgICAgbGFzdFVzZWQ6IERhdGUubm93KCksXG4gICAgICAgIH0sXG4gICAgICAgIGV4cGlyZXNBdDogRGF0ZS5ub3coKSArIDEwMDAwLFxuICAgICAgfTtcblxuICAgICAgcm91dGluZ1RhYmxlLmFkZFJvdXRlKHJvdXRlMSk7XG4gICAgICByb3V0aW5nVGFibGUuYWRkUm91dGUocm91dGUyKTtcblxuICAgICAgY29uc3QgbmV4dEhvcCA9IHJvdXRpbmdUYWJsZS5nZXROZXh0SG9wKCdkZXN0MScpO1xuICAgICAgZXhwZWN0KG5leHRIb3ApLnRvQmUoJ3BlZXIyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSByb3V0ZSBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlciA9IGNyZWF0ZVBlZXIoJ3BlZXIxJywgbmV3IFVpbnQ4QXJyYXkoMzIpLCAnd2VicnRjJyk7XG4gICAgICByb3V0aW5nVGFibGUuYWRkUGVlcihwZWVyKTtcblxuICAgICAgcm91dGluZ1RhYmxlLnVwZGF0ZVJvdXRlTWV0cmljcygncGVlcjEnLCAxNTAsIHRydWUpO1xuICAgICAgY29uc3Qgcm91dGUgPSByb3V0aW5nVGFibGUuZ2V0TmV4dEhvcCgncGVlcjEnKTtcbiAgICAgIGV4cGVjdChyb3V0ZSkudG9CZSgncGVlcjEnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BlZXIgUmVwdXRhdGlvbiBhbmQgQmxhY2tsaXN0aW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIHBlZXIgcmVwdXRhdGlvbiBvbiBzdWNjZXNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlciA9IGNyZWF0ZVBlZXIoJ3BlZXIxJywgbmV3IFVpbnQ4QXJyYXkoMzIpLCAnd2VicnRjJyk7XG4gICAgICByb3V0aW5nVGFibGUuYWRkUGVlcihwZWVyKTtcblxuICAgICAgcm91dGluZ1RhYmxlLnVwZGF0ZVBlZXJSZXB1dGF0aW9uKCdwZWVyMScsIHRydWUpO1xuICAgICAgY29uc3QgdXBkYXRlZCA9IHJvdXRpbmdUYWJsZS5nZXRQZWVyKCdwZWVyMScpO1xuICAgICAgXG4gICAgICBleHBlY3QodXBkYXRlZD8ubWV0YWRhdGEucmVwdXRhdGlvbikudG9CZSg1MSk7XG4gICAgICBleHBlY3QodXBkYXRlZD8ubWV0YWRhdGEuc3VjY2Vzc0NvdW50KS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWNyZWFzZSByZXB1dGF0aW9uIG9uIGZhaWx1cmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZWVyID0gY3JlYXRlUGVlcigncGVlcjEnLCBuZXcgVWludDhBcnJheSgzMiksICd3ZWJydGMnKTtcbiAgICAgIHJvdXRpbmdUYWJsZS5hZGRQZWVyKHBlZXIpO1xuXG4gICAgICByb3V0aW5nVGFibGUudXBkYXRlUGVlclJlcHV0YXRpb24oJ3BlZXIxJywgZmFsc2UpO1xuICAgICAgY29uc3QgdXBkYXRlZCA9IHJvdXRpbmdUYWJsZS5nZXRQZWVyKCdwZWVyMScpO1xuICAgICAgXG4gICAgICBleHBlY3QodXBkYXRlZD8ubWV0YWRhdGEucmVwdXRhdGlvbikudG9CZSg0OCk7XG4gICAgICBleHBlY3QodXBkYXRlZD8ubWV0YWRhdGEuZmFpbHVyZUNvdW50KS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjaGFuZ2UgcGVlciBzdGF0ZSB0byBkZWdyYWRlZCB3aXRoIGxvdyByZXB1dGF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlciA9IGNyZWF0ZVBlZXIoJ3BlZXIxJywgbmV3IFVpbnQ4QXJyYXkoMzIpLCAnd2VicnRjJyk7XG4gICAgICBwZWVyLm1ldGFkYXRhLnJlcHV0YXRpb24gPSAyNTtcbiAgICAgIHJvdXRpbmdUYWJsZS5hZGRQZWVyKHBlZXIpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICByb3V0aW5nVGFibGUudXBkYXRlUGVlclJlcHV0YXRpb24oJ3BlZXIxJywgZmFsc2UpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1cGRhdGVkID0gcm91dGluZ1RhYmxlLmdldFBlZXIoJ3BlZXIxJyk7XG4gICAgICBleHBlY3QodXBkYXRlZD8uc3RhdGUpLnRvQmUoUGVlclN0YXRlLkRFR1JBREVEKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmxhY2tsaXN0IGEgcGVlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlZXIgPSBjcmVhdGVQZWVyKCdwZWVyMScsIG5ldyBVaW50OEFycmF5KDMyKSwgJ3dlYnJ0YycpO1xuICAgICAgcm91dGluZ1RhYmxlLmFkZFBlZXIocGVlcik7XG5cbiAgICAgIHJvdXRpbmdUYWJsZS5ibGFja2xpc3RQZWVyKCdwZWVyMScpO1xuICAgICAgXG4gICAgICBleHBlY3Qocm91dGluZ1RhYmxlLmlzUGVlckJsYWNrbGlzdGVkKCdwZWVyMScpKS50b0JlKHRydWUpO1xuICAgICAgY29uc3QgdXBkYXRlZCA9IHJvdXRpbmdUYWJsZS5nZXRQZWVyKCdwZWVyMScpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWQ/LnN0YXRlKS50b0JlKFBlZXJTdGF0ZS5ESVNDT05ORUNURUQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBibGFja2xpc3QgcGVlciB3aXRoIGV4cGlyeScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlZXIgPSBjcmVhdGVQZWVyKCdwZWVyMScsIG5ldyBVaW50OEFycmF5KDMyKSwgJ3dlYnJ0YycpO1xuICAgICAgcm91dGluZ1RhYmxlLmFkZFBlZXIocGVlcik7XG5cbiAgICAgIHJvdXRpbmdUYWJsZS5ibGFja2xpc3RQZWVyKCdwZWVyMScsIDEwMCk7IC8vIDEwMG1zXG4gICAgICBleHBlY3Qocm91dGluZ1RhYmxlLmlzUGVlckJsYWNrbGlzdGVkKCdwZWVyMScpKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBXYWl0IGZvciBleHBpcnlcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBleHBlY3Qocm91dGluZ1RhYmxlLmlzUGVlckJsYWNrbGlzdGVkKCdwZWVyMScpKS50b0JlKGZhbHNlKTtcbiAgICAgIH0sIDE1MCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVuYmxhY2tsaXN0IGEgcGVlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlZXIgPSBjcmVhdGVQZWVyKCdwZWVyMScsIG5ldyBVaW50OEFycmF5KDMyKSwgJ3dlYnJ0YycpO1xuICAgICAgcm91dGluZ1RhYmxlLmFkZFBlZXIocGVlcik7XG5cbiAgICAgIHJvdXRpbmdUYWJsZS5ibGFja2xpc3RQZWVyKCdwZWVyMScpO1xuICAgICAgZXhwZWN0KHJvdXRpbmdUYWJsZS5pc1BlZXJCbGFja2xpc3RlZCgncGVlcjEnKSkudG9CZSh0cnVlKTtcblxuICAgICAgcm91dGluZ1RhYmxlLnVuYmxhY2tsaXN0UGVlcigncGVlcjEnKTtcbiAgICAgIGV4cGVjdChyb3V0aW5nVGFibGUuaXNQZWVyQmxhY2tsaXN0ZWQoJ3BlZXIxJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQmxvb20gRmlsdGVyIGFuZCBMUlUgQ2FjaGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1c2UgYmxvb20gZmlsdGVyIGZvciBmYXN0IGxvb2t1cHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBoYXNoMSA9ICdoYXNoMSc7XG4gICAgICBjb25zdCBoYXNoMiA9ICdoYXNoMic7XG5cbiAgICAgIGV4cGVjdChyb3V0aW5nVGFibGUuaGFzU2Vlbk1lc3NhZ2UoaGFzaDEpKS50b0JlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgcm91dGluZ1RhYmxlLm1hcmtNZXNzYWdlU2VlbihoYXNoMSk7XG4gICAgICBleHBlY3Qocm91dGluZ1RhYmxlLmhhc1NlZW5NZXNzYWdlKGhhc2gxKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyb3V0aW5nVGFibGUuaGFzU2Vlbk1lc3NhZ2UoaGFzaDIpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXZpY3Qgb2xkIG1lc3NhZ2VzIHdpdGggTFJVIHdoZW4gY2FjaGUgaXMgZnVsbCcsICgpID0+IHtcbiAgICAgIC8vIEZpbGwgY2FjaGUgdG8gbGltaXRcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICAgICAgcm91dGluZ1RhYmxlLm1hcmtNZXNzYWdlU2VlbihgaGFzaCR7aX1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RhdHMgPSByb3V0aW5nVGFibGUuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5jYWNoZVNpemUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcblxuICAgICAgLy8gQWRkIG1vcmUgbWVzc2FnZXMsIHNob3VsZCB0cmlnZ2VyIGV2aWN0aW9uXG4gICAgICBmb3IgKGxldCBpID0gMTAwOyBpIDwgMTEwOyBpKyspIHtcbiAgICAgICAgcm91dGluZ1RhYmxlLm1hcmtNZXNzYWdlU2VlbihgaGFzaCR7aX1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbmV3U3RhdHMgPSByb3V0aW5nVGFibGUuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChuZXdTdGF0cy5jYWNoZVNpemUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ01lbW9yeSBVc2FnZSBNb25pdG9yaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgbWVtb3J5IHVzYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlciA9IGNyZWF0ZVBlZXIoJ3BlZXIxJywgbmV3IFVpbnQ4QXJyYXkoMzIpLCAnd2VicnRjJyk7XG4gICAgICByb3V0aW5nVGFibGUuYWRkUGVlcihwZWVyKTtcbiAgICAgIHJvdXRpbmdUYWJsZS5tYXJrTWVzc2FnZVNlZW4oJ2hhc2gxJyk7XG5cbiAgICAgIGNvbnN0IG1lbW9yeSA9IHJvdXRpbmdUYWJsZS5nZXRNZW1vcnlVc2FnZSgpO1xuICAgICAgXG4gICAgICBleHBlY3QobWVtb3J5LmJ5dGVzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QobWVtb3J5LmJyZWFrZG93bi5wZWVycykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KG1lbW9yeS5icmVha2Rvd24ubWVzc2FnZUNhY2hlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgbWVtb3J5IHVzYWdlIGluIHN0YXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlciA9IGNyZWF0ZVBlZXIoJ3BlZXIxJywgbmV3IFVpbnQ4QXJyYXkoMzIpLCAnd2VicnRjJyk7XG4gICAgICByb3V0aW5nVGFibGUuYWRkUGVlcihwZWVyKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSByb3V0aW5nVGFibGUuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5tZW1vcnlVc2FnZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUm91dGUgRXhwaXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG5vdCBhZGQgZXhwaXJlZCByb3V0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleHBpcmVkUm91dGUgPSB7XG4gICAgICAgIGRlc3RpbmF0aW9uOiAnZGVzdDEnLFxuICAgICAgICBuZXh0SG9wOiAncGVlcjEnLFxuICAgICAgICBob3BDb3VudDogMixcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpIC0gMTAwMDAsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICBob3BDb3VudDogMixcbiAgICAgICAgICBsYXRlbmN5OiAxMDAsXG4gICAgICAgICAgcmVsaWFiaWxpdHk6IDAuOSxcbiAgICAgICAgICBsYXN0VXNlZDogRGF0ZS5ub3coKSAtIDEwMDAwLFxuICAgICAgICB9LFxuICAgICAgICBleHBpcmVzQXQ6IERhdGUubm93KCkgLSAxMDAwLCAvLyBBbHJlYWR5IGV4cGlyZWRcbiAgICAgIH07XG5cbiAgICAgIHJvdXRpbmdUYWJsZS5hZGRSb3V0ZShleHBpcmVkUm91dGUpO1xuICAgICAgXG4gICAgICAvLyBSb3V0ZSBzaG91bGQgYmUgcmVwbGFjZWQgb3IgY2xlYW5lZCB1cFxuICAgICAgY29uc3QgbmV4dEhvcCA9IHJvdXRpbmdUYWJsZS5nZXROZXh0SG9wKCdkZXN0MScpO1xuICAgICAgLy8gU2hvdWxkIHN0aWxsIHdvcmsgaWYgcm91dGUgaXMgdmFsaWRcbiAgICAgIGV4cGVjdChuZXh0SG9wKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9