fe7b11b2f3df676310e5e8f95afa8a92
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const file_validation_1 = require("./file-validation");
describe('File Validation', () => {
    // Mock File object since it's not available in Node.js environment by default
    class MockFile {
        constructor(parts, name, options) {
            this.name = name;
            this.size = parts.join('').length;
            this.type = options.type;
        }
    }
    // @ts-ignore
    global.File = MockFile;
    describe('validateFile', () => {
        it('should validate valid file', () => {
            const file = new File(['content'], 'test.jpg', { type: 'image/jpeg' });
            const result = (0, file_validation_1.validateFile)(file);
            expect(result.valid).toBe(true);
            expect(result.sanitizedName).toBe('test.jpg');
        });
        it('should reject file too large', () => {
            const largeContent = 'a'.repeat(file_validation_1.FILE_LIMITS.MAX_SIZE + 1);
            const file = new File([largeContent], 'large.jpg', { type: 'image/jpeg' });
            const result = (0, file_validation_1.validateFile)(file);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('File too large');
        });
        it('should reject invalid file type', () => {
            const file = new File(['content'], 'test.exe', { type: 'application/x-msdownload' });
            const result = (0, file_validation_1.validateFile)(file);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('File type not allowed');
        });
        it('should reject blocked extension', () => {
            const file = new File(['content'], 'script.js', { type: 'text/javascript' });
            // Even if type was allowed (it's not in the list), extension is blocked
            const result = (0, file_validation_1.validateFile)(file);
            expect(result.valid).toBe(false);
            // Note: In the implementation, type check comes first. 
            // If we use a valid type but invalid extension:
            const file2 = new File(['content'], 'malicious.exe', { type: 'text/plain' });
            const result2 = (0, file_validation_1.validateFile)(file2);
            expect(result2.valid).toBe(false);
            expect(result2.error).toContain('File extension not allowed');
        });
        it('should sanitize filename', () => {
            const file = new File(['content'], '../etc/passwd.jpg', { type: 'image/jpeg' });
            const result = (0, file_validation_1.validateFile)(file);
            expect(result.valid).toBe(true);
            expect(result.sanitizedName).not.toContain('..');
            expect(result.sanitizedName).toBe('_etc_passwd.jpg'); // ../ becomes _, /becomes _
        });
    });
    describe('validateFileList', () => {
        it('should validate list of files', () => {
            const files = [
                new File(['content'], 'test1.jpg', { type: 'image/jpeg' }),
                new File(['content'], 'test2.png', { type: 'image/png' })
            ];
            const result = (0, file_validation_1.validateFileList)(files);
            expect(result.valid).toBe(true);
        });
        it('should reject too many files', () => {
            const files = [];
            for (let i = 0; i < file_validation_1.FILE_LIMITS.MAX_FILES_PER_MESSAGE + 1; i++) {
                files.push(new File(['content'], `test${i}.jpg`, { type: 'image/jpeg' }));
            }
            const result = (0, file_validation_1.validateFileList)(files);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Too many files');
        });
        it('should reject if any file is invalid', () => {
            const files = [
                new File(['content'], 'valid.jpg', { type: 'image/jpeg' }),
                new File(['content'], 'invalid.exe', { type: 'application/x-msdownload' })
            ];
            const result = (0, file_validation_1.validateFileList)(files);
            expect(result.valid).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvZmlsZS12YWxpZGF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx1REFBZ0Y7QUFFaEYsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQiw4RUFBOEU7SUFDOUUsTUFBTSxRQUFRO1FBS1osWUFBWSxLQUFlLEVBQUUsSUFBWSxFQUFFLE9BQXlCO1lBQ2xFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDbEMsSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQzNCLENBQUM7S0FDRjtJQUVELGFBQWE7SUFDYixNQUFNLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUV2QixRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUM1QixFQUFFLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEVBQUUsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7WUFDdkUsTUFBTSxNQUFNLEdBQUcsSUFBQSw4QkFBWSxFQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLDZCQUFX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QUM5QyxNQUFNLEtBQUssR0FBRztnQkFDWixJQUFJLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsQ0FBQztnQkFDMUQsSUFBSSxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBRSxhQUFhLEVBQUUsRUFBRSxJQUFJLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQzthQUMzRSxDQUFDO1lBQ0YsTUFBTSxNQUFNLEdBQUcsSUFBQSxrQ0FBZ0IsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvZmlsZS12YWxpZGF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdmFsaWRhdGVGaWxlLCB2YWxpZGF0ZUZpbGVMaXN0LCBGSUxFX0xJTUlUUyB9IGZyb20gJy4vZmlsZS12YWxpZGF0aW9uJztcblxuZGVzY3JpYmUoJ0ZpbGUgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgLy8gTW9jayBGaWxlIG9iamVjdCBzaW5jZSBpdCdzIG5vdCBhdmFpbGFibGUgaW4gTm9kZS5qcyBlbnZpcm9ubWVudCBieSBkZWZhdWx0XG4gIGNsYXNzIE1vY2tGaWxlIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgc2l6ZTogbnVtYmVyO1xuICAgIHR5cGU6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHBhcnRzOiBzdHJpbmdbXSwgbmFtZTogc3RyaW5nLCBvcHRpb25zOiB7IHR5cGU6IHN0cmluZyB9KSB7XG4gICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgdGhpcy5zaXplID0gcGFydHMuam9pbignJykubGVuZ3RoO1xuICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgIH1cbiAgfVxuXG4gIC8vIEB0cy1pZ25vcmVcbiAgZ2xvYmFsLkZpbGUgPSBNb2NrRmlsZTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVGaWxlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdmFsaWQgZmlsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBuZXcgRmlsZShbJ2NvbnRlbnQnXSwgJ3Rlc3QuanBnJywgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zYW5pdGl6ZWROYW1lKS50b0JlKCd0ZXN0LmpwZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZmlsZSB0b28gbGFyZ2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCBsYXJnZUNvbnRlbnQgPSAnYScucmVwZWF0KEZJTEVfTElNSVRTLk1BWF9TSVpFICsgMSk7XG4gICAgICBjb25zdCBmaWxlID0gbmV3IEZpbGUoW2xhcmdlQ29udGVudF0sICdsYXJnZS5qcGcnLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZShmaWxlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdGaWxlIHRvbyBsYXJnZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBmaWxlIHR5cGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gbmV3IEZpbGUoWydjb250ZW50J10sICd0ZXN0LmV4ZScsIHsgdHlwZTogJ2FwcGxpY2F0aW9uL3gtbXNkb3dubG9hZCcgfSk7XG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignRmlsZSB0eXBlIG5vdCBhbGxvd2VkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBibG9ja2VkIGV4dGVuc2lvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBuZXcgRmlsZShbJ2NvbnRlbnQnXSwgJ3NjcmlwdC5qcycsIHsgdHlwZTogJ3RleHQvamF2YXNjcmlwdCcgfSk7XG4gICAgICAvLyBFdmVuIGlmIHR5cGUgd2FzIGFsbG93ZWQgKGl0J3Mgbm90IGluIHRoZSBsaXN0KSwgZXh0ZW5zaW9uIGlzIGJsb2NrZWRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZShmaWxlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgLy8gTm90ZTogSW4gdGhlIGltcGxlbWVudGF0aW9uLCB0eXBlIGNoZWNrIGNvbWVzIGZpcnN0LiBcbiAgICAgIC8vIElmIHdlIHVzZSBhIHZhbGlkIHR5cGUgYnV0IGludmFsaWQgZXh0ZW5zaW9uOlxuICAgICAgY29uc3QgZmlsZTIgPSBuZXcgRmlsZShbJ2NvbnRlbnQnXSwgJ21hbGljaW91cy5leGUnLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSB2YWxpZGF0ZUZpbGUoZmlsZTIpO1xuICAgICAgZXhwZWN0KHJlc3VsdDIudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdDIuZXJyb3IpLnRvQ29udGFpbignRmlsZSBleHRlbnNpb24gbm90IGFsbG93ZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgZmlsZW5hbWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWxlID0gbmV3IEZpbGUoWydjb250ZW50J10sICcuLi9ldGMvcGFzc3dkLmpwZycsIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlKGZpbGUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2FuaXRpemVkTmFtZSkubm90LnRvQ29udGFpbignLi4nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2FuaXRpemVkTmFtZSkudG9CZSgnX2V0Y19wYXNzd2QuanBnJyk7IC8vIC4uLyBiZWNvbWVzIF8sIC9iZWNvbWVzIF9cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlRmlsZUxpc3QnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBsaXN0IG9mIGZpbGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZXMgPSBbXG4gICAgICAgIG5ldyBGaWxlKFsnY29udGVudCddLCAndGVzdDEuanBnJywgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSksXG4gICAgICAgIG5ldyBGaWxlKFsnY29udGVudCddLCAndGVzdDIucG5nJywgeyB0eXBlOiAnaW1hZ2UvcG5nJyB9KVxuICAgICAgXTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZUxpc3QoZmlsZXMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHRvbyBtYW55IGZpbGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsZXMgPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgRklMRV9MSU1JVFMuTUFYX0ZJTEVTX1BFUl9NRVNTQUdFICsgMTsgaSsrKSB7XG4gICAgICAgIGZpbGVzLnB1c2gobmV3IEZpbGUoWydjb250ZW50J10sIGB0ZXN0JHtpfS5qcGdgLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9KSk7XG4gICAgICB9XG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVMaXN0KGZpbGVzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdUb28gbWFueSBmaWxlcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaWYgYW55IGZpbGUgaXMgaW52YWxpZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVzID0gW1xuICAgICAgICBuZXcgRmlsZShbJ2NvbnRlbnQnXSwgJ3ZhbGlkLmpwZycsIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pLFxuICAgICAgICBuZXcgRmlsZShbJ2NvbnRlbnQnXSwgJ2ludmFsaWQuZXhlJywgeyB0eXBlOiAnYXBwbGljYXRpb24veC1tc2Rvd25sb2FkJyB9KVxuICAgICAgXTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZUxpc3QoZmlsZXMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9