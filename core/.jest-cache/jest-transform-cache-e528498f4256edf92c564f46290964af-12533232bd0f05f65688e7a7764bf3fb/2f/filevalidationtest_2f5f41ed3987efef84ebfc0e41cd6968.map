{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/file-validation.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/file-validation.test.ts"],"sourcesContent":["import { validateFile, validateFileList, FILE_LIMITS } from './file-validation';\n\ndescribe('File Validation', () => {\n  // Mock File object since it's not available in Node.js environment by default\n  class MockFile {\n    name: string;\n    size: number;\n    type: string;\n\n    constructor(parts: string[], name: string, options: { type: string }) {\n      this.name = name;\n      this.size = parts.join('').length;\n      this.type = options.type;\n    }\n  }\n\n  // @ts-ignore\n  global.File = MockFile;\n\n  describe('validateFile', () => {\n    it('should validate valid file', () => {\n      const file = new File(['content'], 'test.jpg', { type: 'image/jpeg' });\n      const result = validateFile(file);\n      expect(result.valid).toBe(true);\n      expect(result.sanitizedName).toBe('test.jpg');\n    });\n\n    it('should reject file too large', () => {\n      const largeContent = 'a'.repeat(FILE_LIMITS.MAX_SIZE + 1);\n      const file = new File([largeContent], 'large.jpg', { type: 'image/jpeg' });\n      const result = validateFile(file);\n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('File too large');\n    });\n\n    it('should reject invalid file type', () => {\n      const file = new File(['content'], 'test.exe', { type: 'application/x-msdownload' });\n      const result = validateFile(file);\n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('File type not allowed');\n    });\n\n    it('should reject blocked extension', () => {\n      const file = new File(['content'], 'script.js', { type: 'text/javascript' });\n      // Even if type was allowed (it's not in the list), extension is blocked\n      const result = validateFile(file);\n      expect(result.valid).toBe(false);\n      // Note: In the implementation, type check comes first. \n      // If we use a valid type but invalid extension:\n      const file2 = new File(['content'], 'malicious.exe', { type: 'text/plain' });\n      const result2 = validateFile(file2);\n      expect(result2.valid).toBe(false);\n      expect(result2.error).toContain('File extension not allowed');\n    });\n\n    it('should sanitize filename', () => {\n      const file = new File(['content'], '../etc/passwd.jpg', { type: 'image/jpeg' });\n      const result = validateFile(file);\n      expect(result.valid).toBe(true);\n      expect(result.sanitizedName).not.toContain('..');\n      expect(result.sanitizedName).toBe('_etc_passwd.jpg'); // ../ becomes _, /becomes _\n    });\n  });\n\n  describe('validateFileList', () => {\n    it('should validate list of files', () => {\n      const files = [\n        new File(['content'], 'test1.jpg', { type: 'image/jpeg' }),\n        new File(['content'], 'test2.png', { type: 'image/png' })\n      ];\n      const result = validateFileList(files);\n      expect(result.valid).toBe(true);\n    });\n\n    it('should reject too many files', () => {\n      const files = [];\n      for (let i = 0; i < FILE_LIMITS.MAX_FILES_PER_MESSAGE + 1; i++) {\n        files.push(new File(['content'], `test${i}.jpg`, { type: 'image/jpeg' }));\n      }\n      const result = validateFileList(files);\n      expect(result.valid).toBe(false);\n      expect(result.error).toContain('Too many files');\n    });\n\n    it('should reject if any file is invalid', () => {\n      const files = [\n        new File(['content'], 'valid.jpg', { type: 'image/jpeg' }),\n        new File(['content'], 'invalid.exe', { type: 'application/x-msdownload' })\n      ];\n      const result = validateFileList(files);\n      expect(result.valid).toBe(false);\n    });\n  });\n});"],"version":3}