{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/health-advanced.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/health-advanced.test.ts"],"sourcesContent":["import { PeerHealthMonitor, PeerHealth } from './health';\nimport { RoutingTable, createPeer } from './routing';\n\ndescribe('Advanced Peer Health Monitoring', () => {\n  let healthMonitor: PeerHealthMonitor;\n  let routingTable: RoutingTable;\n  const localPeerId = 'local-peer';\n  const privateKey = new Uint8Array(32);\n\n  beforeEach(() => {\n    routingTable = new RoutingTable(localPeerId);\n    healthMonitor = new PeerHealthMonitor(\n      localPeerId,\n      privateKey,\n      routingTable,\n      {\n        interval: 1000, // 1 second for testing\n        timeout: 3000,\n        maxMissed: 2,\n        adaptiveInterval: true,\n        minInterval: 500,\n        maxInterval: 2000,\n      }\n    );\n  });\n\n  afterEach(() => {\n    healthMonitor.shutdown();\n  });\n\n  describe('Adaptive Heartbeat Intervals', () => {\n    it('should initialize with default interval', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      \n      healthMonitor.startMonitoring('peer1');\n      const health = healthMonitor.getPeerHealth('peer1');\n      \n      expect(health?.adaptiveInterval).toBe(1000);\n    });\n\n    it('should track RTT and latency history', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      healthMonitor.startMonitoring('peer1');\n\n      const timestamp = Date.now() - 100;\n      healthMonitor.processHeartbeatResponse('peer1', timestamp);\n\n      const health = healthMonitor.getPeerHealth('peer1');\n      expect(health?.rtt).toBeGreaterThan(0);\n      expect(health?.latencyHistory.length).toBeGreaterThan(0);\n    });\n\n    it('should calculate health score based on metrics', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      healthMonitor.startMonitoring('peer1');\n\n      // Simulate good response\n      const timestamp = Date.now() - 50;\n      healthMonitor.processHeartbeatResponse('peer1', timestamp);\n\n      const health = healthMonitor.getPeerHealth('peer1');\n      expect(health?.healthScore).toBeGreaterThan(80);\n    });\n\n    it('should update packet loss on missed heartbeats', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      healthMonitor.startMonitoring('peer1');\n\n      // Force a check without response\n      const health = healthMonitor.getPeerHealth('peer1');\n      if (health) {\n        health.lastHeartbeat = Date.now() - 5000; // Force timeout\n      }\n\n      // Packet loss should increase over time with missed heartbeats\n      expect(health?.packetLoss).toBeDefined();\n    });\n  });\n\n  describe('Health Score Calculation', () => {\n    it('should penalize high latency', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      healthMonitor.startMonitoring('peer1');\n\n      // Simulate high latency response\n      const timestamp = Date.now() - 1500; // 1500ms latency\n      healthMonitor.processHeartbeatResponse('peer1', timestamp);\n\n      const health = healthMonitor.getPeerHealth('peer1');\n      expect(health?.healthScore).toBeLessThan(80);\n    });\n\n    it('should maintain high score for good connection', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      healthMonitor.startMonitoring('peer1');\n\n      // Simulate good responses\n      for (let i = 0; i < 5; i++) {\n        const timestamp = Date.now() - 50;\n        healthMonitor.processHeartbeatResponse('peer1', timestamp);\n      }\n\n      const health = healthMonitor.getPeerHealth('peer1');\n      expect(health?.healthScore).toBeGreaterThanOrEqual(90);\n    });\n  });\n\n  describe('Peer Health State Transitions', () => {\n    it('should track missed heartbeats', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n\n      healthMonitor.startMonitoring('peer1');\n\n      const health = healthMonitor.getPeerHealth('peer1');\n      expect(health).toBeDefined();\n      expect(health?.isHealthy).toBe(true);\n      expect(health?.missedHeartbeats).toBe(0);\n    });\n\n    it('should transition back to healthy on successful response', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      healthMonitor.startMonitoring('peer1');\n\n      const health = healthMonitor.getPeerHealth('peer1');\n      if (health) {\n        health.isHealthy = false;\n        health.missedHeartbeats = 3;\n      }\n\n      const timestamp = Date.now() - 50;\n      healthMonitor.processHeartbeatResponse('peer1', timestamp);\n\n      const updatedHealth = healthMonitor.getPeerHealth('peer1');\n      expect(updatedHealth?.isHealthy).toBe(true);\n      expect(updatedHealth?.missedHeartbeats).toBe(0);\n    });\n  });\n\n  describe('Statistics and Monitoring', () => {\n    it('should provide health statistics', () => {\n      const peer1 = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      const peer2 = createPeer('peer2', new Uint8Array(32), 'webrtc');\n      \n      routingTable.addPeer(peer1);\n      routingTable.addPeer(peer2);\n      \n      healthMonitor.startMonitoring('peer1');\n      healthMonitor.startMonitoring('peer2');\n\n      const stats = healthMonitor.getStats();\n      expect(stats.totalPeers).toBe(2);\n      expect(stats.healthy).toBeGreaterThan(0);\n    });\n\n    it('should calculate average RTT', () => {\n      const peer1 = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer1);\n      healthMonitor.startMonitoring('peer1');\n\n      const timestamp = Date.now() - 100;\n      healthMonitor.processHeartbeatResponse('peer1', timestamp);\n\n      const stats = healthMonitor.getStats();\n      expect(stats.averageRtt).toBeGreaterThan(0);\n    });\n\n    it('should get all peer health statuses', () => {\n      const peer1 = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      const peer2 = createPeer('peer2', new Uint8Array(32), 'webrtc');\n      \n      routingTable.addPeer(peer1);\n      routingTable.addPeer(peer2);\n      \n      healthMonitor.startMonitoring('peer1');\n      healthMonitor.startMonitoring('peer2');\n\n      const allHealth = healthMonitor.getAllPeerHealth();\n      expect(allHealth).toHaveLength(2);\n      expect(allHealth.map(h => h.peerId)).toContain('peer1');\n      expect(allHealth.map(h => h.peerId)).toContain('peer2');\n    });\n  });\n\n  describe('Cleanup and Shutdown', () => {\n    it('should stop monitoring a peer', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      routingTable.addPeer(peer);\n      \n      healthMonitor.startMonitoring('peer1');\n      expect(healthMonitor.getPeerHealth('peer1')).toBeDefined();\n\n      healthMonitor.stopMonitoring('peer1');\n      expect(healthMonitor.getPeerHealth('peer1')).toBeUndefined();\n    });\n\n    it('should shutdown all monitoring', () => {\n      const peer1 = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      const peer2 = createPeer('peer2', new Uint8Array(32), 'webrtc');\n      \n      routingTable.addPeer(peer1);\n      routingTable.addPeer(peer2);\n      \n      healthMonitor.startMonitoring('peer1');\n      healthMonitor.startMonitoring('peer2');\n\n      healthMonitor.shutdown();\n\n      const allHealth = healthMonitor.getAllPeerHealth();\n      expect(allHealth).toHaveLength(0);\n    });\n  });\n});\n"],"version":3}