{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/gossip.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/gossip.test.ts"],"sourcesContent":["/**\n * Tests for Gossip Protocol Implementation\n */\n\nimport { GossipProtocol } from './gossip.js';\nimport type { Message } from '../protocol/message.js';\nimport { MessageType } from '../protocol/message.js';\n\ndescribe('GossipProtocol', () => {\n  let gossip: GossipProtocol;\n\n  beforeEach(() => {\n    gossip = new GossipProtocol({\n      fanout: 3,\n      gossipInterval: 100, // Fast for testing\n      maxMessageAge: 5000,\n      pruneInterval: 1000,\n    });\n  });\n\n  afterEach(() => {\n    gossip.stop();\n    gossip.clear();\n  });\n\n  describe('Peer Management', () => {\n    it('should add peers', () => {\n      gossip.addPeer('peer1');\n      gossip.addPeer('peer2');\n      \n      const stats = gossip.getStats();\n      expect(stats.peerCount).toBe(2);\n    });\n\n    it('should remove peers', () => {\n      gossip.addPeer('peer1');\n      gossip.addPeer('peer2');\n      gossip.removePeer('peer1');\n      \n      const stats = gossip.getStats();\n      expect(stats.peerCount).toBe(1);\n    });\n\n    it('should track active peers', () => {\n      gossip.addPeer('peer1');\n      const stats = gossip.getStats();\n      expect(stats.activePeerCount).toBe(1);\n    });\n  });\n\n  describe('Message Handling', () => {\n    it('should receive new messages', () => {\n      const message = createTestMessage('test message');\n      const isNew = gossip.receiveMessage(message, 'peer1');\n      \n      expect(isNew).toBe(true);\n      const stats = gossip.getStats();\n      expect(stats.messageCount).toBe(1);\n      expect(stats.seenCount).toBe(1);\n    });\n\n    it('should detect duplicate messages', () => {\n      const message = createTestMessage('test message');\n      \n      const isNew1 = gossip.receiveMessage(message, 'peer1');\n      const isNew2 = gossip.receiveMessage(message, 'peer2');\n      \n      expect(isNew1).toBe(true);\n      expect(isNew2).toBe(false); // Duplicate\n      \n      const stats = gossip.getStats();\n      expect(stats.messageCount).toBe(1); // Only one copy stored\n    });\n\n    it('should trigger onMessage callback for new messages', () => {\n      const callback = jest.fn();\n      gossip.onMessage(callback);\n      \n      const message = createTestMessage('test');\n      gossip.receiveMessage(message, 'peer1');\n      \n      expect(callback).toHaveBeenCalledWith(message, 'peer1');\n    });\n\n    it('should not trigger callback for duplicate messages', () => {\n      const callback = jest.fn();\n      gossip.onMessage(callback);\n      \n      const message = createTestMessage('test');\n      gossip.receiveMessage(message, 'peer1');\n      gossip.receiveMessage(message, 'peer2');\n      \n      expect(callback).toHaveBeenCalledTimes(1); // Only once\n    });\n  });\n\n  describe('Gossip Protocol', () => {\n    it('should start and stop gossip rounds', () => {\n      gossip.start();\n      expect(gossip['gossipInterval']).not.toBeNull();\n      \n      gossip.stop();\n      expect(gossip['gossipInterval']).toBeNull();\n    });\n\n    it('should not start multiple times', () => {\n      gossip.start();\n      const interval1 = gossip['gossipInterval'];\n      \n      gossip.start();\n      const interval2 = gossip['gossipInterval'];\n      \n      expect(interval1).toBe(interval2);\n      gossip.stop();\n    });\n\n    it('should prune old messages', () => {\n      jest.useFakeTimers();\n      const message = createTestMessage('old message');\n      gossip.receiveMessage(message, 'peer1');\n      \n      expect(gossip.getStats().messageCount).toBe(1);\n      \n      // Advance time past maxMessageAge (5000ms from config)\n      jest.advanceTimersByTime(6000);\n      \n      // Trigger prune manually\n      gossip['pruneOldMessages']();\n      \n      expect(gossip.getStats().messageCount).toBe(0);\n      jest.useRealTimers();\n    });\n  });\n\n  describe('Statistics', () => {\n    it('should provide accurate stats', () => {\n      gossip.addPeer('peer1');\n      gossip.addPeer('peer2');\n      \n      const msg1 = createTestMessage('msg1');\n      const msg2 = createTestMessage('msg2');\n      \n      gossip.receiveMessage(msg1, 'peer1');\n      gossip.receiveMessage(msg2, 'peer2');\n      \n      const stats = gossip.getStats();\n      expect(stats.peerCount).toBe(2);\n      expect(stats.messageCount).toBe(2);\n      expect(stats.seenCount).toBe(2);\n    });\n  });\n\n  describe('Clear', () => {\n    it('should clear all state', () => {\n      gossip.addPeer('peer1');\n      const message = createTestMessage('test');\n      gossip.receiveMessage(message, 'peer1');\n      \n      gossip.clear();\n      \n      const stats = gossip.getStats();\n      expect(stats.peerCount).toBe(0);\n      expect(stats.messageCount).toBe(0);\n      expect(stats.seenCount).toBe(0);\n    });\n  });\n});\n\n/**\n * Helper to create a test message\n */\nfunction createTestMessage(content: string): Message {\n  return {\n    header: {\n      version: 1,\n      type: MessageType.TEXT,\n      ttl: 10,\n      timestamp: Date.now(),\n      senderId: new Uint8Array(32),\n      signature: new Uint8Array(64),\n    },\n    payload: new TextEncoder().encode(content),\n  };\n}\n"],"version":3}