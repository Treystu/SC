{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/routing.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/routing.test.ts"],"sourcesContent":["import type { Peer } from '../mesh/routing';\nimport { RoutingTable, MessageQueue, createPeer } from '../mesh/routing';\nimport { MessageType } from '../protocol/message';\n\ndescribe('Routing Table', () => {\n  let routingTable: RoutingTable;\n\n  beforeEach(() => {\n    routingTable = new RoutingTable('local-peer');\n  });\n\n  describe('Peer Management', () => {\n    it('should add and retrieve peers', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n\n      routingTable.addPeer(peer);\n      const retrieved = routingTable.getPeer('peer1');\n\n      expect(retrieved?.id).toEqual(peer.id);\n      expect(retrieved?.publicKey).toEqual(peer.publicKey);\n    });\n\n    it('should remove peers', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n\n      routingTable.addPeer(peer);\n      routingTable.removePeer('peer1');\n      const retrieved = routingTable.getPeer('peer1');\n\n      expect(retrieved).toBeUndefined();\n    });\n\n    it('should list all peers', () => {\n      const peer1 = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      const peer2 = createPeer('peer2', new Uint8Array(32), 'bluetooth');\n\n      routingTable.addPeer(peer1);\n      routingTable.addPeer(peer2);\n\n      const peers = routingTable.getAllPeers();\n      expect(peers).toHaveLength(2);\n      expect(peers.map(p => p.id)).toContain('peer1');\n      expect(peers.map(p => p.id)).toContain('peer2');\n    });\n\n    it('should update peer last seen', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n      peer.lastSeen = 1000;\n\n      routingTable.addPeer(peer);\n      routingTable.updatePeerLastSeen('peer1');\n\n      const updated = routingTable.getPeer('peer1');\n      expect(updated!.lastSeen).toBeGreaterThan(1000);\n    });\n\n    it('should remove stale peers', async () => {\n      const stalePeer = createPeer('stale', new Uint8Array(32), 'webrtc');\n      stalePeer.lastSeen = Date.now() - 120000; // 2 minutes ago\n\n      const freshPeer = createPeer('fresh', new Uint8Array(32), 'webrtc');\n\n      routingTable.addPeer(stalePeer);\n      routingTable.addPeer(freshPeer);\n\n      const removed = routingTable.removeStalepeers(60000); // 60 second timeout\n\n      expect(removed).toContain('stale');\n      expect(removed).not.toContain('fresh');\n      expect(routingTable.getPeer('stale')).toBeUndefined();\n      expect(routingTable.getPeer('fresh')).toBeDefined();\n    });\n  });\n\n  describe('Message Deduplication', () => {\n    it('should detect duplicate messages', () => {\n      const hash = 'message-hash-123';\n\n      expect(routingTable.hasSeenMessage(hash)).toBe(false);\n      routingTable.markMessageSeen(hash);\n      expect(routingTable.hasSeenMessage(hash)).toBe(true);\n    });\n\n    it('should track multiple messages', () => {\n      const hashes = ['hash1', 'hash2', 'hash3'];\n\n      hashes.forEach(hash => routingTable.markMessageSeen(hash));\n      hashes.forEach(hash => {\n        expect(routingTable.hasSeenMessage(hash)).toBe(true);\n      });\n    });\n  });\n\n  describe('Routing', () => {\n    it('should create direct routes for connected peers', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n\n      routingTable.addPeer(peer);\n      const nextHop = routingTable.getNextHop('peer1');\n\n      expect(nextHop).toBe('peer1');\n    });\n\n    it('should return undefined for unknown destinations', () => {\n      const nextHop = routingTable.getNextHop('unknown');\n      expect(nextHop).toBeUndefined();\n    });\n  });\n\n  describe('Statistics', () => {\n    it('should return correct stats', () => {\n      const peer = createPeer('peer1', new Uint8Array(32), 'webrtc');\n\n      routingTable.addPeer(peer);\n      routingTable.markMessageSeen('hash1');\n\n      const stats = routingTable.getStats();\n      expect(stats.peerCount).toBe(1);\n      expect(stats.routeCount).toBe(1);\n      expect(stats.cacheSize).toBe(1);\n    });\n  });\n});\n\ndescribe('Message Queue', () => {\n  let queue: MessageQueue;\n\n  beforeEach(() => {\n    queue = new MessageQueue();\n  });\n\n  it('should enqueue and dequeue messages', () => {\n    const message = { data: 'test' };\n    queue.enqueue(MessageType.TEXT, message);\n\n    const dequeued = queue.dequeue();\n    expect(dequeued).toEqual(message);\n  });\n\n  it('should prioritize control messages over text', () => {\n    const textMsg = { type: 'text' };\n    const controlMsg = { type: 'control' };\n\n    queue.enqueue(MessageType.TEXT, textMsg);\n    queue.enqueue(MessageType.CONTROL_PING, controlMsg);\n\n    const first = queue.dequeue();\n    expect(first).toEqual(controlMsg);\n  });\n\n  it('should prioritize voice over text', () => {\n    const textMsg = { type: 'text' };\n    const voiceMsg = { type: 'voice' };\n\n    queue.enqueue(MessageType.TEXT, textMsg);\n    queue.enqueue(MessageType.VOICE, voiceMsg);\n\n    const first = queue.dequeue();\n    expect(first).toEqual(voiceMsg);\n  });\n\n  it('should return null when queue is empty', () => {\n    const message = queue.dequeue();\n    expect(message).toBeNull();\n  });\n\n  it('should track queue size', () => {\n    expect(queue.size()).toBe(0);\n\n    queue.enqueue(MessageType.TEXT, { data: '1' });\n    queue.enqueue(MessageType.TEXT, { data: '2' });\n    expect(queue.size()).toBe(2);\n\n    queue.dequeue();\n    expect(queue.size()).toBe(1);\n  });\n\n  it('should clear all messages', () => {\n    queue.enqueue(MessageType.TEXT, { data: '1' });\n    queue.enqueue(MessageType.VOICE, { data: '2' });\n\n    queue.clear();\n    expect(queue.size()).toBe(0);\n    expect(queue.dequeue()).toBeNull();\n  });\n});\n"],"version":3}