{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/crypto/index.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/crypto/index.ts"],"sourcesContent":["/**\n * Crypto module exports\n * Provides all cryptographic primitives for Sovereign Communications\n */\n\nexport * from './primitives.js';\nexport * from './storage.js';\nexport * from './envelope.js';\n\n// Re-export specific commonly-used items for convenience\nimport {\n  generateIdentity,\n  generateKeyPair,\n  generateKey,\n  generateNonce,\n  generateSessionKey,\n  generateEphemeralKeyPair,\n  signMessage,\n  verifySignature,\n  batchVerifySignatures,\n  encryptMessage,\n  decryptMessage,\n  performKeyExchange,\n  deriveSharedSecret,\n  deriveSessionKey,\n  generateFingerprint,\n  rotateSessionKey,\n  shouldRotateKey,\n  timingSafeEqual,\n  secureWipe,\n  validateEntropy,\n  incrementNonce,\n  randomBytes,\n  NonceManager,\n  initializeRatchet,\n  ratchetStep,\n  deriveMessageKey,\n  type IdentityKeyPair,\n  type SessionKey,\n  type RatchetState,\n} from './primitives.js';\n\n// Re-export the imported items\nexport {\n  generateIdentity,\n  generateKeyPair,\n  generateKey,\n  generateNonce,\n  generateSessionKey,\n  generateEphemeralKeyPair,\n  signMessage,\n  verifySignature,\n  batchVerifySignatures,\n  encryptMessage,\n  decryptMessage,\n  performKeyExchange,\n  deriveSharedSecret,\n  deriveSessionKey,\n  generateFingerprint,\n  rotateSessionKey,\n  shouldRotateKey,\n  timingSafeEqual,\n  secureWipe,\n  validateEntropy,\n  incrementNonce,\n  randomBytes,\n  NonceManager,\n  initializeRatchet,\n  ratchetStep,\n  deriveMessageKey,\n  type IdentityKeyPair,\n  type SessionKey,\n  type RatchetState,\n};\n\n/**\n * CryptoManager class - High-level encryption/decryption API\n * Provides a convenient class-based interface for cryptographic operations\n */\nexport class CryptoManager {\n  private encoder = new TextEncoder();\n  private decoder = new TextDecoder();\n\n  /** Minimum size for encrypted data (nonce size) */\n  private static readonly NONCE_SIZE = 24;\n\n  /**\n   * Validate and extract nonce/ciphertext from encrypted data\n   * @param encrypted - Encrypted data with nonce prepended\n   * @returns Object containing nonce and ciphertext\n   * @throws Error if encrypted data is too short\n   */\n  private extractNonceAndCiphertext(encrypted: Uint8Array): { nonce: Uint8Array; ciphertext: Uint8Array } {\n    if (encrypted.length < CryptoManager.NONCE_SIZE) {\n      throw new Error(`Encrypted data too short: must be at least ${CryptoManager.NONCE_SIZE} bytes (nonce size)`);\n    }\n    return {\n      nonce: encrypted.slice(0, CryptoManager.NONCE_SIZE),\n      ciphertext: encrypted.slice(CryptoManager.NONCE_SIZE),\n    };\n  }\n\n  /**\n   * Generate a random 32-byte symmetric key\n   */\n  generateKey(): Uint8Array {\n    return generateKey();\n  }\n\n  /**\n   * Encrypt a message using XChaCha20-Poly1305\n   * @param message - String or Uint8Array to encrypt\n   * @param key - 32-byte encryption key\n   * @returns Encrypted data with nonce prepended\n   */\n  encrypt(message: string | Uint8Array, key: Uint8Array): Uint8Array {\n    const plaintext = typeof message === 'string' \n      ? this.encoder.encode(message)\n      : message;\n    \n    const nonce = generateNonce();\n    const ciphertext = encryptMessage(plaintext, key, nonce);\n    \n    // Prepend nonce to ciphertext\n    const result = new Uint8Array(nonce.length + ciphertext.length);\n    result.set(nonce, 0);\n    result.set(ciphertext, nonce.length);\n    \n    return result;\n  }\n\n  /**\n   * Decrypt a message using XChaCha20-Poly1305\n   * @param encrypted - Encrypted data with nonce prepended\n   * @param key - 32-byte decryption key\n   * @returns Decrypted string\n   * @throws Error if encrypted data is too short\n   */\n  decrypt(encrypted: Uint8Array, key: Uint8Array): string {\n    const { nonce, ciphertext } = this.extractNonceAndCiphertext(encrypted);\n    const plaintext = decryptMessage(ciphertext, key, nonce);\n    return this.decoder.decode(plaintext);\n  }\n\n  /**\n   * Decrypt a message and return raw bytes (Uint8Array)\n   * @param encrypted - Encrypted data with nonce prepended\n   * @param key - 32-byte decryption key\n   * @returns Decrypted Uint8Array\n   * @throws Error if encrypted data is too short\n   */\n  decryptBytes(encrypted: Uint8Array, key: Uint8Array): Uint8Array {\n    const { nonce, ciphertext } = this.extractNonceAndCiphertext(encrypted);\n    return decryptMessage(ciphertext, key, nonce);\n  }\n\n  /**\n   * Sign a message using Ed25519\n   * @param message - Message to sign (string or Uint8Array)\n   * @param privateKey - 32-byte Ed25519 private key\n   * @returns 64-byte signature\n   */\n  sign(message: string | Uint8Array, privateKey: Uint8Array): Uint8Array {\n    const data = typeof message === 'string'\n      ? this.encoder.encode(message)\n      : message;\n    \n    return signMessage(data, privateKey);\n  }\n\n  /**\n   * Verify a signature using Ed25519\n   * @param message - Original message\n   * @param signature - 64-byte signature\n   * @param publicKey - 32-byte Ed25519 public key\n   * @returns true if valid, false otherwise\n   */\n  verify(message: string | Uint8Array, signature: Uint8Array, publicKey: Uint8Array): boolean {\n    const data = typeof message === 'string'\n      ? this.encoder.encode(message)\n      : message;\n    \n    return verifySignature(data, signature, publicKey);\n  }\n\n  /**\n   * Derive a shared secret using X25519 ECDH\n   * @param privateKey - Our private key\n   * @param peerPublicKey - Peer's public key\n   * @returns 32-byte shared secret\n   */\n  deriveSecret(privateKey: Uint8Array, peerPublicKey: Uint8Array): Uint8Array {\n    return deriveSharedSecret(privateKey, peerPublicKey);\n  }\n}\n\n/**\n * KeyManager class - Manages identity keypairs\n * Provides persistent key storage and generation\n */\nexport class KeyManager {\n  private publicKey: Uint8Array | null = null;\n  private privateKey: Uint8Array | null = null;\n\n  /**\n   * Generate a new Ed25519 identity keypair\n   */\n  generateIdentityKeyPair(): void {\n    const keypair = generateIdentity();\n    this.publicKey = keypair.publicKey;\n    this.privateKey = keypair.privateKey;\n  }\n\n  /**\n   * Get the public key\n   * @throws Error if keypair not generated\n   * @returns A copy of the public key to prevent external modification\n   */\n  getPublicKey(): Uint8Array {\n    if (!this.publicKey) {\n      throw new Error('Keypair not generated. Call generateIdentityKeyPair first.');\n    }\n    return new Uint8Array(this.publicKey);\n  }\n\n  /**\n   * Get the private key\n   * @throws Error if keypair not generated\n   * @returns A copy of the private key to prevent external modification\n   */\n  getPrivateKey(): Uint8Array {\n    if (!this.privateKey) {\n      throw new Error('Keypair not generated. Call generateIdentityKeyPair first.');\n    }\n    return new Uint8Array(this.privateKey);\n  }\n\n  /**\n   * Check if a keypair has been generated\n   */\n  hasKeypair(): boolean {\n    return this.publicKey !== null && this.privateKey !== null;\n  }\n\n  /**\n   * Clear the stored keypair from memory\n   */\n  clear(): void {\n    if (this.privateKey) {\n      secureWipe(this.privateKey);\n    }\n    this.publicKey = null;\n    this.privateKey = null;\n  }\n}\n"],"version":3}