{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/validation.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/validation.ts"],"sourcesContent":["/**\n * Validation and sanitization utilities\n */\n\n// Lazy-loaded DOMPurify instance\nlet DOMPurify: any = null;\nlet initPromise: Promise<void> | null = null;\n\n/**\n * Initialize DOMPurify based on environment\n */\nasync function initDOMPurify(): Promise<void> {\n  if (DOMPurify) return;\n  \n  if (initPromise) {\n    await initPromise;\n    return;\n  }\n  \n  initPromise = (async () => {\n    if (typeof window !== 'undefined') {\n      // Browser environment - use dompurify directly\n      try {\n        const dompurifyModule = await import('dompurify');\n        DOMPurify = dompurifyModule.default;\n      } catch (e) {\n        console.error('Failed to load DOMPurify in browser:', e);\n        throw e;\n      }\n    } else {\n      // Node.js/test environment - use jsdom-based DOMPurify\n      try {\n        const { JSDOM } = await import('jsdom');\n        const dompurifyModule = await import('dompurify');\n        const window = new JSDOM('').window;\n        DOMPurify = dompurifyModule.default(window as any);\n      } catch (e) {\n        // Test fallback - strip all HTML\n        if (process.env.NODE_ENV === 'test') {\n          DOMPurify = {\n            sanitize: (input: string) => input.replace(/<[^>]*>/g, ''),\n          };\n        } else {\n          throw new Error('DOMPurify initialization failed: ' + e);\n        }\n      }\n    }\n  })();\n  \n  await initPromise;\n}\n\n// Synchronous fallback for immediate use\nfunction getSanitizer() {\n  if (!DOMPurify) {\n    // Synchronous fallback - strip all HTML\n    return {\n      sanitize: (input: string) => input.replace(/<[^>]*>/g, ''),\n    };\n  }\n  return DOMPurify;\n}\n\n// Initialize immediately (fire and forget)\ninitDOMPurify().catch(() => {\n  // Fallback already handled in initDOMPurify\n});\n\n/**\n * Sanitize HTML content to prevent XSS attacks\n *\n * Uses DOMPurify to remove all HTML tags and leave only text content\n */\nexport function sanitizeHTML(html: string): string {\n  // Use DOMPurify to remove all HTML tags and leave only text content\n  const sanitizer = getSanitizer();\n  return sanitizer.sanitize(html, {\n    ALLOWED_TAGS: [],\n    ALLOWED_ATTR: [],\n  });\n}\n\n/**\n * Sanitize user input for display\n */\nexport function sanitizeUserInput(input: string): string {\n  // Remove any HTML tags using DOMPurify\n  const sanitizer = getSanitizer();\n  const sanitized = sanitizer.sanitize(input, {\n    ALLOWED_TAGS: [],\n    ALLOWED_ATTR: [],\n  });\n\n  // Limit length\n  return sanitized.substring(0, 10000);\n}\n\n/**\n * Validate and sanitize message content\n */\nexport function validateMessageContent(content: string): {\n  valid: boolean;\n  sanitized: string;\n  error?: string;\n} {\n  if (!content || content.trim().length === 0) {\n    return { valid: false, sanitized: \"\", error: \"Message cannot be empty\" };\n  }\n\n  if (content.length > 10000) {\n    return {\n      valid: false,\n      sanitized: \"\",\n      error: \"Message too long (max 10,000 characters)\",\n    };\n  }\n\n  const sanitized = sanitizeUserInput(content);\n\n  return { valid: true, sanitized };\n}\n\nexport class ValidationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"ValidationError\";\n  }\n}\n\nexport function required(value: unknown, fieldName: string): void {\n  if (value === undefined || value === null || value === \"\") {\n    throw new ValidationError(`${fieldName} is required`);\n  }\n}\n\nexport function validateStringLength(\n  value: string,\n  min: number,\n  max: number,\n  fieldName: string,\n): void {\n  if (typeof value !== \"string\") {\n    throw new ValidationError(`${fieldName} must be a string`);\n  }\n  if (value.length < min) {\n    throw new ValidationError(\n      `${fieldName} must be at least ${min} characters`,\n    );\n  }\n  if (value.length > max) {\n    throw new ValidationError(`${fieldName} must be at most ${max} characters`);\n  }\n}\n"],"version":3}