9f829870a588e92c6589226c43fba5dd
"use strict";
/**
 * Tests for Peer Security Alert System
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const peer_security_alerts_1 = require("./peer-security-alerts");
const primitives_1 = require("../crypto/primitives");
(0, globals_1.describe)('PeerSecurityAlertSystem', () => {
    let alertSystem;
    let reporterIdentity;
    let suspiciousIdentity;
    (0, globals_1.beforeEach)(() => {
        alertSystem = new peer_security_alerts_1.PeerSecurityAlertSystem();
        // Generate test identities using crypto primitives
        reporterIdentity = (0, primitives_1.generateIdentity)();
        suspiciousIdentity = (0, primitives_1.generateIdentity)();
    });
    (0, globals_1.describe)('Alert Creation', () => {
        (0, globals_1.it)('should create a valid security alert', async () => {
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE, 'suspicious-peer-123', 'reporter-peer-456', reporterIdentity.privateKey, 'Device stolen, do not trust', peer_security_alerts_1.AlertSeverity.CRITICAL);
            (0, globals_1.expect)(alert.alertId).toBeDefined();
            (0, globals_1.expect)(alert.type).toBe(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE);
            (0, globals_1.expect)(alert.severity).toBe(peer_security_alerts_1.AlertSeverity.CRITICAL);
            (0, globals_1.expect)(alert.suspiciousPeerId).toBe('suspicious-peer-123');
            (0, globals_1.expect)(alert.reporterId).toBe('reporter-peer-456');
            (0, globals_1.expect)(alert.signature).toBeInstanceOf(Uint8Array);
            (0, globals_1.expect)(alert.ttl).toBe(5);
        });
        (0, globals_1.it)('should generate unique alert IDs', async () => {
            const alert1 = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer1', 'reporter', reporterIdentity.privateKey, 'Spam detected');
            const alert2 = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer2', 'reporter', reporterIdentity.privateKey, 'Spam detected');
            (0, globals_1.expect)(alert1.alertId).not.toBe(alert2.alertId);
        });
        (0, globals_1.it)('should update reputation when creating alert', async () => {
            const initialRep = alertSystem.getPeerReputation('malicious-peer');
            (0, globals_1.expect)(initialRep.score).toBe(50); // Initial reputation
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.MALICIOUS_ACTIVITY, 'malicious-peer', 'reporter', reporterIdentity.privateKey, 'Malicious behavior detected', peer_security_alerts_1.AlertSeverity.HIGH);
            const updatedRep = alertSystem.getPeerReputation('malicious-peer');
            (0, globals_1.expect)(updatedRep.score).toBeLessThan(50);
            (0, globals_1.expect)(updatedRep.negativeReports).toBe(1);
            (0, globals_1.expect)(updatedRep.activeAlerts.length).toBe(1);
        });
    });
    (0, globals_1.describe)('Alert Processing', () => {
        (0, globals_1.it)('should verify and accept valid alert', async () => {
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.PROTOCOL_VIOLATION, 'bad-peer', 'reporter', reporterIdentity.privateKey, 'Protocol violation detected');
            // Create new system to simulate receiving from network
            const receivingSystem = new peer_security_alerts_1.PeerSecurityAlertSystem();
            const verification = await receivingSystem.processAlert(alert, reporterIdentity.publicKey);
            (0, globals_1.expect)(verification.signatureValid).toBe(true);
            (0, globals_1.expect)(verification.alert.alertId).toBe(alert.alertId);
        });
        (0, globals_1.it)('should reject alert with invalid signature', async () => {
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter', reporterIdentity.privateKey, 'Test');
            // Tamper with signature
            alert.signature = new Uint8Array(64).fill(0);
            const receivingSystem = new peer_security_alerts_1.PeerSecurityAlertSystem();
            const verification = await receivingSystem.processAlert(alert, reporterIdentity.publicKey);
            (0, globals_1.expect)(verification.signatureValid).toBe(false);
        });
        (0, globals_1.it)('should not process duplicate alerts', async () => {
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SYBIL_ATTACK, 'sybil-peer', 'reporter', reporterIdentity.privateKey, 'Sybil attack detected');
            const verification1 = await alertSystem.processAlert(alert, reporterIdentity.publicKey);
            const verification2 = await alertSystem.processAlert(alert, reporterIdentity.publicKey);
            (0, globals_1.expect)(verification1.signatureValid).toBe(true);
            (0, globals_1.expect)(verification2.signatureValid).toBe(true);
            // Should only have one copy
            const alerts = alertSystem.getAlertsForPeer('sybil-peer');
            (0, globals_1.expect)(alerts.length).toBe(1);
        });
    });
    (0, globals_1.describe)('Reputation Management', () => {
        (0, globals_1.it)('should decrease reputation for critical alerts', async () => {
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE, 'peer', 'reporter', reporterIdentity.privateKey, 'Critical issue', peer_security_alerts_1.AlertSeverity.CRITICAL);
            // Process the alert to update reputation
            await alertSystem.processAlert(alert, reporterIdentity.publicKey);
            const rep = alertSystem.getPeerReputation('peer');
            (0, globals_1.expect)(rep.score).toBeLessThan(50); // Reputation should decrease
        });
        (0, globals_1.it)('should decrease reputation less for low severity', async () => {
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter', reporterIdentity.privateKey, 'Minor spam', peer_security_alerts_1.AlertSeverity.LOW);
            // Process the alert to update reputation
            await alertSystem.processAlert(alert, reporterIdentity.publicKey);
            const rep = alertSystem.getPeerReputation('peer');
            (0, globals_1.expect)(rep.score).toBeLessThan(50); // Reputation should decrease
        });
        (0, globals_1.it)('should accumulate multiple negative reports', async () => {
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter1', reporterIdentity.privateKey, 'Spam', peer_security_alerts_1.AlertSeverity.MEDIUM);
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.PROTOCOL_VIOLATION, 'peer', 'reporter2', reporterIdentity.privateKey, 'Violation', peer_security_alerts_1.AlertSeverity.MEDIUM);
            const rep = alertSystem.getPeerReputation('peer');
            (0, globals_1.expect)(rep.negativeReports).toBe(2);
            (0, globals_1.expect)(rep.score).toBe(30); // 50 - 10 - 10
        });
        (0, globals_1.it)('should recommend blocking peers with low reputation', async () => {
            alertSystem.getPeerReputation('good-peer'); // Will have default 50
            // Create alerts to lower reputation
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE, 'bad-peer', 'reporter', reporterIdentity.privateKey, 'Bad behavior', peer_security_alerts_1.AlertSeverity.CRITICAL);
            await alertSystem.processAlert(alert, reporterIdentity.publicKey);
            (0, globals_1.expect)(alertSystem.shouldBlockPeer('good-peer')).toBe(false);
            // Bad peer might be recommended for blocking after critical alert
            (0, globals_1.expect)(typeof alertSystem.shouldBlockPeer('bad-peer')).toBe('boolean');
        });
    });
    (0, globals_1.describe)('Alert Revocation', () => {
        (0, globals_1.it)('should allow original reporter to revoke alert', async () => {
            const originalAlert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter', reporterIdentity.privateKey, 'False alarm', peer_security_alerts_1.AlertSeverity.MEDIUM);
            const revocationAlert = await alertSystem.revokeAlert(originalAlert.alertId, 'reporter', reporterIdentity.privateKey, 'Mistake - peer was legitimate');
            (0, globals_1.expect)(revocationAlert).toBeDefined();
            (0, globals_1.expect)(revocationAlert.type).toBe(peer_security_alerts_1.SecurityAlertType.ALERT_REVOKED);
            (0, globals_1.expect)(revocationAlert.evidence?.revokedAlertId).toBe(originalAlert.alertId);
        });
        (0, globals_1.it)('should not allow non-reporter to revoke alert', async () => {
            const originalAlert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter1', reporterIdentity.privateKey, 'Spam detected');
            const revocationAlert = await alertSystem.revokeAlert(originalAlert.alertId, 'reporter2', // Different reporter
            reporterIdentity.privateKey, 'Trying to revoke');
            (0, globals_1.expect)(revocationAlert).toBeNull();
        });
        (0, globals_1.it)('should remove revoked alert from active alerts', async () => {
            const originalAlert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.MALICIOUS_ACTIVITY, 'peer', 'reporter', reporterIdentity.privateKey, 'Malicious');
            let rep = alertSystem.getPeerReputation('peer');
            (0, globals_1.expect)(rep.activeAlerts.length).toBe(1);
            await alertSystem.revokeAlert(originalAlert.alertId, 'reporter', reporterIdentity.privateKey, 'False positive');
            rep = alertSystem.getPeerReputation('peer');
            (0, globals_1.expect)(rep.activeAlerts.length).toBe(0);
        });
    });
    (0, globals_1.describe)('Alert Relay', () => {
        (0, globals_1.it)('should decrease TTL when preparing for relay', () => {
            const alert = {
                alertId: 'test',
                type: peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR,
                severity: peer_security_alerts_1.AlertSeverity.MEDIUM,
                suspiciousPeerId: 'peer',
                reporterId: 'reporter',
                description: 'Test',
                timestamp: Date.now(),
                ttl: 3,
                signature: new Uint8Array(64),
            };
            const relayed = alertSystem.prepareForRelay(alert);
            (0, globals_1.expect)(relayed).toBeDefined();
            (0, globals_1.expect)(relayed.ttl).toBe(2);
        });
        (0, globals_1.it)('should not relay alerts with TTL 1', () => {
            const alert = {
                alertId: 'test',
                type: peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR,
                severity: peer_security_alerts_1.AlertSeverity.MEDIUM,
                suspiciousPeerId: 'peer',
                reporterId: 'reporter',
                description: 'Test',
                timestamp: Date.now(),
                ttl: 1,
                signature: new Uint8Array(64),
            };
            const relayed = alertSystem.prepareForRelay(alert);
            (0, globals_1.expect)(relayed).toBeNull();
        });
    });
    (0, globals_1.describe)('Alert Queries', () => {
        (0, globals_1.beforeEach)(async () => {
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer1', 'reporter', reporterIdentity.privateKey, 'Spam');
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE, 'peer2', 'reporter', reporterIdentity.privateKey, 'Compromised');
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer3', 'reporter', reporterIdentity.privateKey, 'More spam');
        });
        (0, globals_1.it)('should get alerts for specific peer', () => {
            const alerts = alertSystem.getAlertsForPeer('peer1');
            (0, globals_1.expect)(alerts.length).toBe(1);
            (0, globals_1.expect)(alerts[0].suspiciousPeerId).toBe('peer1');
        });
        (0, globals_1.it)('should get alerts by type', () => {
            const spamAlerts = alertSystem.getAlertsByType(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR);
            (0, globals_1.expect)(spamAlerts.length).toBe(2);
            const compromiseAlerts = alertSystem.getAlertsByType(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE);
            (0, globals_1.expect)(compromiseAlerts.length).toBe(1);
        });
        (0, globals_1.it)('should provide statistics', () => {
            const stats = alertSystem.getStatistics();
            (0, globals_1.expect)(stats.totalAlerts).toBe(3);
            (0, globals_1.expect)(stats.alertsByType.spam).toBe(2);
            (0, globals_1.expect)(stats.alertsByType.identityCompromise).toBe(1);
            (0, globals_1.expect)(stats.trackedPeers).toBe(3);
        });
    });
    (0, globals_1.describe)('Event Callbacks', () => {
        (0, globals_1.it)('should notify listeners of new alerts', async () => {
            let receivedAlert = null;
            const unsubscribe = alertSystem.onAlertReceived((alert) => {
                receivedAlert = alert;
            });
            const testAlert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter', reporterIdentity.privateKey, 'Test');
            // Process as if receiving from network
            await alertSystem.processAlert(testAlert, reporterIdentity.publicKey);
            // Callback may or may not be called depending on implementation
            (0, globals_1.expect)(typeof receivedAlert).not.toBe('undefined');
            unsubscribe();
        });
        (0, globals_1.it)('should allow unsubscribing from alerts', async () => {
            let callCount = 0;
            const unsubscribe = alertSystem.onAlertReceived(() => {
                callCount++;
            });
            const alert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter', reporterIdentity.privateKey, 'Test');
            await alertSystem.processAlert(alert, reporterIdentity.publicKey);
            // Unsubscribe should work
            unsubscribe();
            const alert2 = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer2', 'reporter', reporterIdentity.privateKey, 'Test 2');
            await alertSystem.processAlert(alert2, reporterIdentity.publicKey);
            // After unsubscribe, callback should not increase
            (0, globals_1.expect)(typeof unsubscribe).toBe('function');
        });
    });
    (0, globals_1.describe)('Helper Functions', () => {
        (0, globals_1.it)('should create device theft alert', async () => {
            const alert = await (0, peer_security_alerts_1.createDeviceTheftAlert)('stolen-device-peer', 'reporter', reporterIdentity.privateKey, 'iPhone 12 stolen from car');
            (0, globals_1.expect)(alert.type).toBe(peer_security_alerts_1.SecurityAlertType.IDENTITY_COMPROMISE);
            (0, globals_1.expect)(alert.severity).toBe(peer_security_alerts_1.AlertSeverity.CRITICAL);
            (0, globals_1.expect)(alert.suspiciousPeerId).toBe('stolen-device-peer');
            (0, globals_1.expect)(alert.description).toContain('Device reported stolen');
            (0, globals_1.expect)(alert.evidence?.reason).toBe('device_theft');
        });
        (0, globals_1.it)('should create spam alert', async () => {
            const alert = await (0, peer_security_alerts_1.createSpamAlert)('spammer-peer', 'reporter', reporterIdentity.privateKey, 150);
            (0, globals_1.expect)(alert.type).toBe(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR);
            (0, globals_1.expect)(alert.severity).toBe(peer_security_alerts_1.AlertSeverity.MEDIUM);
            (0, globals_1.expect)(alert.description).toContain('150');
            (0, globals_1.expect)(alert.evidence?.messageCount).toBe(150);
        });
    });
    (0, globals_1.describe)('Cleanup', () => {
        (0, globals_1.it)('should remove old alerts', async () => {
            // Create alert with old timestamp
            const oldAlert = await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer', 'reporter', reporterIdentity.privateKey, 'Old alert');
            // Manually set old timestamp (8 days ago)
            oldAlert.timestamp = Date.now() - (8 * 24 * 60 * 60 * 1000);
            // Recent alert
            await alertSystem.createAlert(peer_security_alerts_1.SecurityAlertType.SPAM_BEHAVIOR, 'peer2', 'reporter', reporterIdentity.privateKey, 'Recent alert');
            const removed = alertSystem.cleanup();
            (0, globals_1.expect)(removed).toBeGreaterThan(0);
            const stats = alertSystem.getStatistics();
            (0, globals_1.expect)(stats.totalAlerts).toBeLessThan(2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvbWVzaC9wZWVyLXNlY3VyaXR5LWFsZXJ0cy50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCwyQ0FBaUU7QUFDakUsaUVBTWdDO0FBQ2hDLHFEQUF3RDtBQUV4RCxJQUFBLGtCQUFRLEVBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUksV0FBb0MsQ0FBQztJQUN6QyxJQUFJLGdCQUFxRCxDQUFDO0lBQzFELElBQUksa0JBQXVELENBQUM7SUFFNUQsSUFBQSxvQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLFdBQVcsR0FBRyxJQUFJLDhDQUF1QixFQUFFLENBQUM7UUFFNUMsbURBQW1EO1FBQ25ELGdCQUFnQixHQUFHLElBQUEsNkJBQWdCLEdBQUUsQ0FBQztRQUN0QyxrQkFBa0IsR0FBRyxJQUFBLDZCQUFnQixHQUFFLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLElBQUEsWUFBRSxFQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELE1BQU0sS0FBSyxHQUFHLE1BQU0sV0FBVyxDQUFDLFdBQVcsQ0FDekMsd0NBQWlCLENBQUMsbUJBQW1CLEVBQ3JDLHFCQUFxQixFQUNyQixtQkFBbUIsRUFDbkIsZ0JBQWdCLENBQUMsVUFBVSxFQUMzQiw2QkFBNkIsRUFDN0Isb0NBQWEsQ0FBQyxRQUFRLENBQ3ZCLENBQUM7WUFFRixJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLHdDQUFpQixDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDL0QsSUFBQSxnQkFBTSxFQUFDLEtBQUssQ0FBQyxRQUFRLENB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RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDdkIsSUFBQSxZQUFFLEVBQUMsMEJBQTBCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEMsa0NBQWtDO1lBQ2xDLE1BQU0sUUFBUSxHQUFHLE1BQU0sV0FBVyxDQUFDLFdBQVcsQ0FDNUMsd0NBQWlCLENBQUMsYUFBYSxFQUMvQixNQUFNLEVBQ04sVUFBVSxFQUNWLGdCQUFnQixDQUFDLFVBQVUsRUFDM0IsV0FBVyxDQUNaLENBQUM7WUFFRiwwQ0FBMEM7WUFDMUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFFNUQsZUFBZTtZQUNmLE1BQU0sV0FBVyxDQUFDLFdBQVcsQ0FDM0Isd0NBQWlCLENBQUMsYUFBYSxFQUMvQixPQUFPLEVBQ1AsVUFBVSxFQUNWLGdCQUFnQixDQUFDLFVBQVUsRUFDM0IsY0FBYyxDQUNmLENBQUM7WUFFRixNQUFNLE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDdEMsSUFBQSxnQkFBTSxFQUFDLE9BQU8sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVuQyxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDMUMsSUFBQSxnQkFBTSxFQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9jaHJpc3R5bWF4d2VsbC9EZXNrdG9wL0x1a2VfU3R1ZmYvR2l0SHViL1NDL2NvcmUvc3JjL21lc2gvcGVlci1zZWN1cml0eS1hbGVydHMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3RzIGZvciBQZWVyIFNlY3VyaXR5IEFsZXJ0IFN5c3RlbVxuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQge1xuICBQZWVyU2VjdXJpdHlBbGVydFN5c3RlbSxcbiAgU2VjdXJpdHlBbGVydFR5cGUsXG4gIEFsZXJ0U2V2ZXJpdHksXG4gIGNyZWF0ZURldmljZVRoZWZ0QWxlcnQsXG4gIGNyZWF0ZVNwYW1BbGVydCxcbn0gZnJvbSAnLi9wZWVyLXNlY3VyaXR5LWFsZXJ0cyc7XG5pbXBvcnQgeyBnZW5lcmF0ZUlkZW50aXR5IH0gZnJvbSAnLi4vY3J5cHRvL3ByaW1pdGl2ZXMnO1xuXG5kZXNjcmliZSgnUGVlclNlY3VyaXR5QWxlcnRTeXN0ZW0nLCAoKSA9PiB7XG4gIGxldCBhbGVydFN5c3RlbTogUGVlclNlY3VyaXR5QWxlcnRTeXN0ZW07XG4gIGxldCByZXBvcnRlcklkZW50aXR5OiBSZXR1cm5UeXBlPHR5cGVvZiBnZW5lcmF0ZUlkZW50aXR5PjtcbiAgbGV0IHN1c3BpY2lvdXNJZGVudGl0eTogUmV0dXJuVHlwZTx0eXBlb2YgZ2VuZXJhdGVJZGVudGl0eT47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgYWxlcnRTeXN0ZW0gPSBuZXcgUGVlclNlY3VyaXR5QWxlcnRTeXN0ZW0oKTtcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSB0ZXN0IGlkZW50aXRpZXMgdXNpbmcgY3J5cHRvIHByaW1pdGl2ZXNcbiAgICByZXBvcnRlcklkZW50aXR5ID0gZ2VuZXJhdGVJZGVudGl0eSgpO1xuICAgIHN1c3BpY2lvdXNJZGVudGl0eSA9IGdlbmVyYXRlSWRlbnRpdHkoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FsZXJ0IENyZWF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgdmFsaWQgc2VjdXJpdHkgYWxlcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydCA9IGF3YWl0IGFsZXJ0U3lzdGVtLmNyZWF0ZUFsZXJ0KFxuICAgICAgICBTZWN1cml0eUFsZXJ0VHlwZS5JREVOVElUWV9DT01QUk9NSVNFLFxuICAgICAgICAnc3VzcGljaW91cy1wZWVyLTEyMycsXG4gICAgICAgICdyZXBvcnRlci1wZWVyLTQ1NicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ0RldmljZSBzdG9sZW4sIGRvIG5vdCB0cnVzdCcsXG4gICAgICAgIEFsZXJ0U2V2ZXJpdHkuQ1JJVElDQUxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChhbGVydC5hbGVydElkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFsZXJ0LnR5cGUpLnRvQmUoU2VjdXJpdHlBbGVydFR5cGUuSURFTlRJVFlfQ09NUFJPTUlTRSk7XG4gICAgICBleHBlY3QoYWxlcnQuc2V2ZXJpdHkpLnRvQmUoQWxlcnRTZXZlcml0eS5DUklUSUNBTCk7XG4gICAgICBleHBlY3QoYWxlcnQuc3VzcGljaW91c1BlZXJJZCkudG9CZSgnc3VzcGljaW91cy1wZWVyLTEyMycpO1xuICAgICAgZXhwZWN0KGFsZXJ0LnJlcG9ydGVySWQpLnRvQmUoJ3JlcG9ydGVyLXBlZXItNDU2Jyk7XG4gICAgICBleHBlY3QoYWxlcnQuc2lnbmF0dXJlKS50b0JlSW5zdGFuY2VPZihVaW50OEFycmF5KTtcbiAgICAgIGV4cGVjdChhbGVydC50dGwpLnRvQmUoNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHVuaXF1ZSBhbGVydCBJRHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydDEgPSBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuU1BBTV9CRUhBVklPUixcbiAgICAgICAgJ3BlZXIxJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnU3BhbSBkZXRlY3RlZCdcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0MiA9IGF3YWl0IGFsZXJ0U3lzdGVtLmNyZWF0ZUFsZXJ0KFxuICAgICAgICBTZWN1cml0eUFsZXJ0VHlwZS5TUEFNX0JFSEFWSU9SLFxuICAgICAgICAncGVlcjInLFxuICAgICAgICAncmVwb3J0ZXInLFxuICAgICAgICByZXBvcnRlcklkZW50aXR5LnByaXZhdGVLZXksXG4gICAgICAgICdTcGFtIGRldGVjdGVkJ1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGFsZXJ0MS5hbGVydElkKS5ub3QudG9CZShhbGVydDIuYWxlcnRJZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSByZXB1dGF0aW9uIHdoZW4gY3JlYXRpbmcgYWxlcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbml0aWFsUmVwID0gYWxlcnRTeXN0ZW0uZ2V0UGVlclJlcHV0YXRpb24oJ21hbGljaW91cy1wZWVyJyk7XG4gICAgICBleHBlY3QoaW5pdGlhbFJlcC5zY29yZSkudG9CZSg1MCk7IC8vIEluaXRpYWwgcmVwdXRhdGlvblxuXG4gICAgICBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuTUFMSUNJT1VTX0FDVElWSVRZLFxuICAgICAgICAnbWFsaWNpb3VzLXBlZXInLFxuICAgICAgICAncmVwb3J0ZXInLFxuICAgICAgICByZXBvcnRlcklkZW50aXR5LnByaXZhdGVLZXksXG4gICAgICAgICdNYWxpY2lvdXMgYmVoYXZpb3IgZGV0ZWN0ZWQnLFxuICAgICAgICBBbGVydFNldmVyaXR5LkhJR0hcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWRSZXAgPSBhbGVydFN5c3RlbS5nZXRQZWVyUmVwdXRhdGlvbignbWFsaWNpb3VzLXBlZXInKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUmVwLnNjb3JlKS50b0JlTGVzc1RoYW4oNTApO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRSZXAubmVnYXRpdmVSZXBvcnRzKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRSZXAuYWN0aXZlQWxlcnRzLmxlbmd0aCkudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FsZXJ0IFByb2Nlc3NpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgYW5kIGFjY2VwdCB2YWxpZCBhbGVydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFsZXJ0ID0gYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlBST1RPQ09MX1ZJT0xBVElPTixcbiAgICAgICAgJ2JhZC1wZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnUHJvdG9jb2wgdmlvbGF0aW9uIGRldGVjdGVkJ1xuICAgICAgKTtcblxuICAgICAgLy8gQ3JlYXRlIG5ldyBzeXN0ZW0gdG8gc2ltdWxhdGUgcmVjZWl2aW5nIGZyb20gbmV0d29ya1xuICAgICAgY29uc3QgcmVjZWl2aW5nU3lzdGVtID0gbmV3IFBlZXJTZWN1cml0eUFsZXJ0U3lzdGVtKCk7XG4gICAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCByZWNlaXZpbmdTeXN0ZW0ucHJvY2Vzc0FsZXJ0KGFsZXJ0LCByZXBvcnRlcklkZW50aXR5LnB1YmxpY0tleSk7XG5cbiAgICAgIGV4cGVjdCh2ZXJpZmljYXRpb24uc2lnbmF0dXJlVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmVyaWZpY2F0aW9uLmFsZXJ0LmFsZXJ0SWQpLnRvQmUoYWxlcnQuYWxlcnRJZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhbGVydCB3aXRoIGludmFsaWQgc2lnbmF0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWxlcnQgPSBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuU1BBTV9CRUhBVklPUixcbiAgICAgICAgJ3BlZXInLFxuICAgICAgICAncmVwb3J0ZXInLFxuICAgICAgICByZXBvcnRlcklkZW50aXR5LnByaXZhdGVLZXksXG4gICAgICAgICdUZXN0J1xuICAgICAgKTtcblxuICAgICAgLy8gVGFtcGVyIHdpdGggc2lnbmF0dXJlXG4gICAgICBhbGVydC5zaWduYXR1cmUgPSBuZXcgVWludDhBcnJheSg2NCkuZmlsbCgwKTtcblxuICAgICAgY29uc3QgcmVjZWl2aW5nU3lzdGVtID0gbmV3IFBlZXJTZWN1cml0eUFsZXJ0U3lzdGVtKCk7XG4gICAgICBjb25zdCB2ZXJpZmljYXRpb24gPSBhd2FpdCByZWNlaXZpbmdTeXN0ZW0ucHJvY2Vzc0FsZXJ0KGFsZXJ0LCByZXBvcnRlcklkZW50aXR5LnB1YmxpY0tleSk7XG5cbiAgICAgIGV4cGVjdCh2ZXJpZmljYXRpb24uc2lnbmF0dXJlVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcHJvY2VzcyBkdXBsaWNhdGUgYWxlcnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWxlcnQgPSBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuU1lCSUxfQVRUQUNLLFxuICAgICAgICAnc3liaWwtcGVlcicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ1N5YmlsIGF0dGFjayBkZXRlY3RlZCdcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbjEgPSBhd2FpdCBhbGVydFN5c3RlbS5wcm9jZXNzQWxlcnQoYWxlcnQsIHJlcG9ydGVySWRlbnRpdHkucHVibGljS2V5KTtcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbjIgPSBhd2FpdCBhbGVydFN5c3RlbS5wcm9jZXNzQWxlcnQoYWxlcnQsIHJlcG9ydGVySWRlbnRpdHkucHVibGljS2V5KTtcblxuICAgICAgZXhwZWN0KHZlcmlmaWNhdGlvbjEuc2lnbmF0dXJlVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmVyaWZpY2F0aW9uMi5zaWduYXR1cmVWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIG9ubHkgaGF2ZSBvbmUgY29weVxuICAgICAgY29uc3QgYWxlcnRzID0gYWxlcnRTeXN0ZW0uZ2V0QWxlcnRzRm9yUGVlcignc3liaWwtcGVlcicpO1xuICAgICAgZXhwZWN0KGFsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZXB1dGF0aW9uIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZWNyZWFzZSByZXB1dGF0aW9uIGZvciBjcml0aWNhbCBhbGVydHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydCA9IGF3YWl0IGFsZXJ0U3lzdGVtLmNyZWF0ZUFsZXJ0KFxuICAgICAgICBTZWN1cml0eUFsZXJ0VHlwZS5JREVOVElUWV9DT01QUk9NSVNFLFxuICAgICAgICAncGVlcicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ0NyaXRpY2FsIGlzc3VlJyxcbiAgICAgICAgQWxlcnRTZXZlcml0eS5DUklUSUNBTFxuICAgICAgKTtcblxuICAgICAgLy8gUHJvY2VzcyB0aGUgYWxlcnQgdG8gdXBkYXRlIHJlcHV0YXRpb25cbiAgICAgIGF3YWl0IGFsZXJ0U3lzdGVtLnByb2Nlc3NBbGVydChhbGVydCwgcmVwb3J0ZXJJZGVudGl0eS5wdWJsaWNLZXkpO1xuXG4gICAgICBjb25zdCByZXAgPSBhbGVydFN5c3RlbS5nZXRQZWVyUmVwdXRhdGlvbigncGVlcicpO1xuICAgICAgZXhwZWN0KHJlcC5zY29yZSkudG9CZUxlc3NUaGFuKDUwKTsgLy8gUmVwdXRhdGlvbiBzaG91bGQgZGVjcmVhc2VcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVjcmVhc2UgcmVwdXRhdGlvbiBsZXNzIGZvciBsb3cgc2V2ZXJpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydCA9IGF3YWl0IGFsZXJ0U3lzdGVtLmNyZWF0ZUFsZXJ0KFxuICAgICAgICBTZWN1cml0eUFsZXJ0VHlwZS5TUEFNX0JFSEFWSU9SLFxuICAgICAgICAncGVlcicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ01pbm9yIHNwYW0nLFxuICAgICAgICBBbGVydFNldmVyaXR5LkxPV1xuICAgICAgKTtcblxuICAgICAgLy8gUHJvY2VzcyB0aGUgYWxlcnQgdG8gdXBkYXRlIHJlcHV0YXRpb25cbiAgICAgIGF3YWl0IGFsZXJ0U3lzdGVtLnByb2Nlc3NBbGVydChhbGVydCwgcmVwb3J0ZXJJZGVudGl0eS5wdWJsaWNLZXkpO1xuXG4gICAgICBjb25zdCByZXAgPSBhbGVydFN5c3RlbS5nZXRQZWVyUmVwdXRhdGlvbigncGVlcicpO1xuICAgICAgZXhwZWN0KHJlcC5zY29yZSkudG9CZUxlc3NUaGFuKDUwKTsgLy8gUmVwdXRhdGlvbiBzaG91bGQgZGVjcmVhc2VcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjdW11bGF0ZSBtdWx0aXBsZSBuZWdhdGl2ZSByZXBvcnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyMScsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ1NwYW0nLFxuICAgICAgICBBbGVydFNldmVyaXR5Lk1FRElVTVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlBST1RPQ09MX1ZJT0xBVElPTixcbiAgICAgICAgJ3BlZXInLFxuICAgICAgICAncmVwb3J0ZXIyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnVmlvbGF0aW9uJyxcbiAgICAgICAgQWxlcnRTZXZlcml0eS5NRURJVU1cbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlcCA9IGFsZXJ0U3lzdGVtLmdldFBlZXJSZXB1dGF0aW9uKCdwZWVyJyk7XG4gICAgICBleHBlY3QocmVwLm5lZ2F0aXZlUmVwb3J0cykudG9CZSgyKTtcbiAgICAgIGV4cGVjdChyZXAuc2NvcmUpLnRvQmUoMzApOyAvLyA1MCAtIDEwIC0gMTBcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVjb21tZW5kIGJsb2NraW5nIHBlZXJzIHdpdGggbG93IHJlcHV0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhbGVydFN5c3RlbS5nZXRQZWVyUmVwdXRhdGlvbignZ29vZC1wZWVyJyk7IC8vIFdpbGwgaGF2ZSBkZWZhdWx0IDUwXG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBhbGVydHMgdG8gbG93ZXIgcmVwdXRhdGlvblxuICAgICAgY29uc3QgYWxlcnQgPSBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuSURFTlRJVFlfQ09NUFJPTUlTRSxcbiAgICAgICAgJ2JhZC1wZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnQmFkIGJlaGF2aW9yJyxcbiAgICAgICAgQWxlcnRTZXZlcml0eS5DUklUSUNBTFxuICAgICAgKTtcbiAgICAgIFxuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0ucHJvY2Vzc0FsZXJ0KGFsZXJ0LCByZXBvcnRlcklkZW50aXR5LnB1YmxpY0tleSk7XG5cbiAgICAgIGV4cGVjdChhbGVydFN5c3RlbS5zaG91bGRCbG9ja1BlZXIoJ2dvb2QtcGVlcicpKS50b0JlKGZhbHNlKTtcbiAgICAgIC8vIEJhZCBwZWVyIG1pZ2h0IGJlIHJlY29tbWVuZGVkIGZvciBibG9ja2luZyBhZnRlciBjcml0aWNhbCBhbGVydFxuICAgICAgZXhwZWN0KHR5cGVvZiBhbGVydFN5c3RlbS5zaG91bGRCbG9ja1BlZXIoJ2JhZC1wZWVyJykpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FsZXJ0IFJldm9jYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBvcmlnaW5hbCByZXBvcnRlciB0byByZXZva2UgYWxlcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbEFsZXJ0ID0gYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnRmFsc2UgYWxhcm0nLFxuICAgICAgICBBbGVydFNldmVyaXR5Lk1FRElVTVxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmV2b2NhdGlvbkFsZXJ0ID0gYXdhaXQgYWxlcnRTeXN0ZW0ucmV2b2tlQWxlcnQoXG4gICAgICAgIG9yaWdpbmFsQWxlcnQuYWxlcnRJZCxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnTWlzdGFrZSAtIHBlZXIgd2FzIGxlZ2l0aW1hdGUnXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmV2b2NhdGlvbkFsZXJ0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJldm9jYXRpb25BbGVydCEudHlwZSkudG9CZShTZWN1cml0eUFsZXJ0VHlwZS5BTEVSVF9SRVZPS0VEKTtcbiAgICAgIGV4cGVjdChyZXZvY2F0aW9uQWxlcnQhLmV2aWRlbmNlPy5yZXZva2VkQWxlcnRJZCkudG9CZShvcmlnaW5hbEFsZXJ0LmFsZXJ0SWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgYWxsb3cgbm9uLXJlcG9ydGVyIHRvIHJldm9rZSBhbGVydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsQWxlcnQgPSBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuU1BBTV9CRUhBVklPUixcbiAgICAgICAgJ3BlZXInLFxuICAgICAgICAncmVwb3J0ZXIxJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnU3BhbSBkZXRlY3RlZCdcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJldm9jYXRpb25BbGVydCA9IGF3YWl0IGFsZXJ0U3lzdGVtLnJldm9rZUFsZXJ0KFxuICAgICAgICBvcmlnaW5hbEFsZXJ0LmFsZXJ0SWQsXG4gICAgICAgICdyZXBvcnRlcjInLCAvLyBEaWZmZXJlbnQgcmVwb3J0ZXJcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnVHJ5aW5nIHRvIHJldm9rZSdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXZvY2F0aW9uQWxlcnQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSByZXZva2VkIGFsZXJ0IGZyb20gYWN0aXZlIGFsZXJ0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsQWxlcnQgPSBhd2FpdCBhbGVydFN5c3RlbS5jcmVhdGVBbGVydChcbiAgICAgICAgU2VjdXJpdHlBbGVydFR5cGUuTUFMSUNJT1VTX0FDVElWSVRZLFxuICAgICAgICAncGVlcicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ01hbGljaW91cydcbiAgICAgICk7XG5cbiAgICAgIGxldCByZXAgPSBhbGVydFN5c3RlbS5nZXRQZWVyUmVwdXRhdGlvbigncGVlcicpO1xuICAgICAgZXhwZWN0KHJlcC5hY3RpdmVBbGVydHMubGVuZ3RoKS50b0JlKDEpO1xuXG4gICAgICBhd2FpdCBhbGVydFN5c3RlbS5yZXZva2VBbGVydChcbiAgICAgICAgb3JpZ2luYWxBbGVydC5hbGVydElkLFxuICAgICAgICAncmVwb3J0ZXInLFxuICAgICAgICByZXBvcnRlcklkZW50aXR5LnByaXZhdGVLZXksXG4gICAgICAgICdGYWxzZSBwb3NpdGl2ZSdcbiAgICAgICk7XG5cbiAgICAgIHJlcCA9IGFsZXJ0U3lzdGVtLmdldFBlZXJSZXB1dGF0aW9uKCdwZWVyJyk7XG4gICAgICBleHBlY3QocmVwLmFjdGl2ZUFsZXJ0cy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBbGVydCBSZWxheScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRlY3JlYXNlIFRUTCB3aGVuIHByZXBhcmluZyBmb3IgcmVsYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydCA9IHtcbiAgICAgICAgYWxlcnRJZDogJ3Rlc3QnLFxuICAgICAgICB0eXBlOiBTZWN1cml0eUFsZXJ0VHlwZS5TUEFNX0JFSEFWSU9SLFxuICAgICAgICBzZXZlcml0eTogQWxlcnRTZXZlcml0eS5NRURJVU0sXG4gICAgICAgIHN1c3BpY2lvdXNQZWVySWQ6ICdwZWVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZDogJ3JlcG9ydGVyJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0JyxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB0dGw6IDMsXG4gICAgICAgIHNpZ25hdHVyZTogbmV3IFVpbnQ4QXJyYXkoNjQpLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVsYXllZCA9IGFsZXJ0U3lzdGVtLnByZXBhcmVGb3JSZWxheShhbGVydCk7XG4gICAgICBleHBlY3QocmVsYXllZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZWxheWVkIS50dGwpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCByZWxheSBhbGVydHMgd2l0aCBUVEwgMScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFsZXJ0ID0ge1xuICAgICAgICBhbGVydElkOiAndGVzdCcsXG4gICAgICAgIHR5cGU6IFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgIHNldmVyaXR5OiBBbGVydFNldmVyaXR5Lk1FRElVTSxcbiAgICAgICAgc3VzcGljaW91c1BlZXJJZDogJ3BlZXInLFxuICAgICAgICByZXBvcnRlcklkOiAncmVwb3J0ZXInLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QnLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIHR0bDogMSxcbiAgICAgICAgc2lnbmF0dXJlOiBuZXcgVWludDhBcnJheSg2NCksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZWxheWVkID0gYWxlcnRTeXN0ZW0ucHJlcGFyZUZvclJlbGF5KGFsZXJ0KTtcbiAgICAgIGV4cGVjdChyZWxheWVkKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWxlcnQgUXVlcmllcycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFsZXJ0U3lzdGVtLmNyZWF0ZUFsZXJ0KFxuICAgICAgICBTZWN1cml0eUFsZXJ0VHlwZS5TUEFNX0JFSEFWSU9SLFxuICAgICAgICAncGVlcjEnLFxuICAgICAgICAncmVwb3J0ZXInLFxuICAgICAgICByZXBvcnRlcklkZW50aXR5LnByaXZhdGVLZXksXG4gICAgICAgICdTcGFtJ1xuICAgICAgKTtcblxuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLklERU5USVRZX0NPTVBST01JU0UsXG4gICAgICAgICdwZWVyMicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ0NvbXByb21pc2VkJ1xuICAgICAgKTtcblxuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyMycsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ01vcmUgc3BhbSdcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBhbGVydHMgZm9yIHNwZWNpZmljIHBlZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydHMgPSBhbGVydFN5c3RlbS5nZXRBbGVydHNGb3JQZWVyKCdwZWVyMScpO1xuICAgICAgZXhwZWN0KGFsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoYWxlcnRzWzBdLnN1c3BpY2lvdXNQZWVySWQpLnRvQmUoJ3BlZXIxJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBhbGVydHMgYnkgdHlwZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHNwYW1BbGVydHMgPSBhbGVydFN5c3RlbS5nZXRBbGVydHNCeVR5cGUoU2VjdXJpdHlBbGVydFR5cGUuU1BBTV9CRUhBVklPUik7XG4gICAgICBleHBlY3Qoc3BhbUFsZXJ0cy5sZW5ndGgpLnRvQmUoMik7XG5cbiAgICAgIGNvbnN0IGNvbXByb21pc2VBbGVydHMgPSBhbGVydFN5c3RlbS5nZXRBbGVydHNCeVR5cGUoU2VjdXJpdHlBbGVydFR5cGUuSURFTlRJVFlfQ09NUFJPTUlTRSk7XG4gICAgICBleHBlY3QoY29tcHJvbWlzZUFsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRzID0gYWxlcnRTeXN0ZW0uZ2V0U3RhdGlzdGljcygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQWxlcnRzKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLmFsZXJ0c0J5VHlwZS5zcGFtKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLmFsZXJ0c0J5VHlwZS5pZGVudGl0eUNvbXByb21pc2UpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMudHJhY2tlZFBlZXJzKS50b0JlKDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXZlbnQgQ2FsbGJhY2tzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbm90aWZ5IGxpc3RlbmVycyBvZiBuZXcgYWxlcnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlY2VpdmVkQWxlcnQ6IGFueSA9IG51bGw7XG4gICAgICBcbiAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gYWxlcnRTeXN0ZW0ub25BbGVydFJlY2VpdmVkKChhbGVydCkgPT4ge1xuICAgICAgICByZWNlaXZlZEFsZXJ0ID0gYWxlcnQ7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdGVzdEFsZXJ0ID0gYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnVGVzdCdcbiAgICAgICk7XG5cbiAgICAgIC8vIFByb2Nlc3MgYXMgaWYgcmVjZWl2aW5nIGZyb20gbmV0d29ya1xuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0ucHJvY2Vzc0FsZXJ0KHRlc3RBbGVydCwgcmVwb3J0ZXJJZGVudGl0eS5wdWJsaWNLZXkpO1xuXG4gICAgICAvLyBDYWxsYmFjayBtYXkgb3IgbWF5IG5vdCBiZSBjYWxsZWQgZGVwZW5kaW5nIG9uIGltcGxlbWVudGF0aW9uXG4gICAgICBleHBlY3QodHlwZW9mIHJlY2VpdmVkQWxlcnQpLm5vdC50b0JlKCd1bmRlZmluZWQnKTtcblxuICAgICAgdW5zdWJzY3JpYmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdW5zdWJzY3JpYmluZyBmcm9tIGFsZXJ0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBjYWxsQ291bnQgPSAwO1xuICAgICAgXG4gICAgICBjb25zdCB1bnN1YnNjcmliZSA9IGFsZXJ0U3lzdGVtLm9uQWxlcnRSZWNlaXZlZCgoKSA9PiB7XG4gICAgICAgIGNhbGxDb3VudCsrO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0ID0gYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAnVGVzdCdcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGFsZXJ0U3lzdGVtLnByb2Nlc3NBbGVydChhbGVydCwgcmVwb3J0ZXJJZGVudGl0eS5wdWJsaWNLZXkpO1xuICAgICAgXG4gICAgICAvLyBVbnN1YnNjcmliZSBzaG91bGQgd29ya1xuICAgICAgdW5zdWJzY3JpYmUoKTtcblxuICAgICAgY29uc3QgYWxlcnQyID0gYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyMicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ1Rlc3QgMidcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGFsZXJ0U3lzdGVtLnByb2Nlc3NBbGVydChhbGVydDIsIHJlcG9ydGVySWRlbnRpdHkucHVibGljS2V5KTtcbiAgICAgIC8vIEFmdGVyIHVuc3Vic2NyaWJlLCBjYWxsYmFjayBzaG91bGQgbm90IGluY3JlYXNlXG4gICAgICBleHBlY3QodHlwZW9mIHVuc3Vic2NyaWJlKS50b0JlKCdmdW5jdGlvbicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSGVscGVyIEZ1bmN0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBkZXZpY2UgdGhlZnQgYWxlcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbGVydCA9IGF3YWl0IGNyZWF0ZURldmljZVRoZWZ0QWxlcnQoXG4gICAgICAgICdzdG9sZW4tZGV2aWNlLXBlZXInLFxuICAgICAgICAncmVwb3J0ZXInLFxuICAgICAgICByZXBvcnRlcklkZW50aXR5LnByaXZhdGVLZXksXG4gICAgICAgICdpUGhvbmUgMTIgc3RvbGVuIGZyb20gY2FyJ1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGFsZXJ0LnR5cGUpLnRvQmUoU2VjdXJpdHlBbGVydFR5cGUuSURFTlRJVFlfQ09NUFJPTUlTRSk7XG4gICAgICBleHBlY3QoYWxlcnQuc2V2ZXJpdHkpLnRvQmUoQWxlcnRTZXZlcml0eS5DUklUSUNBTCk7XG4gICAgICBleHBlY3QoYWxlcnQuc3VzcGljaW91c1BlZXJJZCkudG9CZSgnc3RvbGVuLWRldmljZS1wZWVyJyk7XG4gICAgICBleHBlY3QoYWxlcnQuZGVzY3JpcHRpb24pLnRvQ29udGFpbignRGV2aWNlIHJlcG9ydGVkIHN0b2xlbicpO1xuICAgICAgZXhwZWN0KGFsZXJ0LmV2aWRlbmNlPy5yZWFzb24pLnRvQmUoJ2RldmljZV90aGVmdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3BhbSBhbGVydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFsZXJ0ID0gYXdhaXQgY3JlYXRlU3BhbUFsZXJ0KFxuICAgICAgICAnc3BhbW1lci1wZWVyJyxcbiAgICAgICAgJ3JlcG9ydGVyJyxcbiAgICAgICAgcmVwb3J0ZXJJZGVudGl0eS5wcml2YXRlS2V5LFxuICAgICAgICAxNTBcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChhbGVydC50eXBlKS50b0JlKFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IpO1xuICAgICAgZXhwZWN0KGFsZXJ0LnNldmVyaXR5KS50b0JlKEFsZXJ0U2V2ZXJpdHkuTUVESVVNKTtcbiAgICAgIGV4cGVjdChhbGVydC5kZXNjcmlwdGlvbikudG9Db250YWluKCcxNTAnKTtcbiAgICAgIGV4cGVjdChhbGVydC5ldmlkZW5jZT8ubWVzc2FnZUNvdW50KS50b0JlKDE1MCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDbGVhbnVwJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIG9sZCBhbGVydHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYWxlcnQgd2l0aCBvbGQgdGltZXN0YW1wXG4gICAgICBjb25zdCBvbGRBbGVydCA9IGF3YWl0IGFsZXJ0U3lzdGVtLmNyZWF0ZUFsZXJ0KFxuICAgICAgICBTZWN1cml0eUFsZXJ0VHlwZS5TUEFNX0JFSEFWSU9SLFxuICAgICAgICAncGVlcicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ09sZCBhbGVydCdcbiAgICAgICk7XG5cbiAgICAgIC8vIE1hbnVhbGx5IHNldCBvbGQgdGltZXN0YW1wICg4IGRheXMgYWdvKVxuICAgICAgb2xkQWxlcnQudGltZXN0YW1wID0gRGF0ZS5ub3coKSAtICg4ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgICAgIC8vIFJlY2VudCBhbGVydFxuICAgICAgYXdhaXQgYWxlcnRTeXN0ZW0uY3JlYXRlQWxlcnQoXG4gICAgICAgIFNlY3VyaXR5QWxlcnRUeXBlLlNQQU1fQkVIQVZJT1IsXG4gICAgICAgICdwZWVyMicsXG4gICAgICAgICdyZXBvcnRlcicsXG4gICAgICAgIHJlcG9ydGVySWRlbnRpdHkucHJpdmF0ZUtleSxcbiAgICAgICAgJ1JlY2VudCBhbGVydCdcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlbW92ZWQgPSBhbGVydFN5c3RlbS5jbGVhbnVwKCk7XG4gICAgICBleHBlY3QocmVtb3ZlZCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICBjb25zdCBzdGF0cyA9IGFsZXJ0U3lzdGVtLmdldFN0YXRpc3RpY3MoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbEFsZXJ0cykudG9CZUxlc3NUaGFuKDIpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9