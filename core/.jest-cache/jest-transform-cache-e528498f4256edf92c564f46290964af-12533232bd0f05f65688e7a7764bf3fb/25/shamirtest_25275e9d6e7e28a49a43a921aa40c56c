225fedc39849fbf99f7db4ebfe4b0d3a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const shamir_1 = require("./shamir");
describe("Shamir Secret Sharing", () => {
    it("should split and combine a secret correctly", () => {
        const secret = new Uint8Array([10, 20, 30, 40, 50]);
        const n = 5;
        const k = 3;
        const shares = (0, shamir_1.split)(secret, n, k);
        expect(shares.length).toBe(n);
        // Recover with all shares
        const recovered = (0, shamir_1.combine)(shares);
        expect(recovered).toEqual(secret);
    });
    it("should recover with exactly k shares", () => {
        const secret = new TextEncoder().encode("Hello World");
        const n = 5;
        const k = 3;
        const shares = (0, shamir_1.split)(secret, n, k);
        // Select 3 random shares
        const selectedShares = [shares[0], shares[2], shares[4]];
        const recovered = (0, shamir_1.combine)(selectedShares);
        expect(recovered).toEqual(secret);
    });
    it("should fail to recover with k-1 shares (produce garbage)", () => {
        const secret = new Uint8Array([1, 2, 3, 4, 5]);
        const n = 5;
        const k = 3;
        const shares = (0, shamir_1.split)(secret, n, k);
        // Select 2 shares (k-1)
        const selectedShares = [shares[0], shares[1]];
        const recovered = (0, shamir_1.combine)(selectedShares);
        // Should NOT match secret
        expect(recovered).not.toEqual(secret);
    });
    it("should handle k=1 (simple sharing)", () => {
        const secret = new Uint8Array([100]);
        const shares = (0, shamir_1.split)(secret, 3, 1);
        // Any single share should have the secret (y = c0 + 0) -> actually y = c0 is degree 0
        // Wait, degree for k=1 is k-1 = 0. So P(x) = c0.
        // So every share's y should be c0 (the secret).
        expect(shares[0].y).toEqual(secret);
        expect(shares[1].y).toEqual(secret);
        const recovered = (0, shamir_1.combine)([shares[0]]);
        expect(recovered).toEqual(secret);
    });
    it("should handle k=n", () => {
        const secret = new Uint8Array([255, 0, 128]);
        const n = 4;
        const shares = (0, shamir_1.split)(secret, n, n);
        const recovered = (0, shamir_1.combine)(shares);
        expect(recovered).toEqual(secret);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY3J5cHRvL3NoYW1pci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEscUNBQTBDO0FBRTFDLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDckMsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtRQUNyRCxNQUFNLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNaLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVaLE1BQU0sTUFBTSxHQUFHLElBQUEsY0FBSyxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFOUIsMEJBQTBCO1FBQzFCLE1BQU0sU0FBUyxHQUFHLElBQUEsZ0JBQU8sRUFBQyxNQUFNLENBQUMsQ0FBQztRQUNsQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtRQUM5QyxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUN2RCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDWixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDWixNQUFNLE1BQU0sR0FBRyxJQUFBLGNBQUssRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRW5DLHlCQUF5QjtRQUN6QixNQUFNLGNBQWMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekQsTUFBTSxTQUFTLEdBQUcsSUFBQSxnQkFBTyxFQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMERBQTBELEVBQUUsR0FBRyxFQUFFO1FBQ2xFLE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1osTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1osTUFBTSxNQUFNLEdBQUcsSUFBQSxjQUFLLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUVuQyx3QkFBd0I7UUFDeEIsTUFBTSxjQUFjLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUMsTUFBTSxTQUFTLEdBQUcsSUFBQSxnQkFBTyxFQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRTFDLDBCQUEwQjtRQUMxQixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7UUFDNUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sTUFBTSxHQUFHLElBQUEsY0FBSyxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFbkMsc0ZBQXNGO1FBQ3RGLGlEQUFpRDtRQUNqRCxnREFBZ0Q7UUFDaEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFcEMsTUFBTSxTQUFTLEdBQUcsSUFBQSxnQkFBTyxFQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2QyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUMzQixNQUFNLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDWixNQUFNLE1BQU0sR0FBRyxJQUFBLGNBQUssRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRW5DLE1BQU0sU0FBUyxHQUFHLElBQUEsZ0JBQU8sRUFBQyxNQUFNLENBQUMsQ0FBQztRQUNsQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY3J5cHRvL3NoYW1pci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNwbGl0LCBjb21iaW5lIH0gZnJvbSBcIi4vc2hhbWlyXCI7XG5cbmRlc2NyaWJlKFwiU2hhbWlyIFNlY3JldCBTaGFyaW5nXCIsICgpID0+IHtcbiAgaXQoXCJzaG91bGQgc3BsaXQgYW5kIGNvbWJpbmUgYSBzZWNyZXQgY29ycmVjdGx5XCIsICgpID0+IHtcbiAgICBjb25zdCBzZWNyZXQgPSBuZXcgVWludDhBcnJheShbMTAsIDIwLCAzMCwgNDAsIDUwXSk7XG4gICAgY29uc3QgbiA9IDU7XG4gICAgY29uc3QgayA9IDM7XG5cbiAgICBjb25zdCBzaGFyZXMgPSBzcGxpdChzZWNyZXQsIG4sIGspO1xuICAgIGV4cGVjdChzaGFyZXMubGVuZ3RoKS50b0JlKG4pO1xuXG4gICAgLy8gUmVjb3ZlciB3aXRoIGFsbCBzaGFyZXNcbiAgICBjb25zdCByZWNvdmVyZWQgPSBjb21iaW5lKHNoYXJlcyk7XG4gICAgZXhwZWN0KHJlY292ZXJlZCkudG9FcXVhbChzZWNyZXQpO1xuICB9KTtcblxuICBpdChcInNob3VsZCByZWNvdmVyIHdpdGggZXhhY3RseSBrIHNoYXJlc1wiLCAoKSA9PiB7XG4gICAgY29uc3Qgc2VjcmV0ID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKFwiSGVsbG8gV29ybGRcIik7XG4gICAgY29uc3QgbiA9IDU7XG4gICAgY29uc3QgayA9IDM7XG4gICAgY29uc3Qgc2hhcmVzID0gc3BsaXQoc2VjcmV0LCBuLCBrKTtcblxuICAgIC8vIFNlbGVjdCAzIHJhbmRvbSBzaGFyZXNcbiAgICBjb25zdCBzZWxlY3RlZFNoYXJlcyA9IFtzaGFyZXNbMF0sIHNoYXJlc1syXSwgc2hhcmVzWzRdXTtcbiAgICBjb25zdCByZWNvdmVyZWQgPSBjb21iaW5lKHNlbGVjdGVkU2hhcmVzKTtcbiAgICBleHBlY3QocmVjb3ZlcmVkKS50b0VxdWFsKHNlY3JldCk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGZhaWwgdG8gcmVjb3ZlciB3aXRoIGstMSBzaGFyZXMgKHByb2R1Y2UgZ2FyYmFnZSlcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHNlY3JldCA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgY29uc3QgbiA9IDU7XG4gICAgY29uc3QgayA9IDM7XG4gICAgY29uc3Qgc2hhcmVzID0gc3BsaXQoc2VjcmV0LCBuLCBrKTtcblxuICAgIC8vIFNlbGVjdCAyIHNoYXJlcyAoay0xKVxuICAgIGNvbnN0IHNlbGVjdGVkU2hhcmVzID0gW3NoYXJlc1swXSwgc2hhcmVzWzFdXTtcbiAgICBjb25zdCByZWNvdmVyZWQgPSBjb21iaW5lKHNlbGVjdGVkU2hhcmVzKTtcblxuICAgIC8vIFNob3VsZCBOT1QgbWF0Y2ggc2VjcmV0XG4gICAgZXhwZWN0KHJlY292ZXJlZCkubm90LnRvRXF1YWwoc2VjcmV0KTtcbiAgfSk7XG5cbiAgaXQoXCJzaG91bGQgaGFuZGxlIGs9MSAoc2ltcGxlIHNoYXJpbmcpXCIsICgpID0+IHtcbiAgICBjb25zdCBzZWNyZXQgPSBuZXcgVWludDhBcnJheShbMTAwXSk7XG4gICAgY29uc3Qgc2hhcmVzID0gc3BsaXQoc2VjcmV0LCAzLCAxKTtcblxuICAgIC8vIEFueSBzaW5nbGUgc2hhcmUgc2hvdWxkIGhhdmUgdGhlIHNlY3JldCAoeSA9IGMwICsgMCkgLT4gYWN0dWFsbHkgeSA9IGMwIGlzIGRlZ3JlZSAwXG4gICAgLy8gV2FpdCwgZGVncmVlIGZvciBrPTEgaXMgay0xID0gMC4gU28gUCh4KSA9IGMwLlxuICAgIC8vIFNvIGV2ZXJ5IHNoYXJlJ3MgeSBzaG91bGQgYmUgYzAgKHRoZSBzZWNyZXQpLlxuICAgIGV4cGVjdChzaGFyZXNbMF0ueSkudG9FcXVhbChzZWNyZXQpO1xuICAgIGV4cGVjdChzaGFyZXNbMV0ueSkudG9FcXVhbChzZWNyZXQpO1xuXG4gICAgY29uc3QgcmVjb3ZlcmVkID0gY29tYmluZShbc2hhcmVzWzBdXSk7XG4gICAgZXhwZWN0KHJlY292ZXJlZCkudG9FcXVhbChzZWNyZXQpO1xuICB9KTtcblxuICBpdChcInNob3VsZCBoYW5kbGUgaz1uXCIsICgpID0+IHtcbiAgICBjb25zdCBzZWNyZXQgPSBuZXcgVWludDhBcnJheShbMjU1LCAwLCAxMjhdKTtcbiAgICBjb25zdCBuID0gNDtcbiAgICBjb25zdCBzaGFyZXMgPSBzcGxpdChzZWNyZXQsIG4sIG4pO1xuXG4gICAgY29uc3QgcmVjb3ZlcmVkID0gY29tYmluZShzaGFyZXMpO1xuICAgIGV4cGVjdChyZWNvdmVyZWQpLnRvRXF1YWwoc2VjcmV0KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==