{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/proof-of-work.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/proof-of-work.ts"],"sourcesContent":["/**\n * Proof-of-Work (PoW) for Mesh Network Spam Prevention\n * \n * Implements HashCash-style proof-of-work to prevent spam flooding in the mesh network.\n * Messages must include a valid PoW solution to be relayed, making spam attacks\n * computationally expensive.\n * \n * Security Model:\n * - Each message requires computational work proportional to difficulty\n * - Difficulty adjustable based on network conditions\n * - Trusted peers can be exempted from PoW requirements\n * - Relay nodes can require higher difficulty than direct peers\n * \n * Trade-offs:\n * - Battery impact on mobile devices\n * - Message sending latency (difficulty dependent)\n * - Additional bandwidth for nonce field\n * \n * Configuration:\n * - Difficulty: 0-24 leading zero bits (default: 8)\n * - Optional: Can be disabled per peer\n * - Adaptive: Can increase during spam attacks\n */\n\nimport { sha256 } from '@noble/hashes/sha2.js';\n\n/**\n * Proof-of-Work challenge parameters\n */\nexport interface PoWChallenge {\n  /** Unix timestamp in milliseconds */\n  timestamp: number;\n  \n  /** Number of leading zero bits required (0-24) */\n  difficulty: number;\n  \n  /** Solution nonce */\n  nonce: number;\n  \n  /** Optional: Target recipient (prevents nonce reuse) */\n  target?: string;\n}\n\n/**\n * Proof-of-Work configuration\n */\nexport interface PoWConfig {\n  /** Default difficulty for messages (leading zero bits) */\n  defaultDifficulty: number;\n  \n  /** Higher difficulty for relay (messages not for us) */\n  relayDifficulty: number;\n  \n  /** Whether PoW is enabled */\n  enabled: boolean;\n  \n  /** Maximum time to compute PoW (ms) before giving up */\n  maxComputeTime: number;\n  \n  /** Exempt peers (by public key) */\n  exemptPeers: Set<string>;\n  \n  /** Adaptive difficulty during spam attacks */\n  adaptiveDifficulty: boolean;\n}\n\n/**\n * Default PoW configuration\n */\nexport const DEFAULT_POW_CONFIG: PoWConfig = {\n  defaultDifficulty: 8,      // ~256 hashes on average\n  relayDifficulty: 12,        // ~4096 hashes on average\n  enabled: true,\n  maxComputeTime: 5000,       // 5 seconds max\n  exemptPeers: new Set(),\n  adaptiveDifficulty: true\n};\n\n/**\n * Proof-of-Work manager for mesh network\n */\nexport class ProofOfWork {\n  private config: PoWConfig;\n  private stats = {\n    computeAttempts: 0,\n    computeSuccesses: 0,\n    verifyAttempts: 0,\n    verifySuccesses: 0,\n    totalComputeTime: 0,\n    adaptiveIncreases: 0\n  };\n  \n  constructor(config: Partial<PoWConfig> = {}) {\n    this.config = { ...DEFAULT_POW_CONFIG, ...config };\n  }\n  \n  /**\n   * Compute proof-of-work for a message\n   * \n   * @param message - Message bytes to compute PoW for\n   * @param difficulty - Optional difficulty override\n   * @param target - Optional target recipient\n   * @returns PoW challenge with valid nonce, or null if timeout\n   */\n  async computePoW(\n    message: Uint8Array,\n    difficulty?: number,\n    target?: string\n  ): Promise<PoWChallenge | null> {\n    if (!this.config.enabled) {\n      // PoW disabled, return dummy challenge\n      return {\n        timestamp: Date.now(),\n        difficulty: 0,\n        nonce: 0,\n        target\n      };\n    }\n    \n    const startTime = Date.now();\n    const actualDifficulty = difficulty ?? this.config.defaultDifficulty;\n    const timestamp = startTime;\n    \n    this.stats.computeAttempts++;\n    \n    // Prepare message data\n    const targetBytes = target ? new TextEncoder().encode(target) : new Uint8Array(0);\n    const timestampBytes = new Uint8Array(8);\n    new DataView(timestampBytes.buffer).setBigUint64(0, BigInt(timestamp), false);\n    \n    // Try to find valid nonce\n    let nonce = 0;\n    const maxNonce = 2 ** 32; // Prevent infinite loop\n    \n    while (nonce < maxNonce) {\n      // Check timeout\n      if (Date.now() - startTime > this.config.maxComputeTime) {\n        console.warn('PoW computation timed out after', Date.now() - startTime, 'ms');\n        return null;\n      }\n      \n      // Build challenge data: message || timestamp || target || nonce\n      const nonceBytes = new Uint8Array(4);\n      new DataView(nonceBytes.buffer).setUint32(0, nonce, false);\n      \n      const data = new Uint8Array(\n        message.length + timestampBytes.length + targetBytes.length + nonceBytes.length\n      );\n      let offset = 0;\n      data.set(message, offset); offset += message.length;\n      data.set(timestampBytes, offset); offset += timestampBytes.length;\n      data.set(targetBytes, offset); offset += targetBytes.length;\n      data.set(nonceBytes, offset);\n      \n      // Hash and check\n      const hash = sha256(data);\n      \n      if (this.hasLeadingZeros(hash, actualDifficulty)) {\n        // Found valid nonce!\n        this.stats.computeSuccesses++;\n        this.stats.totalComputeTime += Date.now() - startTime;\n        \n        return {\n          timestamp,\n          difficulty: actualDifficulty,\n          nonce,\n          target\n        };\n      }\n      \n      nonce++;\n    }\n    \n    // Failed to find valid nonce\n    console.error('PoW computation failed: exhausted nonce space');\n    return null;\n  }\n  \n  /**\n   * Verify proof-of-work for a message\n   * \n   * @param message - Message bytes\n   * @param challenge - PoW challenge to verify\n   * @param minDifficulty - Minimum required difficulty\n   * @returns true if PoW is valid\n   */\n  verifyPoW(\n    message: Uint8Array,\n    challenge: PoWChallenge,\n    minDifficulty?: number\n  ): boolean {\n    if (!this.config.enabled) {\n      return true; // PoW disabled, always valid\n    }\n    \n    this.stats.verifyAttempts++;\n    \n    // Check difficulty meets minimum\n    const requiredDifficulty = minDifficulty ?? this.config.defaultDifficulty;\n    if (challenge.difficulty < requiredDifficulty) {\n      console.warn('PoW difficulty too low:', challenge.difficulty, '<', requiredDifficulty);\n      return false;\n    }\n    \n    // Check timestamp is reasonable (within 5 minutes)\n    const now = Date.now();\n    const timeDiff = Math.abs(now - challenge.timestamp);\n    if (timeDiff > 5 * 60 * 1000) {\n      console.warn('PoW timestamp too old or in future:', timeDiff, 'ms');\n      return false;\n    }\n    \n    // Reconstruct challenge data\n    const targetBytes = challenge.target ? new TextEncoder().encode(challenge.target) : new Uint8Array(0);\n    const timestampBytes = new Uint8Array(8);\n    new DataView(timestampBytes.buffer).setBigUint64(0, BigInt(challenge.timestamp), false);\n    const nonceBytes = new Uint8Array(4);\n    new DataView(nonceBytes.buffer).setUint32(0, challenge.nonce, false);\n    \n    const data = new Uint8Array(\n      message.length + timestampBytes.length + targetBytes.length + nonceBytes.length\n    );\n    let offset = 0;\n    data.set(message, offset); offset += message.length;\n    data.set(timestampBytes, offset); offset += timestampBytes.length;\n    data.set(targetBytes, offset); offset += targetBytes.length;\n    data.set(nonceBytes, offset);\n    \n    // Verify hash\n    const hash = sha256(data);\n    const isValid = this.hasLeadingZeros(hash, challenge.difficulty);\n    \n    if (isValid) {\n      this.stats.verifySuccesses++;\n    }\n    \n    return isValid;\n  }\n  \n  /**\n   * Check if hash has required number of leading zero bits\n   * \n   * @param hash - Hash to check\n   * @param difficulty - Number of leading zero bits required\n   * @returns true if hash meets difficulty\n   */\n  private hasLeadingZeros(hash: Uint8Array, difficulty: number): boolean {\n    const fullBytes = Math.floor(difficulty / 8);\n    const remainingBits = difficulty % 8;\n    \n    // Check full zero bytes\n    for (let i = 0; i < fullBytes; i++) {\n      if (hash[i] !== 0) {\n        return false;\n      }\n    }\n    \n    // Check remaining bits\n    if (remainingBits > 0) {\n      const mask = 0xFF << (8 - remainingBits);\n      if ((hash[fullBytes] & mask) !== 0) {\n        return false;\n      }\n    }\n    \n    return true;\n  }\n  \n  /**\n   * Check if peer is exempt from PoW\n   * \n   * @param peerId - Peer public key\n   * @returns true if exempt\n   */\n  isPeerExempt(peerId: string): boolean {\n    return this.config.exemptPeers.has(peerId);\n  }\n  \n  /**\n   * Add peer to exemption list (trusted peer)\n   * \n   * @param peerId - Peer public key to exempt\n   */\n  exemptPeer(peerId: string): void {\n    this.config.exemptPeers.add(peerId);\n  }\n  \n  /**\n   * Remove peer from exemption list\n   * \n   * @param peerId - Peer public key\n   */\n  unexemptPeer(peerId: string): void {\n    this.config.exemptPeers.delete(peerId);\n  }\n  \n  /**\n   * Increase difficulty (during spam attack)\n   * \n   * @param amount - Number of bits to increase\n   */\n  increaseDifficulty(amount: number = 2): void {\n    if (!this.config.adaptiveDifficulty) {\n      return;\n    }\n    \n    this.config.defaultDifficulty = Math.min(24, this.config.defaultDifficulty + amount);\n    this.config.relayDifficulty = Math.min(24, this.config.relayDifficulty + amount);\n    this.stats.adaptiveIncreases++;\n    \n    console.log('PoW difficulty increased to:', this.config.defaultDifficulty);\n  }\n  \n  /**\n   * Decrease difficulty (after spam subsides)\n   * \n   * @param amount - Number of bits to decrease\n   */\n  decreaseDifficulty(amount: number = 1): void {\n    if (!this.config.adaptiveDifficulty) {\n      return;\n    }\n    \n    const minDifficulty = DEFAULT_POW_CONFIG.defaultDifficulty;\n    this.config.defaultDifficulty = Math.max(minDifficulty, this.config.defaultDifficulty - amount);\n    this.config.relayDifficulty = Math.max(\n      DEFAULT_POW_CONFIG.relayDifficulty,\n      this.config.relayDifficulty - amount\n    );\n    \n    console.log('PoW difficulty decreased to:', this.config.defaultDifficulty);\n  }\n  \n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<PoWConfig> {\n    return { ...this.config };\n  }\n  \n  /**\n   * Update configuration\n   * \n   * @param updates - Partial config updates\n   */\n  updateConfig(updates: Partial<PoWConfig>): void {\n    this.config = { ...this.config, ...updates };\n  }\n  \n  /**\n   * Get statistics\n   */\n  getStats() {\n    return {\n      ...this.stats,\n      averageComputeTime: this.stats.computeSuccesses > 0\n        ? this.stats.totalComputeTime / this.stats.computeSuccesses\n        : 0,\n      computeSuccessRate: this.stats.computeAttempts > 0\n        ? this.stats.computeSuccesses / this.stats.computeAttempts\n        : 0,\n      verifySuccessRate: this.stats.verifyAttempts > 0\n        ? this.stats.verifySuccesses / this.stats.verifyAttempts\n        : 0\n    };\n  }\n  \n  /**\n   * Reset statistics\n   */\n  resetStats(): void {\n    this.stats = {\n      computeAttempts: 0,\n      computeSuccesses: 0,\n      verifyAttempts: 0,\n      verifySuccesses: 0,\n      totalComputeTime: 0,\n      adaptiveIncreases: 0\n    };\n  }\n  \n  /**\n   * Estimate time to compute PoW for given difficulty\n   * \n   * @param difficulty - Difficulty level\n   * @param hashRate - Hashes per second (default: estimated)\n   * @returns Estimated time in milliseconds\n   */\n  static estimateComputeTime(difficulty: number, hashRate: number = 10000): number {\n    // Average attempts needed = 2^difficulty\n    const averageAttempts = Math.pow(2, difficulty);\n    \n    // Time = attempts / hash rate\n    return (averageAttempts / hashRate) * 1000; // Convert to ms\n  }\n}\n\n/**\n * Helper to convert number to bytes (big-endian)\n */\nfunction _numberToBytes(num: number, bytes: number = 4): Uint8Array {\n  const result = new Uint8Array(bytes);\n  const view = new DataView(result.buffer);\n  \n  if (bytes === 4) {\n    view.setUint32(0, num, false);\n  } else if (bytes === 8) {\n    view.setBigUint64(0, BigInt(num), false);\n  }\n  \n  return result;\n}\n\n/**\n * Benchmark PoW performance\n * \n * @param difficulty - Difficulty to benchmark\n * @param iterations - Number of iterations\n * @returns Average time per computation\n */\nexport async function benchmarkPoW(\n  difficulty: number = 8,\n  iterations: number = 10\n): Promise<number> {\n  const pow = new ProofOfWork({ defaultDifficulty: difficulty, enabled: true });\n  const testMessage = new Uint8Array(100);\n  crypto.getRandomValues(testMessage);\n  \n  const times: number[] = [];\n  \n  for (let i = 0; i < iterations; i++) {\n    const start = Date.now();\n    await pow.computePoW(testMessage, difficulty);\n    times.push(Date.now() - start);\n  }\n  \n  return times.reduce((a, b) => a + b, 0) / times.length;\n}\n"],"version":3}