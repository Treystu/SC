{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/SharePayload.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/SharePayload.ts"],"sourcesContent":["/**\n * SharePayloadGenerator - Generates and verifies share payloads for invites\n * \n * The share payload is what gets encoded (e.g., in a QR code or deep link)\n * and contains all the information needed to redeem an invite\n */\n\nimport { verifySignature as _verifySignature } from '../crypto/primitives.js';\nimport { SharePayload, PendingInvite } from './types.js';\n\nconst APP_VERSION = '0.1.0';\nconst MAX_TIMESTAMP_SKEW = 5 * 60 * 1000; // 5 minutes\n\nexport class SharePayloadGenerator {\n  /**\n   * Create a share payload from an invite\n   */\n  async createPayload(invite: PendingInvite): Promise<SharePayload> {\n    return {\n      version: APP_VERSION,\n      inviteCode: invite.code,\n      inviterPeerId: invite.inviterPeerId,\n      signature: invite.signature,\n      bootstrapPeers: invite.bootstrapPeers,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Verify a share payload\n   * Checks signature, version compatibility, and timestamp\n   */\n  async verifyPayload(payload: SharePayload): Promise<{ valid: boolean; error?: string }> {\n    // Check version compatibility\n    if (!this.isVersionCompatible(payload.version)) {\n      return { valid: false, error: 'Incompatible version' };\n    }\n\n    // Check timestamp to prevent replay attacks\n    const now = Date.now();\n    const timeDiff = Math.abs(now - payload.timestamp);\n    \n    if (timeDiff > MAX_TIMESTAMP_SKEW) {\n      return { valid: false, error: 'Payload timestamp too old or from future' };\n    }\n\n    // Verify the signature (if we have the public key)\n    // Note: Full signature verification would require the inviter's public key\n    // which should be included in the payload or looked up\n    if (payload.signature.length !== 64) {\n      return { valid: false, error: 'Invalid signature format' };\n    }\n\n    // Validate bootstrap peers (basic format check)\n    if (!Array.isArray(payload.bootstrapPeers)) {\n      return { valid: false, error: 'Invalid bootstrap peers format' };\n    }\n\n    return { valid: true };\n  }\n\n  /**\n   * Check if a version string is compatible with the current app version\n   */\n  private isVersionCompatible(version: string): boolean {\n    // Simple version check - in production, use semver\n    const [major] = version.split('.');\n    const [currentMajor] = APP_VERSION.split('.');\n    \n    return major === currentMajor;\n  }\n\n  /**\n   * Serialize a payload to a string (e.g., for QR code encoding)\n   */\n  serializePayload(payload: SharePayload): string {\n    return JSON.stringify({\n      v: payload.version,\n      c: payload.inviteCode,\n      p: payload.inviterPeerId,\n      s: Array.from(payload.signature),\n      b: payload.bootstrapPeers,\n      t: payload.timestamp,\n    });\n  }\n\n  /**\n   * Deserialize a payload from a string\n   */\n  deserializePayload(data: string): SharePayload | null {\n    try {\n      const parsed = JSON.parse(data);\n      \n      return {\n        version: parsed.v,\n        inviteCode: parsed.c,\n        inviterPeerId: parsed.p,\n        signature: new Uint8Array(parsed.s),\n        bootstrapPeers: parsed.b,\n        timestamp: parsed.t,\n      };\n    } catch (error) {\n      return null;\n    }\n  }\n}\n"],"version":3}