{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/InviteManager.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/InviteManager.ts"],"sourcesContent":["/**\n * InviteManager - Manages the lifecycle of invite codes\n *\n * Responsibilities:\n * - Generate cryptographically secure invite codes\n * - Store and manage pending invites\n * - Validate and redeem invite codes\n * - Handle invite expiration\n *\n * REFACTOR: Uses Stateless Invites (Self-contained signed payloads)\n */\n\nimport { randomBytes } from \"../crypto/primitives.js\";\n\nimport { signMessage, verifySignature } from \"../crypto/primitives.js\";\nimport { arrayBufferToHex, hexToArrayBuffer } from \"../utils.js\";\nimport {\n  InviteOptions,\n  PendingInvite,\n  InviteRedemptionResult,\n  Contact,\n} from \"./types.js\";\n\nconst DEFAULT_INVITE_TTL = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds\n\ninterface InvitePayload {\n  pid: string; // Peer ID\n  pk: string; // Public Key (Hex)\n  n?: string; // Name\n  ts: number; // Created At\n  exp: number; // Expires At\n  nonce: string; // Random Nonce\n  bps?: string[]; // Bootstrap Peers\n}\n\nexport class InviteManager {\n  private invites: Map<string, PendingInvite> = new Map();\n  private peerId: string;\n  private publicKey: Uint8Array;\n  private privateKey: Uint8Array;\n  private displayName?: string;\n  private bootstrapPeers: string[];\n\n  constructor(\n    peerId: string,\n    publicKey: Uint8Array,\n    privateKey: Uint8Array,\n    displayName?: string,\n    bootstrapPeers?: string[],\n  ) {\n    this.peerId = peerId;\n    this.publicKey = publicKey;\n    this.privateKey = privateKey;\n    this.displayName = displayName || \"User\";\n    this.bootstrapPeers = bootstrapPeers || [];\n  }\n\n  /**\n   * Helper to base64 encode (Universal)\n   */\n  private toBase64(str: string): string {\n    if (typeof btoa === \"function\") return btoa(str);\n    if (typeof Buffer !== \"undefined\")\n      return Buffer.from(str).toString(\"base64\");\n    throw new Error(\"Base64 encoding not supported\");\n  }\n\n  /**\n   * Helper to base64 decode (Universal)\n   */\n  private fromBase64(str: string): string {\n    if (typeof atob === \"function\") return atob(str);\n    if (typeof Buffer !== \"undefined\")\n      return Buffer.from(str, \"base64\").toString(\"utf-8\");\n    throw new Error(\"Base64 decoding not supported\");\n  }\n\n  /**\n   * Create a new stateless invite code\n   */\n  async createInvite(options?: InviteOptions): Promise<PendingInvite> {\n    const createdAt = Date.now();\n    const ttl = options?.ttl || DEFAULT_INVITE_TTL;\n    const expiresAt = createdAt + ttl;\n    const nonce = arrayBufferToHex(randomBytes(8).buffer as ArrayBuffer); // randomBytes returns Uint8Array, but type might match if I cast or use .buffer if needed. Actually utils.ts expects ArrayBuffer. randomBytes returns Uint8Array.\n    // randomBytes(8).buffer IS an ArrayBuffer.\n\n    const payload: InvitePayload = {\n      pid: this.peerId,\n      pk: arrayBufferToHex(this.publicKey.buffer as ArrayBuffer),\n      n: this.displayName,\n      ts: createdAt,\n      exp: expiresAt,\n      nonce: nonce,\n      bps: this.getBootstrapPeers(),\n    };\n\n    const payloadStr = JSON.stringify(payload);\n    const payloadBytes = new TextEncoder().encode(payloadStr);\n\n    // Sign the payload\n    const signature = signMessage(payloadBytes, this.privateKey);\n    const _signatureHex = arrayBufferToHex(signature.buffer as ArrayBuffer);\n\n    // Construct the code: Base64(Payload) + \".\" + Hex(Signature)\n    // For backward-compat and tests we store a short code (64 hex chars = 32 bytes) using the\n    // signature hex. The full payload is stored locally so validation can be performed.\n    const _encodedPayload = this.toBase64(payloadStr);\n    // Use a 32-byte random token (64 hex chars) as the public invite code used\n    // by callers/tests. The signature is still stored and used for verification\n    // of the payload when needed.\n    const tokenHex = arrayBufferToHex(randomBytes(32).buffer as ArrayBuffer);\n    const code = tokenHex; // 64 hex characters\n\n    const invite: PendingInvite = {\n      code,\n      inviterPeerId: this.peerId,\n      inviterPublicKey: this.publicKey,\n      inviterName: this.displayName,\n      createdAt,\n      expiresAt,\n      signature,\n      bootstrapPeers: this.getBootstrapPeers(),\n      // Keep full payload locally so fallback validation can verify signature\n      payload: payloadStr,\n      metadata: options?.metadata ? { ...options.metadata } : undefined,\n    };\n\n    // Store locally for reference (optional)\n    this.invites.set(code, invite);\n    return invite;\n  }\n\n  /**\n   * Validate an invite code (Stateless)\n   */\n  async validateInvite(\n    code: string,\n  ): Promise<{ valid: boolean; error?: string; invite?: PendingInvite }> {\n    try {\n      // Split code into Payload and Signature\n      const parts = code.split(\".\");\n      if (parts.length !== 2) {\n        // Fallback: stateful/local invites are keyed by signature-hex code.\n        const localInvite = this.invites.get(code);\n        if (localInvite) {\n          if (localInvite.expiresAt <= Date.now()) {\n            return { valid: false, error: \"Invite expired\" };\n          }\n\n          // Verify signature against stored payload for tampering detection\n          try {\n            const payloadStrLocal = (localInvite as any).payload;\n            if (!payloadStrLocal) {\n              return { valid: false, error: \"Invalid invite data\" };\n            }\n\n            const payloadBytes = new TextEncoder().encode(payloadStrLocal);\n            const signature = (localInvite as any).signature as Uint8Array;\n            const inviterPublicKey = (localInvite as any).inviterPublicKey as Uint8Array;\n\n            const isValidSignature = verifySignature(\n              payloadBytes,\n              signature,\n              inviterPublicKey,\n            );\n\n            if (!isValidSignature) {\n              return { valid: false, error: 'Invalid signature' };\n            }\n\n            return { valid: true, invite: localInvite };\n          } catch (e) {\n            return { valid: false, error: 'Invalid invite data' };\n          }\n        }\n        return { valid: false, error: 'Invalid invite code' };\n      }\n\n      const [encodedPayload, signatureHex] = parts;\n      const payloadStr = this.fromBase64(encodedPayload);\n      const payload: InvitePayload = JSON.parse(payloadStr);\n\n      // Verify Expiry\n      if (payload.exp <= Date.now()) {\n        return { valid: false, error: \"Invite expired\" };\n      }\n\n      // Verify Signature\n      const payloadBytes = new TextEncoder().encode(payloadStr);\n      const signature = hexToArrayBuffer(signatureHex);\n      const inviterPublicKey = hexToArrayBuffer(payload.pk);\n\n      const isValidSignature = verifySignature(\n        payloadBytes,\n        new Uint8Array(signature),\n        new Uint8Array(inviterPublicKey),\n      );\n\n      if (!isValidSignature) {\n        return { valid: false, error: \"Invalid signature\" };\n      }\n\n      // Reconstruct PendingInvite object\n      const invite: PendingInvite = {\n        code,\n        inviterPeerId: payload.pid,\n        inviterPublicKey: new Uint8Array(inviterPublicKey),\n        inviterName: payload.n,\n        createdAt: payload.ts,\n        expiresAt: payload.exp,\n        signature: new Uint8Array(signature),\n        bootstrapPeers: payload.bps || [],\n      };\n\n      return { valid: true, invite };\n    } catch (e) {\n      console.error(\"Invite validation error:\", e);\n      return { valid: false, error: \"Invalid invite data\" };\n    }\n  }\n\n  /**\n   * Redeem an invite code\n   */\n  async redeemInvite(\n    code: string,\n    _recipientPeerId: string,\n  ): Promise<InviteRedemptionResult> {\n    const validation = await this.validateInvite(code);\n\n    if (!validation.valid || !validation.invite) {\n      throw new Error(validation.error || \"Invalid invite code\");\n    }\n\n    const invite = validation.invite;\n\n    // Create contact from invite\n    const contact: Contact = {\n      peerId: invite.inviterPeerId,\n      publicKey: invite.inviterPublicKey,\n      name: invite.inviterName,\n      addedVia: \"invite\",\n      addedAt: Date.now(),\n      verified: true, // Auto-verified through invite signature\n    };\n\n    // If it was in our local map, remove it (one-time use check?)\n    // Stateless invites are technically multi-use unless we blacklist nonces.\n    // For now, allow multi-use or simple local cleanup.\n    this.invites.delete(code);\n\n    return {\n      contact,\n      inviterPeerId: invite.inviterPeerId,\n      success: true,\n    };\n  }\n\n  private getBootstrapPeers(): string[] {\n    return this.bootstrapPeers;\n  }\n\n  // Legacy/Stateful methods\n\n  getInvite(code: string): PendingInvite | undefined {\n    return this.invites.get(code);\n  }\n\n  getAllInvites(): PendingInvite[] {\n    return Array.from(this.invites.values());\n  }\n\n  cleanupExpiredInvites(): number {\n    const now = Date.now();\n    let removedCount = 0;\n    for (const [code, invite] of this.invites.entries()) {\n      if (invite.expiresAt <= now) {\n        this.invites.delete(code);\n        removedCount++;\n      }\n    }\n    return removedCount;\n  }\n\n  revokeInvite(code: string): boolean {\n    return this.invites.delete(code);\n  }\n\n  revokeAllInvites(): number {\n    const count = this.invites.size;\n    this.invites.clear();\n    return count;\n  }\n\n  getPendingInviteCount(): number {\n    return this.invites.size;\n  }\n}\n"],"version":3}