{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/SharePayload.test.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/SharePayload.test.ts"],"sourcesContent":["/**\n * Tests for SharePayloadGenerator\n */\n\nimport { SharePayloadGenerator } from './SharePayload';\nimport { InviteManager } from './InviteManager';\nimport { generateIdentity } from '../crypto/primitives';\n\ndescribe('SharePayloadGenerator', () => {\n  let generator: SharePayloadGenerator;\n  let inviteManager: InviteManager;\n  let identity: ReturnType<typeof generateIdentity>;\n\n  beforeEach(() => {\n    generator = new SharePayloadGenerator();\n    identity = generateIdentity();\n    inviteManager = new InviteManager(\n      'test-peer-id',\n      identity.publicKey,\n      identity.privateKey,\n      'Test User'\n    );\n  });\n\n  describe('Payload Creation', () => {\n    it('should create a valid payload from an invite', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n\n      expect(payload.version).toBe('0.1.0');\n      expect(payload.inviteCode).toBe(invite.code);\n      expect(payload.inviterPeerId).toBe(invite.inviterPeerId);\n      expect(payload.signature).toEqual(invite.signature);\n      expect(payload.bootstrapPeers).toEqual(invite.bootstrapPeers);\n      expect(payload.timestamp).toBeDefined();\n      expect(payload.timestamp).toBeGreaterThan(0);\n    });\n\n    it('should include current timestamp', async () => {\n      const invite = await inviteManager.createInvite();\n      const beforeTime = Date.now();\n      const payload = await generator.createPayload(invite);\n      const afterTime = Date.now();\n\n      expect(payload.timestamp).toBeGreaterThanOrEqual(beforeTime);\n      expect(payload.timestamp).toBeLessThanOrEqual(afterTime);\n    });\n  });\n\n  describe('Payload Verification', () => {\n    it('should verify a valid payload', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(true);\n      expect(result.error).toBeUndefined();\n    });\n\n    it('should reject incompatible version', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      payload.version = '99.0.0'; // Future incompatible version\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Incompatible version');\n    });\n\n    it('should accept compatible versions with same major', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      payload.version = '0.2.5'; // Same major version\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(true);\n    });\n\n    it('should reject old timestamps', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      payload.timestamp = Date.now() - (10 * 60 * 1000); // 10 minutes ago\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Payload timestamp too old or from future');\n    });\n\n    it('should reject future timestamps', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      payload.timestamp = Date.now() + (10 * 60 * 1000); // 10 minutes in future\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Payload timestamp too old or from future');\n    });\n\n    it('should accept recent timestamps', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      payload.timestamp = Date.now() - (2 * 60 * 1000); // 2 minutes ago\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(true);\n    });\n\n    it('should reject invalid signature format', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      payload.signature = new Uint8Array(32); // Wrong size\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid signature format');\n    });\n\n    it('should reject invalid bootstrap peers format', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      (payload as any).bootstrapPeers = 'not-an-array';\n\n      const result = await generator.verifyPayload(payload);\n\n      expect(result.valid).toBe(false);\n      expect(result.error).toBe('Invalid bootstrap peers format');\n    });\n  });\n\n  describe('Payload Serialization', () => {\n    it('should serialize and deserialize payload correctly', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      \n      const serialized = generator.serializePayload(payload);\n      const deserialized = generator.deserializePayload(serialized);\n\n      expect(deserialized).not.toBeNull();\n      expect(deserialized?.version).toBe(payload.version);\n      expect(deserialized?.inviteCode).toBe(payload.inviteCode);\n      expect(deserialized?.inviterPeerId).toBe(payload.inviterPeerId);\n      expect(deserialized?.signature).toEqual(payload.signature);\n      expect(deserialized?.bootstrapPeers).toEqual(payload.bootstrapPeers);\n      expect(deserialized?.timestamp).toBe(payload.timestamp);\n    });\n\n    it('should handle serialization with bootstrap peers', async () => {\n      const invite = await inviteManager.createInvite();\n      // Manually add bootstrap peers for testing\n      invite.bootstrapPeers = ['peer1', 'peer2', 'peer3'];\n      \n      const payload = await generator.createPayload(invite);\n      const serialized = generator.serializePayload(payload);\n      const deserialized = generator.deserializePayload(serialized);\n\n      expect(deserialized?.bootstrapPeers).toEqual(['peer1', 'peer2', 'peer3']);\n    });\n\n    it('should return null for invalid JSON', () => {\n      const result = generator.deserializePayload('invalid json{');\n      expect(result).toBeNull();\n    });\n\n    it('should return null for empty string', () => {\n      const result = generator.deserializePayload('');\n      expect(result).toBeNull();\n    });\n\n    it('should handle complex metadata in serialization', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      \n      const serialized = generator.serializePayload(payload);\n      expect(serialized).toBeTruthy();\n      expect(typeof serialized).toBe('string');\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle payload with empty bootstrap peers', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      \n      const result = await generator.verifyPayload(payload);\n      expect(result.valid).toBe(true);\n    });\n\n    it('should serialize compact format', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      \n      const serialized = generator.serializePayload(payload);\n      const parsed = JSON.parse(serialized);\n\n      // Check compact keys are used\n      expect(parsed.v).toBeDefined();\n      expect(parsed.c).toBeDefined();\n      expect(parsed.p).toBeDefined();\n      expect(parsed.s).toBeDefined();\n      expect(parsed.b).toBeDefined();\n      expect(parsed.t).toBeDefined();\n    });\n\n    it('should preserve signature bytes through serialization', async () => {\n      const invite = await inviteManager.createInvite();\n      const payload = await generator.createPayload(invite);\n      \n      const serialized = generator.serializePayload(payload);\n      const deserialized = generator.deserializePayload(serialized);\n\n      expect(deserialized?.signature).toEqual(payload.signature);\n      expect(Array.from(deserialized!.signature)).toEqual(Array.from(payload.signature));\n    });\n  });\n});\n"],"version":3}