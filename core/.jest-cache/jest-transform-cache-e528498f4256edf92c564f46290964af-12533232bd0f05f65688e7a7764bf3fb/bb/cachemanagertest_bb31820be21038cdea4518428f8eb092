4d23cbd4cda1a7d2a04b1df376fe2a36
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cache_manager_1 = require("./cache-manager");
// Mock timers for testing TTL
jest.useFakeTimers();
describe('CacheManager', () => {
    let cache;
    beforeEach(() => {
        jest.clearAllTimers();
        cache = new cache_manager_1.CacheManager(1024 * 1024, 60000); // 1MB, 60s TTL
    });
    afterEach(() => {
        cache.clear();
        jest.clearAllTimers();
    });
    describe('Basic Operations', () => {
        it('should set and get values', () => {
            cache.set('key1', 'value1');
            expect(cache.get('key1')).toBe('value1');
        });
        it('should return null for non-existent keys', () => {
            expect(cache.get('nonexistent')).toBeNull();
        });
        it('should check if key exists', () => {
            cache.set('key1', 'value1');
            expect(cache.has('key1')).toBe(true);
            expect(cache.has('key2')).toBe(false);
        });
        it('should delete values', () => {
            cache.set('key1', 'value1');
            expect(cache.delete('key1')).toBe(true);
            expect(cache.get('key1')).toBeNull();
        });
        it('should return false when deleting non-existent key', () => {
            expect(cache.delete('nonexistent')).toBe(false);
        });
        it('should clear all values', () => {
            cache.set('key1', 'value1');
            cache.set('key2', 'value2');
            cache.clear();
            expect(cache.get('key1')).toBeNull();
            expect(cache.get('key2')).toBeNull();
        });
        it('should update existing values', () => {
            cache.set('key1', 'value1');
            cache.set('key1', 'value2');
            expect(cache.get('key1')).toBe('value2');
        });
    });
    describe('TTL (Time To Live)', () => {
        it('should expire entries after TTL', () => {
            cache.set('key1', 'value1', 1000); // 1 second TTL
            expect(cache.get('key1')).toBe('value1');
            jest.advanceTimersByTime(1001);
            expect(cache.get('key1')).toBeNull();
        });
        it('should use default TTL when not specified', () => {
            cache.set('key1', 'value1');
            jest.advanceTimersByTime(59999);
            expect(cache.get('key1')).toBe('value1');
            jest.advanceTimersByTime(2);
            expect(cache.get('key1')).toBeNull();
        });
        it('should allow custom TTL per entry', () => {
            cache.set('short', 'value1', 1000);
            cache.set('long', 'value2', 10000);
            jest.advanceTimersByTime(1001);
            expect(cache.get('short')).toBeNull();
            expect(cache.get('long')).toBe('value2');
        });
    });
    describe('Eviction', () => {
        it('should evict oldest entry when size limit reached', () => {
            const smallCache = new cache_manager_1.CacheManager(200, 60000); // Very small cache
            smallCache.set('key1', 'a'.repeat(100));
            smallCache.set('key2', 'b'.repeat(100));
            // This should trigger eviction of key1
            smallCache.set('key3', 'c'.repeat(100));
            // key1 should be evicted (oldest), but key3 should be cached
            expect(smallCache.get('key1')).toBeNull();
            expect(smallCache.get('key3')).not.toBeNull();
            // Either key2 was evicted too, or it's still there
            // (depends on exact size calculations)
        });
        it('should track eviction count', () => {
            const smallCache = new cache_manager_1.CacheManager(200, 60000);
            smallCache.set('key1', 'a'.repeat(100));
            smallCache.set('key2', 'b'.repeat(100));
            smallCache.set('key3', 'c'.repeat(100)); // Triggers eviction
            const stats = smallCache.getStats();
            expect(stats.evictions).toBeGreaterThan(0);
        });
    });
    describe('Statistics', () => {
        it('should track hits and misses', () => {
            cache.set('key1', 'value1');
            cache.get('key1'); // hit
            cache.get('key1'); // hit
            cache.get('key2'); // miss
            cache.get('key3'); // miss
            const stats = cache.getStats();
            expect(stats.hits).toBe(2);
            expect(stats.misses).toBe(2);
        });
        it('should calculate hit rate correctly', () => {
            cache.set('key1', 'value1');
            cache.get('key1'); // hit
            cache.get('key1'); // hit
            cache.get('key2'); // miss
            cache.get('key3'); // miss
            expect(cache.getHitRate()).toBe(0.5); // 2 hits out of 4 total
        });
        it('should return 0 hit rate when no requests', () => {
            expect(cache.getHitRate()).toBe(0);
        });
        it('should track cache size and count', () => {
            cache.set('key1', 'value1');
            cache.set('key2', 'value2');
            const stats = cache.getStats();
            expect(stats.count).toBe(2);
            expect(stats.size).toBeGreaterThan(0);
        });
        it('should update stats when clearing cache', () => {
            cache.set('key1', 'value1');
            cache.set('key2', 'value2');
            cache.clear();
            const stats = cache.getStats();
            expect(stats.count).toBe(0);
            expect(stats.size).toBe(0);
        });
    });
    describe('getOrFetch', () => {
        it('should return cached value if exists', async () => {
            cache.set('key1', 'cached');
            const fetcher = jest.fn(async () => 'fetched');
            const result = await cache.getOrFetch('key1', fetcher);
            expect(result).toBe('cached');
            expect(fetcher).not.toHaveBeenCalled();
        });
        it('should fetch and cache if not exists', async () => {
            const fetcher = jest.fn(async () => 'fetched');
            const result = await cache.getOrFetch('key1', fetcher);
            expect(result).toBe('fetched');
            expect(fetcher).toHaveBeenCalledTimes(1);
            expect(cache.get('key1')).toBe('fetched');
        });
        it('should use custom TTL when fetching', async () => {
            const fetcher = async () => 'fetched';
            await cache.getOrFetch('key1', fetcher, 1000);
            jest.advanceTimersByTime(1001);
            expect(cache.get('key1')).toBeNull();
        });
    });
    describe('prewarm', () => {
        it('should prewarm cache with multiple entries', async () => {
            const entries = [
                { key: 'key1', fetcher: async () => 'value1' },
                { key: 'key2', fetcher: async () => 'value2' },
                { key: 'key3', fetcher: async () => 'value3' },
            ];
            await cache.prewarm(entries);
            expect(cache.get('key1')).toBe('value1');
            expect(cache.get('key2')).toBe('value2');
            expect(cache.get('key3')).toBe('value3');
        });
        it('should support custom TTL in prewarm', async () => {
            const entries = [
                { key: 'key1', fetcher: async () => 'value1', ttl: 1000 },
            ];
            await cache.prewarm(entries);
            jest.advanceTimersByTime(1001);
            expect(cache.get('key1')).toBeNull();
        });
    });
    describe('Edge Cases', () => {
        it('should handle empty strings', () => {
            cache.set('key1', '');
            expect(cache.get('key1')).toBe('');
        });
        it('should handle numeric values', () => {
            const numberCache = new cache_manager_1.CacheManager();
            numberCache.set('key1', 42);
            expect(numberCache.get('key1')).toBe(42);
        });
        it('should handle object values', () => {
            const objectCache = new cache_manager_1.CacheManager();
            const obj = { value: 'test' };
            objectCache.set('key1', obj);
            expect(objectCache.get('key1')).toEqual(obj);
        });
        it('should handle undefined values', () => {
            const anyCache = new cache_manager_1.CacheManager();
            anyCache.set('key1', undefined);
            expect(anyCache.get('key1')).toBeUndefined();
        });
    });
});
describe('MediaCache', () => {
    let mediaCache;
    beforeEach(() => {
        mediaCache = new cache_manager_1.MediaCache();
    });
    afterEach(() => {
        mediaCache.clear();
    });
    describe('Basic Operations', () => {
        it('should cache blob values', () => {
            const blob = new Blob(['test'], { type: 'text/plain' });
            mediaCache.set('test.txt', blob);
            const cached = mediaCache.get('test.txt');
            expect(cached).toBe(blob);
        });
        it('should create object URLs from cached blobs', () => {
            const blob = new Blob(['test'], { type: 'text/plain' });
            mediaCache.set('test.txt', blob);
            const url = mediaCache.getObjectURL('test.txt');
            expect(url).toBeTruthy();
            expect(typeof url).toBe('string');
            expect(url).toMatch(/^blob:/);
        });
        it('should return null for non-existent blob URLs', () => {
            const url = mediaCache.getObjectURL('nonexistent');
            expect(url).toBeNull();
        });
    });
    describe('cacheFromURL', () => {
        beforeEach(() => {
            global.fetch = jest.fn();
        });
        it('should fetch and cache from URL', async () => {
            const mockBlob = new Blob(['content'], { type: 'image/png' });
            global.fetch.mockResolvedValue({
                ok: true,
                blob: async () => mockBlob,
            });
            const result = await mediaCache.cacheFromURL('image', 'http://example.com/image.png');
            expect(result).toBe(mockBlob);
            expect(mediaCache.get('image')).toBe(mockBlob);
        });
        it('should throw error on failed fetch', async () => {
            global.fetch.mockResolvedValue({
                ok: false,
            });
            await expect(mediaCache.cacheFromURL('image', 'http://example.com/fail.png')).rejects.toThrow('Failed to fetch image');
        });
        it('should return cached value on subsequent calls', async () => {
            const mockBlob = new Blob(['content'], { type: 'image/png' });
            global.fetch.mockResolvedValue({
                ok: true,
                blob: async () => mockBlob,
            });
            await mediaCache.cacheFromURL('image', 'http://example.com/image.png');
            await mediaCache.cacheFromURL('image', 'http://example.com/image.png');
            expect(global.fetch).toHaveBeenCalledTimes(1);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY2FjaGUtbWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsbURBQW1GO0FBRW5GLDhCQUE4QjtBQUM5QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7QUFFckIsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDNUIsSUFBSSxLQUEyQixDQUFDO0lBRWhDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsS0FBSyxHQUFHLElBQUksNEJBQVksQ0FBUyxJQUFJLEdBQUcsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsZUFBZTtJQUN2RSxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDNUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1lBQ2xELE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLEtBQUssQ0FBQyxHQUFHLENBQUMs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Q0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY2FjaGUtbWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENhY2hlTWFuYWdlciwgTWVkaWFDYWNoZSwgQ2FjaGVFbnRyeSwgQ2FjaGVTdGF0cyB9IGZyb20gJy4vY2FjaGUtbWFuYWdlcic7XG5cbi8vIE1vY2sgdGltZXJzIGZvciB0ZXN0aW5nIFRUTFxuamVzdC51c2VGYWtlVGltZXJzKCk7XG5cbmRlc2NyaWJlKCdDYWNoZU1hbmFnZXInLCAoKSA9PiB7XG4gIGxldCBjYWNoZTogQ2FjaGVNYW5hZ2VyPHN0cmluZz47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICAgIGNhY2hlID0gbmV3IENhY2hlTWFuYWdlcjxzdHJpbmc+KDEwMjQgKiAxMDI0LCA2MDAwMCk7IC8vIDFNQiwgNjBzIFRUTFxuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGNhY2hlLmNsZWFyKCk7XG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQmFzaWMgT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCBhbmQgZ2V0IHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKTtcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTEnKSkudG9CZSgndmFsdWUxJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIGZvciBub24tZXhpc3RlbnQga2V5cycsICgpID0+IHtcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ25vbmV4aXN0ZW50JykpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoZWNrIGlmIGtleSBleGlzdHMnLCAoKSA9PiB7XG4gICAgICBjYWNoZS5zZXQoJ2tleTEnLCAndmFsdWUxJyk7XG4gICAgICBleHBlY3QoY2FjaGUuaGFzKCdrZXkxJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY2FjaGUuaGFzKCdrZXkyJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMScpO1xuICAgICAgZXhwZWN0KGNhY2hlLmRlbGV0ZSgna2V5MScpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBkZWxldGluZyBub24tZXhpc3RlbnQga2V5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNhY2hlLmRlbGV0ZSgnbm9uZXhpc3RlbnQnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsZWFyIGFsbCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjYWNoZS5zZXQoJ2tleTEnLCAndmFsdWUxJyk7XG4gICAgICBjYWNoZS5zZXQoJ2tleTInLCAndmFsdWUyJyk7XG4gICAgICBjYWNoZS5jbGVhcigpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MicpKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgZXhpc3RpbmcgdmFsdWVzJywgKCkgPT4ge1xuICAgICAgY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMScpO1xuICAgICAgY2FjaGUuc2V0KCdrZXkxJywgJ3ZhbHVlMicpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlKCd2YWx1ZTInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1RUTCAoVGltZSBUbyBMaXZlKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4cGlyZSBlbnRyaWVzIGFmdGVyIFRUTCcsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnLCAxMDAwKTsgLy8gMSBzZWNvbmQgVFRMXG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkxJykpLnRvQmUoJ3ZhbHVlMScpO1xuICAgICAgXG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMTAwMSk7XG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkxJykpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IFRUTCB3aGVuIG5vdCBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICBjYWNoZS5zZXQoJ2tleTEnLCAndmFsdWUxJyk7XG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoNTk5OTkpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlKCd2YWx1ZTEnKTtcbiAgICAgIFxuICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDIpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBjdXN0b20gVFRMIHBlciBlbnRyeScsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgnc2hvcnQnLCAndmFsdWUxJywgMTAwMCk7XG4gICAgICBjYWNoZS5zZXQoJ2xvbmcnLCAndmFsdWUyJywgMTAwMDApO1xuICAgICAgXG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMTAwMSk7XG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdzaG9ydCcpKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgnbG9uZycpKS50b0JlKCd2YWx1ZTInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0V2aWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXZpY3Qgb2xkZXN0IGVudHJ5IHdoZW4gc2l6ZSBsaW1pdCByZWFjaGVkJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc21hbGxDYWNoZSA9IG5ldyBDYWNoZU1hbmFnZXI8c3RyaW5nPigyMDAsIDYwMDAwKTsgLy8gVmVyeSBzbWFsbCBjYWNoZVxuICAgICAgXG4gICAgICBzbWFsbENhY2hlLnNldCgna2V5MScsICdhJy5yZXBlYXQoMTAwKSk7XG4gICAgICBzbWFsbENhY2hlLnNldCgna2V5MicsICdiJy5yZXBlYXQoMTAwKSk7XG4gICAgICBcbiAgICAgIC8vIFRoaXMgc2hvdWxkIHRyaWdnZXIgZXZpY3Rpb24gb2Yga2V5MVxuICAgICAgc21hbGxDYWNoZS5zZXQoJ2tleTMnLCAnYycucmVwZWF0KDEwMCkpO1xuICAgICAgXG4gICAgICAvLyBrZXkxIHNob3VsZCBiZSBldmljdGVkIChvbGRlc3QpLCBidXQga2V5MyBzaG91bGQgYmUgY2FjaGVkXG4gICAgICBleHBlY3Qoc21hbGxDYWNoZS5nZXQoJ2tleTEnKSkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChzbWFsbENhY2hlLmdldCgna2V5MycpKS5ub3QudG9CZU51bGwoKTtcbiAgICAgIFxuICAgICAgLy8gRWl0aGVyIGtleTIgd2FzIGV2aWN0ZWQgdG9vLCBvciBpdCdzIHN0aWxsIHRoZXJlXG4gICAgICAvLyAoZGVwZW5kcyBvbiBleGFjdCBzaXplIGNhbGN1bGF0aW9ucylcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgZXZpY3Rpb24gY291bnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzbWFsbENhY2hlID0gbmV3IENhY2hlTWFuYWdlcjxzdHJpbmc+KDIwMCwgNjAwMDApO1xuICAgICAgXG4gICAgICBzbWFsbENhY2hlLnNldCgna2V5MScsICdhJy5yZXBlYXQoMTAwKSk7XG4gICAgICBzbWFsbENhY2hlLnNldCgna2V5MicsICdiJy5yZXBlYXQoMTAwKSk7XG4gICAgICBzbWFsbENhY2hlLnNldCgna2V5MycsICdjJy5yZXBlYXQoMTAwKSk7IC8vIFRyaWdnZXJzIGV2aWN0aW9uXG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gc21hbGxDYWNoZS5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLmV2aWN0aW9ucykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3RhdGlzdGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRyYWNrIGhpdHMgYW5kIG1pc3NlcycsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKTtcbiAgICAgIFxuICAgICAgY2FjaGUuZ2V0KCdrZXkxJyk7IC8vIGhpdFxuICAgICAgY2FjaGUuZ2V0KCdrZXkxJyk7IC8vIGhpdFxuICAgICAgY2FjaGUuZ2V0KCdrZXkyJyk7IC8vIG1pc3NcbiAgICAgIGNhY2hlLmdldCgna2V5MycpOyAvLyBtaXNzXG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gY2FjaGUuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5oaXRzKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLm1pc3NlcykudG9CZSgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGhpdCByYXRlIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKTtcbiAgICAgIFxuICAgICAgY2FjaGUuZ2V0KCdrZXkxJyk7IC8vIGhpdFxuICAgICAgY2FjaGUuZ2V0KCdrZXkxJyk7IC8vIGhpdFxuICAgICAgY2FjaGUuZ2V0KCdrZXkyJyk7IC8vIG1pc3NcbiAgICAgIGNhY2hlLmdldCgna2V5MycpOyAvLyBtaXNzXG4gICAgICBcbiAgICAgIGV4cGVjdChjYWNoZS5nZXRIaXRSYXRlKCkpLnRvQmUoMC41KTsgLy8gMiBoaXRzIG91dCBvZiA0IHRvdGFsXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiAwIGhpdCByYXRlIHdoZW4gbm8gcmVxdWVzdHMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY2FjaGUuZ2V0SGl0UmF0ZSgpKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0cmFjayBjYWNoZSBzaXplIGFuZCBjb3VudCcsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICd2YWx1ZTEnKTtcbiAgICAgIGNhY2hlLnNldCgna2V5MicsICd2YWx1ZTInKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHMgPSBjYWNoZS5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvdW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLnNpemUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHN0YXRzIHdoZW4gY2xlYXJpbmcgY2FjaGUnLCAoKSA9PiB7XG4gICAgICBjYWNoZS5zZXQoJ2tleTEnLCAndmFsdWUxJyk7XG4gICAgICBjYWNoZS5zZXQoJ2tleTInLCAndmFsdWUyJyk7XG4gICAgICBjYWNoZS5jbGVhcigpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IGNhY2hlLmdldFN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMuY291bnQpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuc2l6ZSkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE9yRmV0Y2gnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY2FjaGVkIHZhbHVlIGlmIGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICdjYWNoZWQnKTtcbiAgICAgIFxuICAgICAgY29uc3QgZmV0Y2hlciA9IGplc3QuZm4oYXN5bmMgKCkgPT4gJ2ZldGNoZWQnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhY2hlLmdldE9yRmV0Y2goJ2tleTEnLCBmZXRjaGVyKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnY2FjaGVkJyk7XG4gICAgICBleHBlY3QoZmV0Y2hlcikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmV0Y2ggYW5kIGNhY2hlIGlmIG5vdCBleGlzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmZXRjaGVyID0gamVzdC5mbihhc3luYyAoKSA9PiAnZmV0Y2hlZCcpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2FjaGUuZ2V0T3JGZXRjaCgna2V5MScsIGZldGNoZXIpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdmZXRjaGVkJyk7XG4gICAgICBleHBlY3QoZmV0Y2hlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlKCdmZXRjaGVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBjdXN0b20gVFRMIHdoZW4gZmV0Y2hpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmZXRjaGVyID0gYXN5bmMgKCkgPT4gJ2ZldGNoZWQnO1xuICAgICAgYXdhaXQgY2FjaGUuZ2V0T3JGZXRjaCgna2V5MScsIGZldGNoZXIsIDEwMDApO1xuICAgICAgXG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMTAwMSk7XG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkxJykpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcmV3YXJtJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJld2FybSBjYWNoZSB3aXRoIG11bHRpcGxlIGVudHJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbnRyaWVzID0gW1xuICAgICAgICB7IGtleTogJ2tleTEnLCBmZXRjaGVyOiBhc3luYyAoKSA9PiAndmFsdWUxJyB9LFxuICAgICAgICB7IGtleTogJ2tleTInLCBmZXRjaGVyOiBhc3luYyAoKSA9PiAndmFsdWUyJyB9LFxuICAgICAgICB7IGtleTogJ2tleTMnLCBmZXRjaGVyOiBhc3luYyAoKSA9PiAndmFsdWUzJyB9LFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgYXdhaXQgY2FjaGUucHJld2FybShlbnRyaWVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNhY2hlLmdldCgna2V5MScpKS50b0JlKCd2YWx1ZTEnKTtcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTInKSkudG9CZSgndmFsdWUyJyk7XG4gICAgICBleHBlY3QoY2FjaGUuZ2V0KCdrZXkzJykpLnRvQmUoJ3ZhbHVlMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdXBwb3J0IGN1c3RvbSBUVEwgaW4gcHJld2FybScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBbXG4gICAgICAgIHsga2V5OiAna2V5MScsIGZldGNoZXI6IGFzeW5jICgpID0+ICd2YWx1ZTEnLCB0dGw6IDEwMDAgfSxcbiAgICAgIF07XG4gICAgICBcbiAgICAgIGF3YWl0IGNhY2hlLnByZXdhcm0oZW50cmllcyk7XG4gICAgICBcbiAgICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSgxMDAxKTtcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTEnKSkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0VkZ2UgQ2FzZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5ncycsICgpID0+IHtcbiAgICAgIGNhY2hlLnNldCgna2V5MScsICcnKTtcbiAgICAgIGV4cGVjdChjYWNoZS5nZXQoJ2tleTEnKSkudG9CZSgnJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBudW1lcmljIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG51bWJlckNhY2hlID0gbmV3IENhY2hlTWFuYWdlcjxudW1iZXI+KCk7XG4gICAgICBudW1iZXJDYWNoZS5zZXQoJ2tleTEnLCA0Mik7XG4gICAgICBleHBlY3QobnVtYmVyQ2FjaGUuZ2V0KCdrZXkxJykpLnRvQmUoNDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgb2JqZWN0IHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG9iamVjdENhY2hlID0gbmV3IENhY2hlTWFuYWdlcjx7IHZhbHVlOiBzdHJpbmcgfT4oKTtcbiAgICAgIGNvbnN0IG9iaiA9IHsgdmFsdWU6ICd0ZXN0JyB9O1xuICAgICAgb2JqZWN0Q2FjaGUuc2V0KCdrZXkxJywgb2JqKTtcbiAgICAgIGV4cGVjdChvYmplY3RDYWNoZS5nZXQoJ2tleTEnKSkudG9FcXVhbChvYmopO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5kZWZpbmVkIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFueUNhY2hlID0gbmV3IENhY2hlTWFuYWdlcjxhbnk+KCk7XG4gICAgICBhbnlDYWNoZS5zZXQoJ2tleTEnLCB1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KGFueUNhY2hlLmdldCgna2V5MScpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdNZWRpYUNhY2hlJywgKCkgPT4ge1xuICBsZXQgbWVkaWFDYWNoZTogTWVkaWFDYWNoZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtZWRpYUNhY2hlID0gbmV3IE1lZGlhQ2FjaGUoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBtZWRpYUNhY2hlLmNsZWFyKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCYXNpYyBPcGVyYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FjaGUgYmxvYiB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoWyd0ZXN0J10sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pO1xuICAgICAgbWVkaWFDYWNoZS5zZXQoJ3Rlc3QudHh0JywgYmxvYik7XG4gICAgICBcbiAgICAgIGNvbnN0IGNhY2hlZCA9IG1lZGlhQ2FjaGUuZ2V0KCd0ZXN0LnR4dCcpO1xuICAgICAgZXhwZWN0KGNhY2hlZCkudG9CZShibG9iKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG9iamVjdCBVUkxzIGZyb20gY2FjaGVkIGJsb2JzJywgKCkgPT4ge1xuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFsndGVzdCddLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTtcbiAgICAgIG1lZGlhQ2FjaGUuc2V0KCd0ZXN0LnR4dCcsIGJsb2IpO1xuICAgICAgXG4gICAgICBjb25zdCB1cmwgPSBtZWRpYUNhY2hlLmdldE9iamVjdFVSTCgndGVzdC50eHQnKTtcbiAgICAgIGV4cGVjdCh1cmwpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgdXJsKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgIGV4cGVjdCh1cmwpLnRvTWF0Y2goL15ibG9iOi8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBmb3Igbm9uLWV4aXN0ZW50IGJsb2IgVVJMcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHVybCA9IG1lZGlhQ2FjaGUuZ2V0T2JqZWN0VVJMKCdub25leGlzdGVudCcpO1xuICAgICAgZXhwZWN0KHVybCkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhY2hlRnJvbVVSTCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmV0Y2ggYW5kIGNhY2hlIGZyb20gVVJMJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0Jsb2IgPSBuZXcgQmxvYihbJ2NvbnRlbnQnXSwgeyB0eXBlOiAnaW1hZ2UvcG5nJyB9KTtcbiAgICAgIChnbG9iYWwuZmV0Y2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIG9rOiB0cnVlLFxuICAgICAgICBibG9iOiBhc3luYyAoKSA9PiBtb2NrQmxvYixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtZWRpYUNhY2hlLmNhY2hlRnJvbVVSTCgnaW1hZ2UnLCAnaHR0cDovL2V4YW1wbGUuY29tL2ltYWdlLnBuZycpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKG1vY2tCbG9iKTtcbiAgICAgIGV4cGVjdChtZWRpYUNhY2hlLmdldCgnaW1hZ2UnKSkudG9CZShtb2NrQmxvYik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIG9uIGZhaWxlZCBmZXRjaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChnbG9iYWwuZmV0Y2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIG9rOiBmYWxzZSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIG1lZGlhQ2FjaGUuY2FjaGVGcm9tVVJMKCdpbWFnZScsICdodHRwOi8vZXhhbXBsZS5jb20vZmFpbC5wbmcnKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBmZXRjaCBpbWFnZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY2FjaGVkIHZhbHVlIG9uIHN1YnNlcXVlbnQgY2FsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQmxvYiA9IG5ldyBCbG9iKFsnY29udGVudCddLCB7IHR5cGU6ICdpbWFnZS9wbmcnIH0pO1xuICAgICAgKGdsb2JhbC5mZXRjaCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgb2s6IHRydWUsXG4gICAgICAgIGJsb2I6IGFzeW5jICgpID0+IG1vY2tCbG9iLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IG1lZGlhQ2FjaGUuY2FjaGVGcm9tVVJMKCdpbWFnZScsICdodHRwOi8vZXhhbXBsZS5jb20vaW1hZ2UucG5nJyk7XG4gICAgICBhd2FpdCBtZWRpYUNhY2hlLmNhY2hlRnJvbVVSTCgnaW1hZ2UnLCAnaHR0cDovL2V4YW1wbGUuY29tL2ltYWdlLnBuZycpO1xuICAgICAgXG4gICAgICBleHBlY3QoZ2xvYmFsLmZldGNoKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=