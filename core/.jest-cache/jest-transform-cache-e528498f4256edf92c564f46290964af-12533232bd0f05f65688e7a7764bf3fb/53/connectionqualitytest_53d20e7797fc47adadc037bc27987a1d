392044bc7dbf82d149771ce7022cdff9
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const connection_quality_1 = require("./connection-quality");
describe('Connection Quality', () => {
    describe('calculateConnectionQuality', () => {
        it('should return offline if latency is Infinity', () => {
            const metrics = {
                latency: Infinity,
                packetLoss: 0,
                bandwidth: 0,
                jitter: 0
            };
            expect((0, connection_quality_1.calculateConnectionQuality)(metrics)).toBe('offline');
        });
        it('should return excellent for low latency and packet loss', () => {
            const metrics = {
                latency: 40,
                packetLoss: 0.5,
                bandwidth: 1000,
                jitter: 5
            };
            expect((0, connection_quality_1.calculateConnectionQuality)(metrics)).toBe('excellent');
        });
        it('should return good for moderate latency and packet loss', () => {
            const metrics = {
                latency: 80,
                packetLoss: 2,
                bandwidth: 1000,
                jitter: 10
            };
            expect((0, connection_quality_1.calculateConnectionQuality)(metrics)).toBe('good');
        });
        it('should return fair for higher latency and packet loss', () => {
            const metrics = {
                latency: 150,
                packetLoss: 8,
                bandwidth: 1000,
                jitter: 20
            };
            expect((0, connection_quality_1.calculateConnectionQuality)(metrics)).toBe('fair');
        });
        it('should return poor for high latency', () => {
            const metrics = {
                latency: 300,
                packetLoss: 0,
                bandwidth: 1000,
                jitter: 5
            };
            expect((0, connection_quality_1.calculateConnectionQuality)(metrics)).toBe('poor');
        });
        it('should return poor for high packet loss', () => {
            const metrics = {
                latency: 40,
                packetLoss: 15,
                bandwidth: 1000,
                jitter: 5
            };
            expect((0, connection_quality_1.calculateConnectionQuality)(metrics)).toBe('poor');
        });
    });
    describe('ConnectionMonitor', () => {
        let monitor;
        beforeEach(() => {
            monitor = new connection_quality_1.ConnectionMonitor();
        });
        it('should initialize with default metrics', () => {
            const metrics = monitor.getMetrics();
            expect(metrics.latency).toBe(Infinity);
            expect(metrics.packetLoss).toBe(0);
            expect(metrics.bandwidth).toBe(0);
            expect(metrics.jitter).toBe(0);
        });
        it('should update latency and calculate average', () => {
            monitor.updateLatency(100);
            expect(monitor.getMetrics().latency).toBe(100);
            monitor.updateLatency(200);
            expect(monitor.getMetrics().latency).toBe(150); // (100 + 200) / 2
        });
        it('should calculate jitter', () => {
            monitor.updateLatency(100);
            monitor.updateLatency(110);
            // diff is 10, jitter is 10
            expect(monitor.getMetrics().jitter).toBe(10);
            monitor.updateLatency(100);
            // diffs: 10, 10. jitter: 10
            expect(monitor.getMetrics().jitter).toBe(10);
        });
        it('should update packet loss', () => {
            monitor.updatePacketLoss(100, 95);
            expect(monitor.getMetrics().packetLoss).toBe(5); // 5% loss
        });
        it('should update bandwidth', () => {
            monitor.updateBandwidth(1000, 1000); // 1000 bytes in 1000ms
            expect(monitor.getMetrics().bandwidth).toBe(1000); // 1000 bytes/sec
        });
        it('should return correct quality based on metrics', () => {
            expect(monitor.getQuality()).toBe('offline');
            monitor.updateLatency(40);
            monitor.updatePacketLoss(100, 100); // 0% loss
            expect(monitor.getQuality()).toBe('excellent');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29ubmVjdGlvbi1xdWFsaXR5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2REFJOEI7QUFFOUIsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQzFDLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7WUFDdEQsTUFBTSxPQUFPLEdBQXNCO2dCQUNqQyxPQUFPLEVBQUUsUUFBUTtnQkFDakIsVUFBVSxFQUFFLENBQUM7Z0JBQ2IsU0FBUyxFQUFFLENBQUM7Z0JBQ1osTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUEsK0NBQTBCLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseURBQXlELEVBQUUsR0FBRyxFQUFFO1lBQ2pFLE1BQU0sT0FBTyxHQUFzQjtnQkFDakMsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsVUFBVSxFQUFFLEdBQUc7Z0JBQ2YsU0FBUyxFQUFFLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUEsK0NBQTBCLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseURBQXlELEVBQUUsR0FBRyxFQUFFO1lBQ2pFLE1BQU0sT0FBTyxHQUFzQjtnQkFDakMsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsVUFBVSxFQUFFLENBQUM7Z0JBQ2IsU0FBUyxFQUFFLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLEVBQUU7YUFDWCxDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUEsK0NBQTBCLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdURBQXVELEVBQUUsR0FBRyxFQUFFO1lBQy9ELE1BQU0sT0FBTyxHQUFzQjtnQkFDakMsT0FBTyxFQUFFLEdBQUc7Z0JBQ1osVUFBVSxFQUFFLENBQUM7Z0JBQ2IsU0FBUyxFQUFFLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLEVBQUU7YUFDWCxDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUEsK0NBQTBCLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzdDLE1BQU0sT0FBTyxHQUFzQjtnQkFDakMsT0FBTyxFQUFFLEdBQUc7Z0JBQ1osVUFBVSxFQUFFLENBQUM7Z0JBQ2IsU0FBUyxFQUFFLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUEsK0NBQTBCLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sT0FBTyxHQUFzQjtnQkFDakMsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsVUFBVSxFQUFFLEVBQUU7Z0JBQ2QsU0FBUyxFQUFFLElBQUk7Z0JBQ2YsTUFBTSxFQUFFLENBQUM7YUFDVixDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUEsK0NBQTBCLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsSUFBSSxPQUEwQixDQUFDO1FBRS9CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxPQUFPLEdBQUcsSUFBSSxzQ0FBaUIsRUFBRSxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1lBQ3JELE9BQU8sQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDM0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFL0MsT0FBTyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGtCQUFrQjtRQUNwRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMzQixPQUFPLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzNCLDJCQUEyQjtZQUMzQixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUU3QyxPQUFPLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzNCLDRCQUE0QjtZQUM1QixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVU7UUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1lBQ2pDLE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsdUJBQXVCO1lBQzVELE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsaUJBQWlCO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtZQUN4RCxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTdDLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDMUIsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLFVBQVU7WUFDOUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29ubmVjdGlvbi1xdWFsaXR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIGNhbGN1bGF0ZUNvbm5lY3Rpb25RdWFsaXR5LCBcbiAgQ29ubmVjdGlvbk1vbml0b3IsIFxuICBDb25uZWN0aW9uTWV0cmljcyBcbn0gZnJvbSAnLi9jb25uZWN0aW9uLXF1YWxpdHknO1xuXG5kZXNjcmliZSgnQ29ubmVjdGlvbiBRdWFsaXR5JywgKCkgPT4ge1xuICBkZXNjcmliZSgnY2FsY3VsYXRlQ29ubmVjdGlvblF1YWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gb2ZmbGluZSBpZiBsYXRlbmN5IGlzIEluZmluaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0cmljczogQ29ubmVjdGlvbk1ldHJpY3MgPSB7XG4gICAgICAgIGxhdGVuY3k6IEluZmluaXR5LFxuICAgICAgICBwYWNrZXRMb3NzOiAwLFxuICAgICAgICBiYW5kd2lkdGg6IDAsXG4gICAgICAgIGppdHRlcjogMFxuICAgICAgfTtcbiAgICAgIGV4cGVjdChjYWxjdWxhdGVDb25uZWN0aW9uUXVhbGl0eShtZXRyaWNzKSkudG9CZSgnb2ZmbGluZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXhjZWxsZW50IGZvciBsb3cgbGF0ZW5jeSBhbmQgcGFja2V0IGxvc3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRyaWNzOiBDb25uZWN0aW9uTWV0cmljcyA9IHtcbiAgICAgICAgbGF0ZW5jeTogNDAsXG4gICAgICAgIHBhY2tldExvc3M6IDAuNSxcbiAgICAgICAgYmFuZHdpZHRoOiAxMDAwLFxuICAgICAgICBqaXR0ZXI6IDVcbiAgICAgIH07XG4gICAgICBleHBlY3QoY2FsY3VsYXRlQ29ubmVjdGlvblF1YWxpdHkobWV0cmljcykpLnRvQmUoJ2V4Y2VsbGVudCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZ29vZCBmb3IgbW9kZXJhdGUgbGF0ZW5jeSBhbmQgcGFja2V0IGxvc3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRyaWNzOiBDb25uZWN0aW9uTWV0cmljcyA9IHtcbiAgICAgICAgbGF0ZW5jeTogODAsXG4gICAgICAgIHBhY2tldExvc3M6IDIsXG4gICAgICAgIGJhbmR3aWR0aDogMTAwMCxcbiAgICAgICAgaml0dGVyOiAxMFxuICAgICAgfTtcbiAgICAgIGV4cGVjdChjYWxjdWxhdGVDb25uZWN0aW9uUXVhbGl0eShtZXRyaWNzKSkudG9CZSgnZ29vZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFpciBmb3IgaGlnaGVyIGxhdGVuY3kgYW5kIHBhY2tldCBsb3NzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0cmljczogQ29ubmVjdGlvbk1ldHJpY3MgPSB7XG4gICAgICAgIGxhdGVuY3k6IDE1MCxcbiAgICAgICAgcGFja2V0TG9zczogOCxcbiAgICAgICAgYmFuZHdpZHRoOiAxMDAwLFxuICAgICAgICBqaXR0ZXI6IDIwXG4gICAgICB9O1xuICAgICAgZXhwZWN0KGNhbGN1bGF0ZUNvbm5lY3Rpb25RdWFsaXR5KG1ldHJpY3MpKS50b0JlKCdmYWlyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBwb29yIGZvciBoaWdoIGxhdGVuY3knLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRyaWNzOiBDb25uZWN0aW9uTWV0cmljcyA9IHtcbiAgICAgICAgbGF0ZW5jeTogMzAwLFxuICAgICAgICBwYWNrZXRMb3NzOiAwLFxuICAgICAgICBiYW5kd2lkdGg6IDEwMDAsXG4gICAgICAgIGppdHRlcjogNVxuICAgICAgfTtcbiAgICAgIGV4cGVjdChjYWxjdWxhdGVDb25uZWN0aW9uUXVhbGl0eShtZXRyaWNzKSkudG9CZSgncG9vcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcG9vciBmb3IgaGlnaCBwYWNrZXQgbG9zcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1ldHJpY3M6IENvbm5lY3Rpb25NZXRyaWNzID0ge1xuICAgICAgICBsYXRlbmN5OiA0MCxcbiAgICAgICAgcGFja2V0TG9zczogMTUsXG4gICAgICAgIGJhbmR3aWR0aDogMTAwMCxcbiAgICAgICAgaml0dGVyOiA1XG4gICAgICB9O1xuICAgICAgZXhwZWN0KGNhbGN1bGF0ZUNvbm5lY3Rpb25RdWFsaXR5KG1ldHJpY3MpKS50b0JlKCdwb29yJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25uZWN0aW9uTW9uaXRvcicsICgpID0+IHtcbiAgICBsZXQgbW9uaXRvcjogQ29ubmVjdGlvbk1vbml0b3I7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIG1vbml0b3IgPSBuZXcgQ29ubmVjdGlvbk1vbml0b3IoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSB3aXRoIGRlZmF1bHQgbWV0cmljcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBtb25pdG9yLmdldE1ldHJpY3MoKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmxhdGVuY3kpLnRvQmUoSW5maW5pdHkpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MucGFja2V0TG9zcykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmJhbmR3aWR0aCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmppdHRlcikudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGxhdGVuY3kgYW5kIGNhbGN1bGF0ZSBhdmVyYWdlJywgKCkgPT4ge1xuICAgICAgbW9uaXRvci51cGRhdGVMYXRlbmN5KDEwMCk7XG4gICAgICBleHBlY3QobW9uaXRvci5nZXRNZXRyaWNzKCkubGF0ZW5jeSkudG9CZSgxMDApO1xuXG4gICAgICBtb25pdG9yLnVwZGF0ZUxhdGVuY3koMjAwKTtcbiAgICAgIGV4cGVjdChtb25pdG9yLmdldE1ldHJpY3MoKS5sYXRlbmN5KS50b0JlKDE1MCk7IC8vICgxMDAgKyAyMDApIC8gMlxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgaml0dGVyJywgKCkgPT4ge1xuICAgICAgbW9uaXRvci51cGRhdGVMYXRlbmN5KDEwMCk7XG4gICAgICBtb25pdG9yLnVwZGF0ZUxhdGVuY3koMTEwKTtcbiAgICAgIC8vIGRpZmYgaXMgMTAsIGppdHRlciBpcyAxMFxuICAgICAgZXhwZWN0KG1vbml0b3IuZ2V0TWV0cmljcygpLmppdHRlcikudG9CZSgxMCk7XG5cbiAgICAgIG1vbml0b3IudXBkYXRlTGF0ZW5jeSgxMDApO1xuICAgICAgLy8gZGlmZnM6IDEwLCAxMC4gaml0dGVyOiAxMFxuICAgICAgZXhwZWN0KG1vbml0b3IuZ2V0TWV0cmljcygpLmppdHRlcikudG9CZSgxMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBwYWNrZXQgbG9zcycsICgpID0+IHtcbiAgICAgIG1vbml0b3IudXBkYXRlUGFja2V0TG9zcygxMDAsIDk1KTtcbiAgICAgIGV4cGVjdChtb25pdG9yLmdldE1ldHJpY3MoKS5wYWNrZXRMb3NzKS50b0JlKDUpOyAvLyA1JSBsb3NzXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBiYW5kd2lkdGgnLCAoKSA9PiB7XG4gICAgICBtb25pdG9yLnVwZGF0ZUJhbmR3aWR0aCgxMDAwLCAxMDAwKTsgLy8gMTAwMCBieXRlcyBpbiAxMDAwbXNcbiAgICAgIGV4cGVjdChtb25pdG9yLmdldE1ldHJpY3MoKS5iYW5kd2lkdGgpLnRvQmUoMTAwMCk7IC8vIDEwMDAgYnl0ZXMvc2VjXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IHF1YWxpdHkgYmFzZWQgb24gbWV0cmljcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChtb25pdG9yLmdldFF1YWxpdHkoKSkudG9CZSgnb2ZmbGluZScpO1xuXG4gICAgICBtb25pdG9yLnVwZGF0ZUxhdGVuY3koNDApO1xuICAgICAgbW9uaXRvci51cGRhdGVQYWNrZXRMb3NzKDEwMCwgMTAwKTsgLy8gMCUgbG9zc1xuICAgICAgZXhwZWN0KG1vbml0b3IuZ2V0UXVhbGl0eSgpKS50b0JlKCdleGNlbGxlbnQnKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=