c0ccdc73d2953da10adc3c5bfb6c08c6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConnectionMonitor = void 0;
exports.calculateConnectionQuality = calculateConnectionQuality;
function calculateConnectionQuality(metrics) {
    if (metrics.latency === Infinity) {
        return 'offline';
    }
    // Excellent: <50ms latency, <1% packet loss
    if (metrics.latency < 50 && metrics.packetLoss < 1) {
        return 'excellent';
    }
    // Good: <100ms latency, <5% packet loss
    if (metrics.latency < 100 && metrics.packetLoss < 5) {
        return 'good';
    }
    // Fair: <200ms latency, <10% packet loss
    if (metrics.latency < 200 && metrics.packetLoss < 10) {
        return 'fair';
    }
    // Poor: everything else
    return 'poor';
}
class ConnectionMonitor {
    constructor() {
        this.metrics = {
            latency: Infinity,
            packetLoss: 0,
            bandwidth: 0,
            jitter: 0
        };
        this.latencyHistory = [];
        this.HISTORY_SIZE = 10;
    }
    updateLatency(latency) {
        this.latencyHistory.push(latency);
        if (this.latencyHistory.length > this.HISTORY_SIZE) {
            this.latencyHistory.shift();
        }
        // Calculate average latency
        this.metrics.latency = this.latencyHistory.reduce((a, b) => a + b, 0) / this.latencyHistory.length;
        // Calculate jitter (variance in latency)
        if (this.latencyHistory.length > 1) {
            const diffs = [];
            for (let i = 1; i < this.latencyHistory.length; i++) {
                diffs.push(Math.abs(this.latencyHistory[i] - this.latencyHistory[i - 1]));
            }
            this.metrics.jitter = diffs.reduce((a, b) => a + b, 0) / diffs.length;
        }
    }
    updatePacketLoss(sent, received) {
        this.metrics.packetLoss = ((sent - received) / sent) * 100;
    }
    updateBandwidth(bytes, durationMs) {
        this.metrics.bandwidth = (bytes / durationMs) * 1000; // bytes per second
    }
    getMetrics() {
        return { ...this.metrics };
    }
    getQuality() {
        return calculateConnectionQuality(this.metrics);
    }
}
exports.ConnectionMonitor = ConnectionMonitor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29ubmVjdGlvbi1xdWFsaXR5LnRzIiwibWFwcGluZ3MiOiI7OztBQVNBLGdFQXNCQztBQXRCRCxTQUFnQiwwQkFBMEIsQ0FBQyxPQUEwQjtJQUNuRSxJQUFJLE9BQU8sQ0FBQyxPQUFPLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDakMsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELDRDQUE0QztJQUM1QyxJQUFJLE9BQU8sQ0FBQyxPQUFPLEdBQUcsRUFBRSxJQUFJLE9BQU8sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDbkQsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVELHdDQUF3QztJQUN4QyxJQUFJLE9BQU8sQ0FBQyxPQUFPLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDcEQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELHlDQUF5QztJQUN6QyxJQUFJLE9BQU8sQ0FBQyxPQUFPLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxVQUFVLEdBQUcsRUFBRSxFQUFFLENBQUM7UUFDckQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELHdCQUF3QjtJQUN4QixPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQsTUFBYSxpQkFBaUI7SUFBOUI7UUFDVSxZQUFPLEdBQXNCO1lBQ25DLE9BQU8sRUFBRSxRQUFRO1lBQ2pCLFVBQVUsRUFBRSxDQUFDO1lBQ2IsU0FBUyxFQUFFLENBQUM7WUFDWixNQUFNLEVBQUUsQ0FBQztTQUNWLENBQUM7UUFFTSxtQkFBYyxHQUFhLEVBQUUsQ0FBQztRQUNyQixpQkFBWSxHQUFHLEVBQUUsQ0FBQztJQW9DckMsQ0FBQztJQWxDQyxhQUFhLENBQUMsT0FBZTtRQUMzQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsQyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNuRCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlCLENBQUM7UUFFRCw0QkFBNEI7UUFDNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDO1FBRW5HLHlDQUF5QztRQUN6QyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ25DLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNqQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDcEQsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVFLENBQUM7WUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3hFLENBQUM7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCLENBQUMsSUFBWSxFQUFFLFFBQWdCO1FBQzdDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQzdELENBQUM7SUFFRCxlQUFlLENBQUMsS0FBYSxFQUFFLFVBQWtCO1FBQy9DLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLG1CQUFtQjtJQUMzRSxDQUFDO0lBRUQsVUFBVTtRQUNSLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQsVUFBVTtRQUNSLE9BQU8sMEJBQTBCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xELENBQUM7Q0FDRjtBQTdDRCw4Q0E2Q0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvY29ubmVjdGlvbi1xdWFsaXR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBpbnRlcmZhY2UgQ29ubmVjdGlvbk1ldHJpY3Mge1xuICBsYXRlbmN5OiBudW1iZXI7IC8vIG1zXG4gIHBhY2tldExvc3M6IG51bWJlcjsgLy8gcGVyY2VudGFnZVxuICBiYW5kd2lkdGg6IG51bWJlcjsgLy8gYnl0ZXMvc2VjXG4gIGppdHRlcjogbnVtYmVyOyAvLyBtc1xufVxuXG5leHBvcnQgdHlwZSBDb25uZWN0aW9uUXVhbGl0eSA9ICdleGNlbGxlbnQnIHwgJ2dvb2QnIHwgJ2ZhaXInIHwgJ3Bvb3InIHwgJ29mZmxpbmUnO1xuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQ29ubmVjdGlvblF1YWxpdHkobWV0cmljczogQ29ubmVjdGlvbk1ldHJpY3MpOiBDb25uZWN0aW9uUXVhbGl0eSB7XG4gIGlmIChtZXRyaWNzLmxhdGVuY3kgPT09IEluZmluaXR5KSB7XG4gICAgcmV0dXJuICdvZmZsaW5lJztcbiAgfVxuICBcbiAgLy8gRXhjZWxsZW50OiA8NTBtcyBsYXRlbmN5LCA8MSUgcGFja2V0IGxvc3NcbiAgaWYgKG1ldHJpY3MubGF0ZW5jeSA8IDUwICYmIG1ldHJpY3MucGFja2V0TG9zcyA8IDEpIHtcbiAgICByZXR1cm4gJ2V4Y2VsbGVudCc7XG4gIH1cbiAgXG4gIC8vIEdvb2Q6IDwxMDBtcyBsYXRlbmN5LCA8NSUgcGFja2V0IGxvc3NcbiAgaWYgKG1ldHJpY3MubGF0ZW5jeSA8IDEwMCAmJiBtZXRyaWNzLnBhY2tldExvc3MgPCA1KSB7XG4gICAgcmV0dXJuICdnb29kJztcbiAgfVxuICBcbiAgLy8gRmFpcjogPDIwMG1zIGxhdGVuY3ksIDwxMCUgcGFja2V0IGxvc3NcbiAgaWYgKG1ldHJpY3MubGF0ZW5jeSA8IDIwMCAmJiBtZXRyaWNzLnBhY2tldExvc3MgPCAxMCkge1xuICAgIHJldHVybiAnZmFpcic7XG4gIH1cbiAgXG4gIC8vIFBvb3I6IGV2ZXJ5dGhpbmcgZWxzZVxuICByZXR1cm4gJ3Bvb3InO1xufVxuXG5leHBvcnQgY2xhc3MgQ29ubmVjdGlvbk1vbml0b3Ige1xuICBwcml2YXRlIG1ldHJpY3M6IENvbm5lY3Rpb25NZXRyaWNzID0ge1xuICAgIGxhdGVuY3k6IEluZmluaXR5LFxuICAgIHBhY2tldExvc3M6IDAsXG4gICAgYmFuZHdpZHRoOiAwLFxuICAgIGppdHRlcjogMFxuICB9O1xuICBcbiAgcHJpdmF0ZSBsYXRlbmN5SGlzdG9yeTogbnVtYmVyW10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBISVNUT1JZX1NJWkUgPSAxMDtcbiAgXG4gIHVwZGF0ZUxhdGVuY3kobGF0ZW5jeTogbnVtYmVyKSB7XG4gICAgdGhpcy5sYXRlbmN5SGlzdG9yeS5wdXNoKGxhdGVuY3kpO1xuICAgIGlmICh0aGlzLmxhdGVuY3lIaXN0b3J5Lmxlbmd0aCA+IHRoaXMuSElTVE9SWV9TSVpFKSB7XG4gICAgICB0aGlzLmxhdGVuY3lIaXN0b3J5LnNoaWZ0KCk7XG4gICAgfVxuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIGxhdGVuY3lcbiAgICB0aGlzLm1ldHJpY3MubGF0ZW5jeSA9IHRoaXMubGF0ZW5jeUhpc3RvcnkucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyB0aGlzLmxhdGVuY3lIaXN0b3J5Lmxlbmd0aDtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgaml0dGVyICh2YXJpYW5jZSBpbiBsYXRlbmN5KVxuICAgIGlmICh0aGlzLmxhdGVuY3lIaXN0b3J5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IGRpZmZzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMubGF0ZW5jeUhpc3RvcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZGlmZnMucHVzaChNYXRoLmFicyh0aGlzLmxhdGVuY3lIaXN0b3J5W2ldIC0gdGhpcy5sYXRlbmN5SGlzdG9yeVtpIC0gMV0pKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubWV0cmljcy5qaXR0ZXIgPSBkaWZmcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIGRpZmZzLmxlbmd0aDtcbiAgICB9XG4gIH1cbiAgXG4gIHVwZGF0ZVBhY2tldExvc3Moc2VudDogbnVtYmVyLCByZWNlaXZlZDogbnVtYmVyKSB7XG4gICAgdGhpcy5tZXRyaWNzLnBhY2tldExvc3MgPSAoKHNlbnQgLSByZWNlaXZlZCkgLyBzZW50KSAqIDEwMDtcbiAgfVxuICBcbiAgdXBkYXRlQmFuZHdpZHRoKGJ5dGVzOiBudW1iZXIsIGR1cmF0aW9uTXM6IG51bWJlcikge1xuICAgIHRoaXMubWV0cmljcy5iYW5kd2lkdGggPSAoYnl0ZXMgLyBkdXJhdGlvbk1zKSAqIDEwMDA7IC8vIGJ5dGVzIHBlciBzZWNvbmRcbiAgfVxuICBcbiAgZ2V0TWV0cmljcygpOiBDb25uZWN0aW9uTWV0cmljcyB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5tZXRyaWNzIH07XG4gIH1cbiAgXG4gIGdldFF1YWxpdHkoKTogQ29ubmVjdGlvblF1YWxpdHkge1xuICAgIHJldHVybiBjYWxjdWxhdGVDb25uZWN0aW9uUXVhbGl0eSh0aGlzLm1ldHJpY3MpO1xuICB9XG59Il0sInZlcnNpb24iOjN9