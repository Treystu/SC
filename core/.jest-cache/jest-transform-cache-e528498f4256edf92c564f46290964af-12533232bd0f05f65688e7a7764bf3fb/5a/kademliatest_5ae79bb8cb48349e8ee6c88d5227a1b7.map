{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/dht/kademlia.test.ts","mappings":";AAAA;;GAEG;;AAEH,yCAAkD;AAElD,uCAAwE;AAExE,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;IACpC,IAAI,YAAkC,CAAC;IACvC,IAAI,WAAuB,CAAC;IAE5B,UAAU,CAAC,GAAG,EAAE;QACd,WAAW,GAAG,IAAA,wBAAc,GAAE,CAAC;QAC/B,YAAY,GAAG,IAAI,+BAAoB,CAAC,WAAW,EAAE;YACnD,CAAC,EAAE,EAAE;YACL,KAAK,EAAE,CAAC;YACR,WAAW,EAAE,IAAI;SAClB,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,YAAY,CAAC,IAAI,EAAE,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,SAAS,aAAa,CAAC,MAAmB;QACxC,MAAM,EAAE,GAAG,MAAM,IAAI,IAAA,wBAAc,GAAE,CAAC;QACtC,OAAO;YACL,MAAM,EAAE,EAAE;YACV,MAAM,EAAE,IAAA,qBAAW,EAAC,EAAE,CAAC;YACvB,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE;YACpB,YAAY,EAAE,CAAC;SAChB,CAAC;IACJ,CAAC;IAED,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,EAAE,CAAC,qBAAqB,EAAE,GAAG,EAAE;YAC7B,MAAM,OAAO,GAAG,aAAa,EAAE,CAAC;YAChC,MAAM,MAAM,GAAG,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;YAEhD,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAChC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;QAChE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qBAAqB,EAAE,GAAG,EAAE;YAC7B,MAAM,WAAW,GAAG,aAAa,CAAC,WAAW,CAAC,CAAC;YAC/C,MAAM,MAAM,GAAG,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;YAEpD,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wBAAwB,EAAE,GAAG,EAAE;YAChC,MAAM,OAAO,GAAG,aAAa,EAAE,CAAC;YAChC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;YAEjC,MAAM,OAAO,GAAG,YAAY,CAAC,aAAa,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC3D,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3B,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;QAClE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;YACrC,uBAAuB;YACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC5B,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC;YAC3C,CAAC;YAED,MAAM,MAAM,GAAG,IAAA,wBAAc,GAAE,CAAC;YAChC,MAAM,OAAO,GAAG,YAAY,CAAC,kBAAkB,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YAE3D,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yBAAyB,EAAE,GAAG,EAAE;YACjC,MAAM,QAAQ,GAAG,CAAC,aAAa,EAAE,EAAE,aAAa,EAAE,EAAE,aAAa,EAAE,CAAC,CAAC;YACrE,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;YAElD,MAAM,GAAG,GAAG,YAAY,CAAC,cAAc,EAAE,CAAC;YAC1C,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;QAC7B,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;YACrC,MAAM,GAAG,GAAG,IAAA,wBAAc,EAAC,UAAU,CAAC,CAAC;YACvC,MAAM,KAAK,GAAa;gBACtB,IAAI,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/B,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE;gBACpB,GAAG,EAAE,OAAO;gBACZ,WAAW,EAAE,WAAW;aACzB,CAAC;YAEF,YAAY,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;YACpC,MAAM,SAAS,GAAG,YAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAE7C,MAAM,CAAC,SAAS,CAAC,CAAC,WAAW,EAAE,CAAC;YAChC,MAAM,CAAC,SAAU,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,+CAA+C,EAAE,GAAG,EAAE;YACvD,MAAM,GAAG,GAAG,IAAA,wBAAc,EAAC,cAAc,CAAC,CAAC;YAC3C,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC;QACrD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAChC,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;YAC9B,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;gBACrC,oBAAoB;gBACpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;oBAC3B,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC;gBAC3C,CAAC;gBAED,MAAM,QAAQ,GAAG,IAAA,wBAAc,GAAE,CAAC;gBAClC,MAAM,OAAO,GAAoB;oBAC/B,IAAI,EAAE,WAAuC;oBAC7C,QAAQ,EAAE,IAAA,wBAAc,GAAE;oBAC1B,SAAS,EAAE,QAAQ;oBACnB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;oBACrB,QAAQ;iBACT,CAAC;gBAEF,MAAM,QAAQ,GAAG,YAAY,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;gBAEtD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;gBACjD,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAC1C,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,mCAAmC,EAAE,GAAG,EAAE;gBAC3C,MAAM,QAAQ,GAAG,IAAA,wBAAc,GAAE,CAAC;gBAClC,MAAM,OAAO,GAAoB;oBAC/B,IAAI,EAAE,WAAuC;oBAC7C,QAAQ;oBACR,SAAS,EAAE,QAAQ;oBACnB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;oBACrB,QAAQ,EAAE,IAAA,wBAAc,GAAE;iBAC3B,CAAC;gBAEF,YAAY,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;gBAErC,MAAM,OAAO,GAAG,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAClD,MAAM,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC;YAChC,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,iBAAiB,EAAE,GAAG,EAAE;YAC/B,EAAE,CAAC,8BAA8B,EAAE,GAAG,EAAE;gBACtC,MAAM,GAAG,GAAG,IAAA,wBAAc,EAAC,UAAU,CAAC,CAAC;gBACvC,MAAM,KAAK,GAAa;oBACtB,IAAI,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC/B,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE;oBACpB,GAAG,EAAE,OAAO;oBACZ,WAAW,EAAE,WAAW;iBACzB,CAAC;gBACF,YAAY,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;gBAEpC,MAAM,OAAO,GAAqB;oBAChC,IAAI,EAAE,YAAyC;oBAC/C,QAAQ,EAAE,IAAA,wBAAc,GAAE;oBAC1B,SAAS,EAAE,QAAQ;oBACnB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;oBACrB,GAAG;iBACJ,CAAC;gBAEF,MAAM,QAAQ,GAAG,YAAY,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;gBAEvD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;gBAClD,MAAM,CAAE,QAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC3D,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,wCAAwC,EAAE,GAAG,EAAE;gBAChD,oBAAoB;gBACpB,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC;gBAEzC,MAAM,OAAO,GAAqB;oBAChC,IAAI,EAAE,YAAyC;oBAC/C,QAAQ,EAAE,IAAA,wBAAc,GAAE;oBAC1B,SAAS,EAAE,QAAQ;oBACnB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;oBACrB,GAAG,EAAE,IAAA,wBAAc,EAAC,cAAc,CAAC;iBACpC,CAAC;gBAEF,MAAM,QAAQ,GAAG,YAAY,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;gBAEvD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;gBAC/C,MAAM,CAAE,QAAgB,CAAC,KAAK,CAAC,CAAC,WAAW,EAAE,CAAC;YAChD,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,aAAa,EAAE,GAAG,EAAE;YAC3B,EAAE,CAAC,uCAAuC,EAAE,GAAG,EAAE;gBAC/C,MAAM,GAAG,GAAG,IAAA,wBAAc,EAAC,UAAU,CAAC,CAAC;gBACvC,MAAM,KAAK,GAAa;oBACtB,IAAI,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC/B,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE;oBACpB,GAAG,EAAE,OAAO;oBACZ,WAAW,EAAE,IAAA,wBAAc,GAAE;iBAC9B,CAAC;gBAEF,MAAM,OAAO,GAAiB;oBAC5B,IAAI,EAAE,OAA+B;oBACrC,QAAQ,EAAE,IAAA,wBAAc,GAAE;oBAC1B,SAAS,EAAE,QAAQ;oBACnB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;oBACrB,GAAG;oBACH,KAAK;iBACN,CAAC;gBAEF,MAAM,QAAQ,GAAG,YAAY,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBAEnD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;gBAC7C,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAEpC,gBAAgB;gBAChB,MAAM,MAAM,GAAG,YAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;gBAC1C,MAAM,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC;YAC/B,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,YAAY,EAAE,GAAG,EAAE;YAC1B,EAAE,CAAC,oBAAoB,EAAE,GAAG,EAAE;gBAC5B,MAAM,OAAO,GAAgB;oBAC3B,IAAI,EAAE,MAA6B;oBACnC,QAAQ,EAAE,IAAA,wBAAc,GAAE;oBAC1B,SAAS,EAAE,QAAQ;oBACnB,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;iBACtB,CAAC;gBAEF,MAAM,QAAQ,GAAG,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;gBAElD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACnC,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC5C,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,YAAY,EAAE,GAAG,EAAE;QAC1B,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;YACrC,eAAe;YACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC3B,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC;YAC3C,CAAC;YAED,cAAc;YACd,MAAM,GAAG,GAAG,IAAA,wBAAc,EAAC,MAAM,CAAC,CAAC;YACnC,YAAY,CAAC,UAAU,CAAC,GAAG,EAAE;gBAC3B,IAAI,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;gBACzB,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE;gBACpB,GAAG,EAAE,OAAO;gBACZ,WAAW,EAAE,WAAW;aACzB,CAAC,CAAC;YAEH,MAAM,KAAK,GAAG,YAAY,CAAC,QAAQ,EAAE,CAAC;YAEtC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACjC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAC/C,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC/C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE;QACrB,EAAE,CAAC,uBAAuB,EAAE,GAAG,EAAE;YAC/B,WAAW;YACX,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC;YACzC,YAAY,CAAC,UAAU,CAAC,IAAA,wBAAc,EAAC,MAAM,CAAC,EAAE;gBAC9C,IAAI,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;gBACzB,QAAQ,EAAE,IAAI,CAAC,GAAG,EAAE;gBACpB,GAAG,EAAE,OAAO;gBACZ,WAAW,EAAE,WAAW;aACzB,CAAC,CAAC;YAEH,YAAY,CAAC,KAAK,EAAE,CAAC;YAErB,MAAM,KAAK,GAAG,YAAY,CAAC,QAAQ,EAAE,CAAC;YACtC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAChC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,EAAE,CAAC,mCAAmC,EAAE,GAAG,EAAE;YAC3C,eAAe;YACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC5B,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC,CAAC;YAC3C,CAAC;YAED,MAAM,YAAY,GAAG,YAAY,CAAC,qBAAqB,EAAE,CAAC;YAE1D,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACtC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAC3D,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/mesh/dht/kademlia.test.ts"],"sourcesContent":["/**\n * Kademlia Routing Table Tests\n */\n\nimport { KademliaRoutingTable } from './kademlia';\nimport type { DHTContact, DHTValue, FindNodeRequest, PingRequest, StoreRequest, FindValueRequest, DHTMessageType } from './types';\nimport { generateNodeId, nodeIdToHex, generateDHTKey } from './node-id';\n\ndescribe('KademliaRoutingTable', () => {\n  let routingTable: KademliaRoutingTable;\n  let localNodeId: Uint8Array;\n\n  beforeEach(() => {\n    localNodeId = generateNodeId();\n    routingTable = new KademliaRoutingTable(localNodeId, {\n      k: 20,\n      alpha: 3,\n      pingTimeout: 1000,\n    });\n  });\n\n  afterEach(() => {\n    routingTable.stop();\n  });\n\n  function createContact(nodeId?: Uint8Array): DHTContact {\n    const id = nodeId || generateNodeId();\n    return {\n      nodeId: id,\n      peerId: nodeIdToHex(id),\n      lastSeen: Date.now(),\n      failureCount: 0,\n    };\n  }\n\n  describe('Contact Management', () => {\n    it('should add contacts', () => {\n      const contact = createContact();\n      const result = routingTable.addContact(contact);\n\n      expect(result.added).toBe(true);\n      expect(routingTable.getContact(contact.nodeId)).toBeDefined();\n    });\n\n    it('should not add self', () => {\n      const selfContact = createContact(localNodeId);\n      const result = routingTable.addContact(selfContact);\n\n      expect(result.added).toBe(false);\n    });\n\n    it('should remove contacts', () => {\n      const contact = createContact();\n      routingTable.addContact(contact);\n\n      const removed = routingTable.removeContact(contact.nodeId);\n      expect(removed).toBe(true);\n      expect(routingTable.getContact(contact.nodeId)).toBeUndefined();\n    });\n\n    it('should get closest contacts', () => {\n      // Add several contacts\n      for (let i = 0; i < 10; i++) {\n        routingTable.addContact(createContact());\n      }\n\n      const target = generateNodeId();\n      const closest = routingTable.getClosestContacts(target, 5);\n\n      expect(closest.length).toBeLessThanOrEqual(5);\n    });\n\n    it('should get all contacts', () => {\n      const contacts = [createContact(), createContact(), createContact()];\n      contacts.forEach(c => routingTable.addContact(c));\n\n      const all = routingTable.getAllContacts();\n      expect(all.length).toBe(3);\n    });\n  });\n\n  describe('Local Storage', () => {\n    it('should store values locally', () => {\n      const key = generateDHTKey('test-key');\n      const value: DHTValue = {\n        data: new Uint8Array([1, 2, 3]),\n        storedAt: Date.now(),\n        ttl: 3600000,\n        publisherId: localNodeId,\n      };\n\n      routingTable.storeLocal(key, value);\n      const retrieved = routingTable.getLocal(key);\n\n      expect(retrieved).toBeDefined();\n      expect(retrieved!.data).toEqual(value.data);\n    });\n\n    it('should return undefined for non-existent keys', () => {\n      const key = generateDHTKey('non-existent');\n      expect(routingTable.getLocal(key)).toBeUndefined();\n    });\n  });\n\n  describe('Request Handlers', () => {\n    describe('handleFindNode', () => {\n      it('should return closest nodes', () => {\n        // Add some contacts\n        for (let i = 0; i < 5; i++) {\n          routingTable.addContact(createContact());\n        }\n\n        const targetId = generateNodeId();\n        const request: FindNodeRequest = {\n          type: 'FIND_NODE' as DHTMessageType.FIND_NODE,\n          senderId: generateNodeId(),\n          messageId: 'test-1',\n          timestamp: Date.now(),\n          targetId,\n        };\n\n        const response = routingTable.handleFindNode(request);\n\n        expect(response.type).toBe('FIND_NODE_RESPONSE');\n        expect(response.messageId).toBe('test-1');\n        expect(Array.isArray(response.nodes)).toBe(true);\n      });\n\n      it('should update sender contact info', () => {\n        const senderId = generateNodeId();\n        const request: FindNodeRequest = {\n          type: 'FIND_NODE' as DHTMessageType.FIND_NODE,\n          senderId,\n          messageId: 'test-1',\n          timestamp: Date.now(),\n          targetId: generateNodeId(),\n        };\n\n        routingTable.handleFindNode(request);\n\n        const contact = routingTable.getContact(senderId);\n        expect(contact).toBeDefined();\n      });\n    });\n\n    describe('handleFindValue', () => {\n      it('should return value if found', () => {\n        const key = generateDHTKey('test-key');\n        const value: DHTValue = {\n          data: new Uint8Array([1, 2, 3]),\n          storedAt: Date.now(),\n          ttl: 3600000,\n          publisherId: localNodeId,\n        };\n        routingTable.storeLocal(key, value);\n\n        const request: FindValueRequest = {\n          type: 'FIND_VALUE' as DHTMessageType.FIND_VALUE,\n          senderId: generateNodeId(),\n          messageId: 'test-1',\n          timestamp: Date.now(),\n          key,\n        };\n\n        const response = routingTable.handleFindValue(request);\n\n        expect(response.type).toBe('FIND_VALUE_RESPONSE');\n        expect((response as any).value.data).toEqual(value.data);\n      });\n\n      it('should return nodes if value not found', () => {\n        // Add some contacts\n        routingTable.addContact(createContact());\n\n        const request: FindValueRequest = {\n          type: 'FIND_VALUE' as DHTMessageType.FIND_VALUE,\n          senderId: generateNodeId(),\n          messageId: 'test-1',\n          timestamp: Date.now(),\n          key: generateDHTKey('non-existent'),\n        };\n\n        const response = routingTable.handleFindValue(request);\n\n        expect(response.type).toBe('FIND_VALUE_NODES');\n        expect((response as any).nodes).toBeDefined();\n      });\n    });\n\n    describe('handleStore', () => {\n      it('should store value and return success', () => {\n        const key = generateDHTKey('test-key');\n        const value: DHTValue = {\n          data: new Uint8Array([1, 2, 3]),\n          storedAt: Date.now(),\n          ttl: 3600000,\n          publisherId: generateNodeId(),\n        };\n\n        const request: StoreRequest = {\n          type: 'STORE' as DHTMessageType.STORE,\n          senderId: generateNodeId(),\n          messageId: 'test-1',\n          timestamp: Date.now(),\n          key,\n          value,\n        };\n\n        const response = routingTable.handleStore(request);\n\n        expect(response.type).toBe('STORE_RESPONSE');\n        expect(response.success).toBe(true);\n\n        // Verify stored\n        const stored = routingTable.getLocal(key);\n        expect(stored).toBeDefined();\n      });\n    });\n\n    describe('handlePing', () => {\n      it('should return pong', () => {\n        const request: PingRequest = {\n          type: 'PING' as DHTMessageType.PING,\n          senderId: generateNodeId(),\n          messageId: 'test-1',\n          timestamp: Date.now(),\n        };\n\n        const response = routingTable.handlePing(request);\n\n        expect(response.type).toBe('PONG');\n        expect(response.messageId).toBe('test-1');\n      });\n    });\n  });\n\n  describe('Statistics', () => {\n    it('should return correct stats', () => {\n      // Add contacts\n      for (let i = 0; i < 5; i++) {\n        routingTable.addContact(createContact());\n      }\n\n      // Store value\n      const key = generateDHTKey('test');\n      routingTable.storeLocal(key, {\n        data: new Uint8Array([1]),\n        storedAt: Date.now(),\n        ttl: 3600000,\n        publisherId: localNodeId,\n      });\n\n      const stats = routingTable.getStats();\n\n      expect(stats.nodeCount).toBe(5);\n      expect(stats.valueCount).toBe(1);\n      expect(stats.activeBuckets).toBeGreaterThan(0);\n      expect(stats.memoryUsage).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Clear', () => {\n    it('should clear all data', () => {\n      // Add data\n      routingTable.addContact(createContact());\n      routingTable.storeLocal(generateDHTKey('test'), {\n        data: new Uint8Array([1]),\n        storedAt: Date.now(),\n        ttl: 3600000,\n        publisherId: localNodeId,\n      });\n\n      routingTable.clear();\n\n      const stats = routingTable.getStats();\n      expect(stats.nodeCount).toBe(0);\n      expect(stats.valueCount).toBe(0);\n    });\n  });\n\n  describe('Bucket Distribution', () => {\n    it('should return bucket distribution', () => {\n      // Add contacts\n      for (let i = 0; i < 10; i++) {\n        routingTable.addContact(createContact());\n      }\n\n      const distribution = routingTable.getBucketDistribution();\n\n      expect(distribution.length).toBe(160);\n      expect(distribution.reduce((a, b) => a + b, 0)).toBe(10);\n    });\n  });\n});\n"],"version":3}