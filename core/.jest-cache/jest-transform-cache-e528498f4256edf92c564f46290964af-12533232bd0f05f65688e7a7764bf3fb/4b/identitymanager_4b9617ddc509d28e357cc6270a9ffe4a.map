{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/identity-manager.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/identity-manager.ts"],"sourcesContent":["// Identity and keypair management\nexport interface Identity {\n  id: string;\n  publicKey: CryptoKey;\n  privateKey: CryptoKey;\n  created: Date;\n  displayName?: string;\n}\n\nexport interface IdentityExport {\n  id: string;\n  publicKeyJwk: JsonWebKey;\n  privateKeyJwk: JsonWebKey;\n  created: string;\n  displayName?: string;\n}\n\nexport interface IdentityStorageAdapter {\n  save(key: string, value: string): Promise<void>;\n  load(key: string): Promise<string | null>;\n  remove(key: string): Promise<void>;\n}\n\nexport class LocalStorageAdapter implements IdentityStorageAdapter {\n  async save(key: string, value: string): Promise<void> {\n    if (typeof localStorage !== \"undefined\") {\n      localStorage.setItem(key, value);\n    }\n  }\n\n  async load(key: string): Promise<string | null> {\n    if (typeof localStorage !== \"undefined\") {\n      return localStorage.getItem(key);\n    }\n    return null;\n  }\n\n  async remove(key: string): Promise<void> {\n    if (typeof localStorage !== \"undefined\") {\n      localStorage.removeItem(key);\n    }\n  }\n}\n\nexport class IdentityManager {\n  private identity: Identity | null = null;\n  private storage: IdentityStorageAdapter;\n  private storageKey = \"sovereign-identity\";\n\n  constructor(storage?: IdentityStorageAdapter) {\n    this.storage = storage || new LocalStorageAdapter();\n  }\n\n  // Use the global crypto.subtle which should always be available\n  private get subtle() {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    if (typeof globalThis !== 'undefined' && globalThis.crypto && globalThis.crypto.subtle) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      return globalThis.crypto.subtle;\n    }\n    throw new Error('crypto.subtle is not available in this environment');\n  }\n\n  // Generate new identity\n  async generateIdentity(displayName?: string): Promise<Identity> {\n    // Generate Ed25519 keypair for signing\n    const keyPair = await this.subtle.generateKey(\n      {\n        name: \"Ed25519\",\n        namedCurve: \"Ed25519\",\n      } as any,\n      true,\n      [\"sign\", \"verify\"],\n    );\n\n    // Generate unique ID from public key\n    const publicKeyExport = await this.subtle.exportKey(\n      \"raw\",\n      keyPair.publicKey,\n    );\n    const publicKeyHash = await this.subtle.digest(\n      \"SHA-256\",\n      publicKeyExport,\n    );\n    const id = this.arrayBufferToHex(publicKeyHash)\n      .substring(0, 16)\n      .toUpperCase();\n\n    this.identity = {\n      id,\n      publicKey: keyPair.publicKey,\n      privateKey: keyPair.privateKey,\n      created: new Date(),\n      displayName,\n    };\n\n    await this.saveIdentity();\n    return this.identity;\n  }\n\n  // Load existing identity from storage\n  async loadIdentity(): Promise<Identity | null> {\n    try {\n      const stored = await this.storage.load(this.storageKey);\n      if (!stored) return null;\n\n      const data: IdentityExport = JSON.parse(stored);\n\n      // Import keys\n      const publicKey = await this.subtle.importKey(\n        \"jwk\",\n        data.publicKeyJwk,\n        { name: \"Ed25519\", namedCurve: \"Ed25519\" } as any,\n        true,\n        [\"verify\"],\n      );\n\n      const privateKey = await this.subtle.importKey(\n        \"jwk\",\n        data.privateKeyJwk,\n        { name: \"Ed25519\", namedCurve: \"Ed25519\" } as any,\n        true,\n        [\"sign\"],\n      );\n\n      this.identity = {\n        id: data.id,\n        publicKey,\n        privateKey,\n        created: new Date(data.created),\n        displayName: data.displayName,\n      };\n\n      return this.identity;\n    } catch (error) {\n      console.error(\"Failed to load identity:\", error);\n      return null;\n    }\n  }\n\n  // Save identity to storage\n  private async saveIdentity(): Promise<void> {\n    if (!this.identity) return;\n\n    const exported = await this.exportIdentity();\n    await this.storage.save(this.storageKey, JSON.stringify(exported));\n  }\n\n  // Export identity (for backup)\n  async exportIdentity(): Promise<IdentityExport> {\n    if (!this.identity) throw new Error(\"No identity to export\");\n\n    const publicKeyJwk = await this.subtle.exportKey(\n      \"jwk\",\n      this.identity.publicKey,\n    );\n    const privateKeyJwk = await this.subtle.exportKey(\n      \"jwk\",\n      this.identity.privateKey,\n    );\n\n    return {\n      id: this.identity.id,\n      publicKeyJwk,\n      privateKeyJwk,\n      created: this.identity.created.toISOString(),\n      displayName: this.identity.displayName,\n    };\n  }\n\n  // Import identity (from backup)\n  async importIdentity(data: IdentityExport): Promise<Identity> {\n    const publicKey = await this.subtle.importKey(\n      \"jwk\",\n      data.publicKeyJwk,\n      { name: \"Ed25519\", namedCurve: \"Ed25519\" } as any,\n      true,\n      [\"verify\"],\n    );\n\n    const privateKey = await this.subtle.importKey(\n      \"jwk\",\n      data.privateKeyJwk,\n      { name: \"Ed25519\", namedCurve: \"Ed25519\" } as any,\n      true,\n      [\"sign\"],\n    );\n\n    this.identity = {\n      id: data.id,\n      publicKey,\n      privateKey,\n      created: new Date(data.created),\n      displayName: data.displayName,\n    };\n\n    await this.saveIdentity();\n    return this.identity;\n  }\n\n  // Get current identity\n  getIdentity(): Identity | null {\n    return this.identity;\n  }\n\n  // Get current identity (alias for getIdentity)\n  getCurrentIdentity(): Identity | null {\n    return this.identity;\n  }\n\n  // Check if identity exists\n  hasIdentity(): boolean {\n    return this.identity !== null;\n  }\n\n  // Get public key\n  async getPublicKey(): Promise<CryptoKey> {\n    if (!this.identity) throw new Error(\"No identity loaded\");\n    return this.identity.publicKey;\n  }\n\n  // Get public key as bytes\n  async getPublicKeyBytes(): Promise<Uint8Array> {\n    if (!this.identity) throw new Error(\"No identity loaded\");\n    const exported = await this.subtle.exportKey(\n      \"raw\",\n      this.identity.publicKey,\n    );\n    return new Uint8Array(exported);\n  }\n\n  // Get public key as hex string\n  async getPublicKeyHex(): Promise<string> {\n    if (!this.identity) throw new Error(\"No identity loaded\");\n    const exported = await this.subtle.exportKey(\n      \"raw\",\n      this.identity.publicKey,\n    );\n    return this.arrayBufferToHex(exported);\n  }\n\n  // Sign data\n  async sign(data: Uint8Array): Promise<Uint8Array> {\n    if (!this.identity) throw new Error(\"No identity loaded\");\n\n    const signature = await this.subtle.sign(\n      { name: \"Ed25519\" } as any,\n      this.identity.privateKey,\n      data.buffer as ArrayBuffer,\n    );\n\n    return new Uint8Array(signature);\n  }\n\n  // Verify signature (overloaded - can use current identity's public key or provided key)\n  async verify(\n    data: Uint8Array,\n    signature: Uint8Array,\n    publicKey?: CryptoKey,\n  ): Promise<boolean> {\n    const keyToUse = publicKey || this.identity?.publicKey;\n    if (!keyToUse) throw new Error(\"No public key available\");\n\n    try {\n      return await crypto.subtle.verify(\n        { name: \"Ed25519\" } as any,\n        keyToUse,\n        signature.buffer as ArrayBuffer,\n        data.buffer as ArrayBuffer,\n      );\n    } catch {\n      return false;\n    }\n  }\n\n  // Get public key as string\n  async getPublicKeyString(): Promise<string> {\n    if (!this.identity) throw new Error(\"No identity loaded\");\n\n    const exported = await crypto.subtle.exportKey(\n      \"raw\",\n      this.identity.publicKey,\n    );\n    return this.arrayBufferToHex(exported);\n  }\n\n  // Delete identity\n  async deleteIdentity(): Promise<void> {\n    await this.storage.remove(this.storageKey);\n    this.identity = null;\n  }\n\n  // Helper: ArrayBuffer to hex string\n  private arrayBufferToHex(buffer: ArrayBuffer): string {\n    return Array.from(new Uint8Array(buffer))\n      .map((b) => b.toString(16).padStart(2, \"0\"))\n      .join(\"\");\n  }\n}\n"],"version":3}