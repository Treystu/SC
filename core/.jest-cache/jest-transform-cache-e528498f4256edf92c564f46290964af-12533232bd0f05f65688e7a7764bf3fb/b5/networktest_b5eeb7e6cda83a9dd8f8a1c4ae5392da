8dcea1d6fe13b589ff9c70afeb91e129
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const network_1 = require("./network");
describe('MeshNetwork', () => {
    let network;
    beforeEach(() => {
        network = new network_1.MeshNetwork();
    });
    afterEach(() => {
        network.shutdown();
    });
    describe('Basic Functionality', () => {
        it('should create a mesh network instance', () => {
            expect(network).toBeDefined();
            expect(network.getLocalPeerId()).toBeDefined();
        });
        it('should get connected peers', () => {
            const peers = network.getConnectedPeers();
            expect(Array.isArray(peers)).toBe(true);
        });
        it('should get peer count', () => {
            const count = network.getPeerCount();
            expect(typeof count).toBe('number');
            expect(count).toBeGreaterThanOrEqual(0);
        });
        it('should get statistics', () => {
            const stats = network.getStatistics();
            expect(stats).toBeDefined();
            expect(typeof stats.messagesSent).toBe('number');
            expect(typeof stats.messagesReceived).toBe('number');
        });
        it('should get identity', () => {
            const identity = network.getIdentity();
            expect(identity).toBeDefined();
            expect(identity.publicKey).toBeDefined();
            expect(identity.privateKey).toBeDefined();
        });
        it('should get public key', () => {
            const publicKey = network.getPublicKey();
            expect(publicKey).toBeInstanceOf(Uint8Array);
            expect(publicKey.length).toBeGreaterThan(0);
        });
    });
    describe('Message Handling', () => {
        it('should register message callback', () => {
            const callback = jest.fn();
            network.onMessage(callback);
            // Callback registered successfully
            expect(callback).toBeDefined();
        });
        it('should register peer connected callback', () => {
            const callback = jest.fn();
            network.onPeerConnected(callback);
            expect(callback).toBeDefined();
        });
        it('should register peer disconnected callback', () => {
            const callback = jest.fn();
            network.onPeerDisconnected(callback);
            expect(callback).toBeDefined();
        });
    });
    describe('Lifecycle Management', () => {
        it('should start network', async () => {
            await network.start();
            // Network started successfully
            expect(network).toBeDefined();
        });
        it('should stop network', async () => {
            await network.start();
            await network.stop();
            // Network stopped successfully
            expect(network).toBeDefined();
        });
        it('should shutdown network', () => {
            network.shutdown();
            // Network shut down successfully
            expect(network).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvbWVzaC9uZXR3b3JrLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx1Q0FBd0M7QUFJeEMsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxPQUFvQixDQUFDO0lBRXpCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxPQUFPLEdBQUcsSUFBSSxxQkFBVyxFQUFFLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1lBQy9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM5QixNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtZQUMvQixNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDckMsTUFBTSxDQUFDLE9BQU8sS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxz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Q0FBQztZQUNyQiwrQkFBK0I7WUFDL0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtZQUNqQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDbkIsaUNBQWlDO1lBQ2pDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvbWVzaC9uZXR3b3JrLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWVzaE5ldHdvcmsgfSBmcm9tICcuL25ldHdvcmsnO1xuaW1wb3J0IHR5cGUgeyBQZWVyIH0gZnJvbSAnLi9yb3V0aW5nJztcbmltcG9ydCB7IGNyZWF0ZVBlZXIgfSBmcm9tICcuL3JvdXRpbmcnO1xuXG5kZXNjcmliZSgnTWVzaE5ldHdvcmsnLCAoKSA9PiB7XG4gIGxldCBuZXR3b3JrOiBNZXNoTmV0d29yaztcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBuZXR3b3JrID0gbmV3IE1lc2hOZXR3b3JrKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgbmV0d29yay5zaHV0ZG93bigpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQmFzaWMgRnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG1lc2ggbmV0d29yayBpbnN0YW5jZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChuZXR3b3JrKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG5ldHdvcmsuZ2V0TG9jYWxQZWVySWQoKSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IGNvbm5lY3RlZCBwZWVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlZXJzID0gbmV0d29yay5nZXRDb25uZWN0ZWRQZWVycygpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocGVlcnMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgcGVlciBjb3VudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvdW50ID0gbmV0d29yay5nZXRQZWVyQ291bnQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgY291bnQpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KGNvdW50KS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRzID0gbmV0d29yay5nZXRTdGF0aXN0aWNzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHN0YXRzLm1lc3NhZ2VzU2VudCkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHN0YXRzLm1lc3NhZ2VzUmVjZWl2ZWQpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgaWRlbnRpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBpZGVudGl0eSA9IG5ldHdvcmsuZ2V0SWRlbnRpdHkoKTtcbiAgICAgIGV4cGVjdChpZGVudGl0eSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChpZGVudGl0eS5wdWJsaWNLZXkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoaWRlbnRpdHkucHJpdmF0ZUtleSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IHB1YmxpYyBrZXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwdWJsaWNLZXkgPSBuZXR3b3JrLmdldFB1YmxpY0tleSgpO1xuICAgICAgZXhwZWN0KHB1YmxpY0tleSkudG9CZUluc3RhbmNlT2YoVWludDhBcnJheSk7XG4gICAgICBleHBlY3QocHVibGljS2V5Lmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTWVzc2FnZSBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIG1lc3NhZ2UgY2FsbGJhY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKTtcbiAgICAgIG5ldHdvcmsub25NZXNzYWdlKGNhbGxiYWNrKTtcbiAgICAgIC8vIENhbGxiYWNrIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIHBlZXIgY29ubmVjdGVkIGNhbGxiYWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbGJhY2sgPSBqZXN0LmZuKCk7XG4gICAgICBuZXR3b3JrLm9uUGVlckNvbm5lY3RlZChjYWxsYmFjayk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIHBlZXIgZGlzY29ubmVjdGVkIGNhbGxiYWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FsbGJhY2sgPSBqZXN0LmZuKCk7XG4gICAgICBuZXR3b3JrLm9uUGVlckRpc2Nvbm5lY3RlZChjYWxsYmFjayk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdMaWZlY3ljbGUgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IG5ldHdvcmsnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBuZXR3b3JrLnN0YXJ0KCk7XG4gICAgICAvLyBOZXR3b3JrIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICBleHBlY3QobmV0d29yaykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3RvcCBuZXR3b3JrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbmV0d29yay5zdGFydCgpO1xuICAgICAgYXdhaXQgbmV0d29yay5zdG9wKCk7XG4gICAgICAvLyBOZXR3b3JrIHN0b3BwZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICBleHBlY3QobmV0d29yaykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2h1dGRvd24gbmV0d29yaycsICgpID0+IHtcbiAgICAgIG5ldHdvcmsuc2h1dGRvd24oKTtcbiAgICAgIC8vIE5ldHdvcmsgc2h1dCBkb3duIHN1Y2Nlc3NmdWxseVxuICAgICAgZXhwZWN0KG5ldHdvcmspLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=