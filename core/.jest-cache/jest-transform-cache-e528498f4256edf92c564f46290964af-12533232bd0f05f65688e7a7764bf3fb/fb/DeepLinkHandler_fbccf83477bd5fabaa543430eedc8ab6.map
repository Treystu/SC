{"file":"/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/DeepLinkHandler.ts","mappings":"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","names":[],"sources":["/Users/christymaxwell/Desktop/Luke_Stuff/GitHub/SC/core/src/sharing/DeepLinkHandler.ts"],"sourcesContent":["/**\n * DeepLinkHandler - Handles deep links and universal links for app invites\n *\n * Responsibilities:\n * - Parse various invite URL formats\n * - Handle invite links for new and existing users\n * - Persist invite codes through installation\n * - Support multiple URL schemes (sc://, https://sc.app/join, etc.)\n */\n\nexport interface DeepLinkParams {\n  code?: string;\n  peer?: string;\n  [key: string]: string | undefined;\n}\n\nexport interface ParsedDeepLink {\n  action: string;\n  params: DeepLinkParams;\n}\n\nexport type DeepLinkHandler = (params: DeepLinkParams) => Promise<void>;\n\nexport interface DeepLinkStorage {\n  get(key: string): Promise<string | null>;\n  set(key: string, value: string): Promise<void>;\n  remove(key: string): Promise<void>;\n}\n\nexport interface DeepLinkRouter {\n  navigate(path: string): void;\n}\n\n/**\n * Manages deep link handling for invite codes and peer connections\n */\nexport class DeepLinkManager {\n  private handlers = new Map<string, DeepLinkHandler>();\n  private storage: DeepLinkStorage;\n  private router?: DeepLinkRouter;\n\n  constructor(storage: DeepLinkStorage, router?: DeepLinkRouter) {\n    this.storage = storage;\n    this.router = router;\n    this.registerDefaultHandlers();\n  }\n\n  /**\n   * Register default handlers for common actions\n   */\n  private registerDefaultHandlers(): void {\n    // Handler for join/invite links\n    this.handlers.set('join', async (params) => {\n      const inviteCode = params.code;\n      if (!inviteCode) {\n        console.warn('Join link missing invite code');\n        return;\n      }\n\n      // Check if user is onboarded\n      const isOnboarded = await this.isUserOnboarded();\n\n      if (!isOnboarded) {\n        // Store for after onboarding\n        await this.storage.set('pendingInvite', inviteCode);\n        if (params.inviterName) {\n          await this.storage.set('pendingInviterName', params.inviterName);\n        }\n        this.router?.navigate('/onboarding');\n      } else {\n        // Process immediately - the app will handle this via events\n        await this.storage.set('pendingInvite', inviteCode);\n        if (params.inviterName) {\n          await this.storage.set('pendingInviterName', params.inviterName);\n        }\n        // Navigate to main app - invite will be processed there\n        this.router?.navigate('/');\n      }\n    });\n\n    // Handler for direct peer connection\n    this.handlers.set('connect', async (params) => {\n      const peerId = params.peer;\n      if (!peerId) {\n        console.warn('Connect link missing peer ID');\n        return;\n      }\n\n      // Store peer ID for connection\n      await this.storage.set('pendingPeerConnection', peerId);\n      this.router?.navigate('/');\n    });\n  }\n\n  /**\n   * Register a custom handler for an action\n   */\n  registerHandler(action: string, handler: DeepLinkHandler): void {\n    this.handlers.set(action, handler);\n  }\n\n  /**\n   * Check if user has completed onboarding\n   */\n  async isUserOnboarded(): Promise<boolean> {\n    const onboardingComplete = await this.storage.get('onboarding_complete');\n    return onboardingComplete === 'true';\n  }\n\n  /**\n   * Handle an incoming URL\n   */\n  async handleURL(url: string): Promise<boolean> {\n    const parsed = this.parseURL(url);\n\n    if (!parsed.action) {\n      return false;\n    }\n\n    const handler = this.handlers.get(parsed.action);\n    if (handler) {\n      await handler(parsed.params);\n      return true;\n    }\n\n    console.warn(`No handler registered for action: ${parsed.action}`);\n    return false;\n  }\n\n  /**\n   * Parse various URL formats into action and params\n   *\n   * Supported formats:\n   * - sc://join/INVITE_CODE\n   * - sc://connect/PEER_ID\n   * - https://sc.app/join#INVITE_CODE\n   * - https://sc.app/join?code=INVITE_CODE&inviterName=NAME\n   * - #join=INVITE_CODE\n   * - /join#INVITE_CODE\n   */\n  parseURL(url: string): ParsedDeepLink {\n    // Handle custom scheme (sc://action/params)\n    const customSchemeMatch = url.match(/^sc:\\/\\/(\\w+)\\/(.+)/);\n    if (customSchemeMatch) {\n      return {\n        action: customSchemeMatch[1],\n        params: this.parseCustomSchemeParams(\n          customSchemeMatch[1],\n          customSchemeMatch[2]\n        ),\n      };\n    }\n\n    // Handle HTTPS URLs (https://sc.app/action#code or ?params)\n    try {\n      const urlObj = new URL(url);\n      const pathParts = urlObj.pathname.split('/').filter(Boolean);\n\n      if (pathParts.length > 0) {\n        const action = pathParts[0];\n\n        // Get params from hash or query string\n        let params: DeepLinkParams = {};\n\n        // Check hash first (legacy format: /join#CODE)\n        // Only accept hash if host is sc.app (for HTTPS URLs)\n        if (urlObj.hash && (urlObj.protocol === 'sc:' || urlObj.host === 'sc.app')) {\n          const hashValue = urlObj.hash.substring(1);\n          if (hashValue.includes('=')) {\n            // Hash with params: #key=value&key2=value2\n            params = this.parseQueryString(hashValue);\n          } else {\n            // Simple hash: #INVITE_CODE\n            params = { code: hashValue };\n          }\n        }\n\n        // Also check query parameters\n        urlObj.searchParams.forEach((value, key) => {\n          params[key] = value;\n        });\n\n        return { action, params };\n      }\n    } catch {\n      // Not a valid URL, continue with other formats\n    }\n\n    // Handle hash-only format (#action=value)\n    const hashMatch = url.match(/^#(\\w+)=(.+)/);\n    if (hashMatch) {\n      return {\n        action: hashMatch[1],\n        params: { code: hashMatch[2] },\n      };\n    }\n\n    // Handle path with hash (/action#value)\n    const pathHashMatch = url.match(/\\/(\\w+)#(.+)/);\n    if (pathHashMatch) {\n      return {\n        action: pathHashMatch[1],\n        params: { code: pathHashMatch[2] },\n      };\n    }\n\n    return { action: '', params: {} };\n  }\n\n  /**\n   * Parse custom scheme parameters\n   */\n  private parseCustomSchemeParams(action: string, value: string): DeepLinkParams {\n    switch (action) {\n      case 'join':\n        return { code: value };\n      case 'connect':\n        return { peer: value };\n      default:\n        return { value };\n    }\n  }\n\n  /**\n   * Parse query string into params object\n   */\n  private parseQueryString(query: string): DeepLinkParams {\n    const params: DeepLinkParams = {};\n    const pairs = query.split('&');\n\n    for (const pair of pairs) {\n      const [key, value] = pair.split('=');\n      if (key && value) {\n        params[decodeURIComponent(key)] = decodeURIComponent(value);\n      }\n    }\n\n    return params;\n  }\n\n  /**\n   * Generate an invite URL\n   */\n  static generateInviteURL(\n    baseURL: string,\n    inviteCode: string,\n    inviterName?: string\n  ): string {\n    const url = new URL(baseURL);\n    url.pathname = '/join';\n    url.searchParams.set('code', inviteCode);\n    if (inviterName) {\n      url.searchParams.set('inviterName', inviterName);\n    }\n    return url.toString();\n  }\n\n  /**\n   * Generate a custom scheme invite URL\n   */\n  static generateCustomSchemeURL(inviteCode: string): string {\n    return `sc://join/${inviteCode}`;\n  }\n\n  /**\n   * Get pending invite code from storage\n   */\n  async getPendingInvite(): Promise<{ code: string; inviterName?: string } | null> {\n    const code = await this.storage.get('pendingInvite');\n    if (!code) return null;\n\n    const inviterName = await this.storage.get('pendingInviterName') ?? undefined;\n    return { code, inviterName };\n  }\n\n  /**\n   * Clear pending invite from storage\n   */\n  async clearPendingInvite(): Promise<void> {\n    await this.storage.remove('pendingInvite');\n    await this.storage.remove('pendingInviterName');\n  }\n\n  /**\n   * Get pending peer connection from storage\n   */\n  async getPendingPeerConnection(): Promise<string | null> {\n    return this.storage.get('pendingPeerConnection');\n  }\n\n  /**\n   * Clear pending peer connection from storage\n   */\n  async clearPendingPeerConnection(): Promise<void> {\n    await this.storage.remove('pendingPeerConnection');\n  }\n}\n\n/**\n * Web-specific storage adapter using localStorage\n */\nexport class WebDeepLinkStorage implements DeepLinkStorage {\n  async get(key: string): Promise<string | null> {\n    if (typeof localStorage === 'undefined') return null;\n    return localStorage.getItem(`sc-deeplink-${key}`);\n  }\n\n  async set(key: string, value: string): Promise<void> {\n    if (typeof localStorage === 'undefined') return;\n    localStorage.setItem(`sc-deeplink-${key}`, value);\n  }\n\n  async remove(key: string): Promise<void> {\n    if (typeof localStorage === 'undefined') return;\n    localStorage.removeItem(`sc-deeplink-${key}`);\n  }\n}\n\n/**\n * Create a web-based DeepLinkManager\n */\nexport function createWebDeepLinkManager(): DeepLinkManager {\n  const storage = new WebDeepLinkStorage();\n  return new DeepLinkManager(storage);\n}\n"],"version":3}