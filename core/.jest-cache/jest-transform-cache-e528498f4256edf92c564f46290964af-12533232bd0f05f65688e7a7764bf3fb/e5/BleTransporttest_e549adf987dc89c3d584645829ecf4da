6c7492bdc06b608c953e204ab30de193
"use strict";
/**
 * Tests for BLE Transport Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
const BleTransport_js_1 = require("./BleTransport.js");
describe("BleTransport", () => {
    let transport;
    const localPeerId = "test-local-peer";
    beforeEach(() => {
        transport = new BleTransport_js_1.MockBleTransport(localPeerId);
    });
    afterEach(async () => {
        await transport.stop();
    });
    describe("Initialization", () => {
        it("should create transport with default config", () => {
            expect(transport.localPeerId).toBe(localPeerId);
        });
        it("should create transport with custom config", () => {
            const customTransport = new BleTransport_js_1.MockBleTransport(localPeerId, {
                maxMtu: 256,
                minRssi: -80,
            });
            expect(customTransport.localPeerId).toBe(localPeerId);
        });
    });
    describe("Lifecycle", () => {
        it("should start and stop transport", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            expect(transport.getConnectedPeers()).toHaveLength(0);
            await transport.stop();
        });
    });
    describe("Advertising", () => {
        it("should start and stop advertising", async () => {
            const events = {
                onMessage: jest.fn(),
                onAdvertisingStateChanged: jest.fn(),
            };
            await transport.start(events);
            expect(transport.isAdvertising()).toBe(false);
            await transport.startAdvertising();
            expect(transport.isAdvertising()).toBe(true);
            expect(events.onAdvertisingStateChanged).toHaveBeenCalledWith(true);
            await transport.stopAdvertising();
            expect(transport.isAdvertising()).toBe(false);
            expect(events.onAdvertisingStateChanged).toHaveBeenCalledWith(false);
        });
    });
    describe("Scanning", () => {
        it("should start and stop scanning", async () => {
            const events = {
                onMessage: jest.fn(),
                onScanningStateChanged: jest.fn(),
            };
            await transport.start(events);
            expect(transport.isScanning()).toBe(false);
            await transport.startScanning();
            expect(transport.isScanning()).toBe(true);
            expect(events.onScanningStateChanged).toHaveBeenCalledWith(true);
            await transport.stopScanning();
            expect(transport.isScanning()).toBe(false);
            expect(events.onScanningStateChanged).toHaveBeenCalledWith(false);
        });
        it("should return discovered devices", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const devices = transport.getDiscoveredDevices();
            expect(Array.isArray(devices)).toBe(true);
        });
    });
    describe("Connection", () => {
        it("should connect to a peer", async () => {
            const events = {
                onMessage: jest.fn(),
                onPeerConnected: jest.fn(),
                onStateChange: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            expect(events.onStateChange).toHaveBeenCalledWith("remote-peer", "connecting");
            expect(events.onStateChange).toHaveBeenCalledWith("remote-peer", "connected");
            expect(events.onPeerConnected).toHaveBeenCalled();
            expect(transport.getConnectedPeers()).toContain("remote-peer");
        });
        it("should disconnect from a peer", async () => {
            const events = {
                onMessage: jest.fn(),
                onPeerDisconnected: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            await transport.disconnect("remote-peer");
            expect(events.onPeerDisconnected).toHaveBeenCalledWith("remote-peer", "disconnected");
            expect(transport.getConnectedPeers()).not.toContain("remote-peer");
        });
    });
    describe("Messaging", () => {
        it("should send message to connected peer", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const payload = new Uint8Array([1, 2, 3, 4, 5]);
            await expect(transport.send("remote-peer", payload)).resolves.not.toThrow();
            const peerInfo = transport.getBlePeerInfo("remote-peer");
            expect(peerInfo?.bytesSent).toBe(5);
        });
        it("should fail to send to disconnected peer", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            const payload = new Uint8Array([1, 2, 3, 4, 5]);
            await expect(transport.send("unknown-peer", payload)).rejects.toThrow();
        });
        it("should broadcast to all connected peers", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("peer1");
            await transport.connect("peer2");
            const payload = new Uint8Array([1, 2, 3]);
            await transport.broadcast(payload);
            const peer1Info = transport.getBlePeerInfo("peer1");
            const peer2Info = transport.getBlePeerInfo("peer2");
            expect(peer1Info?.bytesSent).toBe(3);
            expect(peer2Info?.bytesSent).toBe(3);
        });
        it("should exclude peer from broadcast", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("peer1");
            await transport.connect("peer2");
            const payload = new Uint8Array([1, 2, 3]);
            await transport.broadcast(payload, "peer1");
            const peer1Info = transport.getBlePeerInfo("peer1");
            const peer2Info = transport.getBlePeerInfo("peer2");
            expect(peer1Info?.bytesSent).toBe(0);
            expect(peer2Info?.bytesSent).toBe(3);
        });
        it("should receive simulated messages", async () => {
            const onMessage = jest.fn();
            const events = {
                onMessage,
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const payload = new Uint8Array([10, 20, 30]);
            transport.simulateMessage("remote-peer", payload);
            expect(onMessage).toHaveBeenCalledWith(expect.objectContaining({
                from: "remote-peer",
                payload,
            }));
        });
    });
    describe("MTU Negotiation", () => {
        it("should request MTU", async () => {
            const onMtuNegotiated = jest.fn();
            const events = {
                onMessage: jest.fn(),
                onMtuNegotiated,
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const negotiatedMtu = await transport.requestMtu("remote-peer", 256);
            expect(negotiatedMtu).toBeLessThanOrEqual(256);
            expect(onMtuNegotiated).toHaveBeenCalledWith("remote-peer", negotiatedMtu);
        });
        it("should get MTU for connected peer", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const mtu = transport.getMtu("remote-peer");
            expect(mtu).toBeGreaterThan(0);
        });
    });
    describe("RSSI", () => {
        it("should get RSSI for connected peer", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const rssi = await transport.getRssi("remote-peer");
            expect(rssi).toBeDefined();
            expect(rssi).toBeLessThan(0); // RSSI is negative dBm
        });
    });
    describe("Peer Info", () => {
        it("should return BLE-specific peer info", async () => {
            const events = {
                onMessage: jest.fn(),
            };
            await transport.start(events);
            await transport.connect("remote-peer");
            const peerInfo = transport.getBlePeerInfo("remote-peer");
            expect(peerInfo).toBeDefined();
            expect(peerInfo?.transportType).toBe("bluetooth");
            expect(peerInfo?.rssi).toBeDefined();
            expect(peerInfo?.mtu).toBeDefined();
            expect(peerInfo?.discoveredViaScan).toBeDefined();
        });
        it("should return undefined for unknown peer", () => {
            const peerInfo = transport.getBlePeerInfo("unknown-peer");
            expect(peerInfo).toBeUndefined();
        });
    });
    describe("Incoming Connections", () => {
        it("should handle simulated incoming connections", async () => {
            const onPeerConnected = jest.fn();
            const events = {
                onMessage: jest.fn(),
                onPeerConnected,
            };
            await transport.start(events);
            await transport.simulateIncomingConnection("incoming-peer");
            expect(onPeerConnected).toHaveBeenCalledWith("incoming-peer", expect.objectContaining({
                peerId: "incoming-peer",
                state: "connected",
                discoveredViaScan: false,
            }));
        });
    });
});
describe("BLE Constants", () => {
    it("should have valid service UUID", () => {
        expect(BleTransport_js_1.BLE_MESH_SERVICE_UUID).toMatch(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i);
    });
    it("should have valid default config", () => {
        expect(BleTransport_js_1.DEFAULT_BLE_CONFIG.serviceUuid).toBeDefined();
        expect(BleTransport_js_1.DEFAULT_BLE_CONFIG.maxMtu).toBeGreaterThan(0);
        expect(BleTransport_js_1.DEFAULT_BLE_CONFIG.maxConnections).toBeGreaterThan(0);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvdHJhbnNwb3J0L0JsZVRyYW5zcG9ydC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCx1REFLMkI7QUFFM0IsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDNUIsSUFBSSxTQUEyQixDQUFDO0lBQ2hDLE1BQU0sV0FBVyxHQUFHLGlCQUFpQixDQUFDO0lBRXRDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxTQUFTLEdBQUcsSUFBSSxrQ0FBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQsTUFBTSxlQUFlLEdBQUcsSUFBSSxrQ0FBZ0IsQ0FBQyxXQUFXLEVBQUU7Z0JBQ3hELE1BQU0sRUFBRSxHQUFHO2dCQUNYLE9BQU8sRUFBRSxDQUFDLEVBQUU7YUFDYixDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEtBQUssSUFBSSxF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LE1BQU0sR0FBdUI7Z0JBQ2pDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNwQixlQUFlO2FBQ2hCLENBQUM7WUFFRixNQUFNLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDOUIsTUFBTSxTQUFTLENBQUMsMEJBQTBCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFNUQsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDLG9CQUFvQixDQUMxQyxlQUFlLEVBQ2YsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixNQUFNLEVBQUUsZUFBZTtnQkFDdkIsS0FBSyxFQUFFLFdBQVc7Z0JBQ2xCLGlCQUFpQixFQUFFLEtBQUs7YUFDekIsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUM3QixFQUFFLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1FBQ3hDLE1BQU0sQ0FBQyx1Q0FBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FDbkMsaUVBQWlFLENBQ2xFLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7UUFDMUMsTUFBTSxDQUFDLG9DQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JELE1BQU0sQ0FBQyxvQ0FBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckQsTUFBTSxDQUFDLG9DQUFrQixDQUFDLGNBQWMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9jaHJpc3R5bWF4d2VsbC9EZXNrdG9wL0x1a2VfU3R1ZmYvR2l0SHViL1NDL2NvcmUvc3JjL3RyYW5zcG9ydC9CbGVUcmFuc3BvcnQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3RzIGZvciBCTEUgVHJhbnNwb3J0IEltcGxlbWVudGF0aW9uXG4gKi9cblxuaW1wb3J0IHtcbiAgTW9ja0JsZVRyYW5zcG9ydCxcbiAgQkxFX01FU0hfU0VSVklDRV9VVUlELFxuICBERUZBVUxUX0JMRV9DT05GSUcsXG4gIEJsZVRyYW5zcG9ydEV2ZW50cyxcbn0gZnJvbSBcIi4vQmxlVHJhbnNwb3J0LmpzXCI7XG5cbmRlc2NyaWJlKFwiQmxlVHJhbnNwb3J0XCIsICgpID0+IHtcbiAgbGV0IHRyYW5zcG9ydDogTW9ja0JsZVRyYW5zcG9ydDtcbiAgY29uc3QgbG9jYWxQZWVySWQgPSBcInRlc3QtbG9jYWwtcGVlclwiO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHRyYW5zcG9ydCA9IG5ldyBNb2NrQmxlVHJhbnNwb3J0KGxvY2FsUGVlcklkKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCB0cmFuc3BvcnQuc3RvcCgpO1xuICB9KTtcblxuICBkZXNjcmliZShcIkluaXRpYWxpemF0aW9uXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBjcmVhdGUgdHJhbnNwb3J0IHdpdGggZGVmYXVsdCBjb25maWdcIiwgKCkgPT4ge1xuICAgICAgZXhwZWN0KHRyYW5zcG9ydC5sb2NhbFBlZXJJZCkudG9CZShsb2NhbFBlZXJJZCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBjcmVhdGUgdHJhbnNwb3J0IHdpdGggY3VzdG9tIGNvbmZpZ1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21UcmFuc3BvcnQgPSBuZXcgTW9ja0JsZVRyYW5zcG9ydChsb2NhbFBlZXJJZCwge1xuICAgICAgICBtYXhNdHU6IDI1NixcbiAgICAgICAgbWluUnNzaTogLTgwLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoY3VzdG9tVHJhbnNwb3J0LmxvY2FsUGVlcklkKS50b0JlKGxvY2FsUGVlcklkKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJMaWZlY3ljbGVcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHN0YXJ0IGFuZCBzdG9wIHRyYW5zcG9ydFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuZ2V0Q29ubmVjdGVkUGVlcnMoKSkudG9IYXZlTGVuZ3RoKDApO1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RvcCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkFkdmVydGlzaW5nXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBzdGFydCBhbmQgc3RvcCBhZHZlcnRpc2luZ1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uQWR2ZXJ0aXNpbmdTdGF0ZUNoYW5nZWQ6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuXG4gICAgICBleHBlY3QodHJhbnNwb3J0LmlzQWR2ZXJ0aXNpbmcoKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydEFkdmVydGlzaW5nKCk7XG4gICAgICBleHBlY3QodHJhbnNwb3J0LmlzQWR2ZXJ0aXNpbmcoKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChldmVudHMub25BZHZlcnRpc2luZ1N0YXRlQ2hhbmdlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgodHJ1ZSk7XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdG9wQWR2ZXJ0aXNpbmcoKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuaXNBZHZlcnRpc2luZygpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChldmVudHMub25BZHZlcnRpc2luZ1N0YXRlQ2hhbmdlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlNjYW5uaW5nXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBzdGFydCBhbmQgc3RvcCBzY2FubmluZ1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uU2Nhbm5pbmdTdGF0ZUNoYW5nZWQ6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuXG4gICAgICBleHBlY3QodHJhbnNwb3J0LmlzU2Nhbm5pbmcoKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydFNjYW5uaW5nKCk7XG4gICAgICBleHBlY3QodHJhbnNwb3J0LmlzU2Nhbm5pbmcoKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChldmVudHMub25TY2FubmluZ1N0YXRlQ2hhbmdlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgodHJ1ZSk7XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdG9wU2Nhbm5pbmcoKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuaXNTY2FubmluZygpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChldmVudHMub25TY2FubmluZ1N0YXRlQ2hhbmdlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIGRpc2NvdmVyZWQgZGV2aWNlc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIFxuICAgICAgY29uc3QgZGV2aWNlcyA9IHRyYW5zcG9ydC5nZXREaXNjb3ZlcmVkRGV2aWNlcygpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkoZGV2aWNlcykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQ29ubmVjdGlvblwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgY29ubmVjdCB0byBhIHBlZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBCbGVUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgICBvblBlZXJDb25uZWN0ZWQ6IGplc3QuZm4oKSxcbiAgICAgICAgb25TdGF0ZUNoYW5nZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY29ubmVjdChcInJlbW90ZS1wZWVyXCIpO1xuXG4gICAgICBleHBlY3QoZXZlbnRzLm9uU3RhdGVDaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwicmVtb3RlLXBlZXJcIiwgXCJjb25uZWN0aW5nXCIpO1xuICAgICAgZXhwZWN0KGV2ZW50cy5vblN0YXRlQ2hhbmdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcInJlbW90ZS1wZWVyXCIsIFwiY29ubmVjdGVkXCIpO1xuICAgICAgZXhwZWN0KGV2ZW50cy5vblBlZXJDb25uZWN0ZWQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuZ2V0Q29ubmVjdGVkUGVlcnMoKSkudG9Db250YWluKFwicmVtb3RlLXBlZXJcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBkaXNjb25uZWN0IGZyb20gYSBwZWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogQmxlVHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgICAgb25QZWVyRGlzY29ubmVjdGVkOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicmVtb3RlLXBlZXJcIik7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuZGlzY29ubmVjdChcInJlbW90ZS1wZWVyXCIpO1xuXG4gICAgICBleHBlY3QoZXZlbnRzLm9uUGVlckRpc2Nvbm5lY3RlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJyZW1vdGUtcGVlclwiLCBcImRpc2Nvbm5lY3RlZFwiKTtcbiAgICAgIGV4cGVjdCh0cmFuc3BvcnQuZ2V0Q29ubmVjdGVkUGVlcnMoKSkubm90LnRvQ29udGFpbihcInJlbW90ZS1wZWVyXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIk1lc3NhZ2luZ1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgc2VuZCBtZXNzYWdlIHRvIGNvbm5lY3RlZCBwZWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogQmxlVHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNvbm5lY3QoXCJyZW1vdGUtcGVlclwiKTtcblxuICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBhd2FpdCBleHBlY3QodHJhbnNwb3J0LnNlbmQoXCJyZW1vdGUtcGVlclwiLCBwYXlsb2FkKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcblxuICAgICAgY29uc3QgcGVlckluZm8gPSB0cmFuc3BvcnQuZ2V0QmxlUGVlckluZm8oXCJyZW1vdGUtcGVlclwiKTtcbiAgICAgIGV4cGVjdChwZWVySW5mbz8uYnl0ZXNTZW50KS50b0JlKDUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZmFpbCB0byBzZW5kIHRvIGRpc2Nvbm5lY3RlZCBwZWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogQmxlVHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuXG4gICAgICBjb25zdCBwYXlsb2FkID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDMsIDQsIDVdKTtcbiAgICAgIGF3YWl0IGV4cGVjdCh0cmFuc3BvcnQuc2VuZChcInVua25vd24tcGVlclwiLCBwYXlsb2FkKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBicm9hZGNhc3QgdG8gYWxsIGNvbm5lY3RlZCBwZWVyc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicGVlcjFcIik7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY29ubmVjdChcInBlZXIyXCIpO1xuXG4gICAgICBjb25zdCBwYXlsb2FkID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDNdKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5icm9hZGNhc3QocGF5bG9hZCk7XG5cbiAgICAgIGNvbnN0IHBlZXIxSW5mbyA9IHRyYW5zcG9ydC5nZXRCbGVQZWVySW5mbyhcInBlZXIxXCIpO1xuICAgICAgY29uc3QgcGVlcjJJbmZvID0gdHJhbnNwb3J0LmdldEJsZVBlZXJJbmZvKFwicGVlcjJcIik7XG4gICAgICBleHBlY3QocGVlcjFJbmZvPy5ieXRlc1NlbnQpLnRvQmUoMyk7XG4gICAgICBleHBlY3QocGVlcjJJbmZvPy5ieXRlc1NlbnQpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBleGNsdWRlIHBlZXIgZnJvbSBicm9hZGNhc3RcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBCbGVUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY29ubmVjdChcInBlZXIxXCIpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNvbm5lY3QoXCJwZWVyMlwiKTtcblxuICAgICAgY29uc3QgcGF5bG9hZCA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzXSk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuYnJvYWRjYXN0KHBheWxvYWQsIFwicGVlcjFcIik7XG5cbiAgICAgIGNvbnN0IHBlZXIxSW5mbyA9IHRyYW5zcG9ydC5nZXRCbGVQZWVySW5mbyhcInBlZXIxXCIpO1xuICAgICAgY29uc3QgcGVlcjJJbmZvID0gdHJhbnNwb3J0LmdldEJsZVBlZXJJbmZvKFwicGVlcjJcIik7XG4gICAgICBleHBlY3QocGVlcjFJbmZvPy5ieXRlc1NlbnQpLnRvQmUoMCk7XG4gICAgICBleHBlY3QocGVlcjJJbmZvPy5ieXRlc1NlbnQpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZWNlaXZlIHNpbXVsYXRlZCBtZXNzYWdlc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvbk1lc3NhZ2UgPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY29ubmVjdChcInJlbW90ZS1wZWVyXCIpO1xuXG4gICAgICBjb25zdCBwYXlsb2FkID0gbmV3IFVpbnQ4QXJyYXkoWzEwLCAyMCwgMzBdKTtcbiAgICAgIHRyYW5zcG9ydC5zaW11bGF0ZU1lc3NhZ2UoXCJyZW1vdGUtcGVlclwiLCBwYXlsb2FkKTtcblxuICAgICAgZXhwZWN0KG9uTWVzc2FnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBmcm9tOiBcInJlbW90ZS1wZWVyXCIsXG4gICAgICAgICAgcGF5bG9hZCxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiTVRVIE5lZ290aWF0aW9uXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCByZXF1ZXN0IE1UVVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvbk10dU5lZ290aWF0ZWQgPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uTXR1TmVnb3RpYXRlZCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNvbm5lY3QoXCJyZW1vdGUtcGVlclwiKTtcblxuICAgICAgY29uc3QgbmVnb3RpYXRlZE10dSA9IGF3YWl0IHRyYW5zcG9ydC5yZXF1ZXN0TXR1KFwicmVtb3RlLXBlZXJcIiwgMjU2KTtcbiAgICAgIGV4cGVjdChuZWdvdGlhdGVkTXR1KS50b0JlTGVzc1RoYW5PckVxdWFsKDI1Nik7XG4gICAgICBleHBlY3Qob25NdHVOZWdvdGlhdGVkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcInJlbW90ZS1wZWVyXCIsIG5lZ290aWF0ZWRNdHUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZ2V0IE1UVSBmb3IgY29ubmVjdGVkIHBlZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBCbGVUcmFuc3BvcnRFdmVudHMgPSB7XG4gICAgICAgIG9uTWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdHJhbnNwb3J0LnN0YXJ0KGV2ZW50cyk7XG4gICAgICBhd2FpdCB0cmFuc3BvcnQuY29ubmVjdChcInJlbW90ZS1wZWVyXCIpO1xuXG4gICAgICBjb25zdCBtdHUgPSB0cmFuc3BvcnQuZ2V0TXR1KFwicmVtb3RlLXBlZXJcIik7XG4gICAgICBleHBlY3QobXR1KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiUlNTSVwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgZ2V0IFJTU0kgZm9yIGNvbm5lY3RlZCBwZWVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50czogQmxlVHJhbnNwb3J0RXZlbnRzID0ge1xuICAgICAgICBvbk1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LmNvbm5lY3QoXCJyZW1vdGUtcGVlclwiKTtcblxuICAgICAgY29uc3QgcnNzaSA9IGF3YWl0IHRyYW5zcG9ydC5nZXRSc3NpKFwicmVtb3RlLXBlZXJcIik7XG4gICAgICBleHBlY3QocnNzaSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyc3NpKS50b0JlTGVzc1RoYW4oMCk7IC8vIFJTU0kgaXMgbmVnYXRpdmUgZEJtXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiUGVlciBJbmZvXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCByZXR1cm4gQkxFLXNwZWNpZmljIHBlZXIgaW5mb1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB0cmFuc3BvcnQuc3RhcnQoZXZlbnRzKTtcbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5jb25uZWN0KFwicmVtb3RlLXBlZXJcIik7XG5cbiAgICAgIGNvbnN0IHBlZXJJbmZvID0gdHJhbnNwb3J0LmdldEJsZVBlZXJJbmZvKFwicmVtb3RlLXBlZXJcIik7XG4gICAgICBleHBlY3QocGVlckluZm8pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocGVlckluZm8/LnRyYW5zcG9ydFR5cGUpLnRvQmUoXCJibHVldG9vdGhcIik7XG4gICAgICBleHBlY3QocGVlckluZm8/LnJzc2kpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocGVlckluZm8/Lm10dSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChwZWVySW5mbz8uZGlzY292ZXJlZFZpYVNjYW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZXR1cm4gdW5kZWZpbmVkIGZvciB1bmtub3duIHBlZXJcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcGVlckluZm8gPSB0cmFuc3BvcnQuZ2V0QmxlUGVlckluZm8oXCJ1bmtub3duLXBlZXJcIik7XG4gICAgICBleHBlY3QocGVlckluZm8pLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJJbmNvbWluZyBDb25uZWN0aW9uc1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIHNpbXVsYXRlZCBpbmNvbWluZyBjb25uZWN0aW9uc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvblBlZXJDb25uZWN0ZWQgPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCBldmVudHM6IEJsZVRyYW5zcG9ydEV2ZW50cyA9IHtcbiAgICAgICAgb25NZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgICAgIG9uUGVlckNvbm5lY3RlZCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRyYW5zcG9ydC5zdGFydChldmVudHMpO1xuICAgICAgYXdhaXQgdHJhbnNwb3J0LnNpbXVsYXRlSW5jb21pbmdDb25uZWN0aW9uKFwiaW5jb21pbmctcGVlclwiKTtcblxuICAgICAgZXhwZWN0KG9uUGVlckNvbm5lY3RlZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFwiaW5jb21pbmctcGVlclwiLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgcGVlcklkOiBcImluY29taW5nLXBlZXJcIixcbiAgICAgICAgICBzdGF0ZTogXCJjb25uZWN0ZWRcIixcbiAgICAgICAgICBkaXNjb3ZlcmVkVmlhU2NhbjogZmFsc2UsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZShcIkJMRSBDb25zdGFudHNcIiwgKCkgPT4ge1xuICBpdChcInNob3VsZCBoYXZlIHZhbGlkIHNlcnZpY2UgVVVJRFwiLCAoKSA9PiB7XG4gICAgZXhwZWN0KEJMRV9NRVNIX1NFUlZJQ0VfVVVJRCkudG9NYXRjaChcbiAgICAgIC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzAtOWEtZl17NH0tWzAtOWEtZl17NH0tWzAtOWEtZl17MTJ9JC9pXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoXCJzaG91bGQgaGF2ZSB2YWxpZCBkZWZhdWx0IGNvbmZpZ1wiLCAoKSA9PiB7XG4gICAgZXhwZWN0KERFRkFVTFRfQkxFX0NPTkZJRy5zZXJ2aWNlVXVpZCkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoREVGQVVMVF9CTEVfQ09ORklHLm1heE10dSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIGV4cGVjdChERUZBVUxUX0JMRV9DT05GSUcubWF4Q29ubmVjdGlvbnMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==