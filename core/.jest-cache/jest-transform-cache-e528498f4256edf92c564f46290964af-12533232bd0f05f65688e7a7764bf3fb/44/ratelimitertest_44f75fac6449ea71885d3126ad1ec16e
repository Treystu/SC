346b9f8e17f5f9cfd2485aaa04ebd0bd
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const rate_limiter_js_1 = require("./rate-limiter.js");
describe('RateLimiter', () => {
    let limiter;
    beforeEach(() => {
        limiter = new rate_limiter_js_1.RateLimiter();
    });
    describe('canSendMessage', () => {
        it('should allow messages within per-minute limit', () => {
            const userId = 'user1';
            // Should allow first 60 messages
            for (let i = 0; i < 60; i++) {
                const result = limiter.canSendMessage(userId);
                expect(result.allowed).toBe(true);
            }
        });
        it('should deny messages exceeding per-minute limit', () => {
            const userId = 'user1';
            // Send 60 messages (at limit)
            for (let i = 0; i < 60; i++) {
                limiter.canSendMessage(userId);
            }
            // 61st message should be denied
            const result = limiter.canSendMessage(userId);
            expect(result.allowed).toBe(false);
            expect(result.reason).toContain('60 messages per minute');
        });
        it('should track different users independently', () => {
            const result1 = limiter.canSendMessage('user1');
            const result2 = limiter.canSendMessage('user2');
            expect(result1.allowed).toBe(true);
            expect(result2.allowed).toBe(true);
        });
    });
    describe('canSendFile', () => {
        it('should allow files within limit', () => {
            const userId = 'user1';
            for (let i = 0; i < 100; i++) {
                const result = limiter.canSendFile(userId);
                expect(result.allowed).toBe(true);
            }
        });
        it('should deny files exceeding limit', () => {
            const userId = 'user1';
            // Send 100 files (at limit)
            for (let i = 0; i < 100; i++) {
                limiter.canSendFile(userId);
            }
            // 101st file should be denied
            const result = limiter.canSendFile(userId);
            expect(result.allowed).toBe(false);
            expect(result.reason).toContain('100 files per hour');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvcmF0ZS1saW1pdGVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx1REFBZ0Q7QUFFaEQsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxPQUFvQixDQUFDO0lBRXpCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxPQUFPLEdBQUcsSUFBSSw2QkFBVyxFQUFFLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxHQUFHLEVBQUU7WUFDdkQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDO1lBRXZCLGlDQUFpQztZQUNqQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxHQUFHLEVBQUU7WUFDekQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDO1lBRXZCLDhCQUE4QjtZQUM5QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLE9BQU8sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakMsQ0FBQztZQUVELGdDQUFnQztZQUNoQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUUsR0FBRyxFQUFFO1lBQ3BELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDaEQsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVoRCxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtZQUN6QyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUM7WUFFdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM3QixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMzQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQztZQUV2Qiw0QkFBNEI7WUFDNUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM3QixPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlCLENBQUM7WUFFRCw4QkFBOEI7WUFDOUIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy9yYXRlLWxpbWl0ZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSYXRlTGltaXRlciB9IGZyb20gJy4vcmF0ZS1saW1pdGVyLmpzJztcblxuZGVzY3JpYmUoJ1JhdGVMaW1pdGVyJywgKCkgPT4ge1xuICBsZXQgbGltaXRlcjogUmF0ZUxpbWl0ZXI7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbGltaXRlciA9IG5ldyBSYXRlTGltaXRlcigpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2FuU2VuZE1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBtZXNzYWdlcyB3aXRoaW4gcGVyLW1pbnV0ZSBsaW1pdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyMSc7XG5cbiAgICAgIC8vIFNob3VsZCBhbGxvdyBmaXJzdCA2MCBtZXNzYWdlc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2MDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGxpbWl0ZXIuY2FuU2VuZE1lc3NhZ2UodXNlcklkKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IG1lc3NhZ2VzIGV4Y2VlZGluZyBwZXItbWludXRlIGxpbWl0JywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxJztcblxuICAgICAgLy8gU2VuZCA2MCBtZXNzYWdlcyAoYXQgbGltaXQpXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDYwOyBpKyspIHtcbiAgICAgICAgbGltaXRlci5jYW5TZW5kTWVzc2FnZSh1c2VySWQpO1xuICAgICAgfVxuXG4gICAgICAvLyA2MXN0IG1lc3NhZ2Ugc2hvdWxkIGJlIGRlbmllZFxuICAgICAgY29uc3QgcmVzdWx0ID0gbGltaXRlci5jYW5TZW5kTWVzc2FnZSh1c2VySWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVhc29uKS50b0NvbnRhaW4oJzYwIG1lc3NhZ2VzIHBlciBtaW51dGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdHJhY2sgZGlmZmVyZW50IHVzZXJzIGluZGVwZW5kZW50bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQxID0gbGltaXRlci5jYW5TZW5kTWVzc2FnZSgndXNlcjEnKTtcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBsaW1pdGVyLmNhblNlbmRNZXNzYWdlKCd1c2VyMicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0MS5hbGxvd2VkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdDIuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhblNlbmRGaWxlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWxsb3cgZmlsZXMgd2l0aGluIGxpbWl0JywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXIxJztcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBsaW1pdGVyLmNhblNlbmRGaWxlKHVzZXJJZCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSBmaWxlcyBleGNlZWRpbmcgbGltaXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlcjEnO1xuXG4gICAgICAvLyBTZW5kIDEwMCBmaWxlcyAoYXQgbGltaXQpXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICAgIGxpbWl0ZXIuY2FuU2VuZEZpbGUodXNlcklkKTtcbiAgICAgIH1cblxuICAgICAgLy8gMTAxc3QgZmlsZSBzaG91bGQgYmUgZGVuaWVkXG4gICAgICBjb25zdCByZXN1bHQgPSBsaW1pdGVyLmNhblNlbmRGaWxlKHVzZXJJZCk7XG4gICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWFzb24pLnRvQ29udGFpbignMTAwIGZpbGVzIHBlciBob3VyJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9