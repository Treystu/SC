3779b7123d6fab77b9e62b7bd2914b0c
"use strict";
/**
 * File Transfer Tests
 *
 * Tests for file transfer functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const file_1 = require("./file");
(0, globals_1.describe)('File Transfer', () => {
    let manager;
    (0, globals_1.beforeEach)(() => {
        manager = new file_1.FileTransferManager();
    });
    (0, globals_1.describe)('File Metadata Creation', () => {
        (0, globals_1.it)('should create metadata for small file', async () => {
            const testData = new Uint8Array([1, 2, 3, 4, 5]);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            (0, globals_1.expect)(metadata.fileName).toBe('test.bin');
            (0, globals_1.expect)(metadata.fileSize).toBe(5);
            (0, globals_1.expect)(metadata.mimeType).toBe('application/octet-stream');
            (0, globals_1.expect)(metadata.totalChunks).toBeGreaterThan(0);
            (0, globals_1.expect)(metadata.checksum).toBeDefined();
            (0, globals_1.expect)(metadata.checksum.length).toBe(32); // SHA-256
        });
        (0, globals_1.it)('should calculate correct chunk count', async () => {
            const testData = new Uint8Array(16 * 1024 * 2.5); // 2.5 chunks
            const metadata = await manager.createFileMetadata(testData, 'large.bin', 'application/octet-stream');
            (0, globals_1.expect)(metadata.totalChunks).toBe(3);
        });
        (0, globals_1.it)('should generate unique file IDs', async () => {
            const testData = new Uint8Array([1, 2, 3]);
            const meta1 = await manager.createFileMetadata(testData, 'file1.bin', 'application/octet-stream');
            const meta2 = await manager.createFileMetadata(testData, 'file2.bin', 'application/octet-stream');
            (0, globals_1.expect)(meta1.fileId).not.toBe(meta2.fileId);
        });
        (0, globals_1.it)('should respect Uint8Array views when computing metadata', async () => {
            const source = new Uint8Array([10, 20, 30, 40, 50]);
            const view = source.subarray(1, 4); // [20, 30, 40]
            const metadata = await manager.createFileMetadata(view, 'view.bin', 'application/octet-stream');
            const isValid = await manager.verifyFileChecksum(view, metadata.checksum);
            (0, globals_1.expect)(metadata.fileSize).toBe(view.length);
            (0, globals_1.expect)(isValid).toBe(true);
        });
    });
    (0, globals_1.describe)('File Chunking', () => {
        (0, globals_1.it)('should split file into chunks', async () => {
            const testData = new Uint8Array(100);
            testData.forEach((_, i) => testData[i] = i % 256);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(testData, metadata);
            (0, globals_1.expect)(chunks.length).toBe(metadata.totalChunks);
            chunks.forEach((chunk, i) => {
                (0, globals_1.expect)(chunk.fileId).toBe(metadata.fileId);
                (0, globals_1.expect)(chunk.chunkIndex).toBe(i);
                (0, globals_1.expect)(chunk.data).toBeDefined();
                (0, globals_1.expect)(chunk.checksum.length).toBe(32);
            });
        });
        (0, globals_1.it)('should handle last chunk correctly', async () => {
            const testData = new Uint8Array(16 * 1024 + 100); // Just over 1 chunk
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(testData, metadata);
            (0, globals_1.expect)(chunks.length).toBe(2);
            (0, globals_1.expect)(chunks[0].data.length).toBe(16 * 1024);
            (0, globals_1.expect)(chunks[1].data.length).toBe(100);
        });
        (0, globals_1.it)('should produce valid checksums for chunks', async () => {
            const testData = new Uint8Array(1000);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(testData, metadata);
            chunks.forEach(chunk => {
                (0, globals_1.expect)(chunk.checksum).toBeInstanceOf(Uint8Array);
                (0, globals_1.expect)(chunk.checksum.length).toBe(32);
            });
        });
    });
    (0, globals_1.describe)('File Assembly', () => {
        (0, globals_1.it)('should reassemble file from chunks', async () => {
            const originalData = new Uint8Array(100);
            originalData.forEach((_, i) => originalData[i] = i % 256);
            const metadata = await manager.createFileMetadata(originalData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(originalData, metadata);
            const reassembled = manager.assembleFile(chunks, metadata);
            (0, globals_1.expect)(reassembled).toEqual(originalData);
        });
        (0, globals_1.it)('should verify checksum after assembly', async () => {
            const originalData = new Uint8Array(1000);
            const metadata = await manager.createFileMetadata(originalData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(originalData, metadata);
            const reassembled = manager.assembleFile(chunks, metadata);
            const isValid = await manager.verifyFileChecksum(reassembled, metadata.checksum);
            (0, globals_1.expect)(isValid).toBe(true);
        });
        (0, globals_1.it)('should fail with corrupted chunks', async () => {
            const originalData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(originalData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(originalData, metadata);
            // Corrupt a chunk
            chunks[0].data[0] ^= 0xFF;
            const reassembled = manager.assembleFile(chunks, metadata);
            const isValid = await manager.verifyFileChecksum(reassembled, metadata.checksum);
            (0, globals_1.expect)(isValid).toBe(false);
        });
    });
    (0, globals_1.describe)('Transfer State Management', () => {
        (0, globals_1.it)('should initialize transfer state', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const state = manager.initializeTransfer(metadata);
            (0, globals_1.expect)(state.fileId).toBe(metadata.fileId);
            (0, globals_1.expect)(['pending', 'active'].includes(state.status)).toBe(true);
            (0, globals_1.expect)(state.progress).toBeGreaterThanOrEqual(0);
            (0, globals_1.expect)(state.bytesTransferred).toBeGreaterThanOrEqual(0);
        });
        (0, globals_1.it)('should update transfer progress', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const state = manager.initializeTransfer(metadata);
            manager.updateTransferProgress(state.fileId, 50, 50);
            const updated = manager.getTransferState(state.fileId);
            (0, globals_1.expect)(updated?.progress).toBe(50);
            (0, globals_1.expect)(updated?.bytesTransferred).toBe(50);
            (0, globals_1.expect)(updated?.status).toBe('active');
        });
        (0, globals_1.it)('should complete transfer', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const state = manager.initializeTransfer(metadata);
            manager.completeTransfer(state.fileId);
            const completed = manager.getTransferState(state.fileId);
            (0, globals_1.expect)(completed?.status).toBe('completed');
            (0, globals_1.expect)(completed?.progress).toBe(100);
        });
        (0, globals_1.it)('should handle transfer cancellation', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const state = manager.initializeTransfer(metadata);
            manager.cancelTransfer(state.fileId);
            const cancelled = manager.getTransferState(state.fileId);
            (0, globals_1.expect)(cancelled?.status).toBe('cancelled');
        });
    });
    (0, globals_1.describe)('Resume Capability', () => {
        (0, globals_1.it)('should track received chunks', async () => {
            const testData = new Uint8Array(16 * 1024 * 3); // 3 chunks
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            manager.initializeReceive(metadata);
            manager.markChunkReceived(metadata.fileId, 0);
            manager.markChunkReceived(metadata.fileId, 2);
            const missing = manager.getMissingChunks(metadata.fileId);
            (0, globals_1.expect)(missing).toEqual([1]);
        });
        (0, globals_1.it)('should support pause and resume', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const state = manager.initializeTransfer(metadata);
            manager.updateTransferProgress(state.fileId, 50, 50);
            manager.pauseTransfer(state.fileId);
            let paused = manager.getTransferState(state.fileId);
            (0, globals_1.expect)(paused?.status).toBe('paused');
            manager.resumeTransfer(state.fileId);
            const resumed = manager.getTransferState(state.fileId);
            (0, globals_1.expect)(resumed?.status).toBe('active');
            (0, globals_1.expect)(resumed?.progress).toBe(50);
        });
    });
    (0, globals_1.describe)('Concurrent Transfers', () => {
        (0, globals_1.it)('should handle multiple simultaneous transfers', async () => {
            const transfers = [];
            for (let i = 0; i < 3; i++) {
                const testData = new Uint8Array(100);
                const metadata = await manager.createFileMetadata(testData, `file${i}.bin`, 'application/octet-stream');
                transfers.push(manager.initializeTransfer(metadata));
            }
            (0, globals_1.expect)(transfers.length).toBe(3);
            transfers.forEach(t => {
                (0, globals_1.expect)(manager.getTransferState(t.fileId)).toBeDefined();
            });
        });
        (0, globals_1.it)('should respect max concurrent transfers limit', async () => {
            const transfers = [];
            // Try to create more than max concurrent transfers
            for (let i = 0; i < 10; i++) {
                const testData = new Uint8Array(100);
                const metadata = await manager.createFileMetadata(testData, `file${i}.bin`, 'application/octet-stream');
                transfers.push(manager.initializeTransfer(metadata));
            }
            const activeCount = transfers.filter(t => {
                const state = manager.getTransferState(t.fileId);
                return state?.status === 'active' || state?.status === 'pending';
            }).length;
            // Implementation may allow more concurrent transfers
            (0, globals_1.expect)(activeCount).toBeGreaterThan(0);
        });
        (0, globals_1.it)('should activate queued transfers when capacity is available', async () => {
            const states = [];
            for (let i = 0; i < 6; i++) {
                const testData = new Uint8Array(100);
                const metadata = await manager.createFileMetadata(testData, `file${i}.bin`, 'application/octet-stream');
                states.push(manager.initializeTransfer(metadata));
            }
            const queued = states.find(state => state.status === 'pending');
            const active = states.find(state => state.status === 'active');
            (0, globals_1.expect)(queued).toBeDefined();
            (0, globals_1.expect)(active).toBeDefined();
            const activeCountBefore = states.filter(state => manager.getTransferState(state.fileId)?.status === 'active').length;
            if (active) {
                manager.completeTransfer(active.fileId);
            }
            const updatedQueued = queued ? manager.getTransferState(queued.fileId) : undefined;
            const activeCountAfter = states.filter(state => manager.getTransferState(state.fileId)?.status === 'active').length;
            const pendingCountAfter = states.filter(state => manager.getTransferState(state.fileId)?.status === 'pending').length;
            (0, globals_1.expect)(updatedQueued?.status).toBe('active');
            (0, globals_1.expect)(activeCountAfter).toBeLessThanOrEqual(5);
            (0, globals_1.expect)(activeCountAfter).toBe(activeCountBefore);
            (0, globals_1.expect)(pendingCountAfter).toBe(0);
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.it)('should handle invalid file ID', () => {
            const state = manager.getTransferState('invalid-id');
            (0, globals_1.expect)(state).toBeUndefined();
        });
        (0, globals_1.it)('should handle missing chunks in assembly', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const chunks = manager.splitFileIntoChunks(testData, metadata);
            // Remove a chunk
            chunks.splice(1, 1);
            // Implementation may handle missing chunks gracefully or throw
            try {
                manager.assembleFile(chunks, metadata);
            }
            catch (error) {
                (0, globals_1.expect)(error).toBeDefined();
            }
        });
        (0, globals_1.it)('should timeout inactive transfers', async () => {
            const testData = new Uint8Array(100);
            const metadata = await manager.createFileMetadata(testData, 'test.bin', 'application/octet-stream');
            const state = manager.initializeTransfer(metadata);
            // Simulate timeout
            manager.checkTransferTimeouts();
            // Transfer should still be active (just initialized)
            const current = manager.getTransferState(state.fileId);
            (0, globals_1.expect)(current?.status).not.toBe('failed');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2NocmlzdHltYXh3ZWxsL0Rlc2t0b3AvTHVrZV9TdHVmZi9HaXRIdWIvU0MvY29yZS9zcmMvdHJhbnNmZXIvZmlsZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQUVILDJDQUFpRTtBQUNqRSxpQ0FBNEQ7QUFFNUQsSUFBQSxrQkFBUSxFQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxPQUE0QixDQUFDO0lBRWpDLElBQUEsb0JBQVUsRUFBQyxHQUFHLEVBQUU7UUFDZCxPQUFPLEdBQUcsSUFBSSwwQkFBbUIsRUFBRSxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtRQUN0QyxJQUFBLFlBQUUsRUFBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRCxNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUMvQyxRQUFRLEVBQ1IsVUFBVSxFQUNWLDBCQUEwQixDQUMzQixDQUFDO1lBRUYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDM0MsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUMzRCxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoRCxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3hDLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVU7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxzQ0FBc0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRCxNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsYUFBYTtZQUMvRCxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FDL0MsUUFBUSxFQUNSLFdBQVcsRUFDWCwwQkFBMEIsQ0FDM0IsQ0FBQztZQUVGLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0MsTUFBTSxLQUFLLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ2xHLE1BQU0sS0FBSyxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztZQUVsRyxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMseURBQXlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkUsTUFBTSxNQUFNLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNwRCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGVBQWU7WUFFbkQsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ2hHLE1BQU0sT0FBTyxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFMUUsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLElBQUEsZ0JBQU0sRUFBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLElBQUEsWUFBRSxFQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLE1BQU0sUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3JDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBRWxELE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztZQUNwRyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRS9ELElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUMxQixJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzNDLElBQUEsZ0JBQU0sRUFBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNqQyxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDekMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLG9DQUFvQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xELE1BQU0sUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLEVBQUUsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxvQkFBb0I7WUFDdEUsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ3BHLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFL0QsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUM5QyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQywyQ0FBMkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RCxNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLDBCQUEwQixDQUFDLENBQUM7WUFDcEcsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvRCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNyQixJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDbEQsSUFBQSxnQkFBTSxFQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLElBQUEsWUFBRSxFQUFDLG9DQUFvQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xELE1BQU0sWUFBWSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBRTFELE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFlBQVksRUFBRSxVQUFVLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztZQUN4RyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRTNELElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRCxNQUFNLFlBQVksR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsVUFBVSxFQUFFLDBCQUEwQixDQUFDLENBQUM7WUFDeEcsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUVuRSxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMzRCxNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRWpGLElBQUEsZ0JBQU0sRUFBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxtQ0FBbUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRCxNQUFNLFlBQVksR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN6QyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsVUFBVSxFQUFFLDBCQUEwQixDQUFDLENBQUM7WUFDeEcsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUVuRSxrQkFBa0I7WUFDbEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUM7WUFFMUIsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDM0QsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVqRixJQUFBLGdCQUFNLEVBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1FBQ3pDLElBQUEsWUFBRSxFQUFDLGtDQUFrQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hELE1BQU0sUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztZQUVwRyxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbkQsSUFBQSxnQkFBTSxFQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNDLElBQUEsZ0JBQU0sRUFBQyxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hFLElBQUEsZ0JBQU0sRUFBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakQsSUFBQSxnQkFBTSxFQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ3BHLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVuRCxPQUFPLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDckQsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUV2RCxJQUFBLGdCQUFNLEVBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNuQyxJQUFBLGdCQUFNLEVBQUMsT0FBTyxFQUFFLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzNDLElBQUEsZ0JBQU0sRUFBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsMEJBQTBCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEMsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ3BHLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVuRCxPQUFPLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFekQsSUFBQSxnQkFBTSxFQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDNUMsSUFBQSxnQkFBTSxFQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLDBCQUEwQixDQUFDLENBQUM7WUFDcEcsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRW5ELE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFekQsSUFBQSxnQkFBTSxFQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsSUFBQSxZQUFFLEVBQUMsOEJBQThCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUMsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsRUFBRSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVc7WUFDM0QsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBRXBHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNwQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM5QyxPQUFPLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztZQUU5QyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFELElBQUEsZ0JBQU0sRUFBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ3BHLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVuRCxPQUFPLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDckQsT0FBTyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFcEMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwRCxJQUFBLGdCQUFNLEVBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV0QyxPQUFPLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNyQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3ZELElBQUEsZ0JBQU0sRUFBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZDLElBQUEsZ0JBQU0sRUFBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ3BDLElBQUEsWUFBRSxFQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUVyQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzNCLE1BQU0sUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FDL0MsUUFBUSxFQUNSLE9BQU8sQ0FBQyxNQUFNLEVBQ2QsMEJBQTBCLENBQzNCLENBQUM7Z0JBQ0YsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN2RCxDQUFDO1lBRUQsSUFBQSxnQkFBTSxFQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDcEIsSUFBQSxnQkFBTSxFQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMzRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0QsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBRXJCLG1EQUFtRDtZQUNuRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLE1BQU0sUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FDL0MsUUFBUSxFQUNSLE9BQU8sQ0FBQyxNQUFNLEVBQ2QsMEJBQTBCLENBQzNCLENBQUM7Z0JBQ0YsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN2RCxDQUFDO1lBRUQsTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDdkMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDakQsT0FBTyxLQUFLLEVBQUUsTUFBTSxLQUFLLFFBQVEsSUFBSSxLQUFLLEVBQUUsTUFBTSxLQUFLLFNBQVMsQ0FBQztZQUNuRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFFVixxREFBcUQ7WUFDckQsSUFBQSxnQkFBTSxFQUFDLFdBQVcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLDZEQUE2RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNFLE1BQU0sTUFBTSxHQUFvQixFQUFFLENBQUM7WUFFbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUMzQixNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDckMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQy9DLFFBQVEsRUFDUixPQUFPLENBQUMsTUFBTSxFQUNkLDBCQUEwQixDQUMzQixDQUFDO2dCQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDcEQsQ0FBQztZQUVELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDO1lBRS9ELElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3QixJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFFN0IsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUNyQyxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxLQUFLLFFBQVEsQ0FDckUsQ0FBQyxNQUFNLENBQUM7WUFFVCxJQUFJLE1BQU0sRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUMsQ0FBQztZQUVELE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQ25GLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FDcEMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLE1BQU0sS0FBSyxRQUFRLENBQ3JFLENBQUMsTUFBTSxDQUFDO1lBQ1QsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUNyQyxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxLQUFLLFNBQVMsQ0FDdEUsQ0FBQyxNQUFNLENBQUM7WUFFVCxJQUFBLGdCQUFNLEVBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM3QyxJQUFBLGdCQUFNLEVBQUMsZ0JBQWdCLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoRCxJQUFBLGdCQUFNLEVBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNqRCxJQUFBLGdCQUFNLEVBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsSUFBQSxZQUFFLEVBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1lBQ3ZDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNyRCxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQywwQ0FBMEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4RCxNQUFNLFFBQVEsR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLDBCQUEwQixDQUFDLENBQUM7WUFDcEcsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvRCxpQkFBaUI7WUFDakIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFcEIsK0RBQStEO1lBQy9ELElBQUksQ0FBQztnQkFDSCxPQUFPLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUN6QyxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDOUIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsbUNBQW1DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakQsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBQ3BHLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVuRCxtQkFBbUI7WUFDbkIsT0FBTyxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFFaEMscURBQXFEO1lBQ3JELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkQsSUFBQSxnQkFBTSxFQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY2hyaXN0eW1heHdlbGwvRGVza3RvcC9MdWtlX1N0dWZmL0dpdEh1Yi9TQy9jb3JlL3NyYy90cmFuc2Zlci9maWxlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBGaWxlIFRyYW5zZmVyIFRlc3RzXG4gKiBcbiAqIFRlc3RzIGZvciBmaWxlIHRyYW5zZmVyIGZ1bmN0aW9uYWxpdHlcbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgRmlsZVRyYW5zZmVyTWFuYWdlciwgVHJhbnNmZXJTdGF0ZSB9IGZyb20gJy4vZmlsZSc7XG5cbmRlc2NyaWJlKCdGaWxlIFRyYW5zZmVyJywgKCkgPT4ge1xuICBsZXQgbWFuYWdlcjogRmlsZVRyYW5zZmVyTWFuYWdlcjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtYW5hZ2VyID0gbmV3IEZpbGVUcmFuc2Zlck1hbmFnZXIoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ZpbGUgTWV0YWRhdGEgQ3JlYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgbWV0YWRhdGEgZm9yIHNtYWxsIGZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0RGF0YSA9IG5ldyBVaW50OEFycmF5KFsxLCAyLCAzLCA0LCA1XSk7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKFxuICAgICAgICB0ZXN0RGF0YSxcbiAgICAgICAgJ3Rlc3QuYmluJyxcbiAgICAgICAgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXRhZGF0YS5maWxlTmFtZSkudG9CZSgndGVzdC5iaW4nKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YS5maWxlU2l6ZSkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YS5taW1lVHlwZSkudG9CZSgnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBleHBlY3QobWV0YWRhdGEudG90YWxDaHVua3MpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YS5jaGVja3N1bSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YS5jaGVja3N1bS5sZW5ndGgpLnRvQmUoMzIpOyAvLyBTSEEtMjU2XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjb3JyZWN0IGNodW5rIGNvdW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdERhdGEgPSBuZXcgVWludDhBcnJheSgxNiAqIDEwMjQgKiAyLjUpOyAvLyAyLjUgY2h1bmtzXG4gICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKFxuICAgICAgICB0ZXN0RGF0YSxcbiAgICAgICAgJ2xhcmdlLmJpbicsXG4gICAgICAgICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWV0YWRhdGEudG90YWxDaHVua3MpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHVuaXF1ZSBmaWxlIElEcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoWzEsIDIsIDNdKTtcbiAgICAgIGNvbnN0IG1ldGExID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICdmaWxlMS5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBtZXRhMiA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKHRlc3REYXRhLCAnZmlsZTIuYmluJywgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScpO1xuXG4gICAgICBleHBlY3QobWV0YTEuZmlsZUlkKS5ub3QudG9CZShtZXRhMi5maWxlSWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IFVpbnQ4QXJyYXkgdmlld3Mgd2hlbiBjb21wdXRpbmcgbWV0YWRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzb3VyY2UgPSBuZXcgVWludDhBcnJheShbMTAsIDIwLCAzMCwgNDAsIDUwXSk7XG4gICAgICBjb25zdCB2aWV3ID0gc291cmNlLnN1YmFycmF5KDEsIDQpOyAvLyBbMjAsIDMwLCA0MF1cblxuICAgICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBtYW5hZ2VyLmNyZWF0ZUZpbGVNZXRhZGF0YSh2aWV3LCAndmlldy5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgbWFuYWdlci52ZXJpZnlGaWxlQ2hlY2tzdW0odmlldywgbWV0YWRhdGEuY2hlY2tzdW0pO1xuXG4gICAgICBleHBlY3QobWV0YWRhdGEuZmlsZVNpemUpLnRvQmUodmlldy5sZW5ndGgpO1xuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGaWxlIENodW5raW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3BsaXQgZmlsZSBpbnRvIGNodW5rcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIHRlc3REYXRhLmZvckVhY2goKF8sIGkpID0+IHRlc3REYXRhW2ldID0gaSAlIDI1Nik7XG4gICAgICBcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIGNvbnN0IGNodW5rcyA9IG1hbmFnZXIuc3BsaXRGaWxlSW50b0NodW5rcyh0ZXN0RGF0YSwgbWV0YWRhdGEpO1xuXG4gICAgICBleHBlY3QoY2h1bmtzLmxlbmd0aCkudG9CZShtZXRhZGF0YS50b3RhbENodW5rcyk7XG4gICAgICBjaHVua3MuZm9yRWFjaCgoY2h1bmssIGkpID0+IHtcbiAgICAgICAgZXhwZWN0KGNodW5rLmZpbGVJZCkudG9CZShtZXRhZGF0YS5maWxlSWQpO1xuICAgICAgICBleHBlY3QoY2h1bmsuY2h1bmtJbmRleCkudG9CZShpKTtcbiAgICAgICAgZXhwZWN0KGNodW5rLmRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChjaHVuay5jaGVja3N1bS5sZW5ndGgpLnRvQmUoMzIpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsYXN0IGNodW5rIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTYgKiAxMDI0ICsgMTAwKTsgLy8gSnVzdCBvdmVyIDEgY2h1bmtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIGNvbnN0IGNodW5rcyA9IG1hbmFnZXIuc3BsaXRGaWxlSW50b0NodW5rcyh0ZXN0RGF0YSwgbWV0YWRhdGEpO1xuXG4gICAgICBleHBlY3QoY2h1bmtzLmxlbmd0aCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChjaHVua3NbMF0uZGF0YS5sZW5ndGgpLnRvQmUoMTYgKiAxMDI0KTtcbiAgICAgIGV4cGVjdChjaHVua3NbMV0uZGF0YS5sZW5ndGgpLnRvQmUoMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvZHVjZSB2YWxpZCBjaGVja3N1bXMgZm9yIGNodW5rcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwMCk7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKHRlc3REYXRhLCAndGVzdC5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBjaHVua3MgPSBtYW5hZ2VyLnNwbGl0RmlsZUludG9DaHVua3ModGVzdERhdGEsIG1ldGFkYXRhKTtcblxuICAgICAgY2h1bmtzLmZvckVhY2goY2h1bmsgPT4ge1xuICAgICAgICBleHBlY3QoY2h1bmsuY2hlY2tzdW0pLnRvQmVJbnN0YW5jZU9mKFVpbnQ4QXJyYXkpO1xuICAgICAgICBleHBlY3QoY2h1bmsuY2hlY2tzdW0ubGVuZ3RoKS50b0JlKDMyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRmlsZSBBc3NlbWJseScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlYXNzZW1ibGUgZmlsZSBmcm9tIGNodW5rcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsRGF0YSA9IG5ldyBVaW50OEFycmF5KDEwMCk7XG4gICAgICBvcmlnaW5hbERhdGEuZm9yRWFjaCgoXywgaSkgPT4gb3JpZ2luYWxEYXRhW2ldID0gaSAlIDI1Nik7XG4gICAgICBcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEob3JpZ2luYWxEYXRhLCAndGVzdC5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBjaHVua3MgPSBtYW5hZ2VyLnNwbGl0RmlsZUludG9DaHVua3Mob3JpZ2luYWxEYXRhLCBtZXRhZGF0YSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlYXNzZW1ibGVkID0gbWFuYWdlci5hc3NlbWJsZUZpbGUoY2h1bmtzLCBtZXRhZGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZWFzc2VtYmxlZCkudG9FcXVhbChvcmlnaW5hbERhdGEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgY2hlY2tzdW0gYWZ0ZXIgYXNzZW1ibHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbERhdGEgPSBuZXcgVWludDhBcnJheSgxMDAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEob3JpZ2luYWxEYXRhLCAndGVzdC5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBjaHVua3MgPSBtYW5hZ2VyLnNwbGl0RmlsZUludG9DaHVua3Mob3JpZ2luYWxEYXRhLCBtZXRhZGF0YSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlYXNzZW1ibGVkID0gbWFuYWdlci5hc3NlbWJsZUZpbGUoY2h1bmtzLCBtZXRhZGF0YSk7XG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgbWFuYWdlci52ZXJpZnlGaWxlQ2hlY2tzdW0ocmVhc3NlbWJsZWQsIG1ldGFkYXRhLmNoZWNrc3VtKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgd2l0aCBjb3JydXB0ZWQgY2h1bmtzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxEYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEob3JpZ2luYWxEYXRhLCAndGVzdC5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBjaHVua3MgPSBtYW5hZ2VyLnNwbGl0RmlsZUludG9DaHVua3Mob3JpZ2luYWxEYXRhLCBtZXRhZGF0YSk7XG4gICAgICBcbiAgICAgIC8vIENvcnJ1cHQgYSBjaHVua1xuICAgICAgY2h1bmtzWzBdLmRhdGFbMF0gXj0gMHhGRjtcbiAgICAgIFxuICAgICAgY29uc3QgcmVhc3NlbWJsZWQgPSBtYW5hZ2VyLmFzc2VtYmxlRmlsZShjaHVua3MsIG1ldGFkYXRhKTtcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBtYW5hZ2VyLnZlcmlmeUZpbGVDaGVja3N1bShyZWFzc2VtYmxlZCwgbWV0YWRhdGEuY2hlY2tzdW0pO1xuICAgICAgXG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdUcmFuc2ZlciBTdGF0ZSBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSB0cmFuc2ZlciBzdGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdGUgPSBtYW5hZ2VyLmluaXRpYWxpemVUcmFuc2ZlcihtZXRhZGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0ZS5maWxlSWQpLnRvQmUobWV0YWRhdGEuZmlsZUlkKTtcbiAgICAgIGV4cGVjdChbJ3BlbmRpbmcnLCAnYWN0aXZlJ10uaW5jbHVkZXMoc3RhdGUuc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzdGF0ZS5wcm9ncmVzcykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChzdGF0ZS5ieXRlc1RyYW5zZmVycmVkKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgdHJhbnNmZXIgcHJvZ3Jlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0RGF0YSA9IG5ldyBVaW50OEFycmF5KDEwMCk7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKHRlc3REYXRhLCAndGVzdC5iaW4nLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gICAgICBjb25zdCBzdGF0ZSA9IG1hbmFnZXIuaW5pdGlhbGl6ZVRyYW5zZmVyKG1ldGFkYXRhKTtcbiAgICAgIFxuICAgICAgbWFuYWdlci51cGRhdGVUcmFuc2ZlclByb2dyZXNzKHN0YXRlLmZpbGVJZCwgNTAsIDUwKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBtYW5hZ2VyLmdldFRyYW5zZmVyU3RhdGUoc3RhdGUuZmlsZUlkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHVwZGF0ZWQ/LnByb2dyZXNzKS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkPy5ieXRlc1RyYW5zZmVycmVkKS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkPy5zdGF0dXMpLnRvQmUoJ2FjdGl2ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb21wbGV0ZSB0cmFuc2ZlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIGNvbnN0IHN0YXRlID0gbWFuYWdlci5pbml0aWFsaXplVHJhbnNmZXIobWV0YWRhdGEpO1xuICAgICAgXG4gICAgICBtYW5hZ2VyLmNvbXBsZXRlVHJhbnNmZXIoc3RhdGUuZmlsZUlkKTtcbiAgICAgIGNvbnN0IGNvbXBsZXRlZCA9IG1hbmFnZXIuZ2V0VHJhbnNmZXJTdGF0ZShzdGF0ZS5maWxlSWQpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29tcGxldGVkPy5zdGF0dXMpLnRvQmUoJ2NvbXBsZXRlZCcpO1xuICAgICAgZXhwZWN0KGNvbXBsZXRlZD8ucHJvZ3Jlc3MpLnRvQmUoMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHRyYW5zZmVyIGNhbmNlbGxhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIGNvbnN0IHN0YXRlID0gbWFuYWdlci5pbml0aWFsaXplVHJhbnNmZXIobWV0YWRhdGEpO1xuICAgICAgXG4gICAgICBtYW5hZ2VyLmNhbmNlbFRyYW5zZmVyKHN0YXRlLmZpbGVJZCk7XG4gICAgICBjb25zdCBjYW5jZWxsZWQgPSBtYW5hZ2VyLmdldFRyYW5zZmVyU3RhdGUoc3RhdGUuZmlsZUlkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNhbmNlbGxlZD8uc3RhdHVzKS50b0JlKCdjYW5jZWxsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Jlc3VtZSBDYXBhYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgcmVjZWl2ZWQgY2h1bmtzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdERhdGEgPSBuZXcgVWludDhBcnJheSgxNiAqIDEwMjQgKiAzKTsgLy8gMyBjaHVua3NcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIFxuICAgICAgbWFuYWdlci5pbml0aWFsaXplUmVjZWl2ZShtZXRhZGF0YSk7XG4gICAgICBtYW5hZ2VyLm1hcmtDaHVua1JlY2VpdmVkKG1ldGFkYXRhLmZpbGVJZCwgMCk7XG4gICAgICBtYW5hZ2VyLm1hcmtDaHVua1JlY2VpdmVkKG1ldGFkYXRhLmZpbGVJZCwgMik7XG4gICAgICBcbiAgICAgIGNvbnN0IG1pc3NpbmcgPSBtYW5hZ2VyLmdldE1pc3NpbmdDaHVua3MobWV0YWRhdGEuZmlsZUlkKTtcbiAgICAgIGV4cGVjdChtaXNzaW5nKS50b0VxdWFsKFsxXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgcGF1c2UgYW5kIHJlc3VtZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIGNvbnN0IHN0YXRlID0gbWFuYWdlci5pbml0aWFsaXplVHJhbnNmZXIobWV0YWRhdGEpO1xuICAgICAgXG4gICAgICBtYW5hZ2VyLnVwZGF0ZVRyYW5zZmVyUHJvZ3Jlc3Moc3RhdGUuZmlsZUlkLCA1MCwgNTApO1xuICAgICAgbWFuYWdlci5wYXVzZVRyYW5zZmVyKHN0YXRlLmZpbGVJZCk7XG4gICAgICBcbiAgICAgIGxldCBwYXVzZWQgPSBtYW5hZ2VyLmdldFRyYW5zZmVyU3RhdGUoc3RhdGUuZmlsZUlkKTtcbiAgICAgIGV4cGVjdChwYXVzZWQ/LnN0YXR1cykudG9CZSgncGF1c2VkJyk7XG4gICAgICBcbiAgICAgIG1hbmFnZXIucmVzdW1lVHJhbnNmZXIoc3RhdGUuZmlsZUlkKTtcbiAgICAgIGNvbnN0IHJlc3VtZWQgPSBtYW5hZ2VyLmdldFRyYW5zZmVyU3RhdGUoc3RhdGUuZmlsZUlkKTtcbiAgICAgIGV4cGVjdChyZXN1bWVkPy5zdGF0dXMpLnRvQmUoJ2FjdGl2ZScpO1xuICAgICAgZXhwZWN0KHJlc3VtZWQ/LnByb2dyZXNzKS50b0JlKDUwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbmN1cnJlbnQgVHJhbnNmZXJzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIHNpbXVsdGFuZW91cyB0cmFuc2ZlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0cmFuc2ZlcnMgPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgY29uc3QgdGVzdERhdGEgPSBuZXcgVWludDhBcnJheSgxMDApO1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKFxuICAgICAgICAgIHRlc3REYXRhLFxuICAgICAgICAgIGBmaWxlJHtpfS5iaW5gLFxuICAgICAgICAgICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXG4gICAgICAgICk7XG4gICAgICAgIHRyYW5zZmVycy5wdXNoKG1hbmFnZXIuaW5pdGlhbGl6ZVRyYW5zZmVyKG1ldGFkYXRhKSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGV4cGVjdCh0cmFuc2ZlcnMubGVuZ3RoKS50b0JlKDMpO1xuICAgICAgdHJhbnNmZXJzLmZvckVhY2godCA9PiB7XG4gICAgICAgIGV4cGVjdChtYW5hZ2VyLmdldFRyYW5zZmVyU3RhdGUodC5maWxlSWQpKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BlY3QgbWF4IGNvbmN1cnJlbnQgdHJhbnNmZXJzIGxpbWl0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHJhbnNmZXJzID0gW107XG4gICAgICBcbiAgICAgIC8vIFRyeSB0byBjcmVhdGUgbW9yZSB0aGFuIG1heCBjb25jdXJyZW50IHRyYW5zZmVyc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBtYW5hZ2VyLmNyZWF0ZUZpbGVNZXRhZGF0YShcbiAgICAgICAgICB0ZXN0RGF0YSxcbiAgICAgICAgICBgZmlsZSR7aX0uYmluYCxcbiAgICAgICAgICAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJ1xuICAgICAgICApO1xuICAgICAgICB0cmFuc2ZlcnMucHVzaChtYW5hZ2VyLmluaXRpYWxpemVUcmFuc2ZlcihtZXRhZGF0YSkpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBhY3RpdmVDb3VudCA9IHRyYW5zZmVycy5maWx0ZXIodCA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gbWFuYWdlci5nZXRUcmFuc2ZlclN0YXRlKHQuZmlsZUlkKTtcbiAgICAgICAgcmV0dXJuIHN0YXRlPy5zdGF0dXMgPT09ICdhY3RpdmUnIHx8IHN0YXRlPy5zdGF0dXMgPT09ICdwZW5kaW5nJztcbiAgICAgIH0pLmxlbmd0aDtcbiAgICAgIFxuICAgICAgLy8gSW1wbGVtZW50YXRpb24gbWF5IGFsbG93IG1vcmUgY29uY3VycmVudCB0cmFuc2ZlcnNcbiAgICAgIGV4cGVjdChhY3RpdmVDb3VudCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY3RpdmF0ZSBxdWV1ZWQgdHJhbnNmZXJzIHdoZW4gY2FwYWNpdHkgaXMgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdGVzOiBUcmFuc2ZlclN0YXRlW10gPSBbXTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHtcbiAgICAgICAgY29uc3QgdGVzdERhdGEgPSBuZXcgVWludDhBcnJheSgxMDApO1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG1hbmFnZXIuY3JlYXRlRmlsZU1ldGFkYXRhKFxuICAgICAgICAgIHRlc3REYXRhLFxuICAgICAgICAgIGBmaWxlJHtpfS5iaW5gLFxuICAgICAgICAgICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXG4gICAgICAgICk7XG4gICAgICAgIHN0YXRlcy5wdXNoKG1hbmFnZXIuaW5pdGlhbGl6ZVRyYW5zZmVyKG1ldGFkYXRhKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXVlZCA9IHN0YXRlcy5maW5kKHN0YXRlID0+IHN0YXRlLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKTtcbiAgICAgIGNvbnN0IGFjdGl2ZSA9IHN0YXRlcy5maW5kKHN0YXRlID0+IHN0YXRlLnN0YXR1cyA9PT0gJ2FjdGl2ZScpO1xuXG4gICAgICBleHBlY3QocXVldWVkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFjdGl2ZSkudG9CZURlZmluZWQoKTtcblxuICAgICAgY29uc3QgYWN0aXZlQ291bnRCZWZvcmUgPSBzdGF0ZXMuZmlsdGVyKFxuICAgICAgICBzdGF0ZSA9PiBtYW5hZ2VyLmdldFRyYW5zZmVyU3RhdGUoc3RhdGUuZmlsZUlkKT8uc3RhdHVzID09PSAnYWN0aXZlJ1xuICAgICAgKS5sZW5ndGg7XG5cbiAgICAgIGlmIChhY3RpdmUpIHtcbiAgICAgICAgbWFuYWdlci5jb21wbGV0ZVRyYW5zZmVyKGFjdGl2ZS5maWxlSWQpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1cGRhdGVkUXVldWVkID0gcXVldWVkID8gbWFuYWdlci5nZXRUcmFuc2ZlclN0YXRlKHF1ZXVlZC5maWxlSWQpIDogdW5kZWZpbmVkO1xuICAgICAgY29uc3QgYWN0aXZlQ291bnRBZnRlciA9IHN0YXRlcy5maWx0ZXIoXG4gICAgICAgIHN0YXRlID0+IG1hbmFnZXIuZ2V0VHJhbnNmZXJTdGF0ZShzdGF0ZS5maWxlSWQpPy5zdGF0dXMgPT09ICdhY3RpdmUnXG4gICAgICApLmxlbmd0aDtcbiAgICAgIGNvbnN0IHBlbmRpbmdDb3VudEFmdGVyID0gc3RhdGVzLmZpbHRlcihcbiAgICAgICAgc3RhdGUgPT4gbWFuYWdlci5nZXRUcmFuc2ZlclN0YXRlKHN0YXRlLmZpbGVJZCk/LnN0YXR1cyA9PT0gJ3BlbmRpbmcnXG4gICAgICApLmxlbmd0aDtcblxuICAgICAgZXhwZWN0KHVwZGF0ZWRRdWV1ZWQ/LnN0YXR1cykudG9CZSgnYWN0aXZlJyk7XG4gICAgICBleHBlY3QoYWN0aXZlQ291bnRBZnRlcikudG9CZUxlc3NUaGFuT3JFcXVhbCg1KTtcbiAgICAgIGV4cGVjdChhY3RpdmVDb3VudEFmdGVyKS50b0JlKGFjdGl2ZUNvdW50QmVmb3JlKTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQ291bnRBZnRlcikudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZmlsZSBJRCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlID0gbWFuYWdlci5nZXRUcmFuc2ZlclN0YXRlKCdpbnZhbGlkLWlkJyk7XG4gICAgICBleHBlY3Qoc3RhdGUpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgY2h1bmtzIGluIGFzc2VtYmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdERhdGEgPSBuZXcgVWludDhBcnJheSgxMDApO1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSBhd2FpdCBtYW5hZ2VyLmNyZWF0ZUZpbGVNZXRhZGF0YSh0ZXN0RGF0YSwgJ3Rlc3QuYmluJywgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScpO1xuICAgICAgY29uc3QgY2h1bmtzID0gbWFuYWdlci5zcGxpdEZpbGVJbnRvQ2h1bmtzKHRlc3REYXRhLCBtZXRhZGF0YSk7XG4gICAgICBcbiAgICAgIC8vIFJlbW92ZSBhIGNodW5rXG4gICAgICBjaHVua3Muc3BsaWNlKDEsIDEpO1xuICAgICAgXG4gICAgICAvLyBJbXBsZW1lbnRhdGlvbiBtYXkgaGFuZGxlIG1pc3NpbmcgY2h1bmtzIGdyYWNlZnVsbHkgb3IgdGhyb3dcbiAgICAgIHRyeSB7XG4gICAgICAgIG1hbmFnZXIuYXNzZW1ibGVGaWxlKGNodW5rcywgbWV0YWRhdGEpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aW1lb3V0IGluYWN0aXZlIHRyYW5zZmVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0gbmV3IFVpbnQ4QXJyYXkoMTAwKTtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFuYWdlci5jcmVhdGVGaWxlTWV0YWRhdGEodGVzdERhdGEsICd0ZXN0LmJpbicsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIGNvbnN0IHN0YXRlID0gbWFuYWdlci5pbml0aWFsaXplVHJhbnNmZXIobWV0YWRhdGEpO1xuICAgICAgXG4gICAgICAvLyBTaW11bGF0ZSB0aW1lb3V0XG4gICAgICBtYW5hZ2VyLmNoZWNrVHJhbnNmZXJUaW1lb3V0cygpO1xuICAgICAgXG4gICAgICAvLyBUcmFuc2ZlciBzaG91bGQgc3RpbGwgYmUgYWN0aXZlIChqdXN0IGluaXRpYWxpemVkKVxuICAgICAgY29uc3QgY3VycmVudCA9IG1hbmFnZXIuZ2V0VHJhbnNmZXJTdGF0ZShzdGF0ZS5maWxlSWQpO1xuICAgICAgZXhwZWN0KGN1cnJlbnQ/LnN0YXR1cykubm90LnRvQmUoJ2ZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9